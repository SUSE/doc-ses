<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Ceph 管理节点 HA 设置</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>yes</dm:translation>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  <emphasis>Ceph 管理节点</emphasis>是一种其上运行有 Salt Master 服务的 Ceph 集群节点。管理节点是 Ceph 集群的中心点，因为它通过查询其他群集节点的 Salt Minion 服务并提供指示，来管理其余的集群节点。它通常也会包含其他服务，例如 openATTIC Web UI，由 <emphasis>Prometheus</emphasis> 监视工具包对 <emphasis>Grafana</emphasis> 仪表盘提供支持。
 </para>
 <para>
  如果 Ceph 管理节点发生故障，通常需要为该节点提供新的工作硬件，并通过最近的备份恢复完整的集群配置堆栈。此类方法很费时，并会导致集群故障。
 </para>
 <para>
  为防止出现由于管理节点故障导致的 Ceph 集群性能下降，建议您为 Ceph 管理节点使用高可用性 (HA) 集群。
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Ceph 管理节点的 HA 集群概述</title>

  <para>
   HA 集群的原理是当其中一个集群节点发生故障时，由另一个节点自动接管其角色，包括虚拟化 Ceph 管理节点。使用此方法时，其他 Ceph 集群节点不会注意到 Ceph 管理节点发生故障。
  </para>

  <para>
   Ceph 管理节点的最低 HA 解决方案需要以下硬件：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     能够运行具有高可用性扩展的 SUSE Linux Enterprise 以及虚拟化 Ceph 管理节点的两台裸机服务器。
    </para>
   </listitem>
   <listitem>
    <para>
     两个或多个冗余网络通讯路径，例如通过网络设备绑定。
    </para>
   </listitem>
   <listitem>
    <para>
     用于托管 Ceph 管理节点虚拟机的磁盘映像的共享存储。需要可通过这两台服务器访问的共享存储。例如，该共享存储可以是 NFS 导出项、Samba 共享或 iSCSI 目标。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   有关集群要求的更多详细信息，请访问 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html#sec_ha_inst_quick_req"/>。
  </para>

  <figure>
   <title>Ceph 管理节点的双节点 HA 集群</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>构建用于 Ceph 管理节点的 HA 集群</title>

  <para>
   以下过程汇总了为虚拟化 Ceph 管理节点而构建 HA 集群的几个最重要步骤。有关详细信息，请参见指定链接。
  </para>

  <procedure>
   <step>
    <para>
     设置一个具有共享存储的基本双节点 HA 集群，如 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在两个集群节点上，安装运行 KVM 超级管理程序和 <systemitem class="library">libvirt</systemitem> 工具包所需的所有程序包，如 <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_vt_installation_kvm.html"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在第一个集群节点上，使用 <systemitem class="library">libvirt</systemitem> 创建新的 KVM 虚拟机 (VM)，如 <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_libvirt_inst_vmm.html"/> 中所述。使用预配置的共享存储来存储 VM 的磁盘映像。
    </para>
   </step>
   <step>
    <para>
     VM 设置完成后，将其配置导出到共享存储上的 XML 文件。使用以下语法：
    </para>
<screen>
<prompt>root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     为 Ceph 管理节点 VM 创建资源。有关创建 HA 资源的一般信息，请参见 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_conf_hawk2.html"/>。<link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/> 中提供了有关为 KVM 虚拟机创建资源的详细信息。
    </para>
   </step>
   <step>
    <para>
     在新创建的 VM guest 中，部署 Ceph 管理节点，包括您需要在其上使用的其他服务。遵循<xref linkend="ceph-install-stack"/>中的相关步骤。同时，在非 HA 集群服务器上部署其余 Ceph 集群节点。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
