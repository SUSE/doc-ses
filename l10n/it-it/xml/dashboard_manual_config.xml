<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_manual_config.xml" version="5.0" xml:id="dashboard-initial-configuration">
 <title>Configurazione manuale</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sì</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Questa sezione fornisce informazioni avanzate per gli utenti che preferiscono configurare manualmente le impostazioni del dashboard nella riga di comando.
 </para>
 <sect1 xml:id="dashboard-ssl">
  <title>Configurazione del supporto TLS/SSL</title>

  <para>
   Per default, tutte le connessioni HTTP al dashboard sono protette da TLS/SSL. Per la connessione sicura è necessario un certificato SSL. È possibile utilizzare un certificato firmato da se stessi o generarne uno e farlo firmare da un'autorità di certificazione (CA) nota.
  </para>

  <tip>
   <title>disabilitazione di SSL</title>
   <para>
    In alcune situazioni, potrebbe essere opportuno disabilitare il supporto SSL. Ad esempio, se il dashboard è in esecuzione dietro un proxy che non supporta SSL.
   </para>
   <para>
    Prestare attenzione quando si disabilita SSL poiché <emphasis role="bold">i nomi utente e le password</emphasis> verranno inviati al dashboard <emphasis role="bold">senza cifratura</emphasis>.
   </para>
   <para>
    Per disabilitare SSL eseguire:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/ssl false
</screen>
  </tip>

  <tip>
   <title>riavvio dei processi del Ceph Manager</title>
   <para>
    In seguito alla modifica del certificato e della chiave SSL, è necessario riavviare manualmente i processi di Ceph Manager. Per farlo, eseguire
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr fail <replaceable>ACTIVE-MANAGER-NAME</replaceable></screen>
   <para>
    o disabilitare e riabilitare il modulo del dashboard (questa azione comporta inoltre la rigenerazione del manager):
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard
<prompt>cephuser@adm &gt; </prompt>ceph mgr module enable dashboard
</screen>
  </tip>

  <sect2 xml:id="self-sign-certificates">
   <title>Creazione di certificati autofirmati</title>
   <para>
    La procedura di creazione di un certificato firmato da se stessi per la comunicazione sicura è semplice. In questo modo è possibile rendere operativo il dashboard più rapidamente.
   </para>
   <note>
    <title>complain del browser Web</title>
    <para>
     La maggior parte dei browser Web creerà un complain relativo al certificato firmato da se stessi e richiederà una conferma esplicita prima di stabilire una connessione sicura al dashboard.
    </para>
   </note>
   <para>
    Per generare e installare un certificato firmato da se stessi, utilizzare il seguente comando integrato:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard create-self-signed-cert
</screen>
  </sect2>

  <sect2 xml:id="cert-sign-CA">
   <title>Utilizzo dei certificati firmati dall'autorità di certificazione</title>
   <para>
    Per proteggere correttamente la connessione al dashboard ed eliminare i complain del browser Web per i certificati firmati da se stessi, si consiglia di utilizzare un certificato firmato da una CA.
   </para>
   <para>
    È possibile generare una coppia di chiavi di certificato con un comando simile al seguente:
   </para>
<screen>
<prompt role="root">root # </prompt>openssl req -new -nodes -x509 \
  -subj "/O=IT/CN=ceph-mgr-dashboard" -days 3650 \
  -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</screen>
   <para>
    Il comando riportato sopra consente di generare i file <filename>dashboard.key</filename> e <filename>dashboard.crt</filename>. Dopo aver ottenuto il file <filename>dashboard.crt</filename> firmato dalla CA, abilitarlo per tutte le istanze di Ceph Manager eseguendo i comandi seguenti:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/key -i dashboard.key
</screen>
   <tip>
    <title>certificati diversi per ogni istanza del Manager</title>
    <para>
     Se sono richiesti certificati diversi per ogni istanza di Ceph Manager, modificare i comandi e includere il nome dell'istanza come segue. Sostituire <replaceable>NAME</replaceable> con il nome dell'istanza di Ceph Manager (in genere il nome host correlato):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/key -i dashboard.key
</screen>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-hostname-port">
  <title>Modifica del nome host e del numero di porta</title>

  <para>
   Il Ceph Dashboard è associato a un indirizzo TCP/IP e a una porta TCP specifici. Per default, il Ceph Manager attualmente attivo che ospita il dashboard è associato alla porta TCP 8443 (o alla porta 8080 se SSL è disabilitato).
  </para>

  <note>
   <para>
    Se sugli host che eseguono Ceph Manager (e di conseguenza il Ceph Dashboard) è abilitato un firewall, potrebbe essere necessario modificare la configurazione per abilitare l'accesso a queste porte. Per ulteriori informazioni sulle impostazioni del firewall per Ceph, vedere <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Per default, il Ceph Dashboard è associato a "::", corrispondente a tutti gli indirizzi IPv4 e IPv6 disponibili. È possibile modificare l'indirizzo IP e il numero di porta dell'applicazione Web per fare in modo che vengano applicati a tutte le istanze di Ceph Manager utilizzando i comandi seguenti:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>

  <tip>
   <title>configurazione delle istanze di Ceph Manager separatamente</title>
   <para>
    Dal momento che ogni daemon <systemitem class="daemon">ceph-mgr</systemitem> ospita la propria istanza del dashboard, potrebbe essere necessario configurare separatamente tali istanze. Modificare l'indirizzo IP e il numero di porta di un'istanza del Manager specifica utilizzando i comandi seguenti (sostituire <replaceable>NAME</replaceable> con l'ID dell'istanza <systemitem class="daemon">ceph-mgr</systemitem>):
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>
  </tip>

  <tip>
   <title>elenco degli endpoint configurati</title>
   <para>
    Il comando <command>ceph mgr services</command> consente di visualizzare tutti gli endpoint attualmente configurati. Cercare la chiave <literal>dashboard</literal> per ottenere l'URL per l'accesso al dashboard.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-username-password">
  <title>Regolazione dei nomi utente e delle password</title>

  <para>
   Se non si desidera utilizzare l'account amministratore di default, creare un account utente diverso e associarlo almeno a un ruolo. Viene fornito un set di ruoli di sistema predefiniti che è possibile utilizzare. Per ulteriori informazioni, fare riferimento a <xref linkend="dashboard-user-roles"/>.
  </para>

  <para>
   Per creare un utente con privilegi di amministratore, utilizzare il comando seguente:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard ac-user-create <replaceable>USER_NAME</replaceable> <replaceable>PASSWORD</replaceable> administrator
</screen>
 </sect1>
 <sect1 xml:id="dashboard-ogw-enabling">
  <title>Abilitazione del front-end di gestione di Object Gateway</title>

  <para>
   Per utilizzare la funzionalità di gestione di Object Gateway del dashboard, è necessario immettere le credenziali di login di un utente con il flag <option>system</option> abilitato:
  </para>

  <procedure>
   <step>
    <para>
     Se non si dispone di un utente con il flag <option>system</option>, crearne uno:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user create --uid=<replaceable>USER_ID</replaceable> --display-name=<replaceable>DISPLAY_NAME</replaceable> --system
</screen>
    <para>
     Annotare le chiavi <replaceable>access_key</replaceable> e <replaceable>secret_key</replaceable> nell'output del comando.
    </para>
   </step>
   <step>
    <para>
     È possibile inoltre ottenere le credenziali di un utente esistente utilizzando il comando <command>radosgw-admin</command>:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user info --uid=<replaceable>USER_ID</replaceable>
</screen>
   </step>
   <step>
    <para>
     Immettere le credenziali ricevute sul dashboard:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-access-key <replaceable>ACCESS_KEY</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-secret-key <replaceable>SECRET_KEY</replaceable>
</screen>
   </step>
  </procedure>

  <note>
   <para>
    Per default, il firewall è abilitato in SUSE Linux Enterprise Server 15 SP2. Per ulteriori informazioni sulla configurazione del firewall, vedere <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Vi sono diversi aspetti da considerare:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Il nome host e il numero di porta di Object Gateway vengono determinati automaticamente.
    </para>
   </listitem>
   <listitem>
    <para>
     Se sono utilizzate più zone, l'host all'interno del gruppo di zone master e della zona master verrà determinato automaticamente. Queste impostazioni sono sufficienti per la maggior parte delle configurazioni, ma in alcuni casi è consigliabile impostare manualmente il nome host e la porta:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-host <replaceable>HOST</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-port <replaceable>PORT</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Potrebbero essere necessarie queste impostazioni aggiuntive:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-scheme <replaceable>SCHEME</replaceable>  # http or https
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-admin-resource <replaceable>ADMIN_RESOURCE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-user-id <replaceable>USER_ID</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Se si utilizza un certificato firmato da se stessi (<xref linkend="dashboard-ssl"/>) nella configurazione Object Gateway, disabilitare la verifica del certificato nel dashboard per evitare connessioni rifiutate a causa di certificati firmati da una CA sconosciuta o non corrispondenti al nome host:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-ssl-verify False
</screen>
   </listitem>
   <listitem>
    <para>
     Se Object Gateway impiega troppo tempo per elaborare le richieste e si verificano timeout sul dashboard, è possibile modificare il valore di timeout (impostato per default su 45 secondi):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rest-requests-timeout <replaceable>SECONDS</replaceable>
</screen>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="dashboard-iscsi-management">
  <title>Abilitazione della gestione iSCSI</title>

  <para>
   Il Ceph Dashboard gestisce le destinazioni iSCSI tramite l'API REST fornita dal servizio <systemitem class="service">rbd-target-api</systemitem> di Ceph iSCSI Gateway. Assicurarsi che sia installata e abilitata sugli iSCSI Gateway.
  </para>

  <note>
   <para>
    La funzionalità di gestione di iSCSI del Ceph Dashboard dipende dalla versione 3 più recente del progetto <literal>ceph-iscsi</literal>. Assicurarsi che il sistema operativo fornisca la versione corretta, altrimenti il Ceph Dashboard non abiliterà le funzioni di gestione.
   </para>
  </note>

  <para>
   Se l'API REST <literal>ceph-iscsi</literal> è configurata in modalità HTTPS e utilizza un certificato autofirmato, configurare il dashboard in modo che eviti la verifica del certificato SSL durante l'accesso all'API ceph-iscsi.
  </para>

  <para>
   Disabilitare la verifica SSL dell'API:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard set-iscsi-api-ssl-verification false</screen>

  <para>
   Definire i gateway iSCSI disponibili:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-list
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-add <replaceable>scheme</replaceable>://<replaceable>username</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>[:port]
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-rm <replaceable>gateway_name</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="dashboard-sso">
  <title>Abilitazione del Single Sign-On (SSO)</title>

  <para>
   <emphasis>Single Sign-On</emphasis> (SSO) è un metodo di controllo dell'accesso che consente agli utenti di eseguire contemporaneamente il login su più applicazioni utilizzando un solo ID e una sola password.
  </para>

  <para>
   Il Ceph Dashboard supporta l'autenticazione esterna degli utenti tramite il protocollo SAML 2.0. Dal momento che l'<emphasis>autorizzazione</emphasis> viene comunque eseguita dal dashboard, è necessario innanzitutto creare gli account utente e associarli ai ruoli desiderati. Tuttavia, il processo di <emphasis>autenticazione</emphasis> può essere eseguito da un <emphasis>provider di identità</emphasis> (IdP) esistente.
  </para>

  <para>
   Per configurare Single Sign-On, utilizzare il comando seguente:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso setup saml2 <replaceable>CEPH_DASHBOARD_BASE_URL</replaceable> \
 <replaceable>IDP_METADATA</replaceable> <replaceable>IDP_USERNAME_ATTRIBUTE</replaceable> \
 <replaceable>IDP_ENTITY_ID</replaceable> <replaceable>SP_X_509_CERT</replaceable> \
 <replaceable>SP_PRIVATE_KEY</replaceable>
</screen>

  <para>
   Parametri:
  </para>

  <variablelist>
   <varlistentry>
    <term><replaceable>CEPH_DASHBOARD_BASE_URL</replaceable></term>
    <listitem>
     <para>
      URL di base da cui è accessibile il Ceph Dashboard (ad esempio "https://cephdashboard.local").
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_METADATA</replaceable></term>
    <listitem>
     <para>
      URL, percorso del file o contenuto del file XML dei metadati dell'IdP (ad esempio "https://myidp/metadata").
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_USERNAME_ATTRIBUTE</replaceable></term>
    <listitem>
     <para>
      Opzionale. Attributo che verrà utilizzato per ottenere il nome utente dalla risposta di autenticazione. L'impostazione di default è "uid".
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_ENTITY_ID</replaceable></term>
    <listitem>
     <para>
      Opzionale. Utilizzare quando è presente più di un'entità ID sui metadati dell'IdP.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>SP_X_509_CERT</replaceable> / <replaceable>SP_PRIVATE_KEY</replaceable></term>
    <listitem>
     <para>
      Opzionale. Percorso del file o contenuto del certificato che verrà utilizzato dal Ceph Dashboard (provider di servizi) per l'accesso e la cifratura.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>richieste SAML</title>
   <para>
    Il valore dell'autorità di certificazione delle richieste SAML seguirà questo modello:
   </para>
<screen>
<replaceable>CEPH_DASHBOARD_BASE_URL</replaceable>/auth/saml2/metadata
</screen>
  </note>

  <para>
   Per visualizzare la configurazione SAML 2.0 corrente, eseguire:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso show saml2
</screen>

  <para>
   Per disabilitare Single Sign-On, eseguire:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso disable
</screen>

  <para>
   Per verificare se SSO è abilitato, eseguire:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso status
</screen>

  <para>
   Per abilitare SSO eseguire:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso enable saml2
</screen>
 </sect1>
</chapter>
