<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>管理 RADOS 块设备</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>是</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  要列出所有可用的 RADOS 块设备 (RBD)，请点击主菜单中的<menuchoice><guimenu>块设备</guimenu><guimenu>映像</guimenu></menuchoice>。
 </para>
 <para>
  该列表显示有关设备的简要信息，例如设备名称、相关存储池名称、名称空间、设备大小、设备上的对象数量和大小、有关详细信息供应的详细信息以及父项。
 </para>
 <figure>
  <title>RBD 映像列表</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>查看有关 RBD 的详细信息</title>

  <para>
   要查看某个设备的更多详细信息，请点击表中对应的行：
  </para>

  <figure>
   <title>RBD 详细信息</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>查看 RBD 的配置</title>

  <para>
   要查看某个设备的详细配置，请点击表中对应的行，然后点击下方表中的<guimenu>配置</guimenu>选项卡：
  </para>

  <figure>
   <title>RBD 配置</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>创建 RBD</title>

  <para>
   要添加新设备，请点击表标题左上方的<guimenu>创建</guimenu>，然后在<guimenu>创建 RBD</guimenu> 屏幕上执行以下操作：
  </para>

  <figure>
   <title>添加新的 RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     输入新设备的名称。有关命名限制，请参见<xref linkend="sysreq-naming"/>。
    </para>
   </step>
   <step>
    <para>
     选择要在其中创建新 RBD 设备且指定了 <option>rbd</option> 应用的存储池。
    </para>
   </step>
   <step>
    <para>
     指定新设备的大小。
    </para>
   </step>
   <step>
    <para>
     为设备指定其他选项。要微调设备参数，请点击<guimenu>高级设置</guimenu>，然后输入对象大小、条带单元或条带个数的值。要输入服务质量 (QoS) 限制，请点击<guimenu>服务质量 (QoS)</guimenu>，然后输入限制。
    </para>
   </step>
   <step>
    <para>
     点击<guimenu>创建 RBD</guimenu> 进行确认。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>删除 RBD</title>

  <para>
   要删除设备，请选择表中该设备对应的行。点击<guimenu>创建</guimenu>按钮旁的下拉箭头，然后点击<guimenu>删除</guimenu>。点击<guimenu>删除 RBD</guimenu> 确认删除。
  </para>

  <tip>
   <title>将 RBD 移至回收站</title>
   <para>
    删除 RBD 的操作无法撤消。如果您选择将设备<guimenu>移至回收站</guimenu>，那么稍后还可以将其恢复，只需在主表的<guimenu>回收站</guimenu>选项卡上选择该设备，然后点击表标题左上方的<guimenu>恢复</guimenu>。
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>创建 RADOS 块设备快照</title>

  <para>
   要创建 RADOS 块设备快照，请选择表中该设备对应的行，将会显示详细的配置内容窗格。选择<guimenu>快照</guimenu>选项卡，然后点击表标题左上方的<guimenu>创建</guimenu>。输入快照的名称，然后点击<guimenu>创建 RBD 快照</guimenu>进行确认。
  </para>

  <para>
   选择快照后，您可以在设备上执行其他操作，例如重命名、保护、克隆、复制或删除。<guimenu>回滚</guimenu>可根据当前快照恢复设备的状态。
  </para>

  <figure>
   <title>RBD 快照</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>RBD 镜像</title>

  <para>
   RADOS 块设备映像可以在两个 Ceph 集群之间异步镜像。您可以使用 Ceph Dashboard 在两个或更多集群之间配置 RBD 映像复制。此功能有两种模式：
  </para>

  <variablelist>
   <varlistentry>
    <term>基于日志</term>
    <listitem>
     <para>
      此模式使用 RBD 日志映像功能来确保集群之间的复制在时间点和崩溃时保持一致。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>基于快照</term>
    <listitem>
     <para>
      此模式使用定期安排或手动创建的 RBD 映像镜像快照，以在集群之间复制崩溃时保持一致的 RBD 映像。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   镜像是基于对等集群中的每个存储池进行配置的，可以对存储池中的特定映像子集进行配置，也可以配置为在仅使用基于日志的镜像时自动镜像存储池中的所有映像。
  </para>

  <para>
   镜像是使用 <command>rbd</command> 命令配置的，默认情况下，SUSE Enterprise Storage 7 中会安装该应用。<systemitem class="daemon">rbd-mirror</systemitem> 守护进程负责从远程对等集群提取映像更新，并将它们应用于本地集群中的映像。有关启用 <systemitem class="daemon">rbd-mirror</systemitem> 守护进程的详细信息，请参见<xref linkend="rbd-mirror-daemon-enable"/>。
  </para>

  <para>
   根据复制需求，RBD 块设备镜像可以配置为单向或双向复制：
  </para>

  <variablelist>
   <varlistentry>
    <term>单向复制</term>
    <listitem>
     <para>
      当数据仅会从主集群镜像到次集群时，<systemitem class="daemon">rbd-mirror</systemitem> 守护进程仅在次集群上运行。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>双向复制</term>
    <listitem>
     <para>
      当数据从一个集群上的主映像镜像到另一个集群上的非主映像（反之亦然）时，<systemitem class="daemon">rbd-mirror</systemitem> 守护进程将在两个集群上运行。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem> 守护进程的每个实例都必须能够同时连接到本地和远程 Ceph 集群，例如所有 Monitor 和 OSD 主机。此外，网络必须在两个数据中心之间有足够的带宽来处理镜像工作负载。
   </para>
  </important>

  <tip>
   <title>一般信息</title>
   <para>
    有关 RADOS 块设备镜像的一般信息和命令行方法，请参见<xref linkend="ceph-rbd-mirror"/>。
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>配置主集群和次集群</title>
   <para>
    <emphasis>主</emphasis>集群是用于创建包含映像的原始存储池的集群。<emphasis>次</emphasis>集群是用于从<emphasis>主</emphasis>集群复制存储池或映像的集群。
   </para>
   <note>
    <title>相对命名</title>
    <para>
     在复制上下文中，<emphasis>主</emphasis>与<emphasis>次</emphasis>这两个术语有可能是相对的，因为相较于集群来说，它们与单个存储池更为相关。例如，在双向复制中，可将一个存储池从<emphasis>主</emphasis>集群镜像到<emphasis>次</emphasis>集群，与此同时，也可以将另一个存储池从<emphasis>次</emphasis>集群镜像到<emphasis>主</emphasis>集群。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>启用 <systemitem class="daemon">rbd-mirror</systemitem> 守护进程</title>
   <para>
    以下过程说明如何使用 <command>rbd</command> 命令来执行配置镜像的基本管理任务。镜像在 Ceph 集群中逐池进行配置。
   </para>
   <para>
    两个对等集群上都应执行存储池配置步骤。为清楚起见，这些过程假设名为“primary”和“secondary”的两个集群可从单台主机访问。
   </para>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem> 守护进程负责执行实际的集群数据复制。
   </para>
   <procedure>
    <step>
     <para>
      重命名 <filename>ceph.conf</filename> 和密钥环文件，并将其从主要主机复制到次要主机：
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      要使用 <command>rbd</command> 针对存储池启用镜像，请指定 <command>mirror pool enable</command>、存储池名称和镜像模式：
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       镜像模式可以是 <literal>image</literal> 或 <literal>pool</literal>。例如：
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      在 Ceph Dashboard 上，导航到<menuchoice><guimenu>块设备</guimenu><guimenu>镜像</guimenu></menuchoice>。<guimenu>守护进程</guimenu>表的左侧会显示处于活跃状态的运行中 <systemitem class="daemon">rbd-mirror</systemitem> 守护进程及其健康状况。
     </para>
     <figure>
      <title>正在运行的 <systemitem class="daemon">rbd-mirror</systemitem> 守护进程</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>禁用镜像</title>
   <para>
    要使用 <command>rbd</command> 针对存储池禁用镜像，请指定 <command>mirror pool disable</command> 命令和存储池名称：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    使用这种方法对存储池禁用镜像时，还会对已为其明确启用镜像的所有映像（该存储池中）禁用镜像。
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>引导对等</title>
   <para>
    为了使 <systemitem class="daemon">rbd-mirror</systemitem> 发现其对等集群，需要将对等注册到存储池，并需要创建用户帐户。此过程可以使用 <command>rbd</command> 通过 <command>mirror pool peer bootstrap create</command> 和 <command>mirror pool peer bootstrap import</command> 命令自动完成。
   </para>
   <para>
    要使用 <command>rbd</command> 手动创建新的引导令牌，请指定 <command>mirror pool peer bootstrap create</command> 命令、存储池名称以及描述本地集群的可选站点名称：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    <command>mirror pool peer bootstrap create</command> 的输出将是应提供给 <command>mirror pool peer bootstrap import</command> 命令的令牌。例如，在主集群上：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
  joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    要使用 <command>rbd</command> 命令手动导入另一个集群创建的引导令牌，请指定 <command>mirror pool peer bootstrap import</command> 命令、存储池名称、所创建令牌的文件路径（或设为“-”以从标准输入读取），以及描述本地集群的可选站点名称和镜像方向（默认设为 <literal>rx-tx</literal> 以进行双向镜像，但也可设为 <literal>rx-only</literal> 以进行单向镜像）：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    例如，在次集群上：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>删除集群对等</title>
   <para>
    要使用 <command>rbd</command> 命令删除镜像对等 Ceph 集群，请指定 <command>mirror pool peer remove</command> 命令、存储池名称和对等 UUID（可通过 <command>rbd mirror pool info</command> 命令获得）：
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>在 Ceph Dashboard 中配置存储池复制</title>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem> 守护进程需要拥有主集群的访问权限，才能镜像 RBD 映像。继续之前，请确保已按照<xref linkend="rbd-mirror-peer-bootstrap"/>中的步骤操作。
   </para>
   <procedure>
    <step>
     <para>
      在<emphasis>主</emphasis>和<emphasis>次</emphasis>两个集群上，创建名称相同的存储池并为其指定 <literal>rbd</literal> 应用。有关创建新存储池的更多详细信息，请参见<xref linkend="dashboard-pools-create"/>。
     </para>
     <figure>
      <title>创建具有 RBD 应用的存储池</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      在<emphasis>主</emphasis>和<emphasis>次</emphasis>两个集群的仪表盘上，导航到<menuchoice><guimenu>块设备</guimenu><guimenu>镜像</guimenu></menuchoice>。在<guimenu>存储池</guimenu>表右侧点击要复制的存储池的名称，然后点击<guimenu>编辑模式</guimenu>，并选择复制模式。在此示例中，我们将使用<emphasis>存储池</emphasis>复制模式，也就是说将复制给定存储池中的所有映像。点击<guimenu>更新</guimenu>进行确认。
     </para>
     <figure>
      <title>配置复制模式</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>主集群上的错误或警报</title>
      <para>
       更新复制模式后，右侧相应的列中会显示错误或警告标志。这是因为尚未为存储池指定用于复制的同伴用户。对于<emphasis>主</emphasis>集群，请省略此标志，因为我们只需为<emphasis>次</emphasis>集群指定同伴用户。
      </para>
     </important>
    </step>
    <step>
     <para>
      在<emphasis>次</emphasis>集群的仪表盘上，导航到<menuchoice><guimenu>块设备</guimenu><guimenu>镜像</guimenu></menuchoice>。通过选择<guimenu>添加对等</guimenu>添加存储池镜像对等。提供<emphasis>主</emphasis>集群的详细信息：
     </para>
     <figure>
      <title>添加对等身份凭证</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>群集名称</guimenu></term>
       <listitem>
        <para>
         用于识别主集群的任意唯一字符串，如“primary”。该集群名称不得与实际环境中次集群的名称相同。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephX ID</guimenu></term>
       <listitem>
        <para>
         您创建作为镜像同伴的 Ceph 用户 ID。此示例中为“rbd-mirror-peer”。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Monitor 地址</guimenu></term>
       <listitem>
        <para>
         主集群 Ceph Monitor 节点的 IP 地址的逗号分隔列表。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephX 密钥</guimenu></term>
       <listitem>
        <para>
         与同伴用户 ID 相关的密钥。您可以通过在主集群上运行以下示例命令来获得该密钥：
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      点击<guimenu>提交</guimenu>进行确认。
     </para>
     <figure>
      <title>副本存储池列表</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>确认 RBD 映像复制是否有效</title>
   <para>
    如果 <systemitem class="daemon">rbd-mirror</systemitem> 守护进程正在运行，在 Ceph Dashboard 上配置 RBD 映像复制后，就需要确认复制实际上是否有效：
   </para>
   <procedure>
    <step>
     <para>
      在<emphasis>主</emphasis>集群的 Ceph Dashboard 上创建 RBD 映像，将您已创建用于复制目的的存储池设为其父存储池。为映像启用<option>互斥锁</option>和<option>日志</option>特性。有关如何创建 RBD 映像的详细信息，请参见<xref linkend="dashboard-rbds-create"/>。
     </para>
     <figure>
      <title>新 RBD 映像</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      创建要复制的映像后，打开<emphasis>次</emphasis>集群的 Ceph Dashboard，并导航到<menuchoice><guimenu>块设备</guimenu><guimenu>镜像</guimenu></menuchoice>。右侧的<guimenu>存储池</guimenu>表将在 <guimenu># 远程</guimenu>所示数量的映像中反映该变化，并会同步 <guimenu># 本地</guimenu>所示数量的映像。
     </para>
     <figure>
      <title>同步的新 RBD 映像</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>复制进度</title>
      <para>
       页面底部的<guimenu>映像</guimenu>表会显示 RBD 映像的复制状态。<guimenu>问题</guimenu>选项卡包含可能的问题，<guimenu>正在同步</guimenu>选项卡显示映像复制的进度，<guimenu>已就绪</guimenu>选项卡列出所有已成功复制的映像。
      </para>
      <figure>
       <title>RBD 映像的复制状态</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      在<emphasis>主</emphasis>集群上，将数据写入 RBD 映像。在<emphasis>次</emphasis>集群的 Ceph Dashboard 上，导航到<menuchoice><guimenu>块设备</guimenu><guimenu>映像</guimenu></menuchoice>，监视相应映像大小的增长是否与主集群上写入的数据一致。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>管理 iSCSI 网关</title>

  <tip>
   <title>iSCSI 网关的更多信息</title>
   <para>
    有关 iSCSI 网关的更多一般信息，请参见<xref linkend="cha-ceph-iscsi"/>。
   </para>
  </tip>

  <para>
   要列出所有可用网关和映射的映像，请点击主菜单中的<menuchoice><guimenu>块设备</guimenu><guimenu>iSCSI</guimenu></menuchoice>。<guimenu>概述</guimenu>选项卡即会打开，列出当前配置的 iSCSI 网关和映射的 RBD 映像。
  </para>

  <para>
   <guimenu>网关</guimenu>表列出每个网关的状态、iSCSI 目标数量及会话数量。<guimenu>映像</guimenu>表列出每个映射的映像的名称、相关存储池名称、后备存储类型及其他统计数据详细信息。
  </para>

  <para>
   <guimenu>目标</guimenu>选项卡列出当前配置的 iSCSI 目标。
  </para>

  <figure>
   <title>iSCSI 目标列表</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   要查看有关目标的更多详细信息，请点击表中该目标对应行上的下拉箭头。一个树状结构纲要即会打开，列出磁盘、端口、发起程序和组。点击某一项可将其展开并查看详细内容，右侧的表中也可能会显示其相关配置。
  </para>

  <figure>
   <title>iSCSI 目标详细信息</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>添加 iSCSI 目标</title>
   <para>
    要添加新的 iSCSI 目标，请点击<guimenu>目标</guimenu>表左上方的<guimenu>创建</guimenu>，并输入所需信息。
   </para>
   <figure>
    <title>添加新目标</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      输入新网关的目标地址。
     </para>
    </step>
    <step>
     <para>
      点击<guimenu>添加端口</guimenu>并从列表中选择一个或多个 iSCSI 门户。
     </para>
    </step>
    <step>
     <para>
      点击<guimenu>添加映像</guimenu>并为网关选择一个或多个 RBD 映像。
     </para>
    </step>
    <step>
     <para>
      如果您需要使用身份验证才能访问网关，请激活 <guimenu>ACL 身份验证</guimenu>复选框并输入身份凭证。选中<guimenu>相互身份验证</guimenu>和<guimenu>发现身份验证</guimenu>之后，您可看到更多高级身份验证选项。
     </para>
    </step>
    <step>
     <para>
      点击<guimenu>创建目标</guimenu>进行确认。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>编辑 iSCSI 目标</title>
   <para>
    要编辑某个现有 iSCSI 目标，请点击<guimenu>目标</guimenu>表中对应的行，然后点击表左上方的<guimenu>编辑</guimenu>。
   </para>
   <para>
    然后，您便可以修改 iSCSI 目标、添加或删除端口，以及添加或删除相关 RBD 映像。您还可以调整网关的身份验证信息。
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>删除 iSCSI 目标</title>
   <para>
    要删除 iSCSI 目标，请选择表中对应的行并点击<guimenu>编辑</guimenu>按钮旁的下拉箭头，然后选择<guimenu>删除</guimenu>。激活<guimenu>是的，我确定</guimenu>，然后点击<guimenu>删除 iSCSI 目标</guimenu>进行确认。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>RBD 服务质量 (QoS)</title>

  <tip>
   <title>详细信息</title>
   <para>
    有关 RBD QoS 配置选项的更多一般信息和说明，请参见<xref linkend="rbd-qos"/>。
   </para>
  </tip>

  <para>
   QoS 选项可在不同级别配置。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     全局
    </para>
   </listitem>
   <listitem>
    <para>
     基于每个存储池
    </para>
   </listitem>
   <listitem>
    <para>
     基于每个映像
    </para>
   </listitem>
  </itemizedlist>

  <para>
   <emphasis>全局</emphasis>配置位于列表顶部，将用于所有新创建的 RBD 映像，以及不会覆盖存储池或 RBD 映像层级相应值的映像。全局指定的选项值可能会被基于每个存储池或映像设置的值覆盖。针对某个存储池指定的选项将应用到该存储池的所有 RBD 映像，除非被针对某个映像设置的配置选项所覆盖。对映像指定的选项将覆盖对存储池指定的选项以及全局指定的选项。
  </para>

  <para>
   因此可以如此操作：全局定义默认值，对默认值进行调整以适合特定存储池的所有 RBD 映像，然后覆盖单个 RBD 映像的存储池配置。
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>全局配置选项</title>
   <para>
    要全局配置 RADOS 块设备选项，请从主菜单中选择<menuchoice><guimenu>集群</guimenu>
    <guimenu>配置</guimenu></menuchoice>。
   </para>
   <procedure>
    <step>
     <para>
      要列出所有可用的全局配置选项，请在<menuchoice><guimenu>级别</guimenu></menuchoice>旁从下拉菜单中选择<menuchoice><guimenu>高级</guimenu></menuchoice>。
     </para>
    </step>
    <step>
     <para>
      在搜索字段中过滤 <literal>rbd_qos</literal>，以过滤表的结果。QoS 的所有可用配置选项即会列出。
     </para>
    </step>
    <step>
     <para>
      要更改某个值，请点击表中对应的行，然后选择表左上方的<guimenu>编辑</guimenu>。<guimenu>编辑</guimenu>对话框包含 6 个不同的字段供您指定值。在 <guimenu>mgr</guimenu> 文本框中，RBD 配置选项值是必填的。
     </para>
     <note>
      <para>
       此对话框与其他对话框不同，不允许您使用方便的单位指定值。您只能使用字节或 IOPS 单位设置这些值，具体取决于您要编辑的选项。
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>针对新存储池配置选项</title>
   <para>
    要创建新存储池并对其配置 RBD 配置选项，请点击<menuchoice><guimenu>存储池</guimenu>
    <guimenu>创建</guimenu></menuchoice>。选择<guimenu>副本</guimenu>作为存储池类型。然后，您需要为存储池添加 <literal>rbd</literal> 应用标记，这样才能配置 RBD QoS 选项。
   </para>
   <note>
    <para>
     对于纠删码存储池是无法配置 RBD QoS 配置选项的。要为纠删码存储池配置 RBD QoS 选项，您需要编辑 RBD 映像的副本元数据池。该配置随后将应用于该映像的纠删码数据池。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>针对现有存储池配置选项</title>
   <para>
    要对某个现有存储池配置 RBD QoS 选项，请点击<guimenu>存储池</guimenu>，然后点击表中该存储池对应的行，并选择表左上方的<guimenu>编辑</guimenu>。
   </para>
   <para>
    对话框中应该就会显示 <guimenu>RBD 配置</guimenu>部分，下面是<guimenu>服务质量 (QoS)</guimenu> 部分。
   </para>
   <note>
    <para>
     如果 <guimenu>RBD 配置</guimenu>和<guimenu>服务质量 (QoS)</guimenu> 部分均未显示，则可能是因为您正在编辑无法用于设置 RBD 配置选项的<emphasis>纠删码</emphasis>池，或该存储池未配置为供 RBD 映像使用。在下一个案例中，将为存储池指定 <guimenu>rbd</guimenu> 应用标记，相应的配置部分将会显示。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>配置选项</title>
   <para>
    点击<guimenu>服务质量 +</guimenu> 展开配置选项。所有可用选项的列表即会显示。文本框中已显示配置选项的单位。对于任何每秒字节数 (BPS) 选项，您可以选择使用“1M”或“5G”之类的缩写。系统会自动将其转换为对应的“1 MB/s”和“5 GB/s”。
   </para>
   <para>
    点击每个文本框右侧的重设置按钮，将删除对该存储池设置的所有值。此操作不会删除全局配置或对 RBD 映像配置的选项的配置值。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>使用新 RBD 映像创建 RBD QoS 选项</title>
   <para>
    要创建 RBD 映像并对该映像设置 RBD QoS 选项，请选择<menuchoice><guimenu>设备块</guimenu> <guimenu>映像</guimenu></menuchoice>，然后点击<guimenu>创建</guimenu>。点击<guimenu>高级...</guimenu> 可展开高级配置部分。点击<guimenu>服务质量 +</guimenu> 可打开所有可用配置选项。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>编辑现有映像的 RBD QoS 选项</title>
   <para>
    要编辑现有映像的 RBD QoS 选项，请选择<menuchoice><guimenu>块设备</guimenu>
    <guimenu>映像</guimenu></menuchoice>，然后点击表中该存储池对应的行，最后点击<guimenu>编辑</guimenu>。编辑对话框随即显示。点击<guimenu>高级...</guimenu> 可展开高级配置部分。点击<guimenu>服务质量 +</guimenu> 可打开所有可用配置选项。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>在复制或克隆映像时更改配置选项</title>
   <para>
    如果克隆或复制了 RBD 映像，对该特定映像设置的值默认也将被复制。如果您想在复制或克隆期间更改这些值，可通过在复制/克隆对话框中指定更新的配置值来进行更改，此过程与创建或编辑 RBD 映像时的方式相同。执行此操作只能设置（或重设置）所复制或克隆的 RBD 映像的值，无法更改来源 RBD 映像配置，也无法更改全局配置。
   </para>
   <para>
    如果您选择在复制/克隆时重设置选项值，系统将不会对该映像设置该选项的值。这意味着系统将使用为父存储池指定的该选项的任何值（如果为父存储池配置了相应值）。如果没有为父存储池配置相应值，则将使用全局默认值。
   </para>
  </sect2>
 </sect1>
</chapter>
