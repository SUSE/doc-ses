<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="upgrade-to-pacific.xml" version="5.0" xml:id="upgrade-to-pacific">
 <title>从 SUSE Enterprise Storage 7 升级到版本 7.1</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  本章说明将 SUSE Enterprise Storage 7 升级到版本 7.1 的步骤。
 </para>
 <para>
  升级包括以下任务：
 </para>
 <itemizedlist>
  <listitem>
   <para>
    将底层 SUSE Linux Enterprise Server 15 SP2 升级到 SUSE Linux Enterprise Server 15 SP3 版本。
   </para>
  </listitem>
  <listitem>
   <para>
    从 Ceph Octopus 升级到 Pacific。
   </para>
  </listitem>
 </itemizedlist>
 <sect1 xml:id="before-upgrade-7p">
  <title>升级前</title>

  <para>
   开始升级之前，<emphasis>必须</emphasis>完成以下任务。在 SUSE Enterprise Storage 7 生命周期内可随时执行这些任务。
  </para>

  <sect2 xml:id="upgrade-consider-points-7p">
   <title>需考虑的要点</title>
   <para>
    升级前，请务必通读以下内容，确保您了解所有需要执行的任务。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <emphasis>阅读发行说明</emphasis>.在发行说明中，可以找到更多有关自 SUSE Enterprise Storage 的上一个版本发行后所进行的更改的信息。检查发行说明以了解：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        您的硬件是否有特殊注意事项。
       </para>
      </listitem>
      <listitem>
       <para>
        所使用的任何软件包是否发生了重大更改。
       </para>
      </listitem>
      <listitem>
       <para>
        是否需要对您的安装实施特殊预防措施。
       </para>
      </listitem>
     </itemizedlist>
     <para>
      发行说明还提供未能及时编入手册中的信息。它们还包含有关已知问题的说明。
     </para>
     <para>
      您可以在 <link xlink:href="https://www.suse.com/releasenotes/"/> 上找到联机 SES 7.1 发行说明。
     </para>
     <para>
      此外，安装 SES 7.1 储存库中的 <package>release-notes-ses</package> 软件包之后，可在本地的 <filename>/usr/share/doc/release-notes</filename> 目录中或 <link xlink:href="https://www.suse.com/releasenotes/"/> 网页上找到发行说明。
     </para>
    </listitem>
    <listitem>
     <para>
      阅读<xref linkend="ses-deployment"/>，熟悉 <systemitem class="resource">ceph-salt</systemitem> 和 Ceph orchestrator，尤其要了解有关服务规范的信息。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="upgrade-backup-config-data-7p">
   <title>备份集群配置和数据</title>
   <para>
    我们强烈建议您在开始升级之前备份所有集群配置和数据。有关如何备份所有数据的说明，请参见<xref linkend="cha-deployment-backup"/>。
   </para>
  </sect2>

  <sect2 xml:id="verify-previous-upgrade-patch-repos-7p">
   <title>确认对软件储存库和容器映像的访问权限</title>
   <para>
    确认是否每个集群节点都能访问 SUSE Linux Enterprise Server 15 SP3 和 SUSE Enterprise Storage 7.1 软件储存库以及容器映像注册表。
   </para>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-repos-7p">
    <title>软件储存库</title>
    <para>
     如果所有节点都已在 SCC 中注册，您便可以使用 <command>zypper migration</command> 命令进行升级。有关更多详细信息，请参见 <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>。
    </para>
    <para>
     如果节点<emphasis role="bold">未</emphasis>在 SCC 中注册，请禁用所有现有软件储存库，并为以下每个扩展添加 <literal>Pool</literal> 和 <literal>Updates</literal> 储存库：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       SLE-Product-SLES/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Basesystem/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Server-Applications/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SUSE-Enterprise-Storage-7.1
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-images-7p">
    <title>容器映像</title>
    <para>
     所有集群节点都需要访问容器映像注册表。在大多数情况下，您将使用 <literal>registry.suse.com</literal> 上的公共 SUSE 注册表。您需要以下映像：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/ceph
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/grafana
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-server
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-node-exporter
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-alertmanager
      </para>
     </listitem>
    </itemizedlist>
    <para>
     或者，例如对于实体隔离部署，请配置本地注册表并确认您是否有一组正确的容器映像可用。有关配置本地容器映像注册表的更多详细信息，请参见<xref linkend="deploy-cephadm-configure-registry"/>。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="upgrade-cluster-nodes">
  <title>将每个集群节点上的 SUSE Linux Enterprise Server 迁移到 SUSE Linux Enterprise Server 15 SP3 版本</title>

  <para>
   如果集群节点配置为使用 SUSE Customer Center，您可以使用 <command>zypper migration</command> 命令。
  </para>

  <para>
   如果集群节点的软件储存库是手动配置的，则需要手动升级节点。
  </para>

  <para>
   有关使用 <command>zypper</command> 升级 SUSE Linux Enterprise Server 的详细信息，请参见 <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>。
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-packages">
  <title>升级每个集群节点上与 SUSE Enterprise Storage 相关的软件包</title>

  <para>
   要将 SUSE Enterprise Storage 软件包升级到最新版本，请使用 <command>ceph-salt update</command> 命令。有关详细信息，请参考 <xref linkend="cephadm-rolling-updates"/>。
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-services">
  <title>升级现有 Ceph 集群服务</title>

  <para>
   从管理节点中运行以下命令来将整个 Ceph 集群升级到 Pacific 版本：
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch upgrade start --image registry.suse.com/ses/7.1/ceph/ceph</screen>
 </sect1>
</chapter>
