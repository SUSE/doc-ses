<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="manager_modules.xml" version="5.0" xml:id="cha-mgr-modules">
 <title>Módulos de Ceph Manager</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  La arquitectura de Ceph Manager (consulte el <xref linkend="storage-intro-core-nodes"/> para obtener una breve introducción) permite ampliar su funcionalidad mediante <emphasis>módulos</emphasis>, como la &quot;consola&quot; (consulte la <xref linkend="part-dashboard"/>), &quot;prometheus&quot; (consulte el <xref linkend="monitoring-alerting"/>), o el &quot;equilibrador&quot;.
 </para>
 <para>
  Para mostrar todos los módulos disponibles, ejecute:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module ls
{
        "enabled_modules": [
                "restful",
                "status"
        ],
        "disabled_modules": [
                "dashboard"
        ]
}</screen>
 <para>
  Para habilitar o inhabilitar un módulo específico, ejecute:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable <replaceable>MODULE-NAME</replaceable></screen>
 <para>
  Por ejemplo:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard</screen>
 <para>
  Para mostrar los servicios que proporcionan los módulos habilitados, ejecute:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr services
{
        "dashboard": "http://myserver.com:7789/",
        "restful": "https://myserver.com:8789/"
}</screen>
 <sect1 xml:id="mgr-modules-balancer">
  <title>Equilibrador</title>

  <para>
   El módulo del equilibrador optimiza la distribución del grupo de colocación (PG) entre los OSD para conseguir una distribución más equilibrada. Aunque el módulo se activa por defecto, está inactivo. Admite los dos modos siguientes: <literal>crush-compat</literal> y <literal>upmap</literal>.
  </para>

  <tip>
   <title>estado y configuración actuales del equilibrador</title>
   <para>
    Para ver el estado actual del equilibrador y los datos de configuración, ejecute:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer status</screen>
  </tip>

  <sect2 xml:id="mgr-balancer-crush-compat">
   <title>Modo &quot;crush-compat&quot;</title>
   <para>
    En el modo &quot;crush-compat&quot;, el equilibrador ajusta los conjuntos de reequilibrio de peso de los OSD para lograr una mejor distribución de los datos. Mueve los grupos de colocación por los OSD, lo que causa que el clúster tenga temporalmente el estado <literal>HEALTH_WARN</literal> debido a los grupos de colocación descolocados.
   </para>
   <tip>
    <title>activación del modo</title>
    <para>
     Aunque &quot;crush-compat&quot; es el modo por defecto, se recomienda activarlo explícitamente:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer mode crush-compat</screen>
   </tip>
  </sect2>

  <sect2 xml:id="mgr-balancer-planning-executing">
   <title>Planificación y ejecución del equilibrado de datos</title>
   <para>
    Mediante el módulo de equilibrador, puede crear un plan para equilibrar los datos. A continuación, puede ejecutar el plan manualmente o dejar que los grupos de colocación se equilibren continuamente de forma automática.
   </para>
   <para>
    La decisión de ejecutar el equilibrador en modo manual o automático depende de varios factores, como el desequilibrio actual de los datos, el tamaño del clúster, el número de grupos de colocación o la actividad de E/S. Se recomienda crear un plan inicial y ejecutarlo en un momento de baja carga de E/S en el clúster. El motivo es que, probablemente, el desequilibrio inicial será considerable y es una buena práctica para reducir el impacto en los clientes. Después de una ejecución manual inicial, considere la posibilidad de activar el modo automático y de supervisar el tráfico de reequilibrio bajo una carga de E/S normal. Deben sopesarse las mejoras en la distribución del grupo de colocación frente al tráfico de reequilibrio causado por el equilibrador.
   </para>
   <tip>
    <title>fracción móvil de grupos de colocación (PG)</title>
    <para>
     Durante el proceso de equilibrio, el módulo de equilibrador regula los movimientos de los grupos de colocación para que solo se mueva una fracción configurable de ellos. El valor por defecto es el 5 %, y se puede ajustar, por ejemplo al 9 %, ejecutando el comando siguiente:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr target_max_misplaced_ratio .09</screen>
   </tip>
   <para>
    Para crear y ejecutar un plan de equilibrio, siga estos pasos:
   </para>
   <procedure>
    <step>
     <para>
      Compruebe la puntuación actual del clúster:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval</screen>
    </step>
    <step>
     <para>
      Cree un plan. Por ejemplo, &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer optimize great_plan</screen>
    </step>
    <step>
     <para>
      Vea qué cambios implicará el plan &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer show great_plan</screen>
    </step>
    <step>
     <para>
      Compruebe la puntuación potencial del clúster si decide aplicar el plan &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval great_plan</screen>
    </step>
    <step>
     <para>
      Ejecute el plan &quot;great_plan&quot; una sola vez:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer execute great_plan</screen>
    </step>
    <step>
     <para>
      Observe el equilibrio del clúster con el comando <command>ceph -s</command>. Si el resultado es satisfactorio, active el equilibrio automático:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer on</screen>
     <para>
      Si más adelante decide desactivar el equilibrio automático, ejecute:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer off</screen>
    </step>
   </procedure>
   <tip>
    <title>equilibrio automático sin plan inicial</title>
    <para>
     Es posible activar el equilibrio automático sin ejecutar un plan inicial. En tal caso, el reequilibrio de los grupos de colocación puede tardar bastante tiempo.
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="mgr-modules-telemetry">
  <title>Habilitación del módulo de telemetría</title>

  <para>
   El complemento de telemetría envía datos anónimos del proyecto Ceph sobre el clúster en el que se ejecuta el complemento.
  </para>

  <para>
   Este componente (que hay que aceptar explícitamente) incluye contadores y estadísticas sobre cómo se ha distribuido el clúster, la versión de Ceph, la distribución de los hosts y otros parámetros que ayudan al proyecto a comprender mejor la forma en que se usa Ceph. No contiene datos confidenciales como nombres de repositorios, nombres de objetos, contenido de objetos ni nombres de host.
  </para>

  <para>
   El propósito del módulo de telemetría es proporcionar comentarios automatizado para que los desarrolladores puedan cuantificar las tasas de adopción y el seguimiento o detectar los elementos que deben explicarse o validarse mejor durante la configuración para evitar resultados no deseados.
  </para>

  <note>
   <para>
    El módulo de telemetría requiere que los nodos de Ceph Manager tengan la capacidad de enviar datos a través de HTTPS a los servidores de fases anteriores. Asegúrese de que su cortafuegos corporativos permita esta acción.
   </para>
  </note>

  <procedure>
   <step>
    <para>
     Para habilitar el módulo de telemetría:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable telemetry</screen>
    <note>
     <para>
      Este comando solo permite ver los datos localmente. No comparte datos con la comunidad de Ceph.
     </para>
    </note>
   </step>
   <step>
    <para>
     Para permitir que el módulo de telemetría comience a compartir datos:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry on</screen>
   </step>
   <step>
    <para>
     Para inhabilitar el uso compartido de los datos de telemetría:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry off</screen>
   </step>
   <step>
    <para>
     Para generar un informe JSON que se pueda imprimir:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry show</screen>
   </step>
   <step>
    <para>
     Para añadir un contacto y una descripción al informe:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/contact John Doe john.doe@example.com
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/description 'My first Ceph cluster'</screen>
   </step>
   <step>
    <para>
     El módulo compila y envía un informe nuevo cada 24 horas por defecto. Para ajustar este intervalo:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/interval <replaceable>HOURS</replaceable></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
