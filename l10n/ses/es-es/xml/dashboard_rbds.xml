<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>Gestión de dispositivos de bloques RADOS</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sí</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Para mostrar todos los dispositivos de bloques RADOS (RBD) disponibles, haga clic en <menuchoice><guimenu>Bloque</guimenu><guimenu>Imágenes</guimenu></menuchoice> en el menú principal.
 </para>
 <para>
  La lista muestra información breve sobre el dispositivo, como el nombre del dispositivo, el nombre del repositorio relacionado, el espacio de nombres, el tamaño del dispositivo, el número y el tamaño de los objetos del dispositivo, detalles sobre la provisión de los detalles y el padre.
 </para>
 <figure>
  <title>Lista de imágenes RBD</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>Visualización de detalles de los RBD</title>

  <para>
   Para ver información más detallada sobre un dispositivo, haga clic en su fila en la tabla:
  </para>

  <figure>
   <title>Detalles de RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>Visualización de la configuración de RBD</title>

  <para>
   Para ver la configuración detallada de un dispositivo, haga clic en su fila en la tabla y, a continuación, en la pestaña <guimenu>Configuración</guimenu> de la tabla inferior:
  </para>

  <figure>
   <title>Configuración de RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>Creación de RBD</title>

  <para>
   Para añadir un dispositivo nuevo, haga clic en <guimenu>Crear</guimenu> en la parte superior izquierda del encabezado de la tabla y haga lo siguiente en la pantalla <guimenu>Crear RBD:</guimenu>
  </para>

  <figure>
   <title>Adición de un RBD nuevo</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     Introduzca el nombre del dispositivo nuevo. Consulte el <xref linkend="sysreq-naming"/> para conocer las limitaciones a la hora de asignar un nombre.
    </para>
   </step>
   <step>
    <para>
     Seleccione el repositorio con la aplicación <option>rbd</option> asignada desde la que se creará el nuevo dispositivo RBD.
    </para>
   </step>
   <step>
    <para>
     Especifique el tamaño del nuevo dispositivo.
    </para>
   </step>
   <step>
    <para>
     Especifique las opciones adicionales para el dispositivo. Para ajustar los parámetros del dispositivo, haga clic en <guimenu>Avanzado</guimenu> e introduzca valores para el tamaño del objeto, la unidad de repartición o el recuento de repartición. Para especificar los límites de calidad de servicio (QoS), haga clic en <guimenu>Calidad del servicio</guimenu> e introdúzcalos.
    </para>
   </step>
   <step>
    <para>
     Para confirmar, haga clic en <guimenu>Crear RBD.</guimenu>
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>Supresión de RBD</title>

  <para>
   Para suprimir un dispositivo, selecciónelo en la fila de la tabla. Haga clic en la flecha desplegable situada junto al botón <guimenu>Crear</guimenu> y haga clic en <guimenu>Suprimir.</guimenu> Para confirmar, haga clic en <guimenu>Suprimir RBD.</guimenu>
  </para>

  <tip>
   <title>traslado de los RBD a la papelera</title>
   <para>
    Suprimir un RBD es una acción irreversible. Si en su lugar, usa la opción <guimenu>Mover a la papelera,</guimenu> podrá restaurar el dispositivo más adelante seleccionándolo en la pestaña <guimenu>Papelera</guimenu> de la tabla principal y haciendo clic en <guimenu>Restaurar</guimenu> en la parte superior izquierda del encabezado de la tabla.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>Creación de instantáneas de dispositivos de bloques RADOS</title>

  <para>
   Para crear una instantánea de dispositivo de bloques RADOS, seleccione el dispositivo en la fila de la tabla y aparecerá el panel de contenido de configuración detallada. Seleccione la pestaña <guimenu>Instantáneas</guimenu> y haga clic en <guimenu>Crear</guimenu> en la parte superior izquierda del encabezado de la tabla. Escriba el nombre de la instantánea y haga clic en <guimenu>Crear instantánea de RBD</guimenu> para confirmar.
  </para>

  <para>
   Después de seleccionar una instantánea, puede realizar acciones adicionales en el dispositivo, como cambiar su nombre, protegerlo, clonarlo, copiarlo o suprimirlo. La opción <guimenu>Rollback</guimenu> (Deshacer) restaura el estado del dispositivo de la instantánea actual.
  </para>

  <figure>
   <title>Instantáneas de RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>Duplicación de un RBD</title>

  <para>
   Los dispositivos de bloques de imágenes RADOS se pueden duplicar de forma asincrónica entre dos clústeres de Ceph. Puede usar Ceph Dashboard para configurar la réplica de imágenes RBD entre dos o más clústeres. Esta capacidad está disponible en dos modos:
  </para>

  <variablelist>
   <varlistentry>
    <term>Basada en registro</term>
    <listitem>
     <para>
      Este modo utiliza las imágenes RBD transaccionales para garantizar la réplica protegida contra bloqueos de un momento concreto entre los clústeres.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Basada en instantáneas</term>
    <listitem>
     <para>
      Este modo utiliza instantáneas de duplicación de imágenes RBD creadas de forma programada periódicamente o manualmente para replicar imágenes de RBD protegidas contra bloqueos entre clústeres.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   La duplicación se configura en cada repositorio dentro de clústeres conectores y se puede configurar en un subconjunto específico de imágenes dentro del repositorio o para que refleje automáticamente todas las imágenes de un repositorio si se usa únicamente la duplicación transaccional.
  </para>

  <para>
   La duplicación se configura mediante el comando <command>rbd</command>, que se instala por defecto en SUSE Enterprise Storage 7. El daemon <systemitem class="daemon">rbd-mirror</systemitem> es el responsable de la extracción de actualizaciones de imágenes del clúster conector remoto y de aplicarlos a la imagen en el clúster local. Consulte la <xref linkend="rbd-mirror-daemon-enable"/> para obtener más información sobre cómo habilitar el daemon <systemitem class="daemon">rbd-mirror</systemitem>.
  </para>

  <para>
   Dependiendo de la necesidad de réplica, la duplicación del dispositivo de bloques RADOS se puede configurar para la réplica unidireccional o bidireccional:
  </para>

  <variablelist>
   <varlistentry>
    <term>Réplica unidireccional</term>
    <listitem>
     <para>
      Cuando los datos solo se duplican desde un clúster primario a un clúster secundario, el daemon <systemitem class="daemon">rbd-mirror</systemitem> se ejecuta solo en el clúster secundario.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Réplica bidireccional</term>
    <listitem>
     <para>
      Cuando los datos se duplican desde imágenes primarias de un clúster a imágenes no primarias de otro clúster (y viceversa), el daemon <systemitem class="daemon">rbd-mirror</systemitem> se ejecuta en ambos clústeres.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    Cada instancia del daemon <systemitem class="daemon">rbd-mirror</systemitem> debe poder conectarse a los clústeres de Ceph locales y remotos simultáneamente; por ejemplo, a todos los monitores y los hosts OSD. Además, la red debe tener suficiente ancho de banda entre los dos centros de datos para poder gestionar la carga de trabajo de duplicación.
   </para>
  </important>

  <tip>
   <title>información general</title>
   <para>
    Para obtener información general y el enfoque de la línea de comandos para duplicar un dispositivo de bloques RADOS, consulte la <xref linkend="ceph-rbd-mirror"/>.
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>Configuración de clústeres primarios y secundarios</title>
   <para>
    El clúster <emphasis>primario</emphasis> es aquel donde se crea el repositorio original con imágenes. El clúster <emphasis>secundario</emphasis> es donde se replican el repositorio o las imágenes desde el clúster <emphasis>primario</emphasis>.
   </para>
   <note>
    <title>nomenclatura relativa</title>
    <para>
     Los términos <emphasis>primario</emphasis> y <emphasis>secundario</emphasis> pueden ser relativos en el contexto de la réplica, ya que están más relacionados con los repositorios individuales que con los clústeres. Por ejemplo, en la réplica bidireccional, un repositorio se puede duplicar desde el clúster <emphasis>primario</emphasis> al <emphasis>secundario</emphasis>, mientras que otro repositorio se puede duplicar desde el clúster <emphasis>secundario</emphasis> al <emphasis>primario</emphasis>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>Habilitación del daemon <systemitem class="daemon">rbd-mirror</systemitem></title>
   <para>
    Los siguientes procedimientos demuestran cómo llevar a cabo las tareas administrativas básicas para configurar la duplicación mediante el comando <command>rbd</command>. La duplicación se configura de forma independiente para cada repositorio dentro de los clústeres de Ceph.
   </para>
   <para>
    Los pasos para configurar el repositorio deben realizarse en ambos clústeres conectores. Para simplificar los ejemplos, en estos procedimientos se presupone que hay dos clústeres, denominados "primario" y "secundario, a los que se puede acceder desde un único host.
   </para>
   <para>
    El daemon <systemitem class="daemon">rbd-mirror</systemitem> realiza la réplica de los datos del clúster.
   </para>
   <procedure>
    <step>
     <para>
      Cambie el nombre de <filename>ceph.conf</filename> y de los archivos de anillo de claves y cópielos del host primario al secundario:
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      Para habilitar la duplicación en un repositorio con <command>rbd</command>, especifique el comando <command>mirror pool enable</command>, el nombre del repositorio y el modo de duplicación:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       El modo de duplicación puede ser <literal>image</literal> o <literal>pool</literal>. Por ejemplo:
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      En Ceph Dashboard diríjase a <menuchoice><guimenu>Bloque</guimenu><guimenu>Duplicación</guimenu></menuchoice>. La tabla <guimenu>Daemons</guimenu> de la izquierda muestra los daemons <systemitem class="daemon">rbd-mirror</systemitem> que se ejecutan activamente y su estado.
     </para>
     <figure>
      <title>Ejecución de daemons <systemitem class="daemon">rbd-mirror</systemitem></title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>Inhabilitación de la duplicación</title>
   <para>
    Para inhabilitar la duplicación en un repositorio con <command>rbd</command>, especifique el comando <command>mirror pool disable</command> y el nombre del repositorio:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    Cuando se inhabilita la duplicación en un repositorio de esta forma, la duplicación también se inhabilitará en cualquier imagen (dentro del repositorio) para la que se haya habilitado la duplicación explícitamente.
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>Conectores de carga</title>
   <para>
    Para que <systemitem class="daemon">rbd-mirror</systemitem> descubra su clúster conector, este debe estar registrado en el repositorio y debe crearse una cuenta de usuario. Este proceso se puede automatizar con <command>rbd</command> mediante los comandos <command>mirror pool peer bootstrap create</command> y <command>mirror pool peer bootstrap import</command>.
   </para>
   <para>
    Para crear manualmente un nuevo testigo de arranque con <command>rbd</command>, especifique el comando <command>mirror pool peer bootstrap create</command>, un nombre de repositorio y un nombre de sitio opcional para describir el clúster local:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    El resultado del comando <command>mirror pool peer bootstrap create</command> será un testigo que se debe proporcionar al comando <command>mirror pool peer bootstrap import</command>. Por ejemplo, en el clúster primario:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
  joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    Para importar manualmente el testigo de arranque creado por otro clúster con el comando <command>rbd</command>, especifique el comando <command>mirror pool peer bootstrap import</command>, el nombre del repositorio, una vía de archivo al testigo creado (o "-" para leer desde la entrada estándar), junto con un nombre de sitio opcional para describir el clúster local y una dirección de duplicación (por defecto es <literal>rx-tx</literal> para la duplicación bidireccional, pero también se puede definir como <literal>rx-only</literal> para la duplicación unidireccional):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    Por ejemplo, en el clúster secundario:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>Eliminación de un clúster conector</title>
   <para>
    Para eliminar un clúster conector duplicado de Ceph con el comando <command>rbd</command>, especifique el comando <command>mirror pool peer remove</command>, el nombre del repositorio y el UUID del conector (disponible mediante el comando <command>rbd mirror pool info</command>):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Configuración de la réplica de repositorios en Ceph Dashboard</title>
   <para>
    El daemon <systemitem class="daemon">rbd-mirror</systemitem> debe tener acceso al clúster primario para poder duplicar imágenes RBD. Antes de continuar, asegúrese de que ha seguido los pasos descritos en la <xref linkend="rbd-mirror-peer-bootstrap"/>.
   </para>
   <procedure>
    <step>
     <para>
      Tanto en el clúster <emphasis>primario</emphasis> como en el <emphasis>secundario</emphasis>, cree repositorios con un nombre idéntico y asígneles la aplicación <literal>rbd</literal>. Consulte la <xref linkend="dashboard-pools-create"/> para obtener más información sobre cómo crear un repositorio.
     </para>
     <figure>
      <title>Creación de un repositorio con la aplicación RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Tanto en la consola <emphasis>primaria</emphasis> como en la <emphasis>secundaria</emphasis> del clúster, diríjase a <menuchoice><guimenu>Bloque</guimenu><guimenu>Duplicación</guimenu></menuchoice>. En la tabla <guimenu>Repositorio</guimenu> de la derecha, haga clic en el nombre del repositorio que desea replicar y, después de hacer clic en <guimenu>Editar modo</guimenu>, seleccione el modo de réplica. En este ejemplo, trabajaremos con un modo de réplica de <emphasis>repositorio</emphasis>, lo que significa que se replicarán todas las imágenes de un repositorio determinado. Para confirmar, haga clic en <guimenu>Actualizar.</guimenu>
     </para>
     <figure>
      <title>Configuración del modo de réplica</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>error o advertencia en el clúster primario</title>
      <para>
       Después de actualizar el modo de réplica, aparecerá un indicador de error o advertencia en la columna correspondiente de la derecha. Esto se debe a que el repositorio no tiene asignado todavía ningún usuario par para la réplica. Ignore este indicador para el clúster <emphasis>primario</emphasis>, ya que solo se asignará un usuario par al clúster <emphasis>secundario</emphasis>.
      </para>
     </important>
    </step>
    <step>
     <para>
      En la consola del clúster <emphasis>secundario</emphasis>, diríjase a <menuchoice><guimenu>Bloque</guimenu><guimenu>Duplicación</guimenu></menuchoice>. Añada el par de duplicación del repositorio seleccionando <guimenu>Añadir par</guimenu>. Proporcione los detalles del clúster <emphasis>primario</emphasis>:
     </para>
     <figure>
      <title>Adición de credenciales del par</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>Nombre del clúster</guimenu></term>
       <listitem>
        <para>
         Se trata de una cadena arbitraria exclusiva que identifica al clúster primario; por ejemplo, "primario". El nombre del clúster debe ser distinto del nombre real del clúster secundario.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>ID de CephX</guimenu></term>
       <listitem>
        <para>
         El ID de usuario de Ceph que creó como par de duplicación. En este ejemplo es "rbd-mirror-peer".
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Direcciones de monitores</guimenu></term>
       <listitem>
        <para>
         Lista separada por comas de direcciones IP o nombres de host de los nodos de Ceph Monitor del clúster principal.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Clave de CephX</guimenu></term>
       <listitem>
        <para>
         La clave relacionada con el ID de usuario par. Puede recuperarla ejecutando el siguiente comando de ejemplo en el clúster primario:
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Para confirmar, haga clic en <guimenu>Enviar.</guimenu>
     </para>
     <figure>
      <title>Lista de repositorios replicados</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>Verificación del funcionamiento de la réplica de la imagen RBD</title>
   <para>
    Cuando el daemon <systemitem class="daemon">rbd-mirror</systemitem> esté en ejecución y la réplica de la imagen RBD esté configurada en Ceph Dashboard, podrá verificar si la réplica realmente funciona:
   </para>
   <procedure>
    <step>
     <para>
      En Ceph Dashboard del clúster <emphasis>primario</emphasis>, cree una imagen RBD cuyo repositorio primario sea el repositorio que ya creó con fines de réplica. Habilite las funciones <option>Bloqueo exclusivo</option> y <option>En diario</option> de la imagen. Consulte la <xref linkend="dashboard-rbds-create"/> para obtener más información sobre cómo crear imágenes RBD.
     </para>
     <figure>
      <title>Nueva imagen RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Después de crear la imagen que desea replicar, abra la Ceph Dashboard del clúster <emphasis>secundario</emphasis> y diríjase a <menuchoice><guimenu>Bloque</guimenu><guimenu>Duplicación</guimenu></menuchoice>. La tabla <guimenu>Repositorios</guimenu> de la derecha reflejará el cambio en el número de imágenes de <guimenu>N.º remotos</guimenu> y sincronizará el número de imágenes de <guimenu>N.º locales</guimenu>.
     </para>
     <figure>
      <title>Nueva imagen RBD sincronizada</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>progreso de la réplica</title>
      <para>
       La tabla <guimenu>Imágenes</guimenu> de la parte inferior de la página muestra el estado de la réplica de las imágenes RBD. La pestaña <guimenu>Problemas</guimenu> incluye los problemas que se han podido producir, <guimenu>Sincronización</guimenu> muestra el progreso de la réplica de la imagen y <guimenu>Listo</guimenu> muestra todas las imágenes cuya réplica se ha realizado correctamente.
      </para>
      <figure>
       <title>Estado de réplica de las imágenes RBD</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      En el clúster <emphasis>primario</emphasis>, escriba datos en la imagen RBD. En la Ceph Dashboard del clúster <emphasis>secundario</emphasis>, diríjase a <menuchoice><guimenu>Bloque</guimenu><guimenu>Imágenes</guimenu></menuchoice> y supervise si el tamaño de la imagen correspondiente aumenta a medida que se escriben los datos en el clúster primario.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>Gestión de pasarelas iSCSI Gateway</title>

  <tip>
   <title>más información sobre las pasarelas iSCSI Gateway</title>
   <para>
    Para obtener información general sobre las pasarelas iSCSI Gateway, consulte el <xref linkend="cha-ceph-iscsi"/>.
   </para>
  </tip>

  <para>
   Para mostrar todas las pasarelas disponibles y las imágenes asignadas, haga clic en <menuchoice><guimenu>Bloque</guimenu><guimenu>iSCSI</guimenu></menuchoice> en el menú principal. Se abre una pestaña <guimenu>Resumen,</guimenu> que muestra las pasarelas iSCSI Gateway configuradas actualmente y las imágenes RBD asignadas.
  </para>

  <para>
   La tabla <guimenu>Puertas de enlace iSCSI</guimenu> muestra el estado de cada pasarela, el número de destinos iSCSI y el número de sesiones. La tabla <guimenu>Imágenes</guimenu> muestra el nombre de cada imagen asignada, el nombre del repositorio relacionado, el tipo de almacén y otros detalles estadísticos.
  </para>

  <para>
   La pestaña <guimenu>Destinos</guimenu> muestra los destinos iSCSI configurados actualmente.
  </para>

  <figure>
   <title>Lista de destinos iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Para ver información más detallada acerca de un destino, haga clic en la flecha desplegable de la fila de la tabla de destino. Se abre un esquema estructurado en forma de árbol con los discos, los portales, los iniciadores y los grupos incluidos. Haga clic en un elemento para expandirlo y ver su contenido detallado, opcionalmente con la configuración relacionada en la tabla de la derecha.
  </para>

  <figure>
   <title>Detalles de destino iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>Adición de destinos iSCSI</title>
   <para>
    Para añadir un destino iSCSI nuevo, haga clic en <guimenu>Crear</guimenu> en la parte superior izquierda de la tabla <guimenu>Destinos</guimenu> e introduzca la información necesaria.
   </para>
   <figure>
    <title>Adición de un destino nuevo</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      Escriba la dirección de destino de la nueva pasarela.
     </para>
    </step>
    <step>
     <para>
      Haga clic en <guimenu>Añadir portal</guimenu> y seleccione uno o varios portales iSCSI de la lista.
     </para>
    </step>
    <step>
     <para>
      Haga clic en <guimenu>Añadir imagen</guimenu> y seleccione una o varias imágenes RBD para la pasarela.
     </para>
    </step>
    <step>
     <para>
      Si necesita utilizar autenticación para acceder a la pasarela, marque la casilla de verificación <guimenu>Autenticación de ACL</guimenu> e introduzca las credenciales. Encontrará opciones de autenticación más avanzadas después de activar <guimenu>Autenticación mutua</guimenu> y <guimenu>Autenticación de descubrimiento</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Para confirmar, haga clic en <guimenu>Crear destino.</guimenu>
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>Edición de destinos iSCSI</title>
   <para>
    Para editar un destino iSCSI existente, haga clic en su fila en la tabla <guimenu>Destinos</guimenu> y haga clic en <guimenu>Editar</guimenu> en la parte superior izquierda de la tabla.
   </para>
   <para>
    A continuación, puede modificar el destino iSCSI, añadir o suprimir portales y añadir o suprimir imágenes RBD relacionadas. También puede ajustar la información de autenticación para la pasarela.
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>Supresión de destinos iSCSI</title>
   <para>
    Para suprimir un destino iSCSI, seleccione la fila de la tabla, haga clic en la flecha desplegable situada junto al botón <guimenu>Editar</guimenu> y seleccione <guimenu>Suprimir.</guimenu> Active la casilla de verificación <guimenu>Sí, seguro</guimenu> y haga clic en <guimenu>Suprimir destino iSCSI</guimenu> para confirmar.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>Calidad del servicio (QoS) de un RBD</title>

  <tip>
   <title>información adicional</title>
   <para>
    Para obtener información general y una descripción de las opciones de configuración de QoS de un RDB, consulte la <xref linkend="rbd-qos"/>.
   </para>
  </tip>

  <para>
   Las opciones de QoS se pueden configurar en diferentes niveles.
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Globalmente
    </para>
   </listitem>
   <listitem>
    <para>
     En cada repositorio
    </para>
   </listitem>
   <listitem>
    <para>
     En cada imagen
    </para>
   </listitem>
  </itemizedlist>

  <para>
   La configuración <emphasis>global</emphasis> se encuentra en la parte superior de la lista y se utiliza para todas las imágenes RBD recién creadas y para aquellas imágenes que no sustituyen estos valores en la capa del repositorio o de la imagen RBD. Un valor especificado globalmente se puede sustituir en cada repositorio o imagen. Las opciones especificadas en un repositorio se aplicarán a todas las imágenes RBD de ese repositorio a menos que se sustituyan por una opción de configuración definida en una imagen. Las opciones especificadas en una imagen sustituyen a las opciones especificadas en un repositorio y a las especificadas globalmente.
  </para>

  <para>
   De esta manera, es posible definir valores por defecto globalmente, adaptarlos para todas las imágenes de RBD de un repositorio específico y sustituir la configuración del repositorio para imágenes RBD individuales.
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>Configuración global de opciones</title>
   <para>
    Para configurar las opciones del dispositivo de bloques RADOS de forma global, seleccione <menuchoice><guimenu>Clúster</guimenu>
    <guimenu>Configuración</guimenu></menuchoice> en el menú principal.
   </para>
   <procedure>
    <step>
     <para>
      Para mostrar todas las opciones de configuración global disponibles, junto a <menuchoice><guimenu>Nivel,</guimenu></menuchoice> seleccione <menuchoice><guimenu>Avanzado</guimenu></menuchoice> en el menú desplegable.
     </para>
    </step>
    <step>
     <para>
      Los resultados de la tabla se pueden filtrar por <literal>rbd_qos</literal> en el campo de búsqueda. Esto muestra todas las opciones de configuración disponibles para QoS.
     </para>
    </step>
    <step>
     <para>
      Para cambiar un valor, haga clic en la fila de la tabla y seleccione <guimenu>Editar</guimenu> en la parte superior izquierda de la tabla. El recuadro de diálogo <guimenu>Editar</guimenu> contiene seis campos diferentes para especificar valores. Los valores de la opción de configuración de RBD se deben indicar en el recuadro de texto <guimenu>mgr</guimenu>.
     </para>
     <note>
      <para>
       A diferencia de otros recuadros de diálogo, este no permite especificar el valor en unidades según convenga. Debe establecer estos valores en bytes o IOPS, dependiendo de la opción que esté editando.
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>Configuración de opciones en un nuevo repositorio</title>
   <para>
    Para crear un nuevo repositorio y configurar las opciones de configuración de RBD en él, haga clic en <menuchoice><guimenu>Repositorios</guimenu>
    <guimenu>Crear</guimenu></menuchoice>. Seleccione <guimenu>replicado</guimenu> como tipo de repositorio. A continuación, deberá añadir la etiqueta de aplicación <literal>rbd</literal> al repositorio para poder configurar las opciones de QoS de RBD.
   </para>
   <note>
    <para>
     No es posible configurar las opciones de configuración de QoS de RBD en un repositorio codificado de borrado. Para configurar las opciones de QoS de RBD para los repositorios codificados de borrado, debe editar el repositorio de metadatos replicados de una imagen RBD. A continuación, la configuración se aplicará al repositorio codificado de borrado de esa imagen.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>Configuración de opciones en un repositorio existente</title>
   <para>
    Para configurar las opciones de QoS de RBD en un repositorio existente, haga clic en <guimenu>Repositorios</guimenu>, haga clic en la fila del repositorio en la tabla y seleccione <guimenu>Editar</guimenu> en la parte superior izquierda de la tabla.
   </para>
   <para>
    Debería ver la sección <guimenu>Configuración de RBD</guimenu> en el recuadro de diálogo, seguida de una sección <guimenu>Calidad del servicio</guimenu>.
   </para>
   <note>
    <para>
     Si no ve las secciones <guimenu>Configuración de RBD</guimenu> ni <guimenu>Calidad del servicio</guimenu>, es probable que esté editando un repositorio <emphasis>codificado de borrado</emphasis>, que no se puede usar para establecer opciones de configuración de RBD, o bien que el repositorio no esté configurado para que las imágenes RBD lo puedan usar. En este último caso, asigne la etiqueta de aplicación <guimenu>rbd</guimenu> al repositorio y aparecerán las secciones de configuración correspondientes.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>Opciones de configuración</title>
   <para>
    Haga clic en el signo + de <guimenu>Calidad del servicio</guimenu> para abrir todas las opciones de configuración disponibles. Aparecerá una lista de todas las opciones disponibles. Las unidades de las opciones de configuración ya se muestran en los recuadros de texto. En el caso de las opciones de bytes por segundo (BPS), es posible utilizar accesos directos tales como "1M" o "5G". Se convertirán automáticamente a "1 MB/s" y "5 GB/s", respectivamente.
   </para>
   <para>
    Al hacer clic en el botón de restablecimiento situado a la derecha de cada recuadro de texto, se eliminará cualquier valor establecido en el repositorio. Esta acción no elimina los valores de configuración de las opciones configuradas globalmente o en una imagen RBD.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>Creación de opciones de QoS de RBD con una imagen RBD nueva</title>
   <para>
    Para crear una imagen RBD con las opciones de QoS de RBD establecidas en esa imagen, seleccione <menuchoice><guimenu>Bloque</guimenu> <guimenu>Imágenes</guimenu></menuchoice> y haga clic en <guimenu>Crear</guimenu>. Haga clic en <guimenu>Avanzado</guimenu> para expandir la sección de configuración avanzada. Haga clic en <guimenu>Calidad del servicio</guimenu> para abrir todas las opciones de configuración disponibles.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>Edición de las opciones de QoS de RBD en imágenes existentes</title>
   <para>
    Para editar las opciones de QoS de RBD en una imagen existente, seleccione <menuchoice><guimenu>Bloque</guimenu>
    <guimenu>Imágenes</guimenu></menuchoice>, haga clic en la fila del repositorio en la tabla y, por último, haga clic en <guimenu>Editar</guimenu>. Aparecerá el recuadro de diálogo de edición. Haga clic en <guimenu>Avanzado</guimenu> para expandir la sección de configuración avanzada. Haga clic en <guimenu>Calidad del servicio</guimenu> para abrir todas las opciones de configuración disponibles.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>Cambio de las opciones de configuración al copiar o clonar imágenes</title>
   <para>
    Si se clona o se copia una imagen RBD, los valores establecidos en esa imagen en particular también se copiarán por defecto. Si desea cambiarlos durante la copia o la clonación, puede hacerlo especificando los valores de configuración actualizados en el recuadro de diálogo correspondiente, del mismo modo que cuando se crear o se edita una imagen RBD. Al realizar esta acción, solo establecerá (o restablecerá) los valores de la imagen RBD que se va a copiar o clonar. Esta operación no cambia ni la configuración de la imagen RBD de origen ni la configuración global.
   </para>
   <para>
    Si decide restablecer el valor de la opción durante la copia o clonación, no se establecerá ningún valor para esa opción en esa imagen. Eso significa que cualquier valor de esa opción especificada para el repositorio padre se usará si el repositorio padre tiene el valor configurado. De lo contrario, se usará el valor por defecto global.
   </para>
  </sect2>
 </sect1>
</chapter>
