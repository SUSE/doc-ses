<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_manual_config.xml" version="5.0" xml:id="dashboard-initial-configuration">
 <title>Configuración manual</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  En esta sección se presenta información avanzada para los usuarios que prefieren configurar manualmente los valores de la consola en la línea de comandos.
 </para>
 <sect1 xml:id="dashboard-ssl">
  <title>Configuración de la compatibilidad con TLS/SSL</title>

  <para>
   Todas las conexiones HTTP a la consola están protegidas por defecto con TLS/SSL. Una conexión segura requiere un certificado SSL. Puede usar un certificado autofirmado o generar un certificado y hacer que una entidad de certificación (CA) conocida lo firme.
  </para>

  <tip>
   <title>inhabilitación de SSL</title>
   <para>
    A veces puede ser necesario inhabilitar SSL por algún motivo. Por ejemplo, si la consola se ejecuta mediante un proxy que no admite SSL.
   </para>
   <para>
    Tenga cuidado al inhabilitar SSL, ya que los <emphasis role="bold">nombres de usuario y las contraseñas</emphasis> se enviarán a la consola <emphasis role="bold">sin cifrar</emphasis>.
   </para>
   <para>
    Para inhabilitar SSL, ejecute:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/ssl false
</screen>
  </tip>

  <tip>
   <title>reinicio de los procesos de Ceph Manager</title>
   <para>
    Debe reiniciar los procesos de Ceph Manager manualmente después de cambiar el certificado SSL y la clave. Puede hacerlo ejecutando:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr fail <replaceable>ACTIVE-MANAGER-NAME</replaceable></screen>
   <para>
    o inhabilitando y volviendo a habilitar el módulo de consola, lo que también activa que el gestor se vuelva a reproducir a sí mismo:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard
<prompt>cephuser@adm &gt; </prompt>ceph mgr module enable dashboard
</screen>
  </tip>

  <sect2 xml:id="self-sign-certificates">
   <title>Creación de certificados autofirmados</title>
   <para>
    Crear un certificado autofirmado para establecer comunicaciones seguras es sencillo. Es una manera rápida de conseguir poner en funcionamiento la consola.
   </para>
   <note>
    <title>queja de los navegadores Web</title>
    <para>
     La mayoría de los navegadores Web producen una advertencia sobre los certificados autofirmados y requerirán que se confirmen explícitamente antes de establecer una conexión segura con la consola.
    </para>
   </note>
   <para>
    Para generar e instalar un certificado autofirmado, utilice el siguiente comando integrado:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard create-self-signed-cert
</screen>
  </sect2>

  <sect2 xml:id="cert-sign-CA">
   <title>Uso de certificados firmados por una CA</title>
   <para>
    Para proteger correctamente la conexión a la consola y eliminar las advertencias de los navegadores Web sobre los certificados autofirmados, se recomienda usar un certificado firmado por una CA.
   </para>
   <para>
    Puede generar un par de claves de certificado con un comando similar al siguiente:
   </para>
<screen>
<prompt role="root"># </prompt>openssl req -new -nodes -x509 \
  -subj "/O=IT/CN=ceph-mgr-dashboard" -days 3650 \
  -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</screen>
   <para>
    El comando anterior genera los archivos <filename>dashboard.key</filename> y <filename>dashboard.crt</filename>. Después de que una CA haya firmado el archivo <filename>dashboard.crt</filename>, habilítelo para todas las instancias de Ceph Manager ejecutando los comandos siguientes:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate-key -i dashboard.key
</screen>
   <tip>
    <title>certificados diferentes para cada instancia del gestor</title>
    <para>
     Si necesita certificados diferentes para cada instancia de Ceph Manager, modifique los comandos e incluya el nombre de la instancia de la siguiente manera. Sustituya <replaceable>NAME</replaceable> por el nombre de la instancia de Ceph Manager (normalmente es el nombre de host relacionado):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate <replaceable>NAME</replaceable> -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate-key <replaceable>NAME</replaceable> -i dashboard.key
</screen>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-hostname-port">
  <title>Cambio del nombre del host y el número del puerto</title>

  <para>
   Ceph Dashboard se asocia con una dirección TCP/IP y un puerto TCP específicos. Por defecto, la instancia de Ceph Manager activa actualmente donde se aloja la consola se vincula al puerto TCP 8443 (o al 8080 si SSL está inhabilitado).
  </para>

  <note>
   <para>
    Si hay un cortafuegos habilitado en los hosts en los que se ejecuta Ceph Manager (y, por lo tanto, Ceph Dashboard), es posible que deba cambiar la configuración para habilitar el acceso a estos puertos. Para obtener más información sobre la configuración del cortafuegos para Ceph, consulte el <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Ceph Dashboard se asocia por defecto con &quot;::&quot;, que corresponde a todas las direcciones IPv4 e IPv6 disponibles. Es posible cambiar la dirección IP y el número de puerto de la aplicación Web para que se apliquen a todas las instancias de Ceph Manager mediante los siguientes comandos:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>

  <tip>
   <title>configuración por separado de instancias de Ceph Manager</title>
   <para>
    Dado que cada daemon <systemitem class="daemon">ceph-mgr</systemitem> aloja su propia instancia de la consola, es posible que deba configurarlos por separado. Cambie la dirección IP y el número de puerto de una instancia específica del gestor mediante los comandos siguientes (sustituya <replaceable>NAME</replaceable> por el ID de la instancia de <systemitem class="daemon">ceph-mgr</systemitem>):
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>
  </tip>

  <tip>
   <title>listado de puestos finales configurados</title>
   <para>
    El comando <command>ceph mgr services</command> muestra todos los puestos finales que están configurados actualmente. Busque la clave <literal>dashboard</literal> para obtener la dirección URL con la que acceder a la consola.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-username-password">
  <title>Ajuste de nombres de usuario y contraseñas</title>

  <para>
   Si no desea utilizar la cuenta de administrador por defecto, cree una cuenta de usuario diferente y asóciela con al menos una función. Proporcionamos un conjunto de funciones de sistema predefinidos que puede usar. Para obtener más información, consulte el <xref linkend="dashboard-user-roles"/>.
  </para>

  <para>
   Para crear un usuario con privilegios de administrador, utilice el comando siguiente:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard ac-user-create <replaceable>USER_NAME</replaceable> <replaceable>PASSWORD</replaceable> administrator
</screen>
 </sect1>
 <sect1 xml:id="dashboard-ogw-enabling">
  <title>Habilitación del procesador frontal de gestión de Object Gateway</title>

  <para>
   Para utilizar la funcionalidad de gestión de Object Gateway de la consola, debe proporcionar las credenciales de entrada de un usuario con el indicador <option>system</option> habilitado:
  </para>

  <procedure>
   <step>
    <para>
     Si no tiene ningún usuario con el indicador <option>system</option>, cree uno:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user create --uid=<replaceable>USER_ID</replaceable> --display-name=<replaceable>DISPLAY_NAME</replaceable> --system
</screen>
    <para>
     Tome nota de las claves <replaceable>access_key</replaceable> y <replaceable>secret_key</replaceable> del resultado del comando.
    </para>
   </step>
   <step>
    <para>
     También puede obtener las credenciales de un usuario existente mediante el comando <command>radosgw-admin</command>:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user info --uid=<replaceable>USER_ID</replaceable>
</screen>
   </step>
   <step>
    <para>
     Proporcione las credenciales que ha recibido a la consola en archivos independientes:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-access-key <replaceable>ACCESS_KEY_FILE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-secret-key <replaceable>SECRET_KEY_FILE</replaceable>
</screen>
   </step>
  </procedure>

  <note>
   <para>
    Por defecto, el cortafuegos está habilitado en SUSE Linux Enterprise Server 15 SP3. Para obtener más información acerca de la configuración del cortafuegos, consulte el <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Se deben tener en cuenta varios puntos:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     El nombre de host y el número de puerto de Object Gateway se determinan automáticamente.
    </para>
   </listitem>
   <listitem>
    <para>
     Si se utilizan varias zonas, el host se determinará automáticamente dentro del grupo de zonas maestras y la zona maestra. Esto es suficiente para la mayoría de configuraciones, pero en algunas circunstancias es posible que sea necesario definir el nombre de host y el puerto manualmente:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-host <replaceable>HOST</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-port <replaceable>PORT</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Podría necesitar estos ajustes adicionales:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-scheme <replaceable>SCHEME</replaceable>  # http or https
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-admin-resource <replaceable>ADMIN_RESOURCE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-user-id <replaceable>USER_ID</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Si utiliza un certificado autofirmado (<xref linkend="dashboard-ssl"/>) en la configuración de Object Gateway, inhabilite la verificación del certificado en la consola para evitar que se rechacen conexiones debido a que haya certificados firmados por una CA desconocida o a que no coincidan con el nombre de host:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-ssl-verify False
</screen>
   </listitem>
   <listitem>
    <para>
     Si Object Gateway tarda demasiado en procesar las peticiones y se agota el tiempo de espera en la consola, el valor del tiempo de espera se puede ajustar (por defecto es de 45 segundos):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rest-requests-timeout <replaceable>SECONDS</replaceable>
</screen>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="dashboard-iscsi-management">
  <title>Habilitación de la gestión de iSCSI</title>

  <para>
   Ceph Dashboard gestiona los destinos iSCSI mediante la API REST proporcionada por el servicio <systemitem class="service">rbd-target-api</systemitem> de Ceph iSCSI Gateway. Asegúrese de que está instalado y habilitado en las pasarelas iSCSI.
  </para>

  <note>
   <para>
    La funcionalidad de gestión de iSCSI de Ceph Dashboard depende de la última versión 3 del proyecto <literal>ceph-iscsi</literal>. Asegúrese de que el sistema operativo proporciona la versión correcta; de lo contrario, Ceph Dashboard no habilitará las funciones de gestión.
   </para>
  </note>

  <para>
   Si la API REST <literal>ceph-iscsi</literal> está configurada en modo HTTPS y utiliza un certificado autofirmado, configure la consola para evitar la verificación del certificado SSL al acceder a la API ceph-iscsi.
  </para>

  <para>
   Inhabilite la verificación SSL de la API:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard set-iscsi-api-ssl-verification false</screen>

  <para>
   Defina las pasarelas iSCSI disponibles:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-list
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-add <replaceable>scheme</replaceable>://<replaceable>username</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>[:port]
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-rm <replaceable>gateway_name</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="dashboard-sso">
  <title>Habilitación de Single Sign-On</title>

  <para>
   <emphasis>Single Sign-On</emphasis> (SSO) es un método de control de acceso que permite a los usuarios entrar a la sesión mediante un único identificador y una contraseña en varias aplicaciones simultáneamente.
  </para>

  <para>
   Ceph Dashboard admite la autenticación externa de usuarios a través del protocolo SAML 2.0. Dado que la <emphasis>autorización</emphasis> la sigue realizando la consola, primero debe crear cuentas de usuario y asociarlas a las funciones deseadas. Sin embargo, el proceso de <emphasis>autenticación</emphasis> lo puede realizar un <emphasis>proveedor de identidades</emphasis> (IdP) existente.
  </para>

  <para>
   Para configurar Single Sign-On, utilice el siguiente comando:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso setup saml2 <replaceable>CEPH_DASHBOARD_BASE_URL</replaceable> \
 <replaceable>IDP_METADATA</replaceable> <replaceable>IDP_USERNAME_ATTRIBUTE</replaceable> \
 <replaceable>IDP_ENTITY_ID</replaceable> <replaceable>SP_X_509_CERT</replaceable> \
 <replaceable>SP_PRIVATE_KEY</replaceable>
</screen>

  <para>
   Parámetros:
  </para>

  <variablelist>
   <varlistentry>
    <term><replaceable>CEPH_DASHBOARD_BASE_URL</replaceable></term>
    <listitem>
     <para>
      La URL base desde la que se puede acceder a la Ceph Dashboard (por ejemplo, &quot;https://consolaceph.local&quot;).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_METADATA</replaceable></term>
    <listitem>
     <para>
      La URL, la vía o el contenido del XML de metadatos del IdP (por ejemplo, &quot;https://miidp/metadatos&quot;).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_USERNAME_ATTRIBUTE</replaceable></term>
    <listitem>
     <para>
      Opcional. El atributo que se usará para obtener el nombre de usuario de la respuesta de autenticación. El valor por defecto es &quot;uid&quot;.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_ENTITY_ID</replaceable></term>
    <listitem>
     <para>
      Opcional. Se usa cuando existe más de un ID de entidad en los metadatos del IdP.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>SP_X_509_CERT</replaceable> / <replaceable>SP_PRIVATE_KEY</replaceable></term>
    <listitem>
     <para>
      Opcional. Vía o contenido del certificado que usará la Ceph Dashboard (el proveedor de servicios) para la firma y el cifrado. Es necesario que se pueda acceder a estas vías de archivo desde la instancia activa de Ceph Manager.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>peticiones SAML</title>
   <para>
    Este patrón irá seguido del valor del emisor de las peticiones SAML:
   </para>
<screen>
<replaceable>CEPH_DASHBOARD_BASE_URL</replaceable>/auth/saml2/metadata
</screen>
  </note>

  <para>
   Para mostrar la configuración actual de SAML 2.0, ejecute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso show saml2
</screen>

  <para>
   Para inhabilitar Single Sign-On, ejecute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso disable
</screen>

  <para>
   Para comprobar si SSO está habilitado, ejecute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso status
</screen>

  <para>
   Para habilitar SSO, ejecute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso enable saml2
</screen>
 </sect1>
</chapter>
