<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>Gerenciar dispositivos de blocos RADOS</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sim</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Para listar todos os Dispositivos de Blocos RADOS (RBDs, RADOS Block Devices) disponíveis, clique em <menuchoice><guimenu>Bloco</guimenu><guimenu>Imagens</guimenu></menuchoice> no menu principal.
 </para>
 <para>
  A lista mostra informações resumidas sobre o dispositivo, como nome do dispositivo, nome do pool relacionado, namespace, tamanho do dispositivo, número e tamanho dos objetos no dispositivo, dados sobre aprovisionamento dos detalhes e pai.
 </para>
 <figure>
  <title>Lista de imagens RBD</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>Visualizando detalhes sobre RBDs</title>

  <para>
   Para ver informações mais detalhadas sobre um dispositivo, clique na linha dele na tabela:
  </para>

  <figure>
   <title>Detalhes do RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>Visualizando a configuração do RBD</title>

  <para>
   Para ver a configuração detalhada de um dispositivo, clique na linha dele na tabela e, em seguida, na guia <guimenu>Configuração</guimenu> na tabela inferior:
  </para>

  <figure>
   <title>Configuração do RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>Criando RBDs</title>

  <para>
   Para adicionar um novo dispositivo, clique em <guimenu>Criar</guimenu> na parte superior esquerda do cabeçalho da tabela e faça o seguinte na tela <guimenu>Criar RBD</guimenu>:
  </para>

  <figure>
   <title>Adicionando um novo RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     Insira o nome do novo dispositivo. Consulte o <xref linkend="sysreq-naming"/> para saber as limitações de nomeação.
    </para>
   </step>
   <step>
    <para>
     Selecione o pool com o aplicativo <option>rbd</option> atribuído que será usado como base para criação do novo dispositivo RBD.
    </para>
   </step>
   <step>
    <para>
     Especifique o tamanho do novo dispositivo.
    </para>
   </step>
   <step>
    <para>
     Especifique outras opções para o dispositivo. Para ajustar os parâmetros do dispositivo, clique em <guimenu>Avançado</guimenu> e insira os valores para tamanho do objeto, unidade de distribuição ou total de distribuições. Para inserir limites de Qualidade do Serviço (QdS), clique em <guimenu>Qualidade do Serviço</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Clique em <guimenu>Criar RBD</guimenu> para confirmar.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>Apagando RBDs</title>

  <para>
   Para apagar um dispositivo, selecione-o na linha da tabela. Clique na seta suspensa ao lado do botão <guimenu>Criar</guimenu> e clique em <guimenu>Excluir</guimenu>. Clique em <guimenu>Excluir RBD</guimenu> para confirmar a exclusão.
  </para>

  <tip>
   <title>Movendo RBDs para o lixo</title>
   <para>
    A exclusão de um RBD é uma ação irreversível. Em vez disso, se você <guimenu>Mover para Lixo</guimenu>, poderá restaurar o dispositivo posteriormente selecionando-o na guia <guimenu>Lixo</guimenu> da tabela principal e clicando em <guimenu>Restaurar</guimenu> na parte superior esquerda do cabeçalho da tabela.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>Criando instantâneos de dispositivo de blocos RADOS</title>

  <para>
   Para criar um instantâneo de Dispositivo de Blocos RADOS, selecione o dispositivo na linha da tabela, e o painel de conteúdo da configuração detalhada é exibido. Selecione a guia <guimenu>Instantâneos</guimenu> e clique em <guimenu>Criar</guimenu> na parte superior esquerda do cabeçalho da tabela. Insira o nome do instantâneo e clique em <guimenu>Criar Instantâneo do RBD</guimenu> para confirmar.
  </para>

  <para>
   Após selecionar um instantâneo, você poderá executar outras ações no dispositivo, como renomear, proteger, clonar, copiar ou apagar. <guimenu>Rollback</guimenu> restaura o estado do dispositivo com base no instantâneo atual.
  </para>

  <figure>
   <title>Instantâneos do RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>Espelhamento do RBD</title>

  <para>
   É possível espelhar as imagens de Dispositivo de Blocos RADOS de forma assíncrona entre dois clusters do Ceph. Você pode usar o Ceph Dashboard para configurar a replicação de imagens RBD entre dois ou mais clusters. Esse recurso está disponível em dois modos:
  </para>

  <variablelist>
   <varlistentry>
    <term>Com base em diário</term>
    <listitem>
     <para>
      Esse modo usa o recurso de registro de imagens RBD em diário para garantir a replicação consistente com o ponto no tempo e a falha entre os clusters.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Com base em instantâneo</term>
    <listitem>
     <para>
      Esse modo usa instantâneos de espelho de imagens RBD programados periodicamente ou criados manualmente para replicar imagens RBD consistentes com a falha entre os clusters.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   O espelhamento é configurado por pool nos clusters de peer e pode ser configurado em um subconjunto específico de imagens no pool ou configurado para espelhar automaticamente todas as imagens em um pool ao usar apenas o espelhamento com base em diário.
  </para>

  <para>
   O espelhamento é configurado usando o comando <command>rbd</command> que, por padrão, está instalado no SUSE Enterprise Storage 7. O daemon <systemitem class="daemon">rbd-mirror</systemitem> é responsável por capturar as atualizações da imagem do cluster de peer remoto e aplicá-las à imagem no cluster local. Consulte a <xref linkend="rbd-mirror-daemon-enable"/> para obter mais informações sobre como habilitar o daemon <systemitem class="daemon">rbd-mirror</systemitem>.
  </para>

  <para>
   Dependendo da necessidade de replicação, o espelhamento de Dispositivo de Blocos RADOS pode ser configurado para replicação unidirecional ou bidirecional:
  </para>

  <variablelist>
   <varlistentry>
    <term>Replicação unidirecional</term>
    <listitem>
     <para>
      Quando os dados são espelhados apenas de um cluster principal para um cluster secundário, o daemon <systemitem class="daemon">rbd-mirror</systemitem> é executado somente no cluster secundário.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Replicação bidirecional</term>
    <listitem>
     <para>
      Quando os dados são espelhados de imagens principais em um cluster para imagens não principais em outro cluster (e vice-versa), o daemon <systemitem class="daemon">rbd-mirror</systemitem> é executado nos dois clusters.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    Cada instância do daemon <systemitem class="daemon">rbd-mirror</systemitem> deve ser capaz de se conectar aos clusters do Ceph local e remoto simultaneamente, por exemplo, todos os hosts de monitor e OSD. Além disso, a rede deve ter largura de banda suficiente entre os dois data centers para processar a carga de trabalho de espelhamento.
   </para>
  </important>

  <tip>
   <title>Informações gerais</title>
   <para>
    Para obter informações gerais e a abordagem de linha de comando para espelhamento do Dispositivo de Blocos RADOS, consute a <xref linkend="ceph-rbd-mirror"/>.
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>Configurando clusters principais e secundários</title>
   <para>
    O cluster <emphasis>principal</emphasis> é onde o pool original com as imagens é criado. O cluster <emphasis>secundário</emphasis> é onde o pool ou as imagens são replicados do cluster <emphasis>principal</emphasis>.
   </para>
   <note>
    <title>Nomeação relativa</title>
    <para>
     Os termos <emphasis>principal</emphasis> e <emphasis>secundário</emphasis> podem ser relativos no contexto de replicação porque estão mais relacionados aos pools individuais do que aos clusters. Por exemplo, na replicação de duas vias, é possível espelhar um pool do cluster <emphasis>principal</emphasis> para o <emphasis>secundário</emphasis>. É possível também espelhar outro pool do cluster <emphasis>secundário</emphasis> para o <emphasis>principal</emphasis>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>Habilitando o daemon <systemitem class="daemon">rbd-mirror</systemitem></title>
   <para>
    Os procedimentos a seguir demonstram como executar as tarefas administrativas básicas para configurar o espelhamento usando o comando <command>rbd</command>. O espelhamento é configurado por pool nos clusters do Ceph.
   </para>
   <para>
    As etapas de configuração do pool devem ser executadas nos dois clusters de peer. Estes procedimentos consideram a existência de dois clusters, chamados "principal" e "secundário", acessíveis de um único host, por motivos de clareza.
   </para>
   <para>
    O daemon <systemitem class="daemon">rbd-mirror</systemitem> executa a replicação de dados do cluster real.
   </para>
   <procedure>
    <step>
     <para>
      Renomeie os arquivos <filename>ceph.conf</filename> e de chaveiro e copie-os do host principal para o host secundário:
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      Para habilitar o espelhamento em um pool com <command>rbd</command>, especifique <command>mirror pool enable</command>, o nome do pool e o modo de espelhamento:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       O modo de espelhamento pode ser <literal>image</literal> ou <literal>pool</literal>. Por exemplo:
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      No Ceph Dashboard, navegue até <menuchoice><guimenu>Bloco</guimenu><guimenu>Espelhamento</guimenu></menuchoice>. A tabela <guimenu>Daemons</guimenu> à esquerda mostra os daemons <systemitem class="daemon">rbd-mirror</systemitem> em execução ativa e a saúde deles.
     </para>
     <figure>
      <title>Executando daemons <systemitem class="daemon">rbd-mirror</systemitem></title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>Desabilitando o espelhamento</title>
   <para>
    Para desabilitar o espelhamento em um pool com <command>rbd</command>, especifique o comando <command>mirror pool disable</command> e o nome do pool:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    Quando o espelhamento é desabilitado dessa maneira em um pool, ele também é desabilitado em todas as imagens (no pool) para as quais ele foi explicitamente habilitado.
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>Inicializando peers</title>
   <para>
    Para que <systemitem class="daemon">rbd-mirror</systemitem> descubra seu cluster de peer, o peer precisa ser registrado no pool, e uma conta do usuário precisa ser criada. Esse processo pode ser automatizado com o <command>rbd</command> e usando os comandos <command>mirror pool peer bootstrap create</command> e <command>mirror pool peer bootstrap import</command>.
   </para>
   <para>
    Para criar manualmente um novo token de boot com o <command>rbd</command>, especifique o comando <command>mirror pool peer bootstrap create</command>, o nome de um pool, junto com o nome de um site opcional, para descrever o cluster local:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    A saída do <command>mirror pool peer bootstrap create</command> será um token que deve ser inserido no comando <command>mirror pool peer bootstrap import</command>. Por exemplo, no cluster principal:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm \
  1vbl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    Para importar manualmente o token de boot criado por outro cluster com o comando <command>rbd</command>, especifique o comando <command>mirror pool peer bootstrap import</command>, o nome do pool, um caminho de arquivo para o token criado (ou '-' para ler a entrada padrão), juntamente com um nome de site opcional para descrever o cluster local e uma direção de espelhamento (o padrão é <literal>rx-tx</literal> para espelhamento bidirecional, mas também pode ser definido como <literal>rx-only</literal> para espelhamento unidirecional):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    Por exemplo, no cluster secundário:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>Removendo o peer do cluster</title>
   <para>
    Para remover um cluster do Ceph de peer de espelhamento, com o comando <command>rbd</command>, especifique o comando <command>mirror pool peer remove</command>, o nome do pool e o UUID do peer (disponível ao executar o comando <command>rbd mirror pool info</command>):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Configurando a replicação de pool no Ceph Dashboard</title>
   <para>
    O daemon <systemitem class="daemon">rbd-mirror</systemitem> precisa ter acesso ao cluster principal para poder espelhar imagens RBD. Verifique se você seguiu as etapas na <xref linkend="rbd-mirror-peer-bootstrap"/> antes de continuar.
   </para>
   <procedure>
    <step>
     <para>
      Em ambos os clusters <emphasis>principal</emphasis> e <emphasis>secundário</emphasis>, crie pools com nomes idênticos e atribua o aplicativo <literal>rbd</literal> a eles. Consulte a <xref linkend="dashboard-pools-create"/> para obter mais detalhes sobre a criação de um novo pool.
     </para>
     <figure>
      <title>Criando um pool com o aplicativo RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Em ambos os painéis de controle dos clusters <emphasis>principal</emphasis> e <emphasis>secundário</emphasis>, navegue até <menuchoice><guimenu>Bloco</guimenu><guimenu>Espelhamento</guimenu></menuchoice>. Na tabela <guimenu>Pools</guimenu> à direita, clique no nome do pool que será replicado e, após clicar em <guimenu>Modo de Edição</guimenu>, selecione o modo de replicação. Neste exemplo, trabalharemos com um modo de replicação de <emphasis>pool</emphasis>, o que significa que todas as imagens em um determinado pool serão replicadas. Clique em <guimenu>Atualizar</guimenu> para confirmar.
     </para>
     <figure>
      <title>Configurando o modo de replicação</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>erro ou aviso sobre o cluster principal</title>
      <para>
       Após a atualização do modo de replicação, um flag de erro ou aviso aparecerá na coluna direita correspondente. Isso acontece porque o pool ainda não tem um usuário peer atribuído para replicação. Ignore esse flag para o cluster <emphasis>principal</emphasis> já que atribuímos um usuário peer apenas ao cluster <emphasis>secundário</emphasis>.
      </para>
     </important>
    </step>
    <step>
     <para>
      No Painel de Controle do cluster <emphasis>secundário</emphasis>, navegue até <menuchoice><guimenu>Bloco</guimenu><guimenu>Espelhamento</guimenu></menuchoice>. Adicione o peer do espelho do pool selecionando <guimenu>Adicionar Peer</guimenu>. Insira os detalhes do cluster <emphasis>principal</emphasis>:
     </para>
     <figure>
      <title>Adicionando credenciais do peer</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>Cluster Name</guimenu></term>
       <listitem>
        <para>
         Uma string exclusiva arbitrária que identifica o cluster principal, como “primary”. O nome do cluster precisa ser diferente do nome do cluster secundário real.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>ID do CephX</guimenu></term>
       <listitem>
        <para>
         O ID de usuário do Ceph que você criou como um peer de espelhamento. Neste exemplo, ele é o “rbd-mirror-peer”.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Endereços do Monitor</guimenu></term>
       <listitem>
        <para>
         Lista de endereços IP separados por vírgula dos nós do Ceph Monitor do cluster principal.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Chave do CephX</guimenu></term>
       <listitem>
        <para>
         A chave relacionada ao ID de usuário peer. Você pode recuperá-la executando o seguinte comando de exemplo no cluster principal:
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Clique em <guimenu>Enviar</guimenu> para confirmar.
     </para>
     <figure>
      <title>Lista de pools replicados</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>Verificando se a replicação de imagens RBD funciona</title>
   <para>
    Quando o daemon <systemitem class="daemon">rbd-mirror</systemitem> está em execução e a replicação de imagens RBD foi configurada no Ceph Dashboard, é hora de verificar se a replicação está realmente funcionando:
   </para>
   <procedure>
    <step>
     <para>
      No Ceph Dashboard do cluster <emphasis>principal</emphasis>, crie uma imagem RBD de modo que seu pool pai seja o pool que você já criou para fins de replicação. Habilite os recursos <option>Bloqueio exclusivo</option> e <option>Registro em diário</option> para a imagem. Consulte a <xref linkend="dashboard-rbds-create"/> para obter detalhes sobre como criar imagens RBD.
     </para>
     <figure>
      <title>Nova imagem RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Após criar a imagem que você deseja replicar, abra o Ceph Dashboard do cluster <emphasis>secundário</emphasis> e navegue até <menuchoice><guimenu>Bloco</guimenu><guimenu>Espelhamento</guimenu></menuchoice>. A tabela <guimenu>Pools</guimenu> à direita refletirá a mudança no número de imagens de <guimenu>Nº Remoto</guimenu> e sincronizará o número de imagens de <guimenu>Nº Local</guimenu>.
     </para>
     <figure>
      <title>Nova imagem RBD sincronizada</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>Andamento da replicação</title>
      <para>
       A tabela <guimenu>Imagens</guimenu> na parte inferior da página mostra o status da replicação das imagens RBD. A guia <guimenu>Problemas</guimenu> inclui possíveis problemas, a guia <guimenu>Sincronizando</guimenu> exibe o andamento da replicação de imagens e a guia <guimenu>Pronto</guimenu> lista todas as imagens com replicação bem-sucedida.
      </para>
      <figure>
       <title>Status da replicação das imagens RBD</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      No cluster <emphasis>principal</emphasis>, grave os dados na imagem RBD. No Ceph Dashboard do cluster <emphasis>secundário</emphasis>, navegue até <menuchoice><guimenu>Bloco</guimenu><guimenu>Imagens</guimenu></menuchoice> e monitore se o tamanho da imagem correspondente aumenta à medida que os dados no cluster principal são gravados.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>Gerenciando iSCSI Gateways</title>

  <tip>
   <title>Mais informações sobre gateways iSCSI</title>
   <para>
    Para obter mais informações gerais sobre os Gateways iSCSI, consulte o <xref linkend="cha-ceph-iscsi"/>.
   </para>
  </tip>

  <para>
   Para listar todos os gateways e imagens mapeadas disponíveis, clique em <menuchoice><guimenu>Bloco</guimenu><guimenu>iSCSI</guimenu></menuchoice> no menu principal. A guia <guimenu>Visão geral</guimenu> é aberta com a lista atual dos iSCSI Gateways configurados e das imagens RBD mapeadas.
  </para>

  <para>
   A tabela <guimenu>Gateways</guimenu> lista o estado de cada gateway, o número de destinos iSCSI e a quantidade de sessões. A tabela <guimenu>Imagens</guimenu> lista o nome de cada imagem mapeada, o tipo de backstore do nome do pool relacionado e outros detalhes estatísticos.
  </para>

  <para>
   A guia <guimenu>Destinos</guimenu> lista os destinos iSCSI configurados no momento.
  </para>

  <figure>
   <title>Lista de destinos iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Para ver informações mais detalhadas sobre um destino, clique na seta suspensa na linha da tabela de destinos. Um esquema estruturado em árvore é aberto com uma lista de discos, portais, iniciadores e grupos. Clique em um item para expandi-lo e ver seu conteúdo detalhado, opcionalmente com uma configuração relacionada na tabela à direita.
  </para>

  <figure>
   <title>Detalhes do destino iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>Adicionando destinos iSCSI</title>
   <para>
    Para adicionar um novo destino iSCSI, clique em <guimenu>Criar</guimenu> na parte superior esquerda da tabela <guimenu>Destinos</guimenu> e insira as informações necessárias.
   </para>
   <figure>
    <title>Adicionando um novo destino</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      Digite o endereço de destino do novo gateway.
     </para>
    </step>
    <step>
     <para>
      Clique em <guimenu>Adicionar portal</guimenu> e selecione um ou vários portais iSCSI na lista.
     </para>
    </step>
    <step>
     <para>
      Clique em <guimenu>Adicionar imagem</guimenu> e selecione uma ou várias imagens RBD para o gateway.
     </para>
    </step>
    <step>
     <para>
      Se você precisa usar a autenticação para acessar o gateway, ative a caixa de seleção <guimenu>Autenticação ACL</guimenu> e insira as credenciais. Você poderá encontrar opções de autenticação mais avançadas após ativar <guimenu>Autenticação mútua</guimenu> e <guimenu>Autenticação de descoberta</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Clique em <guimenu>Criar Destino</guimenu> para confirmar.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>Editando destinos iSCSI</title>
   <para>
    Para editar um destino iSCSI existente, clique na linha dele na tabela <guimenu>Destinos</guimenu> e clique em <guimenu>Editar</guimenu> na parte superior esquerda da tabela.
   </para>
   <para>
    Em seguida, você pode modificar o destino iSCSI, adicionar ou apagar portais e adicionar ou apagar imagens RBD relacionadas. Você também pode ajustar as informações de autenticação para o gateway.
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>Apagando destinos iSCSI</title>
   <para>
    Para apagar um destino iSCSI, selecione a linha da tabela e clique na seta suspensa ao lado do botão <guimenu>Editar</guimenu> e selecione <guimenu>Excluir</guimenu>. Ative <guimenu>Sim, desejo</guimenu> e clique em <guimenu>Excluir destino iSCSI</guimenu> para confirmar.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>Qualidade do Serviço (QdS) do RBD</title>

  <tip>
   <title>Para obter mais informações</title>
   <para>
    Para obter mais informações gerais e uma descrição das opções de configuração de QdS do RBD, consulte a <xref linkend="rbd-qos"/>.
   </para>
  </tip>

  <para>
   É possível configurar as opções de QdS em diferentes níveis.
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Globalmente
    </para>
   </listitem>
   <listitem>
    <para>
     Por pool
    </para>
   </listitem>
   <listitem>
    <para>
     Por imagem
    </para>
   </listitem>
  </itemizedlist>

  <para>
   A configuração <emphasis>global</emphasis> fica na parte superior da lista e será usada para todas as imagens RBD recém-criadas e para as imagens que não anulam esses valores no pool nem na camada da imagem RBD. Um valor de opção especificado globalmente pode ser anulado por pool ou por imagem. As opções especificadas em um pool serão aplicadas a todas as imagens RBD desse pool, exceto se forem anuladas por uma opção de configuração definida em uma imagem. As opções especificadas em uma imagem anularão as opções especificadas em um pool e globalmente.
  </para>

  <para>
   Dessa forma, é possível definir padrões globalmente, adaptá-los a todas as imagens RBD de um pool específico e anular a configuração do pool para imagens RBD individuais.
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>Configurando opções globalmente</title>
   <para>
    Para configurar as opções do Dispositivo de Blocos RADOS globalmente, selecione <menuchoice><guimenu>Cluster</guimenu>
    <guimenu>Configuração</guimenu></menuchoice> no menu principal.
   </para>
   <procedure>
    <step>
     <para>
      Para listar todas as opções de configuração global disponíveis, ao lado de <menuchoice><guimenu>Nível</guimenu></menuchoice>, escolha <menuchoice><guimenu>Avançado</guimenu></menuchoice> no menu suspenso.
     </para>
    </step>
    <step>
     <para>
      Em seguida, filtre os resultados da tabela por <literal>rbd_qos</literal> no campo de pesquisa. Esse procedimento lista todas as opções de configuração disponíveis para QdS.
     </para>
    </step>
    <step>
     <para>
      Para mudar um valor, clique na linha da tabela e selecione <guimenu>Editar</guimenu> na parte superior esquerda da tabela. A caixa de diálogo <guimenu>Editar</guimenu> inclui seus campos diferentes para especificar valores. Os valores da opção de configuração do RBD são obrigatórios na caixa de texto <guimenu>mgr.</guimenu>
     </para>
     <note>
      <para>
       Ao contrário das outras caixas de diálogo, esta não permite especificar o valor em unidades práticas. É necessário definir esses valores em bytes ou IOPS, dependendo da opção que você está editando.
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>Configurando opções em um novo pool</title>
   <para>
    Para criar um novo pool e definir opções de configuração do RBD nele, clique em <menuchoice><guimenu>Pools</guimenu>
    <guimenu>Criar</guimenu></menuchoice>. Selecione <guimenu>replicado</guimenu> como tipo de pool. Em seguida, você precisa adicionar a tag do aplicativo <literal>rbd</literal> ao pool para poder configurar as opções de QdS do RBD.
   </para>
   <note>
    <para>
     Não é possível definir opções de configuração de QdS do RBD em um pool codificado para eliminação. Para definir opções de QdS do RBD para pools codificados para eliminação, você precisa editar o pool replicado de metadados de uma imagem RBD. Na sequência, a configuração será aplicada ao pool de dados codificado para eliminação dessa imagem.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>Configurando opções em pool existente</title>
   <para>
    Para definir opções de QdS do RBD em um pool existente, clique em <guimenu>Pools</guimenu>, clique na linha do pool na tabela e selecione <guimenu>Editar</guimenu> na parte superior esquerda da tabela.
   </para>
   <para>
    Você deve ver a seção <guimenu>Configuração do RBD</guimenu> na caixa de diálogo, seguida de uma seção <guimenu>Qualidade do Serviço</guimenu>.
   </para>
   <note>
    <para>
     Se a seção <guimenu>Configuração do RBD</guimenu> ou <guimenu>Qualidade do Serviço</guimenu> não for exibida, provavelmente você estará editando um pool <emphasis>codificado para eliminação</emphasis>, que não pode ser usado para definir opções de configuração do RBD, ou o pool não foi configurado para uso por imagens RBD. Neste último caso, atribua a tag do aplicativo <guimenu>rbd</guimenu> ao pool, e as seções de configuração correspondentes serão exibidas.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>Opções de configuração</title>
   <para>
    Clique em <guimenu>Qualidade do Serviço +</guimenu> para expandir as opções de configuração. Uma lista de todas as opções disponíveis será exibida. As unidades das opções de configuração já aparecem nas caixas de texto. No caso de qualqer opção de bytes por segundo (BPS, bytes per second), use atalhos como “1M” ou “5G”. Eles serão automaticamente convertidos em “1 MB/s” e “5 GB/s”, respectivamente.
   </para>
   <para>
    Ao clicar no botão de redefinição à direita de cada caixa de texto, qualquer valor definido no pool será removido. Isso não remove os valores de configuração das opções definidas globalmente ou em uma imagem RBD.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>Criando opções de QdS do RBD com uma nova imagem RBD</title>
   <para>
    Para criar uma imagem RBD com opções de QdS do RBD definidas nela, selecione <menuchoice><guimenu>Bloco</guimenu> <guimenu>Imagens</guimenu></menuchoice> e clique em <guimenu>Criar</guimenu>. Clique em <guimenu>Avançado...</guimenu> para expandir a seção de configuração avançada. Clique em <guimenu>Qualidade do Serviço +</guimenu> para abrir todas as opções de configuração disponíveis.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>Editando opções de QdS do RBD em imagens existentes</title>
   <para>
    Para editar as opções de QdS do RBD em uma imagem existente, selecione <menuchoice><guimenu>Bloco</guimenu>
    <guimenu>Imagens</guimenu></menuchoice>, clique na linha do pool na tabela e, por último, clique em <guimenu>Editar</guimenu>. A caixa de diálogo de edição será exibida. Clique em <guimenu>Avançado...</guimenu> para expandir a seção de configuração avançada. Clique em <guimenu>Qualidade do Serviço +</guimenu> para abrir todas as opções de configuração disponíveis.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>Mudando as opções de configuração ao copiar ou clonar imagens</title>
   <para>
    Se uma imagem RBD for clonada ou copiada, os valores definidos nela também serão copiados por padrão. Para mudá-los durante a cópia ou clonagem, você pode especificar os valores de configuração atualizados na caixa de diálogo de cópia/clonagem da mesma forma que na criação ou edição de uma imagem RBD. Esse procedimento apenas definirá (ou redefinirá) os valores para a imagem RBD que é copiada ou clonada. Essa operação não muda a configuração da imagem RBD de origem nem a configuração global.
   </para>
   <para>
    Se você redefinir o valor da opção durante a cópia/clonagem, nenhum valor para essa opção será definido nessa imagem. Isso significa que qualquer valor dessa opção especificado para o pool pai será usado se o pool pai tiver o valor configurado. Do contrário, o padrão global será usado.
   </para>
  </sect2>
 </sect1>
</chapter>
