<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Configuração de alta disponibilidade do nó de admin</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sim</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  O <emphasis>Nó de Admin</emphasis> é um nó de cluster do Ceph em que o serviço do Master Salt é executado. Ele gerencia o restante dos nós do cluster consultando e instruindo os serviços do Minion Salt. Normalmente, ele também inclui outros serviços, por exemplo, o painel de controle do <emphasis>Grafana</emphasis> com suporte do kit de ferramentas de monitoramento do <emphasis>Prometheus</emphasis>.
 </para>
 <para>
  Em caso de falha no Nó de Admin, geralmente você precisa fornecer um novo hardware ativo para o nó e restaurar a pilha completa de configuração do cluster de um backup recente. Esse é um método demorado e provoca interrupção no cluster.
 </para>
 <para>
  Para evitar o tempo de espera no desempenho do cluster do Ceph causado pela falha no Nó de Admin, é recomendável usar o cluster de Alta Disponibilidade (HA, High Availability) para o Nó de Admin do Ceph.
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Estrutura do cluster de HA para o nó de admin</title>

  <para>
   A ideia de um cluster de HA é que, em caso de falha em um nó do cluster, o outro nó assume automaticamente a função dele, incluindo o Nó de Admin virtualizado. Dessa forma, os outros nós do cluster do Ceph não percebem a falha no Nó de Admin.
  </para>

  <para>
   A solução de HA mínima para o Nó de Admin requer o seguinte hardware:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Dois servidores completamente vazios capazes de executar o SUSE Linux Enterprise com a extensão de Alta Disponibilidade e de virtualizar o Nó de Admin.
    </para>
   </listitem>
   <listitem>
    <para>
     Dois ou mais caminhos de comunicação de rede redundantes. Por exemplo, via Ligação de Dispositivo de Rede.
    </para>
   </listitem>
   <listitem>
    <para>
     Armazenamento compartilhado para hospedar a(s) imagem(ns) de disco da máquina virtual do Nó de Admin. O armazenamento compartilhado precisa ser acessível aos dois servidores. Por exemplo, ele pode ser uma exportação NFS, um compartilhamento do Samba ou um destino iSCSI.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Encontre mais detalhes sobre os requisitos de cluster no site <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/art-sleha-install-quick.html#sec-ha-inst-quick-req"/>.
  </para>

  <figure>
   <title>Cluster de HA de 2 nós para o Nó de Admin</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>Criando um cluster de HA com o nó de admin</title>

  <para>
   O procedimento a seguir resume as etapas mais importantes de criação do cluster de HA para virtualização do Nó de Admin. Para obter detalhes, consulte os links indicados.
  </para>

  <procedure>
   <step>
    <para>
     Configure um cluster de HA básico de 2 nós com armazenamento compartilhado, conforme descrito em <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/art-sleha-install-quick.html"/>.
    </para>
   </step>
   <step>
    <para>
     Em ambos os nós do cluster, instale todos os pacotes necessários para executar o hipervisor KVM e o kit de ferramentas <systemitem class="library">libvirt</systemitem>, conforme descrito em <link xlink:href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-vt-installation.html#sec-vt-installation-kvm"/>.
    </para>
   </step>
   <step>
    <para>
     No primeiro nó do cluster, crie uma nova VM (Virtual Machine – Máquina Virtual) KVM usando o <systemitem class="library">libvirt</systemitem>, conforme descrito em <link xlink:href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-kvm-inst.html#sec-libvirt-inst-virt-install"/>. Use o armazenamento compartilhado pré-configurado para armazenar as imagens de disco da VM.
    </para>
   </step>
   <step>
    <para>
     Após o término da configuração da VM, exporte sua configuração para um arquivo XML no armazenamento compartilhado. Use a seguinte sintaxe:
    </para>
<screen>
<prompt role="root">root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Crie um recurso para a VM do Nó de Admin. Consulte <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/cha-conf-hawk2.html"/> para obter informações gerais sobre a criação de recursos de HA. Há informações detalhadas sobre a criação de recursos para uma máquina virtual KVM descritas em <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/>.
    </para>
   </step>
   <step>
    <para>
     No convidado da VM recém-criado, implante o Nó de Admin, incluindo os serviços adicionais necessários nele. Siga as etapas relevantes na <xref linkend="deploy-salt"/>. Ao mesmo tempo, implante os nós de cluster do Ceph restantes nos servidores de cluster não HA.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
