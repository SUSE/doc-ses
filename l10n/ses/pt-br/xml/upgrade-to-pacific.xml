<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="upgrade-to-pacific.xml" version="5.0" xml:id="upgrade-to-pacific">
 <title>Upgrade do SUSE Enterprise Storage 7 para 7.1</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Este capítulo apresenta as etapas para fazer upgrade do SUSE Enterprise Storage 7 para a versão 7.1.
 </para>
 <para>
  O upgrade inclui as seguintes tarefas:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Fazer upgrade do SUSE Linux Enterprise Server subjacente e do SUSE Linux Enterprise Server 15 SP2 para a versão SUSE Linux Enterprise Server 15 SP3.
   </para>
  </listitem>
  <listitem>
   <para>
    Fazer upgrade do Ceph Octopus para o Pacific.
   </para>
  </listitem>
 </itemizedlist>
 <sect1 xml:id="before-upgrade-7p">
  <title>Antes de fazer upgrade</title>

  <para>
   As tarefas a seguir <emphasis>devem</emphasis> ser concluídas antes de você iniciar o upgrade. Isso pode ser feito a qualquer momento durante a vida útil do SUSE Enterprise Storage 7.
  </para>

  <sect2 xml:id="upgrade-consider-points-7p">
   <title>Pontos a serem considerados</title>
   <para>
    Antes de fazer upgrade, leia as seções a seguir para garantir que você entenda todas as tarefas que precisam ser executadas.
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <emphasis>Ler os detalhes da versão</emphasis>. Neles, você encontra mais informações sobre o que mudou desde a versão anterior do SUSE Enterprise Storage. Consulte os detalhes da versão para verificar se:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Seu hardware precisa de considerações especiais.
       </para>
      </listitem>
      <listitem>
       <para>
        Qualquer pacote de software usado foi significativamente modificado.
       </para>
      </listitem>
      <listitem>
       <para>
        São necessárias precauções especiais para a instalação.
       </para>
      </listitem>
     </itemizedlist>
     <para>
      Os detalhes da versão também apresentam informações que não puderam ser incluídas a tempo no manual. Eles também incluem notas sobre problemas conhecidos.
     </para>
     <para>
      Você encontra os detalhes da versão do SES 7.1 online em <link xlink:href="https://www.suse.com/releasenotes/"/>.
     </para>
     <para>
      Além disso, após a instalação do pacote <package>release-notes-ses</package> do repositório SES 7.1, você encontrará os detalhes da versão no diretório local <filename>/usr/share/doc/release-notes</filename> ou online em <link xlink:href="https://www.suse.com/releasenotes/"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      Leia o <xref linkend="ses-deployment"/> para se familiarizar com o <systemitem class="resource">ceph-salt</systemitem> e o orquestrador do Ceph, especialmente as informações sobre as especificações do serviço.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="upgrade-backup-config-data-7p">
   <title>Fazendo backup da configuração e dos dados do cluster</title>
   <para>
    É altamente recomendável fazer backup de todas as configurações e os dados do cluster antes de iniciar o upgrade. Para obter instruções sobre como fazer backup de todos os seus dados, consulte <xref linkend="cha-deployment-backup"/>.
   </para>
  </sect2>

  <sect2 xml:id="verify-previous-upgrade-patch-repos-7p">
   <title>Verificando o acesso a repositórios do software e imagens de container</title>
   <para>
    Verifique se cada nó do cluster tem acesso aos repositórios do software SUSE Linux Enterprise Server 15 SP3 e SUSE Enterprise Storage 7.1 e também ao registro de imagens de container.
   </para>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-repos-7p">
    <title>Repositórios do software</title>
    <para>
     Se todos os nós foram registrados no SCC, você poderá usar o comando <command>zypper migration</command> para fazer upgrade. Consulte <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/> para obter mais detalhes.
    </para>
    <para>
     Se os nós <emphasis role="bold">não</emphasis> foram registrados no SCC, desabilite todos os repositórios existentes do software e adicione os dois repositórios <literal>Pool</literal> e <literal>Updates</literal> para cada uma das seguintes extensões:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       SLE-Product-SLES/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Basesystem/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Server-Applications/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SUSE-Enterprise-Storage-7.1
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-images-7p">
    <title>Imagens de container</title>
    <para>
     Todos os nós do cluster precisam acessar o registro de imagens de container. Na maioria dos casos, você usará o registro público do SUSE em <literal>registry.suse.com</literal>. Você precisa das seguintes imagens:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/ceph
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/grafana
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-server
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-node-exporter
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-alertmanager
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Por exemplo, para implantações isoladas (air-gapped), uma alternativa é configurar um registro local e verificar se você tem o conjunto correto de imagens de container disponível. Consulte a <xref linkend="deploy-cephadm-configure-registry"/> para obter mais detalhes sobre como configurar um registro de imagens de container local.
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="upgrade-cluster-nodes">
  <title>Migrar o SUSE Linux Enterprise Server em cada nó do cluster para a versão SUSE Linux Enterprise Server 15 SP3</title>

  <para>
   Se os nós do cluster foram configurados para usar o SUSE Customer Center, você pode usar o comando <command>zypper migration</command>.
  </para>

  <para>
   Se os repositórios de software dos nós do cluster foram configurados manualmente, você precisa fazer upgrade manual dos nós.
  </para>

  <para>
   Para obter informações detalhadas sobre o upgrade do SUSE Linux Enterprise Server usando o <command>zypper</command>, consulte <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>.
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-packages">
  <title>Atualizar os pacotes relacionados ao SUSE Enterprise Storage em cada nó do cluster</title>

  <para>
   Para atualizar os pacotes do SUSE Enterprise Storage para a versão mais recente, use o comando <command>ceph-salt update</command>. Para obter mais detalhes, visite <xref linkend="cephadm-rolling-updates"/>.
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-services">
  <title>Fazer upgrade dos serviços de cluster existentes do Ceph</title>

  <para>
   Faça upgrade de todo o cluster do Ceph para a versão Pacific executando o seguinte comando do Nó de Admin:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch upgrade start --image registry.suse.com/ses/7.1/ceph/ceph</screen>
 </sect1>
</chapter>
