<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="manager_modules.xml" version="5.0" xml:id="cha-mgr-modules">
 <title>Moduli di Ceph Manager</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  L&apos;architettura di Ceph Manager (per una breve presentazione, consultare questo riferimento: <xref linkend="storage-intro-core-nodes"/>) consente di estendere le sue funzionalità tramite i <emphasis>moduli</emphasis>, come &quot;dashboard&quot; (vedere il <xref linkend="part-dashboard"/>), &quot;prometheus&quot; (vedere il <xref linkend="monitoring-alerting"/>) o &quot;servizio di bilanciamento&quot;.
 </para>
 <para>
  Per visualizzare un elenco di tutti i moduli disponibili, eseguire:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module ls
{
        "enabled_modules": [
                "restful",
                "status"
        ],
        "disabled_modules": [
                "dashboard"
        ]
}</screen>
 <para>
  Per abilitare o disabilitare un modulo specifico, eseguire:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable <replaceable>MODULE-NAME</replaceable></screen>
 <para>
  Esempio:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard</screen>
 <para>
  Per visualizzare un elenco dei servizi forniti dai moduli abilitati, eseguire:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr services
{
        "dashboard": "http://myserver.com:7789/",
        "restful": "https://myserver.com:8789/"
}</screen>
 <sect1 xml:id="mgr-modules-balancer">
  <title>Servizio di bilanciamento</title>

  <para>
   Il modulo del servizio di bilanciamento consente di ottimizzare la distribuzione del gruppo di posizionamento (PG) sugli OSD per una distribuzione più bilanciata. Anche se attivato per default, il modulo è inattivo. Supporta le due modalità seguenti: <literal>crush-compat</literal> e <literal>upmap</literal>.
  </para>

  <tip>
   <title>configurazione e stato attuali del servizio di bilanciamento</title>
   <para>
    Per visualizzare le informazioni sulla configurazione e sullo stato attuali del servizio di bilanciamento, eseguire:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer status</screen>
  </tip>

  <sect2 xml:id="mgr-balancer-crush-compat">
   <title>Modalità &quot;crush-compat&quot;</title>
   <para>
    Nella modalità &quot;crush-compat&quot;, il servizio di bilanciamento regola il valore reweight-sets degli OSD per ottenere una migliore distribuzione dei dati. Sposta i gruppi di posizionamento tra gli OSD, attivando temporaneamente lo stato <literal>HEALTH_WARN</literal> sul cluster derivante dalla posizione errata dei gruppi di posizionamento.
   </para>
   <tip>
    <title>attivazione della modalità</title>
    <para>
     Anche se &quot;crush-compat&quot; è la modalità di default, si consiglia di attivarla esplicitamente:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer mode crush-compat</screen>
   </tip>
  </sect2>

  <sect2 xml:id="mgr-balancer-planning-executing">
   <title>Pianificazione ed esecuzione del bilanciamento dei dati</title>
   <para>
    Tramite il modulo del servizio di bilanciamento, è possibile pianificare il bilanciamento dei dati. È quindi possibile eseguire manualmente tale pianificazione oppure impostare il bilanciamento continuo dei gruppi di posizionamento tramite il servizio di bilanciamento.
   </para>
   <para>
    La scelta di eseguire il servizio di bilanciamento in modalità automatica o manuale dipende da diversi fattori, come lo squilibrio dei dati attuali, le dimensioni del cluster, il numero di gruppi di posizionamento o l&apos;attività I/O. Si consiglia di creare una pianificazione iniziale e di eseguirla quando il carico I/O sul cluster è ridotto. Infatti, lo squilibrio iniziale sarà probabilmente notevole ed è quindi consigliabile mantenere basso l&apos;impatto sui client. Dopo l&apos;iniziale esecuzione manuale, considerare l&apos;attivazione della modalità automatica e monitorare il traffico di ribilanciamento in condizioni di carico I/O normale. I miglioramenti apportati alla distribuzione del gruppo di posizionamento devono essere ponderati in base al traffico di ribilanciamento creato dal servizio di bilanciamento.
   </para>
   <tip>
    <title>frazione mobile dei gruppi di posizionamento (PG)</title>
    <para>
     Durante il processo di bilanciamento, il modulo del servizio di bilanciamento limita i movimenti del gruppo di posizionamento per fare in modo che ne venga spostata soltanto una frazione configurabile. Il valore di default è 5% ed è possibile regolare la frazione, ad esempio sul 9%, eseguendo il comando seguente:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr target_max_misplaced_ratio .09</screen>
   </tip>
   <para>
    Per creare ed eseguire una pianificazione del bilanciamento, seguire la procedura indicata di seguito:
   </para>
   <procedure>
    <step>
     <para>
      Controllare il punteggio del cluster corrente:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval</screen>
    </step>
    <step>
     <para>
      Creare una pianificazione. Ad esempio, &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer optimize great_plan</screen>
    </step>
    <step>
     <para>
      Verificare i cambiamenti implicati dall&apos;uso di &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer show great_plan</screen>
    </step>
    <step>
     <para>
      Controllare il punteggio potenziale del cluster se si dovesse decidere di applicare &quot;great_plan&quot;:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval great_plan</screen>
    </step>
    <step>
     <para>
      Eseguire &quot;great_plan&quot; per una sola volta:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer execute great_plan</screen>
    </step>
    <step>
     <para>
      Osservare il bilanciamento del cluster con il comando <command>ceph -s</command>. Se si è soddisfatti del risultato, attivare il bilanciamento automatico:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer on</screen>
     <para>
      Se in un secondo momento si decide di disattivare il bilanciamento automatico, eseguire:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer off</screen>
    </step>
   </procedure>
   <tip>
    <title>bilanciamento automatico senza pianificazione iniziale</title>
    <para>
     È possibile attivare il bilanciamento automatico senza eseguire una pianificazione iniziale. In questo caso, l&apos;esecuzione del ribilanciamento dei gruppi di posizionamento potrebbe impiegare molto tempo.
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="mgr-modules-telemetry">
  <title>Abilitazione del modulo di telemetria</title>

  <para>
   Il plug-in di telemetria consente di inviare i dati anonimi del progetto Ceph relativi al cluster su cui è in esecuzione il plug-in.
  </para>

  <para>
   Questo componente (che richiede il consenso esplicito) contiene contatori e statistiche sulla modalità di distribuzione del cluster, sulla versione di Ceph, sulla distribuzione degli host e su altri parametri, che consentono di comprendere meglio l&apos;utilizzo di Ceph. Non contiene nessun dato sensibile come nomi dei pool, nomi e contenuto di oggetti o nomi host.
  </para>

  <para>
   Lo scopo del modulo di telemetria consiste nel fornire agli sviluppatori un ciclo di feedback automatizzato per agevolare il calcolo dei tassi di adozione, il controllo o l&apos;individuazione degli aspetti da approfondire o convalidare ulteriormente durante la configurazione per evitare risultati indesiderati.
  </para>

  <note>
   <para>
    Per essere in grado di inviare i dati su HTTPS ai server upstream, il modulo di telemetria richiede i nodi Ceph Manager. Assicurarsi che i firewall aziendali consentano questa azione.
   </para>
  </note>

  <procedure>
   <step>
    <para>
     Per abilitare il modulo di telemetria:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable telemetry</screen>
    <note>
     <para>
      Questo comando consente soltanto di visualizzare i dati a livello locale. Questo comando non condivide i dati con la community di Ceph.
     </para>
    </note>
   </step>
   <step>
    <para>
     Per consentire al modulo di telemetria di avviare la condivisione dei dati:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry on</screen>
   </step>
   <step>
    <para>
     Per disabilitare la condivisione dei dati di telemetria:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry off</screen>
   </step>
   <step>
    <para>
     Per generare un rapporto JSON stampabile:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry show</screen>
   </step>
   <step>
    <para>
     Per aggiungere un contatto e una descrizione al rapporto:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/contact John Doe john.doe@example.com
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/description 'My first Ceph cluster'</screen>
   </step>
   <step>
    <para>
     Per default, il modulo compila e invia un nuovo rapporto ogni 24 ore. Per modificare questo intervallo:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/interval <replaceable>HOURS</replaceable></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
