<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_nfsganesha.xml" version="5.0" xml:id="cha-ceph-nfsganesha">

 <title>NFS Ganesha</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  NFS Ganesha è un server NFS che viene eseguito in uno spazio di indirizzamento dell&apos;utente come parte del kernel del sistema operativo. Con NFS Ganesha, è possibile collegare un meccanismo di memorizzazione, come Ceph, e accedervi da qualsiasi client NFS. Per istruzioni sull&apos;installazione, vedere <xref linkend="deploy-cephadm-day2-service-nfs"/>.
 </para>
 <note>
  <title>prestazioni di NFS Ganesha</title>
  <para>
   A causa dell&apos;aumento dell&apos;overhead del protocollo e della latenza aggiuntiva causati dagli hop di rete extra tra il client e lo storage, l&apos;accesso a Ceph tramite un gateway NFS potrebbe ridurre notevolmente le prestazioni dell&apos;applicazione se confrontate con quelle del CephFS nativo.
  </para>
 </note>
 <para>
  Ogni servizio NFS Ganesha è composto da una gerarchia di configurazione contenente:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Un <filename>ganesha.conf</filename> di bootstrap
   </para>
  </listitem>
  <listitem>
   <para>
    Un oggetto di configurazione comune RADOS per ciascun servizio
   </para>
  </listitem>
  <listitem>
   <para>
    Un oggetto di configurazione RADOS per ciascuna esportazione
   </para>
  </listitem>
 </itemizedlist>
 <para>
  La configurazione di bootstrap è la configurazione minima per l&apos;avvio del daemon <systemitem class="daemon">nfs-ganesha</systemitem> all&apos;interno di un container. Ciascuna configurazione di bootstrap conterrà una direttiva <literal>%url</literal> che include eventuali configurazioni aggiuntive dell&apos;oggetto di configurazione comune RADOS. L&apos;oggetto di configurazione comune può includere ulteriori direttive <literal>%url</literal> per ciascuna delle esportazioni NFS definite negli oggetti di configurazione RADOS di esportazione.
 </para>
 <figure>
  <title>Struttura di NFS Ganesha</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="nfs_ganesha_structure.png" width="75%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="nfs_ganesha_structure.png" width="75%"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="ceph-nfsganesha-nfservice">
  <title>Creazione di un servizio NFS</title>

  <para>
   Per specificare la distribuzione dei servizi Ceph, si consiglia di creare un file con formattazione YAML contenente la specifica dei servizi da distribuire. È possibile creare un file della specifica separato per ogni tipo di servizio oppure specificare più tipi di servizi (o tutti) in un unico file.
  </para>

  <para>
   A seconda dell&apos;opzione scelta, per creare un servizio NFS Ganesha, sarà necessario aggiornare o creare un file con formattazione YAML pertinente. Per ulteriori informazioni sulla creazione del file, vedere <xref linkend="cephadm-service-and-placement-specs"/>.
  </para>

  <para>
   Dopo aver aggiornato o creato il file eseguire quanto riportato di seguito per creare un servizio <literal>nfs-ganesha</literal>:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph orch apply -i <replaceable>FILE_NAME</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-services">
  <title>Avvio o riavvio di NFS Ganesha</title>

  <important>
   <para>
    L&apos;avvio del servizio NFS Ganesha non esporta automaticamente un file system CephFS. Per esportare un file system CephFS, creare un file di configurazione di esportazione. Per ulteriori dettagli, fare riferimento alla <xref linkend="ceph-nfsganesha-create-export"/>.
   </para>
  </important>

  <para>
   Per avviare il servizio NFS Ganesha, eseguire:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch start nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Per riavviare il servizio NFS Ganesha, eseguire:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch restart nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Se si desidera riavviare soltanto un singolo daemon NFS Ganesha, eseguire:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch daemon restart nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Quando si avvia o riavvia NFS Ganesha, il timeout di tolleranza per NFS v4 è di 90 secondi. Durante la moratoria, le nuove richieste dai client vengono rifiutate attivamente. Pertanto, è possibile che i client subiscano un rallentamento delle richieste durante la moratoria di NFS.
  </para>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-list-objects">
  <title>Elenco di oggetti nel pool di recupero NFS</title>

  <para>
   Eseguire quanto riportato di seguito per elencare gli oggetti nel pool di recupero NFS:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>rados --pool <replaceable>POOL_NAME</replaceable> --namespace <replaceable>NAMESPACE_NAME</replaceable> ls</screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-create-export">
  <title>Creazione di un&apos;esportazione NFS</title>

  <para>
   È possibile creare un&apos;esportazione NFS nel Ceph Dashboard oppure manualmente, dalla riga di comando. Per creare l&apos;esportazione mediante il Ceph Dashboard, fare riferimento al <xref linkend="dash-webui-nfs"/> e più specificamente alla <xref linkend="dash-webui-nfs-create"/>.
  </para>

  <para>
   Per creare manualmente un&apos;esportazione NFS, creare un file di configurazione per l&apos;esportazione. Ad esempio, un file <filename>/tmp/export-1</filename> con il seguente contenuto:
  </para>

<screen>
EXPORT {
    export_id = 1;
    path = "/";
    pseudo = "/";
    access_type = "RW";
    squash = "no_root_squash";
    protocols = 3, 4;
    transports = "TCP", "UDP";
    FSAL {
        name = "CEPH";
        user_id = "admin";
        filesystem = "a";
        secret_access_key = "<replaceable>SECRET_ACCESS_KEY</replaceable>";
    }
}
</screen>

  <para>
   Dopo aver creato e salvato il file di configurazione per la nuova esportazione, eseguire il seguente comando per creare l&apos;esportazione:
  </para>

<screen>rados --pool <replaceable>POOL_NAME</replaceable> --namespace <replaceable>NAMESPACE_NAME</replaceable> put <replaceable>EXPORT_NAME</replaceable> <replaceable>EXPORT_CONFIG_FILE</replaceable></screen>

  <para>
   Ad esempio:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>rados --pool example_pool --namespace example_namespace put export-1 /tmp/export-1</screen>

  <note>
   <para>
    Modificare il blocco FSAL in modo che includa l&apos;ID utente <systemitem class="service">cephx</systemitem> desiderato e la chiave di accesso segreta.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-verify">
  <title>Verifica dell&apos;esportazione NFS</title>

  <para>
   NFS v4 crea un elenco di esportazioni nella radice di uno pseudo file system. È possibile verificare che le condivisioni NFS vengano esportate montando <filename>/</filename> del nodo del server NFS Ganesha:
  </para>

<screen><prompt role="root"># </prompt><command>mount</command> -t nfs <replaceable>nfs_ganesha_server_hostname:/ /path/to/local/mountpoint</replaceable>
<prompt role="root"># </prompt><command>ls</command> <replaceable>/path/to/local/mountpoint</replaceable> cephfs</screen>

  <note>
   <title>NFS Ganesha è disponibile solo nella versione v4</title>
   <para>
    Per default, cephadm configurerà un server NFS v4. NFS v4 non interagisce con <literal>rpcbind</literal> o con il daemon <literal>mountd</literal>. Gli strumenti del client NFS, come <command>showmount</command>, non visualizzeranno nessuna esportazione configurata.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-mount">
  <title>Montaggio dell&apos;esportazione NFS</title>

  <para>
   Per montare la condivisione NFS esportata su un host client, eseguire:
  </para>

<screen><prompt role="root"># </prompt><command>mount</command> -t nfs <replaceable>nfs_ganesha_server_hostname:/ /path/to/local/mountpoint</replaceable></screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-customrole">
  <title>Cluster NFS Ganesha multipli</title>

  <para>
   È possibile definire più cluster NFS Ganesha per:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Separare i cluster NFS Ganesha per l&apos;accesso a CephFS.
    </para>
   </listitem>
  </itemizedlist>


 </sect1>
</chapter>
