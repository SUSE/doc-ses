<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Configurazione ad elevata disponibilità del nodo admin</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sì</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Il <emphasis>nodo admin </emphasis> è un nodo del cluster Ceph dove è in esecuzione il servizio Salt Master. Gestisce il resto dei nodi del cluster tramite l'invio di interrogazioni e istruzioni ai rispettivi servizi Salt Minion. Comprende in genere anche altri servizi, ad esempio il dashboard <emphasis>Grafana</emphasis> supportato dal kit di strumenti di monitoraggio <emphasis>Prometheus</emphasis>.
 </para>
 <para>
  In caso di errore del nodo admin, occorre di solito fornire un nuovo hardware funzionante per il nodo e ripristinare lo stack di configurazione cluster completo da un backup recente. Tale metodo richiede tempo e determina l'indisponibilità del cluster.
 </para>
 <para>
  Per evitare il tempo di fermo delle prestazioni del cluster Ceph provocati dall'errore del nodo admin, si consiglia di utilizzare il cluster ad elevata disponibilità (High Availability, HA) per il nodo admin Ceph.
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Profilo del cluster ad elevata disponibilità per il nodo admin</title>

  <para>
   Il concetto di un cluster HA prevede che in caso di errore di un nodo del cluster, l'altro nodo subentri automaticamente nel ruolo, compreso il nodo admin virtualizzato. In questo modo, gli altri nodi del cluster Ceph non avvertono l'errore del nodo admin Ceph.
  </para>

  <para>
   La soluzione HA minima per il nodo admin richiede il seguente hardware:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Due server bare metal in grado di eseguire SUSE Linux Enterprise con l'estensione High Availability e virtualizzare il nodo admin.
    </para>
   </listitem>
   <listitem>
    <para>
     Due o più percorsi di comunicazione di rete ridondanti, ad esempio tramite Network Device Bonding.
    </para>
   </listitem>
   <listitem>
    <para>
     Storage condiviso per ospitare le immagini dei dischi della macchina virtuale del nodo admin. Lo storage condiviso deve essere accessibile da entrambi i server. Può essere ad esempio un'esportazione NFS, una condivisione Samba o una destinazione iSCSI.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Ulteriori dettagli sui requisiti del cluster sono disponibili all'indirizzo <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-install-quick/#sec-ha-inst-quick-req"/>.
  </para>

  <figure>
   <title>Cluster ad elevata disponibilità a 2 nodi per il nodo admin</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>Costruzione del cluster ad elevata disponibilità con il nodo admin</title>

  <para>
   La procedura seguente riepiloga i passaggi più importanti di costruzione del cluster HA per virtualizzare il nodo admin. Per i dettagli, consultare i collegamenti indicati.
  </para>

  <procedure>
   <step>
    <para>
     Configurare un cluster HA di base a 2 nodi con storage condiviso come descritto in <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-install-quick/#art-sleha-install-quick"/>.
    </para>
   </step>
   <step>
    <para>
     Su entrambi i nodi cluster, installare tutti i pacchetti richiesti per eseguire l'ipervisore KVM e il toolkit <systemitem class="library">libvirt</systemitem> come descritto in <link xlink:href="https://documentation.suse.com/sles/15-SP2/single-html/SLES-virtualization/#sec-vt-installation-kvm"/>.
    </para>
   </step>
   <step>
    <para>
     Sul primo nodo del cluster, creare una nuova macchina virtuale (VM) KVM utilizzando <systemitem class="library">libvirt</systemitem> come descritto in <link xlink:href="https://documentation.suse.com/sles/15-SP2/single-html/SLES-virtualization/#sec-libvirt-inst-virt-install"/>. Utilizzare lo storage condiviso preconfigurato per memorizzare le immagini del disco della VM.
    </para>
   </step>
   <step>
    <para>
     Al termine della configurazione della VM, esportarne la configurazione su un file XML sullo storage condiviso. Usare la seguente sintassi:
    </para>
<screen>
<prompt role="root">root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Creare una risorsa per la VM del nodo admin. Per informazioni generali sulla creazione di risorse HA, consultare <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-guide/#cha-conf-hawk2"/>. All'indirizzo <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/> sono disponibili informazioni dettagliate sulla creazione di risorse per una macchina virtuale KVM.
    </para>
   </step>
   <step>
    <para>
     Sul guest VM appena creato, distribuire il nodo admin compresi i servizi aggiuntivi necessari. Seguire la procedura pertinente indicata nella <xref linkend="deploy-salt"/>. Contemporaneamente, distribuire i restanti nodi del cluster Ceph sui server del cluster non HA.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
