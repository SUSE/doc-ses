<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>Gestione del dispositivo di blocco RADOS (RADOS Block Device, RBD)</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sì</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Per visualizzare un elenco di tutti i dispositivi di blocco RADOS (RBD) disponibili, fare clic su <menuchoice><guimenu>Blocco</guimenu><guimenu>Immagini</guimenu></menuchoice> nel menu principale.
 </para>
 <para>
  L'elenco mostra brevi informazioni sul dispositivo come il nome, il nome pool correlato, lo spazio dei nomi, le dimensioni del dispositivo, il numero e la dimensione degli oggetti sul dispositivo, i dettagli sul provisioning e il dispositivo superiore.
 </para>
 <figure>
  <title>Elenco delle immagini RBD</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>Visualizzazione dei dettagli sugli RBD</title>

  <para>
   Per visualizzare altri dettagli su un dispositivo, fare clic sulla relativa riga nella tabella:
  </para>

  <figure>
   <title>Dettagli RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>Visualizzazione della configurazione dell'RBD</title>

  <para>
   Per visualizzare la configurazione dettagliata di un dispositivo, fare clic sulla relativa riga nella tabella e sulla scheda <guimenu>Configurazione</guimenu> nella tabella inferiore:
  </para>

  <figure>
   <title>Configurazione RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>Creazione di RBD</title>

  <para>
   Per aggiungere un nuovo dispositivo, fare clic su <guimenu>Crea</guimenu> in alto a sinistra nell'intestazione della tabella ed eseguire quanto riportato di seguito nella schermata <guimenu>Crea RBD</guimenu>:
  </para>

  <figure>
   <title>Aggiunta di un nuovo RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     Immettere il nome del nuovo dispositivo. Per le restrizioni di denominazione, fare riferimento a <xref linkend="sysreq-naming"/>.
    </para>
   </step>
   <step>
    <para>
     Selezionare il pool con l'applicazione <option>rbd</option> assegnata da cui verrà creato il nuovo dispositivo RBD.
    </para>
   </step>
   <step>
    <para>
     Specificare le dimensioni del nuovo dispositivo.
    </para>
   </step>
   <step>
    <para>
     Specificare le opzioni aggiuntive per il dispositivo. Per ottimizzare i parametri del dispositivo, fare clic su <guimenu>Avanzate</guimenu> e immettere i valori relativi alle dimensioni dell'oggetto, all'unità di striping o al numero di striping. Per immettere i limiti di qualità del servizio (QoS, Quality of Service), fare clic su <guimenu>Qualità di servizio</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Confermare con <guimenu>Crea RBD</guimenu>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>Eliminazione di RBD</title>

  <para>
   Per eliminare un dispositivo, selezionarlo nella riga della tabella. Fare clic sulla freccia a discesa accanto al pulsante <guimenu>Crea</guimenu> e fare clic su <guimenu>Elimina</guimenu>. Confermare l'eliminazione con <guimenu>Delete RBD</guimenu> (Elimina RBD).
  </para>

  <tip>
   <title>spostamento degli RBD nel cestino</title>
   <para>
    L'eliminazione di un RBD è un'azione irreversibile. Se invece si seleziona l'opzione <guimenu>Sposta nel cestino</guimenu>, è possibile ripristinare il dispositivo in un secondo momento selezionandolo nella scheda <guimenu>Cestino</guimenu> della tabella principale e facendo clic su <guimenu>Ripristina</guimenu> in alto a sinistra nell'intestazione della tabella.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>Creazione di snapshot del dispositivo di blocco RADOS (RADOS Block Device, RBD)</title>

  <para>
   Per creare uno snapshot del dispositivo di blocco RADOS (RADOS Block Device, RBD), selezionare il dispositivo nella riga della tabella per visualizzare il pannello dei contenuti relativo ai dettagli della configurazione. Selezionare la scheda <guimenu>Snapshot</guimenu> e fare clic su <guimenu>Crea</guimenu> in alto a sinistra nell'intestazione della tabella. Immettere il nome dello snapshot e confermare con <guimenu>Crea snapshot RBD</guimenu>.
  </para>

  <para>
   Dopo aver selezionato una snapshot, è possibile eseguire ulteriori azioni sul dispositivo, ad esempio rinominarlo, proteggerlo, clonarlo, copiarlo o eliminarlo. L'opzione <guimenu>Rollback</guimenu> consente di ripristinare lo stato del dispositivo dallo snapshot attuale.
  </para>

  <figure>
   <title>Snapshot RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>Copia speculare RBD</title>

  <para>
   È possibile eseguire la copia speculare delle immagini del dispositivo di blocco RADOS (RADOS Block Device, RBD) in modo asincrono tra due cluster Ceph. È possibile utilizzare il Ceph Dashboard per configurare la replica delle immagini RBD tra due o più cluster. Questa funzionalità è disponibile in due modalità:
  </para>

  <variablelist>
   <varlistentry>
    <term>Basata sul journal</term>
    <listitem>
     <para>
      Questa modalità utilizza la funzione di journaling dell'immagine RBD per assicurare la replica temporizzata e con coerenza per arresto anomalo tra cluster.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Basata su snapshot</term>
    <listitem>
     <para>
      Questa modalità utilizza snapshot di copia speculare dell'immagine RBD pianificati periodicamente o creati manualmente per eseguire la replica delle immagini RBD con coerenza per arresto anomalo tra cluster.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   La copia speculare è configurata su ogni singolo pool all'interno dei cluster peer ed è possibile configurarla su un sottoinsieme specifico di immagini all'interno del pool o per fare in modo che esegua automaticamente la copia speculare di tutte le immagini del pool quando è in uso soltanto la modalità basata sul journal.
  </para>

  <para>
   Per la configurazione della copia speculare si utilizza il comando <command>rbd</command>, installato per default in SUSE Enterprise Storage 7. Il daemon <systemitem class="daemon">rbd-mirror</systemitem> è responsabile del pull degli aggiornamenti delle immagini dal cluster peer remote e della loro applicazione all'immagine nel cluster local. Vedere la <xref linkend="rbd-mirror-daemon-enable"/> per maggiori informazioni sull'abilitazione del daemon <systemitem class="daemon">rbd-mirror</systemitem>.
  </para>

  <para>
   A seconda delle necessità di replica, è possibile configurare la copia speculare del dispositivo di blocco RADOS (RADOS Block Device, RBD) sulla replica a una o due vie:
  </para>

  <variablelist>
   <varlistentry>
    <term>Replica a una via</term>
    <listitem>
     <para>
      Quando la copia speculare dei dati avviene soltanto da un cluster primario a uno secondario, il daemon <systemitem class="daemon">rbd-mirror</systemitem> viene eseguito solo sul cluster secondario.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Replica a due vie</term>
    <listitem>
     <para>
      Quando la copia speculare dei dati avviene dalle immagini primarie su un cluster alle immagini non primarie su un altro cluster (e viceversa), il daemon <systemitem class="daemon">rbd-mirror</systemitem> viene eseguito su entrambi i cluster.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    Ogni istanza del daemon <systemitem class="daemon">rbd-mirror</systemitem> deve essere in grado di connettersi contemporaneamente al cluster Ceph local e remote, ad esempio a tutti i monitor e agli host OSD. Inoltre, la larghezza di banda della rete tra i due data center deve essere sufficiente per gestire il workload della copia speculare.
   </para>
  </important>

  <tip>
   <title>informazioni generali</title>
   <para>
    Per informazioni generali e sull'approccio della riga di comando alla copia speculare del dispositivo di blocco RADOS, fare riferimento alla <xref linkend="ceph-rbd-mirror"/>.
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>Configurazione dei cluster primario e secondario</title>
   <para>
    Nel cluster <emphasis>primario</emphasis> viene creato il pool originale con le immagini. Nel cluster <emphasis>secondario</emphasis> vengono replicati il pool o le immagini dal cluster <emphasis>primario</emphasis>.
   </para>
   <note>
    <title>denominazione relativa</title>
    <para>
     I termini <emphasis>primario</emphasis> e <emphasis>secondario</emphasis> possono essere relativi nel contesto della replica, perché fanno riferimento più ai singoli pool che ai cluster. Ad esempio, nella replica bidirezionale, è possibile eseguire la copia speculare di un pool dal cluster <emphasis>primario</emphasis> a quello <emphasis>secondario</emphasis> mentre è in corso la copia speculare di un altro pool dal cluster <emphasis>secondario</emphasis> a quello <emphasis>primario</emphasis>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>Abilitazione del daemon <systemitem class="daemon">rbd-mirror</systemitem></title>
   <para>
    Nelle procedure seguenti è illustrato come eseguire task amministrativi di base per configurare la copia speculare tramite il comando <command>rbd</command>. La copia speculare è configurata per ogni singolo pool nei cluster Ceph.
   </para>
   <para>
    I passaggi di configurazione del pool devono essere eseguiti su entrambi i cluster peer. Per maggior chiarezza, in queste procedure si presuppone che due cluster, denominati "primary" e "secondary", siano accessibili da un singolo host.
   </para>
   <para>
    Il daemon <systemitem class="daemon">rbd-mirror</systemitem> esegue la replica effettiva dei dati del cluster.
   </para>
   <procedure>
    <step>
     <para>
      Rinominare <filename>ceph.conf</filename> e i file di portachiavi e copiarli dall'host primario all'host secondario:
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      Per abilitare la copia speculare su un pool con <command>rbd</command>, specificare il comando <command>mirror pool enable</command>, il nome del pool e la modalità di copia speculare:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       La modalità di copia speculare può essere <literal>image</literal> o <literal>pool</literal>. Esempio:
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      Nel Ceph Dashboard, andare a <menuchoice><guimenu>Blocco</guimenu><guimenu>Esecuzione di copia speculare</guimenu></menuchoice>. Nella tabella <guimenu>Daemon</guimenu> a sinistra vengono mostrati i daemon <systemitem class="daemon">rbd-mirror</systemitem> in esecuzione e il relativo stato.
     </para>
     <figure>
      <title>Esecuzione dei daemon <systemitem class="daemon">rbd-mirror</systemitem></title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>Disabilitazione della copia speculare</title>
   <para>
    Per disabilitare la copia speculare con <command>rbd</command>, specificare il comando <command>mirror pool disable</command> e il nome del pool:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    Quando si disabilita la copia speculare su un pool in questo modo, questa verrà disabilitata anche su qualsiasi immagine (nel pool) per la quale è stata abilitata esplicitamente la copia speculare.
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>Esecuzione del bootstrap dei peer</title>
   <para>
    Affinché <systemitem class="daemon">rbd-mirror</systemitem> rilevi il rispettivo cluster peer, è necessario registrare il peer nel pool e creare un account utente. Questo processo può essere automatizzato con <command>rbd</command> tramite i comandi <command>mirror pool peer bootstrap create</command> e <command>mirror pool peer bootstrap import</command>.
   </para>
   <para>
    Per creare manualmente un nuovo token di bootstrap con <command>rbd</command>, specificare il comando <command>mirror pool peer bootstrap create</command>, il nome del pool e un nome del sito facoltativo per la descrizione del cluster local:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    L'output di <command>mirror pool peer bootstrap create</command> sarà un token che dovrà essere fornito al comando <command>mirror pool peer bootstrap import</command>. Ad esempio, sul cluster primario:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1 \
  vbl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    Per importare manualmente il token di bootstrap creato da un altro cluster con il comando <command>rbd</command>, specificare il comando <command>mirror pool peer bootstrap import</command>, il nome del pool, il percorso del file al token creato (oppure "-" per leggere dall'input standard), insieme al nome del sito facoltativo per la descrizione del cluster local e a una direzione di copia speculare (l'impostazione di default è <literal>rx-tx</literal> per la copia speculare bidirezionale, ma è possibile configurare questa impostazione anche su <literal>rx-only</literal> per la copia speculare unidirezionale):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    Ad esempio, sul cluster secondario:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>Rimozione di un peer del cluster</title>
   <para>
    Per rimuovere un cluster Ceph peer in copia speculare con il comando <command>rbd</command>, specificare il comando <command>mirror pool peer remove</command>, il nome del pool e l'UUID del peer (disponibile dal comando <command>rbd mirror pool info</command>):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Configurazione della replica del pool nel Ceph Dashboard</title>
   <para>
    Il daemon <systemitem class="daemon">rbd-mirror</systemitem> deve disporre dell'accesso al cluster primario per poter eseguire la copia speculare delle immagini RBD. Assicurarsi di aver seguito la procedura descritta nella <xref linkend="rbd-mirror-peer-bootstrap"/> prima di continuare.
   </para>
   <procedure>
    <step>
     <para>
      Nel cluster <emphasis>primario</emphasis> e <emphasis>secondario</emphasis>, creare pool con un nome identico e assegnarvi l'applicazione <literal>rbd</literal>. Per ulteriori dettagli sulla creazione di un nuovo pool, fare riferimento alla <xref linkend="dashboard-pools-create"/>.
     </para>
     <figure>
      <title>Creazione di un pool con l'applicazione RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Nei dashboard del cluster <emphasis>primario</emphasis> e <emphasis>secondario</emphasis>, andare a <menuchoice><guimenu>Blocco</guimenu><guimenu>Esecuzione della copia speculare</guimenu></menuchoice>. Nella tabella <guimenu>Pool</guimenu> a destra, fare clic sul nome del pool da replicare e, dopo aver fatto clic su <guimenu>Modalità di modifica</guimenu>, selezionare la modalità di replica. In questo esempio, verrà utilizzata la modalità di replica <emphasis>pool</emphasis>, che indica che verranno replicate tutte le immagini all'interno di un determinato pool. Confermare con <guimenu>Aggiorna</guimenu>.
     </para>
     <figure>
      <title>Configurazione della modalità di replica</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>errore o avviso nel cluster primario</title>
      <para>
       In seguito all'aggiornamento della modalità di replica, verrà visualizzato un errore o un flag di avviso nella colonna destra corrispondente. Ciò si verifica perché al pool non è stato ancora assegnato nessun utente peer per la replica. Ignorare questo flag per il cluster <emphasis>primario</emphasis> poiché l'utente peer viene assegnato soltanto al cluster <emphasis>secondario</emphasis>.
      </para>
     </important>
    </step>
    <step>
     <para>
      Nel dashboard del cluster <emphasis>secondario</emphasis>, andare a <menuchoice><guimenu>Blocco</guimenu><guimenu>Esecuzione della copia speculare</guimenu></menuchoice>. Aggiungere il peer di copia speculare del pool selezionando <guimenu>Aggiungi peer</guimenu>. Specificare i dettagli del cluster <emphasis>primario</emphasis>:
     </para>
     <figure>
      <title>Aggiunta delle credenziali del peer</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>Nome cluster</guimenu></term>
       <listitem>
        <para>
         Stringa univoca arbitraria che identifica il cluster primario come "primary". Il nome del cluster deve essere diverso dal nome reale del cluster secondario.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>ID CephX</guimenu></term>
       <listitem>
        <para>
         ID utente Ceph creato come peer in copia speculare. In questo esempio è "rbd-mirror-peer".
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Indirizzi dei monitor</guimenu></term>
       <listitem>
        <para>
         Elenco separato da virgole degli indirizzi IP dei nodi Ceph Monitor del cluster primario.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Chiave CephX</guimenu></term>
       <listitem>
        <para>
         Chiave correlata all'ID utente peer. È possibile recuperarla eseguendo sul cluster primario il comando di esempio seguente:
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Confermare con <guimenu>Invia</guimenu>.
     </para>
     <figure>
      <title>Elenco dei pool replicati</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>Verifica del funzionamento della replica dell'immagine RBD</title>
   <para>
    Una volta che il daemon <systemitem class="daemon">rbd-mirror</systemitem> è in esecuzione e la replica dell'immagine RBD è configurata nel Ceph Dashboard, è il momento di verificare il funzionamento della replica:
   </para>
   <procedure>
    <step>
     <para>
      Nel Ceph Dashboard del cluster <emphasis>primario</emphasis>, creare un'immagine RBD per fare in modo che il relativo pool superiore sia quello già creato per scopi di replica. Abilitare le funzioni <option>Blocco esclusivo</option> e <option>Journaling</option> per l'immagine. Per i dettagli sulla creazione delle immagini RBD, fare riferimento alla <xref linkend="dashboard-rbds-create"/>.
     </para>
     <figure>
      <title>Nuova immagine RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Dopo aver creato l'immagine che si desidera replicare, aprire il Ceph Dashboard del cluster <emphasis>secondario</emphasis> e andare a <menuchoice><guimenu>Blocco</guimenu><guimenu>Esecuzione della copia speculare</guimenu></menuchoice>. La tabella <guimenu>Pool</guimenu> a destra rifletterà la modifica del numero di immagini <guimenu># Remoto</guimenu> e sincronizzerà il numero di immagini <guimenu># Locale</guimenu>.
     </para>
     <figure>
      <title>Nuova immagine RBD sincronizzata</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>avanzamento della replica</title>
      <para>
       Nella tabella <guimenu>Immagini</guimenu> in basso nella pagina viene mostrato lo stato della replica delle immagini RBD. La scheda <guimenu>Problemi</guimenu> include i possibili problemi, la scheda <guimenu>Sincronizzazione in corso</guimenu> visualizza l'avanzamento della replica dell'immagine e la scheda <guimenu>Pronto</guimenu> elenca tutte le immagini di cui è riuscita la replica.
      </para>
      <figure>
       <title>Stato della replica delle immagini RBD</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      Nel cluster <emphasis>primario</emphasis>, scrivere i dati nell'immagine RBD. Nel Ceph Dashboard del cluster <emphasis>secondario</emphasis>, andare a <menuchoice><guimenu>Blocco</guimenu><guimenu>Immagini</guimenu></menuchoice> e controllare se le dimensioni dell'immagine corrispondente aumentano via via che i dati vengono scritti nel cluster primario.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>Gestione di iSCSI Gateway</title>

  <tip>
   <title>ulteriori informazioni sugli iSCSI Gateway</title>
   <para>
    Per ulteriori informazioni generali sugli iSCSI Gateway, fare riferimento al <xref linkend="cha-ceph-iscsi"/>.
   </para>
  </tip>

  <para>
   Per visualizzare un elenco di tutti i gateway e le immagini mappate disponibili, fare clic su <menuchoice><guimenu>Blocco</guimenu><guimenu>iSCSI</guimenu></menuchoice> nel menu principale. Si apre la scheda <guimenu>Panoramica</guimenu>, in cui vengono elencati gli iSCSI Gateway attualmente configurati e le immagini RBD mappate.
  </para>

  <para>
   Nella tabella dei <guimenu>gateway</guimenu> sono elencati lo stato, il numero di destinazioni iSCSI e il numero di sessioni di ogni gateway. Nella tabella <guimenu>Immagini</guimenu> sono elencati il nome, il nome del pool correlato, il tipo di backstore e altri dettagli statistici di ciascuna immagine mappata.
  </para>

  <para>
   Nella scheda <guimenu>Destinazioni</guimenu> sono elencate le destinazioni iSCSI attualmente configurate.
  </para>

  <figure>
   <title>Elenco delle destinazioni iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Per visualizzare ulteriori informazioni dettagliate su una destinazione, fare clic sulla freccia a discesa nella riga della tabella delle destinazioni. Si apre uno schema con struttura ad albero in cui sono elencati i dischi, i portali, gli iniziatori e i gruppi. Fare clic su un elemento per espanderlo e visualizzare i relativi contenuti dettagliati, facoltativamente insieme alla configurazione correlata, nella tabella a destra.
  </para>

  <figure>
   <title>Dettagli sulla destinazione iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>Aggiunta di destinazioni iSCSI</title>
   <para>
    Per aggiungere una nuova destinazione iSCSI, fare clic su <guimenu>Crea</guimenu> in alto a sinistra nella tabella <guimenu>Destinazioni</guimenu> e immettere le informazioni richieste.
   </para>
   <figure>
    <title>Aggiunta di una nuova destinazione</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      Immettere l'indirizzo di destinazione del nuovo gateway.
     </para>
    </step>
    <step>
     <para>
      Fare clic su <guimenu>Aggiungi portale</guimenu> e selezionare uno o più portali iSCSI dall'elenco.
     </para>
    </step>
    <step>
     <para>
      Fare clic su <guimenu>Aggiungi immagine</guimenu> e selezionare una o più immagini RBD per il gateway.
     </para>
    </step>
    <step>
     <para>
      Se è necessario utilizzare l'autenticazione per accedere al gateway, attivare la casella di controllo <guimenu>Autenticazione ACL</guimenu> e immettere le credenziali. Ulteriori opzioni di autenticazione avanzata sono disponibili dopo l'attivazione di <guimenu>Mutual authentication (Autenticazione reciproca)</guimenu> e <guimenu>Discovery authentication (Autenticazione rilevazione)</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Confermare con <guimenu>Create Target</guimenu> (Crea destinazione).
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>Modifica delle destinazioni iSCSI</title>
   <para>
    Per modificare una destinazione iSCSI esistente, fare clic sulla relativa riga nella tabella <guimenu>Destinazioni</guimenu>, quindi su <guimenu>Modifica</guimenu> in alto a sinistra nella tabella.
   </para>
   <para>
    È quindi possibile modificare la destinazione iSCSI, aggiungere o eliminare portali e aggiungere o eliminare immagini RBD correlate. È inoltre possibile regolare le informazioni di autenticazione per il gateway.
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>Eliminazione delle destinazioni iSCSI</title>
   <para>
    Per eliminare una destinazione iSCSI, selezionare la riga della tabella e fare clic sulla freccia a discesa accanto al pulsante <guimenu>Modifica</guimenu>, quindi selezionare <guimenu>Elimina</guimenu>. Attivare la casella <guimenu>Sì</guimenu> e confermare con <guimenu>Elimina destinazione iSCSI</guimenu>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>Qualità di servizio (QoS) RBD</title>

  <tip>
   <title>ulteriori informazioni</title>
   <para>
    Per ulteriori informazioni generali e per una descrizione delle opzioni di configurazione QoS RBD, fare riferimento alla <xref linkend="rbd-qos"/>.
   </para>
  </tip>

  <para>
   È possibile configurare le opzioni QoS a livelli diversi.
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Globalmente
    </para>
   </listitem>
   <listitem>
    <para>
     Per ogni singolo pool
    </para>
   </listitem>
   <listitem>
    <para>
     Per ogni singola immagine
    </para>
   </listitem>
  </itemizedlist>

  <para>
   La configurazione <emphasis>globale</emphasis> si trova in cima all'elenco e verrà utilizzata per tutte le immagini RBD di nuova creazione e per quelle immagini che non ignorano tali valori sul livello di pool o di immagine RBD. Un valore di opzione specificato globalmente può essere ignorato per ogni singolo pool o per ogni singola immagine. Le opzioni specificate in un pool verranno applicate a tutte le immagini RBD di tale pool a meno che non siano sostituite da un'opzione di configurazione impostata in un'immagine. Le opzioni specificate in un'immagine sostituiranno quelle specificate globalmente e quelle specificate in un pool.
  </para>

  <para>
   In questo modo, è possibile definire i valori di default globalmente, adattarli a tutte le immagini RBD di un pool specifico e sostituire la configurazione del pool per le singole immagini RBD.
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>Configurazione delle opzioni a livello globale</title>
   <para>
    Per configurare le opzioni del dispositivo di blocco RADOS (RADOS Block Device, RBD) a livello globale, selezionare <menuchoice><guimenu>Cluster</guimenu>
    <guimenu>Configurazione</guimenu></menuchoice> dal menu principale.
   </para>
   <procedure>
    <step>
     <para>
      Per elencare tutte le opzioni di configurazione globale disponibili, accanto a <menuchoice><guimenu>Livello</guimenu></menuchoice>, selezionare <menuchoice><guimenu>Avanzate</guimenu></menuchoice> dal menu a discesa.
     </para>
    </step>
    <step>
     <para>
      Filtrare i risultati della tabella applicando il filtro <literal>rbd_qos</literal> nel campo di ricerca per visualizzare un elenco di tutte le opzioni di configurazione disponibili per QoS.
     </para>
    </step>
    <step>
     <para>
      Per modificare un valore, fare clic sulla relativa riga di tabella e selezionare <guimenu>Modifica</guimenu> in alto a sinistra nella tabella. La finestra di dialogo <guimenu>Modifica</guimenu> contiene sei campi diversi tramite cui è possibile specificare i valori. I valori dell'opzione di configurazione RBD sono obbligatori nella casella di testo <guimenu>mgr.</guimenu>
     </para>
     <note>
      <para>
       A differenza di altre finestre di dialogo, questa non consente di specificare il valore nelle unità adeguate. È necessario impostare tali valori in byte o IOPS, a seconda dell'opzione che si sta modificando.
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>Configurazione delle opzioni in un nuovo pool</title>
   <para>
    Per creare un nuovo pool e configurarvi le opzioni di configurazione RBD, fare clic su <menuchoice><guimenu>Pool</guimenu>
    <guimenu>Crea</guimenu></menuchoice>. Selezionare <guimenu>replicated</guimenu> (replicato) come tipo di pool. Sarà quindi necessario aggiungere il tag applicazione <literal>rbd</literal> al pool per poter configurare le opzioni QoS RBD.
   </para>
   <note>
    <para>
     Non è possibile configurare le opzioni di configurazione QoS RBD sui pool con codice di cancellazione. A questo scopo, è necessario modificare il pool dei metadati replicato di un'immagine RBD. La configurazione verrà quindi applicata al pool di dati con codice di cancellazione di tale immagine.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>Configurazione delle opzioni in un pool esistente</title>
   <para>
    Per configurare le opzioni QoS RBD in un pool esistente, fare clic su <guimenu>Pool</guimenu>, quindi sulla riga di tabella corrispondente al pool e selezionare <guimenu>Modifica</guimenu> in alto a sinistra nella tabella.
   </para>
   <para>
    Dovrebbe aprirsi la sezione <guimenu>Configurazione RBD</guimenu> nella finestra di dialogo, seguita dalla sezione <guimenu>Qualità di servizio</guimenu>.
   </para>
   <note>
    <para>
     Se le sezioni <guimenu>Configurazione RBD</guimenu> o <guimenu>Qualità di servizio</guimenu> non vengono visualizzate, è possibile che si stia modificando un pool con codice di cancellazione (<emphasis>erasure coded</emphasis>), il quale non può essere utilizzato per impostare le opzioni di configurazione RBD, o che il pool non sia configurato per l'utilizzo da parte delle immagini RBD. Nell'ultimo caso, assegnare il tag applicazione <guimenu>rbd</guimenu> al pool per visualizzare le sezioni di configurazione corrispondenti.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>Opzioni di configurazione</title>
   <para>
    Fare clic su <guimenu>Qualità di servizio +</guimenu> per espandere le opzioni di configurazione. Verrà visualizzato un elenco di tutte le opzioni disponibili. Le unità delle opzioni di configurazione sono già visualizzate nelle caselle di testo. Se si seleziona l'opzione dei byte per secondo (BPS), è possibile utilizzare scorciatoie come "1M" o "5G". Tali valori verranno convertiti automaticamente in "1 MB/s" e "5 GB/s" rispettivamente.
   </para>
   <para>
    Se si fa clic sul pulsante di reimpostazione a destra di ciascuna casella di testo, i valori impostati nel pool verranno rimossi. Questa azione non rimuove i valori di configurazione delle opzioni configurate a livello globale o in un'immagine RBD.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>Creazione delle opzioni QoS RBD con una nuova immagine RBD</title>
   <para>
    Per creare un'immagine RBD con le opzioni QoS RBD impostate in quest'ultima, selezionare <menuchoice><guimenu>Blocco</guimenu> <guimenu>Immagini</guimenu></menuchoice> e fare clic su <guimenu>Crea</guimenu>. Fare clic su <guimenu>Avanzate...</guimenu> per espandere la sezione di configurazione avanzata. Fare clic su <guimenu>Qualità di servizio +</guimenu> per aprire tutte le opzioni di configurazione disponibili.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>Modifica delle opzioni QoS RBD sulle immagini esistenti</title>
   <para>
    Per modificare le opzioni QoS RBD in un'immagine esistente, selezionare <menuchoice><guimenu>Blocco</guimenu>
    <guimenu>Immagini</guimenu></menuchoice>, fare clic sulla riga di tabella corrispondente al pool e quindi su <guimenu>Modifica</guimenu>. Verrà visualizzata la finestra di dialogo per la modifica. Fare clic su <guimenu>Avanzate...</guimenu> per espandere la sezione di configurazione avanzata. Fare clic su <guimenu>Qualità di servizio +</guimenu> per aprire tutte le opzioni di configurazione disponibili.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>Modifica delle opzioni di configurazione durante la copia o la clonazione delle immagini</title>
   <para>
    Se un'immagine RBD viene clonata o copiata, per default verranno copiati anche i valori impostati in tale immagine. Se si desidera modificarli durante la copia o la clonazione, specificare i valori di configurazione aggiornati nella finestra di dialogo di copia/clonazione seguendo gli stessi passaggi della procedura di creazione o modifica di un'immagine RBD. Questa operazione consente di impostare (o reimpostare) soltanto i valori dell'immagine RBD copiata o clonata e non influisce sulla configurazione dell'immagine RBD di origine o sulla configurazione globale.
   </para>
   <para>
    Se si sceglie di reimpostare il valore di opzione durante la procedura di copia/clonazione, nell'immagine non verrà impostato alcun valore per tale opzione. Ciò vuol dire che verrà utilizzato il valore di tale opzione specificato per il pool superiore se in quest'ultimo è stato configurato tale valore. In caso contrario, verrà utilizzata l'impostazione di default globale.
   </para>
  </sect2>
 </sect1>
</chapter>
