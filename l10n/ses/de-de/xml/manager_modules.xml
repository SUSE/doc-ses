<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="manager_modules.xml" version="5.0" xml:id="cha-mgr-modules">
 <title>Ceph-Manager-Module</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>Ja</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Der Funktionsumfang des Ceph Managers (kurze Einführung siehe <xref linkend="storage-intro-core-nodes"/>) kann dank seiner Architektur mithilfe von <emphasis>Modulen</emphasis> erweitert werden, z. B. „dashboard“ (siehe <xref linkend="part-dashboard"/>), „prometheus“ (siehe <xref linkend="monitoring-alerting"/>) oder „balancer“.
 </para>
 <para>
  Mit folgendem Kommando rufen Sie eine Liste aller verfügbaren Module ab:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module ls
{
        "enabled_modules": [
                "restful",
                "status"
        ],
        "disabled_modules": [
                "dashboard"
        ]
}</screen>
 <para>
  Mit folgendem Kommando aktivieren oder deaktivieren Sie ein bestimmtes Modul:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable <replaceable>MODULE-NAME</replaceable></screen>
 <para>
  Beispiel:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard</screen>
 <para>
  Mit folgendem Kommando rufen Sie eine Liste der Services ab, die die aktivierten Module anbieten:
 </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr services
{
        "dashboard": "http://myserver.com:7789/",
        "restful": "https://myserver.com:8789/"
}</screen>
 <sect1 xml:id="mgr-modules-balancer">
  <title>Ausgleichsprogramm</title>

  <para>
   Das Ausgleichsprogramm-Modul optimiert die Verteilung der Platzierungsgruppen (PG) auf die OSDs, sodass die Implementierung ausgeglichener wird. Das Modul ist standardmäßig aktiviert, ist jedoch inaktiv. Es unterstützt die Modi <literal>crush-compat</literal> und <literal>upmap</literal>.
  </para>

  <tip>
   <title>Status und Konfiguration des aktuellen Ausgleichsprogramms</title>
   <para>
    Mit folgendem Kommando zeigen Sie die Informationen zum Status und der Konfiguration des aktuellen Ausgleichsprogramms an:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer status</screen>
  </tip>

  <sect2 xml:id="mgr-balancer-crush-compat">
   <title>Modus „crush-compat“</title>
   <para>
    Im Modus „crush-compat“ passt das Ausgleichsprogramm die Neugewichtungs-Sets der OSDs an, sodass eine verbesserte Verteilung der Daten erzielt wird. Die PGs werden zwischen den OSDs verschoben, so dass vorübergehend der Cluster-Status <literal>HEALTH_WARN</literal> aufgrund von falsch platzierten PGs eintritt.
   </para>
   <tip>
    <title>Modusaktivierung</title>
    <para>
     Auch wenn „crush-compat“ der Standardmodus ist, wird empfohlen, ihn explizit zu aktivieren:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer mode crush-compat</screen>
   </tip>
  </sect2>

  <sect2 xml:id="mgr-balancer-planning-executing">
   <title>Planen und Ausführen des Datenausgleichs</title>
   <para>
    Mit dem Ausgleichsprogramm-Modul können Sie einen Plan für den Datenausgleich aufstellen. Anschließend können Sie den Plan manuell ausführen oder die PGs fortlaufend durch das Ausgleichsprogramm ausgleichen lassen.
   </para>
   <para>
    Die Entscheidung, ob das Ausgleichsprogramm im manuellen oder automatischen Modus ausgeführt werden soll, ist von verschiedenen Faktoren abhängig, z. B. vom aktuellen Ungleichgewicht der Daten, von der Cluster-Größe, der PG-Anzahl oder der E/A-Aktivität. Es wird empfohlen, einen anfänglichen Plan aufzustellen und in einem Zeitraum mit niedrigerer E/A-Belastung im Cluster auszuführen. Zu Beginn liegt in der Regel ein erhebliches Ungleichgewicht vor und es ist dringend zu empfehlen, die Auswirkungen auf die Clients so gering wie möglich zu halten. Nach der ersten manuellen Ausführung können Sie ggf. den automatischen Modus aktivieren und den Ausgleichsdatenverkehr bei normaler E/A-Belastung überwachen. Die Verbesserungen bei der PG-Verteilung sind gegen den Ausgleichsdatenverkehr abzuwägen, der durch das Ausgleichsprogramm verursacht wird.
   </para>
   <tip>
    <title>Verschiebbarer Anteil der Platzierungsgruppen (PGs)</title>
    <para>
     Während des Ausgleichsprozesses schränkt das Ausgleichsprogramm die PG-Verschiebungen ein, sodass nur ein konfigurierbarer Anteil der PGs verschoben wird. Der Standardwert ist 5 %. Mit folgendem Kommando erhöhen Sie den Anteil beispielsweise auf 9 %:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr target_max_misplaced_ratio .09</screen>
   </tip>
   <para>
    So können Sie einen Ausgleichsplan aufstellen und umsetzen:
   </para>
   <procedure>
    <step>
     <para>
      Prüfen Sie die aktuelle Cluster-Bewertung:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval</screen>
    </step>
    <step>
     <para>
      Stellen Sie einen Plan auf. Beispielsweise „great_plan“:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer optimize great_plan</screen>
    </step>
    <step>
     <para>
      Betrachten Sie die Veränderungen, die „great_plan“ mit sich bringen wird:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer show great_plan</screen>
    </step>
    <step>
     <para>
      Prüfen Sie die potentielle Clusterbewertung, wenn Sie sich entscheiden, „great_plan“ umzusetzen:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer eval great_plan</screen>
    </step>
    <step>
     <para>
      Führen Sie „great_plan“ einmalig aus:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer execute great_plan</screen>
    </step>
    <step>
     <para>
      Beobachten Sie den Cluster-Ausgleich mit dem Kommando <command>ceph -s</command>. Wenn Sie mit dem Ergebnis zufrieden sind, aktivieren Sie den automatischen Ausgleich:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer on</screen>
     <para>
      Mit folgendem Kommando deaktivieren Sie den automatischen Ausgleich später:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph balancer off</screen>
    </step>
   </procedure>
   <tip>
    <title>Automatischer Ausgleich ohne anfänglichen Plan</title>
    <para>
     Sie können den automatischen Ausgleich aktivieren, ohne einen anfänglichen Plan umzusetzen. In diesem Fall müssen Sie damit rechnen, dass der Ausgleich der Platzierungsgruppen unter Umständen lange dauert.
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="mgr-modules-telemetry">
  <title>Aktivieren des Telemetriemoduls</title>

  <para>
   Das Telemetrie-Plugin sendet anonyme Daten zum Cluster, in dem das Plugin ausgeführt wird, an das Ceph-Projekt.
  </para>

  <para>
   Diese (Opt-in-)Komponente umfasst Zähler und Statistiken zur Implementierung des Clusters, außerdem die Ceph-Version, die Verteilung der Hosts und andere Parameter, die dem Projekt einen besseren Einblick in die Nutzung von Ceph eröffnen. Vertrauliche Daten wie Pool-Namen, Objektnamen, Objektinhalte oder Hostnamen werden nicht übermittelt.
  </para>

  <para>
   Das Telemetriemodul fungiert als automatisierte Feedback-Schleife für die Entwickler und trägt dazu bei, die Akzeptanz zu ermitteln, das Tracking umzusetzen und Punkte festzustellen, die im Rahmen der Konfiguration besser erklärt oder eingehender geprüft werden müssen, damit unerwünschte Ergebnisse verhindert werden.
  </para>

  <note>
   <para>
    Zur Nutzung des Telemetriemoduls müssen die Ceph-Manager-Knoten in der Lage sein, Daten über HTTPS an die vorgeschalteten Server zu übermitteln. Ihre Unternehmens-Firewalls müssen diesen Vorgang zulassen.
   </para>
  </note>

  <procedure>
   <step>
    <para>
     So aktivieren Sie das Telemetriemodul:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr module enable telemetry</screen>
    <note>
     <para>
      Mit diesem Kommando können Sie Ihre Daten lediglich lokal abrufen. Dieses Kommando gibt Ihre Daten nicht an die Ceph-Community weiter.
     </para>
    </note>
   </step>
   <step>
    <para>
     So lassen Sie die Weitergabe von Daten durch das Telemetriemodul zu:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry on</screen>
   </step>
   <step>
    <para>
     So deaktivieren Sie die Weitergabe der Telemetriedaten:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry off</screen>
   </step>
   <step>
    <para>
     So erzeugen Sie einen druckbaren JSON-Bericht:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph telemetry show</screen>
   </step>
   <step>
    <para>
     So ergänzen Sie den Bericht mit einem Ansprechpartner und einer Beschreibung:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/contact John Doe john.doe@example.com
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/description 'My first Ceph cluster'</screen>
   </step>
   <step>
    <para>
     Das Modul erstellt und sendet standardmäßig alle 24 Stunden einen neuen Bericht. So passen Sie diesen Zeitabstand an:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/telemetry/interval <replaceable>HOURS</replaceable></screen>
   </step>
  </procedure>
 </sect1>
</chapter>
