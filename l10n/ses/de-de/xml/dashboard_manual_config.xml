<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_manual_config.xml" version="5.0" xml:id="dashboard-initial-configuration">
 <title>Manuelle Konfiguration</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  In diesem Abschnitt erhalten Sie erweiterte Informationen für Benutzer, die die Dashboard-Einstellungen manuell über die Kommandozeile konfigurieren möchten.
 </para>
 <sect1 xml:id="dashboard-ssl">
  <title>Konfigurieren der TLS/SSL-Unterstützung</title>

  <para>
   Alle HTTP-Verbindungen zum Dashboard werden standardmäßig mit TLS/SSL gesichert. Für eine sichere Verbindung ist ein SSL-Zertifikat erforderlich. Sie können entweder ein eigensigniertes Zertifikat verwenden oder ein Zertifikat erzeugen und durch eine bekannte Zertifizierungsstelle (CA) signieren lassen.
  </para>

  <tip>
   <title>Deaktivieren von SSL</title>
   <para>
    Unter Umständen muss die SSL-Unterstützung deaktiviert werden. Dies ist beispielsweise der Fall, wenn das Dashboard hinter einem Proxy ausgeführt wird, der SSL nicht unterstützt.
   </para>
   <para>
    Deaktivieren Sie SSL nur mit Bedacht, da die <emphasis role="bold">Benutzernamen und Passwörter</emphasis> damit <emphasis role="bold">unverschlüsselt</emphasis> an das Dashboard gesendet werden.
   </para>
   <para>
    Mit folgendem Kommando deaktivieren Sie SSL:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/ssl false
</screen>
  </tip>

  <tip>
   <title>Neustarten der Ceph-Manager-Prozesse</title>
   <para>
    Die Ceph-Manager-Prozesse müssen nach einer Änderung des SSL-Zertifikats und des Schlüssels manuell neu gestartet werden. Führen Sie hierzu entweder das folgende Kommando aus:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr fail <replaceable>ACTIVE-MANAGER-NAME</replaceable></screen>
   <para>
    oder deaktivieren Sie das Dashboard-Modul und aktivieren Sie es wieder, wodurch auch der Manager sich selbst wieder neu erzeugt:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard
<prompt>cephuser@adm &gt; </prompt>ceph mgr module enable dashboard
</screen>
  </tip>

  <sect2 xml:id="self-sign-certificates">
   <title>Erstellen von eigensignierten Zertifikaten</title>
   <para>
    Ein eigensigniertes Zertifikat für die sichere Kommunikation lässt sich schnell und einfach erstellen. So bringen Sie das Dashboard rasch in Gang.
   </para>
   <note>
    <title>Fehlermeldungen bei Webbrowsern</title>
    <para>
     Die meisten Webbrowser geben bei selbstsignierten Zertifikaten eine Fehlermeldung aus und fordern eine explizite Bestätigung, bevor eine sichere Verbindung zum Dashboard hergestellt wird.
    </para>
   </note>
   <para>
    Mit dem folgenden integrierten Kommando erzeugen und installieren Sie ein selbstsigniertes Zertifikat:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard create-self-signed-cert
</screen>
  </sect2>

  <sect2 xml:id="cert-sign-CA">
   <title>Verwenden von Zertifikaten, die von einer Zertifizierungsstelle signiert wurden</title>
   <para>
    Damit die Verbindung zum Dashboard ordnungsgemäß gesichert wird und Webbrowser-Fehlermeldungen zu selbstsignierten Zertifikaten unterbunden werden, wird empfohlen, ein Zertifikat zu verwenden, das von einer CA signiert ist.
   </para>
   <para>
    Mit einem Kommando wie im folgenden Beispiel erzeugen Sie ein Zertifikat-Schlüsselpaar:
   </para>
<screen>
<prompt role="root"># </prompt>openssl req -new -nodes -x509 \
  -subj "/O=IT/CN=ceph-mgr-dashboard" -days 3650 \
  -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</screen>
   <para>
    Das obige Kommando gibt die Dateien <filename>dashboard.key</filename> und <filename>dashboard.crt</filename> aus. Sobald die Datei <filename>dashboard.crt</filename> von einer CA signiert wurde, aktivieren Sie es mit dem folgenden Kommando für alle Ceph-Manager-Instanzen:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate-key -i dashboard.key
</screen>
   <tip>
    <title>Unterschiedliche Zertifikate für die einzelnen Manager-Instanzen</title>
    <para>
     Wenn Sie unterschiedliche Zertifikate für die einzelnen Ceph-Manager-Instanzen benötigen, bearbeiten Sie die Kommandos und geben Sie den Namen der Instanz wie folgt an. Ersetzen Sie <replaceable>NAME</replaceable> durch den Namen der Ceph-Manager-Instanz (in der Regel der zugehörige Hostname):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate <replaceable>NAME</replaceable> -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-ssl-certificate-key <replaceable>NAME</replaceable> -i dashboard.key
</screen>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-hostname-port">
  <title>Ändern des Hostnamens und der Portnummer</title>

  <para>
   Ceph Dashboard bindet an eine bestimmte TCP/IP-Adresse und an einen bestimmten TCP-Port. Standardmäßig bindet der derzeit aktive Ceph Manager, auf dem das Dashboard gehostet wird, an den TCP-Port 8443 (oder 8080, wenn SSL deaktiviert ist).
  </para>

  <note>
   <para>
    Wenn auf den Hosts, auf denen Ceph Manager (und damit Ceph Dashboard) ausgeführt wird, eine Firewall aktiviert ist, müssen Sie möglicherweise die Konfiguration ändern, um den Zugriff auf diese Ports zu ermöglichen. Weitere Informationen zu den Firewall-Einstellungen für Ceph finden Sie im <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Ceph Dashboard bindet standardmäßig an „::“, was allen verfügbaren IPv4- und IPv6-Adressen entspricht. Mit folgenden Kommandos können Sie die IP-Adresse und die Portnummer der Webanwendung ändern, sodass sie für alle Ceph-Manager-Instanzen gelten:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>

  <tip>
   <title>Separate Konfiguration der Ceph-Manager-Instanzen</title>
   <para>
    Auf jedem <systemitem class="daemon">ceph-mgr</systemitem>-Daemon wird eine eigene Dashboard-Instanz gehostet; unter Umständen müssen diese Instanzen daher separat konfiguriert werden. Mit folgenden Kommandos ändern Sie die IP-Adresse und die Portnummer für eine bestimmte Manager-Instanz (ersetzen Sie <replaceable>NAME</replaceable> mit der ID der <systemitem class="daemon">ceph-mgr</systemitem>-Instanz):
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>
  </tip>

  <tip>
   <title>Auflisten der konfigurierten Endpunkte</title>
   <para>
    Das Kommando <command>ceph mgr services</command> gibt alle derzeit konfigurierten Endpunkte zurück. Über den Schlüssel <literal>dashboard</literal> erhalten Sie die URL für den Zugriff auf das Dashboard.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-username-password">
  <title>Anpassen der Benutzernamen und Passwörter</title>

  <para>
   Wenn Sie nicht das standardmäßige Administratorkonto verwenden möchten, erstellen Sie ein anderes Benutzerkonto und weisen Sie diesem Konto mindestens eine Rolle zu. Es steht eine Reihe vordefinierter Systemrollen zur Auswahl. Weitere Einzelheiten finden Sie im <xref linkend="dashboard-user-roles"/>.
  </para>

  <para>
   Mit folgendem Kommando erstellen Sie einen Benutzer mit Administratorrechten:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard ac-user-create <replaceable>USER_NAME</replaceable> <replaceable>PASSWORD</replaceable> administrator
</screen>
 </sect1>
 <sect1 xml:id="dashboard-ogw-enabling">
  <title>Aktivieren des Verwaltungs-Frontends für das Object Gateway</title>

  <para>
   Sollen die Object-Gateway-Verwaltungsfunktionen des Dashboards genutzt werden, müssen Sie die Anmeldeberechtigung eines Benutzers mit dem aktivierten <option>system</option>-Flag angeben:
  </para>

  <procedure>
   <step>
    <para>
     Falls kein Benutzer mit dem <option>system</option>-Flag vorhanden ist, müssen Sie einen erstellen:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user create --uid=<replaceable>USER_ID</replaceable> --display-name=<replaceable>DISPLAY_NAME</replaceable> --system
</screen>
    <para>
     Beachten Sie die Schlüssel <replaceable>access_key</replaceable> und <replaceable>secret_key</replaceable> in der Ausgabe des Kommandos.
    </para>
   </step>
   <step>
    <para>
     Sie können die Berechtigungsnachweise eines vorhandenen Benutzers auch mit dem Kommando <command>radosgw-admin</command> abrufen:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user info --uid=<replaceable>USER_ID</replaceable>
</screen>
   </step>
   <step>
    <para>
     Übermitteln Sie die erhaltenen Berechtigungsnachweise in separaten Dateien an das Dashboard:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-access-key <replaceable>ACCESS_KEY_FILE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-secret-key <replaceable>SECRET_KEY_FILE</replaceable>
</screen>
   </step>
  </procedure>

  <note>
   <para>
    Standardmäßig ist die Firewall in SUSE Linux Enterprise Server 15 SP3 aktiviert. Weitere Informationen zur Firewall-Konfiguration finden Sie im <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Es sind mehrere Punkte zu beachten:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Der Hostname und die Portnummer des Object Gateways werden automatisch ermittelt.
    </para>
   </listitem>
   <listitem>
    <para>
     Wenn mehrere Zonen verwendet werden, wird automatisch der Host in der Master-Zonengruppe und der Master-Zone ermittelt. Bei den meisten Einrichtungen reicht dies aus, doch unter bestimmten Umständen müssen Sie den Hostnamen und den Port manuell festlegen:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-host <replaceable>HOST</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-port <replaceable>PORT</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Sie benötigen ggf. die folgenden zusätzlichen Einstellungen:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-scheme <replaceable>SCHEME</replaceable>  # http or https
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-admin-resource <replaceable>ADMIN_RESOURCE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-user-id <replaceable>USER_ID</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Wenn die Object-Gateway-Einrichtung ein selbstsigniertes Zertifikat umfasst (<xref linkend="dashboard-ssl"/>), deaktivieren Sie die Zertifikatsprüfung im Dashboard, sodass keine Verbindungen aufgrund von Zertifikaten, die von einer unbekannten CA signiert wurden oder nicht mit dem Hostnamen übereinstimmen, verweigert werden:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-ssl-verify False
</screen>
   </listitem>
   <listitem>
    <para>
     Wenn die Verarbeitung von Anforderungen im Object Gateway zu lange dauert und eine Zeitüberschreitung im Dashboard auftritt, können Sie den Zeitüberschreitungswert anpassen (Standardwert 45 Sekunden):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rest-requests-timeout <replaceable>SECONDS</replaceable>
</screen>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="dashboard-iscsi-management">
  <title>Aktivieren der iSCSI-Verwaltung</title>

  <para>
   Das Ceph Dashboard verwaltet iSCSI-Ziele mithilfe der REST-API, die vom Service <systemitem class="service">rbd-target-api</systemitem> des Ceph-iSCSI-Gateways bereitgestellt wird. Stellen Sie sicher, dass es auf iSCSI-Gateways installiert und aktiviert ist.
  </para>

  <note>
   <para>
    Die iSCSI-Verwaltungsfunktion des Ceph Dashboards hängt von der neuesten Version 3 des <literal>ceph-iscsi</literal>-Projekts ab. Stellen Sie sicher, dass Ihr Betriebssystem die richtige Version bereitstellt, da das Ceph Dashboard die Verwaltungsfunktionen andernfalls nicht aktiviert.
   </para>
  </note>

  <para>
   Wenn die <literal>ceph-iscsi</literal>-REST-API im HTTPS-Modus konfiguriert ist und ein eigensigniertes Zertifikat verwendet, konfigurieren Sie das Dashboard so, dass die Überprüfung des SSL-Zertifikats beim Zugriff auf die ceph-iscsi-API vermieden wird.
  </para>

  <para>
   Deaktivieren Sie die API-SSL-Überprüfung:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard set-iscsi-api-ssl-verification false</screen>

  <para>
   Definieren Sie die verfügbaren iSCSI-Gateways:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-list
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-add <replaceable>scheme</replaceable>://<replaceable>username</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>[:port]
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-rm <replaceable>gateway_name</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="dashboard-sso">
  <title>Aktivieren von Single Sign-on</title>

  <para>
   Mit der Zugriffskontrollmethode <emphasis>Single Sign-on</emphasis> (SSO) können die Benutzer sich mit einer einzigen ID und einem einzigen Passwort bei mehreren Anwendungen gleichzeitig anmelden.
  </para>

  <para>
   Das Ceph Dashboard unterstützt die externe Authentifizierung von Benutzern über das SAML-2.0-Protokoll. Da die <emphasis>Autorisierung</emphasis> weiterhin durch das Dashboard vorgenommen wird, müssen Sie zunächst Benutzerkonten erstellen und ihnen die gewünschten Rollen zuweisen. Der <emphasis>Authentifizierungsprozess</emphasis> kann jedoch von einem vorhandenen <emphasis>Identitätsanbieter</emphasis> (IdP) durchgeführt werden.
  </para>

  <para>
   Mit folgendem Kommando konfigurieren Sie das Single Sign-on:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso setup saml2 <replaceable>CEPH_DASHBOARD_BASE_URL</replaceable> \
 <replaceable>IDP_METADATA</replaceable> <replaceable>IDP_USERNAME_ATTRIBUTE</replaceable> \
 <replaceable>IDP_ENTITY_ID</replaceable> <replaceable>SP_X_509_CERT</replaceable> \
 <replaceable>SP_PRIVATE_KEY</replaceable>
</screen>

  <para>
   Parameter:
  </para>

  <variablelist>
   <varlistentry>
    <term><replaceable>CEPH_DASHBOARD_BASE_URL</replaceable></term>
    <listitem>
     <para>
      Basis-URL für den Zugriff auf Ceph Dashboard (z. B. „https://cephdashboard.local“).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_METADATA</replaceable></term>
    <listitem>
     <para>
      URL, Dateipfad oder Inhalt der IdP-Metadaten-XML (z. B. „https://myidp/metadata“).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_USERNAME_ATTRIBUTE</replaceable></term>
    <listitem>
     <para>
      Optional. Attribut, mit dem der Benutzername aus der Authentifizierungsantwort ermittelt wird. Der Standardwert lautet „uid“.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_ENTITY_ID</replaceable></term>
    <listitem>
     <para>
      Optional. Für den Fall, dass die IdP-Metadaten mehrere Entitäts-IDs umfassen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>SP_X_509_CERT</replaceable> / <replaceable>SP_PRIVATE_KEY</replaceable></term>
    <listitem>
     <para>
      Optional. Dateipfad oder Inhalt des Zertifikats, mit dem das Ceph Dashboard (Service-Anbieter) die Signierung und Verschlüsselung vornimmt. Diese Dateipfade müssen von der aktiven Ceph-Manager-Instanz aus zugänglich sein.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>SAML-Anforderungen</title>
   <para>
    Für den Ausstellerwert der SAML-Anforderungen gilt folgende Syntax:
   </para>
<screen>
<replaceable>CEPH_DASHBOARD_BASE_URL</replaceable>/auth/saml2/metadata
</screen>
  </note>

  <para>
   Mit folgendem Kommando rufen Sie die aktuelle SAML-2.0-Konfiguration ab:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso show saml2
</screen>

  <para>
   Mit folgendem Kommando deaktivieren Sie Single Sign-on:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso disable
</screen>

  <para>
   Mit folgendem Kommando prüfen Sie, ob SSO aktiviert ist:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso status
</screen>

  <para>
   Mit folgendem Kommando aktivieren Sie SSO:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso enable saml2
</screen>
 </sect1>
</chapter>
