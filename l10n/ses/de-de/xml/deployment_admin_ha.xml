<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Einrichten des Hochverfügbarkeits-Clusters für den Admin-Knoten</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>Ja</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Der <emphasis>Admin-Knoten</emphasis> ist ein Ceph-Cluster-Knoten, in dem der Salt-Master-Service ausgeführt wird. Er verwaltet die restlichen Cluster-Knoten, indem er deren Salt-Minion-Services abfragt und anweist. Er enthält normalerweise auch andere Services, beispielsweise das <emphasis>Grafana</emphasis> Dashboard, das vom <emphasis>Prometheus</emphasis>-Überwachungs-Toolkit unterstützt wird.
 </para>
 <para>
  Falls im Admin-Knoten ein Fehler auftritt, müssen Sie normalerweise neue funktionierende Hardware für den Knoten zur Verfügung stellen und den gesamten Konfigurationsstapel des Clusters von einer kürzlich erstellten Sicherung wiederherstellen. Eine derartige Methode ist zeitaufwändig und verursacht den Ausfall des Clusters.
 </para>
 <para>
  Wir empfehlen einen Hochverfügbarkeits-Cluster für den Ceph Admin-Knoten, um Ausfallzeiten in der Ceph-Cluster-Leistung, die durch Admin-Knoten-Fehler verursacht werden, zu verhindern.
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Überblick zum Hochverfügbarkeits-Cluster für den Admin-Knoten</title>

  <para>
   Hinter einem Hochverfügbarkeits-Cluster steckt die Überlegung, dass im Fall eines Fehlers im Cluster-Knoten der andere Knoten automatisch dessen Rolle übernimmt, einschließlich des virtualisierten Admin-Knoten. Auf diese Weise bemerken andere Ceph-Cluster-Knoten gar nicht, dass im Admin-Knoten ein Fehler aufgetreten ist.
  </para>

  <para>
   Für die Mindestlösung eines Hochverfügbarkeits-Clusters für den Admin-Knoten ist die folgende Hardware erforderlich:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Zwei Bare Metal Server, auf denen SUSE Linux Enterprise mit der Hochverfügbarkeitserweiterung ausgeführt und der Admin-Knoten virtualisiert wird.
    </para>
   </listitem>
   <listitem>
    <para>
     Mindestens zwei redundante Pfade für die Netzwerkkommunikation, beispielsweise durch Netzwerkgeräte-Bonding.
    </para>
   </listitem>
   <listitem>
    <para>
     Gemeinsamer Speicher zum Hosten von Festplatten-Images der virtuellen Maschine des Admin-Knoten. Beide Server müssen auf den gemeinsamen Server zugreifen können. Es kann sich dabei beispielsweise um einen NFS-Export, eine Samba-Freigabe oder ein iSCSI-Ziel handeln.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Weitere detaillierte Informationen zu den Cluster-Anforderungen finden Sie in <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/art-sleha-install-quick.html#sec-ha-inst-quick-req"/>.
  </para>

  <figure>
   <title>Hochverfügbarkeits-Cluster mit zwei Knoten für den Admin-Knoten</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>Erstellen eines Hochverfügbarkeits-Clusters mit dem Admin-Knoten</title>

  <para>
   Der folgende Vorgang fasst die wichtigsten Schritte zur Erstellung des Hochverfügbarkeits-Clusters zur Virtualisierung des Admin-Knoten zusammen. Weitere detaillierte Informationen finden Sie unter den angegebenen Links.
  </para>

  <procedure>
   <step>
    <para>
     Richten Sie einen einfachen Hochverfügbarkeits-Cluster mit zwei Knoten und gemeinsamem Speicher ein. Eine Beschreibung hierzu finden Sie unter <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/art-sleha-install-quick.html"/>.
    </para>
   </step>
   <step>
    <para>
     Installieren Sie in beiden Cluster-Knoten alle Pakete, die zur Ausführung des KVM-Hypervisors und des <systemitem class="library">libvirt</systemitem>-Toolkits erforderlich sind. Eine Beschreibung hierzu finden Sie unter <link xlink:href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-vt-installation.html#sec-vt-installation-kvm"/>.
    </para>
   </step>
   <step>
    <para>
     Erstellen Sie im ersten Cluster-Knoten eine neue virtuelle KVM-Maschine und nutzen Sie dazu <systemitem class="library">libvirt</systemitem>. Eine Beschreibung hierzu finden Sie unter <link xlink:href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-kvm-inst.html#sec-libvirt-inst-virt-install"/>. Speichern Sie die Festplatten-Images der VM im vorkonfigurierten gemeinsamen Speicher.
    </para>
   </step>
   <step>
    <para>
     Exportieren Sie nach Abschluss der VM-Einrichtung deren Konfiguration in eine XML-Datei im gemeinsamen Speicher. Verwenden Sie folgende Syntax:
    </para>
<screen>
<prompt role="root">root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Erstellen Sie eine Ressource für die VM des Admin-Knoten. Allgemeine Informationen zum Erstellen von Hochverfügbarkeits-Ressourcen finden Sie unter <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/html/SLE-HA-all/cha-conf-hawk2.html"/>. Detaillierte Informationen zum Erstellen einer Ressource für eine virtuelle KVM-Maschine finden Sie unter <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/>.
    </para>
   </step>
   <step>
    <para>
     Stellen Sie auf dem neu erstellten VM-Gast den Admin-Knoten einschließlich der dort benötigten weiteren Services bereit. Befolgen Sie die relevanten Anweisungen unter <xref linkend="deploy-salt"/>. Stellen Sie gleichzeitig die restlichen Ceph-Cluster-Knoten auf den Servern ohne Hochverfügbarkeits-Cluster bereit.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
