<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_nfsganesha.xml" version="5.0" xml:id="cha-ceph-nfsganesha">

 <title>NFS Ganesha</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  NFS Ganesha ist ein NFS-Server, der in einem Benutzeradressenbereich statt als Teil des Betriebssystem-Kernels ausgeführt wird. Mit NFS Ganesha binden Sie Ihren eigenen Speichermechanismus ein, wie zum Beispiel Ceph, und greifen von einem beliebigen NFS Client darauf zu. Die Installationsanweisungen finden Sie im <xref linkend="deploy-cephadm-day2-service-nfs"/>.
 </para>
 <note>
  <title>NFS-Ganesha-Leistung</title>
  <para>
   Angesichts des erhöhten Protokoll-Overheads und der zusätzlichen Latenz durch zusätzliche Netzwerk-Hops zwischen Client und Speicher kann ein Zugriff auf Ceph über einen NFS-Gateway die Anwendungsleistung im Vergleich zu einem nativen CephFS erheblich senken.
  </para>
 </note>
 <para>
  Jeder NFS-Ganesha-Dienst besteht aus einer Konfigurationshierarchie, die Folgendes enthält:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Einen Bootstrap <filename>ganesha.conf</filename>
   </para>
  </listitem>
  <listitem>
   <para>
    Ein gemeinsames RADOS-Konfigurationsobjekt pro Service
   </para>
  </listitem>
  <listitem>
   <para>
    Ein RADOS-Konfigurationsobjekt pro Export
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Die Bootstrap-Konfiguration ist die Minimalkonfiguration zum Starten des <systemitem class="daemon">nfs-ganesha</systemitem>-Daemons innerhalb eines Containers. Jede Bootstrap-Konfiguration enthält eine <literal>%url</literal>-Anweisung, die jede zusätzliche Konfiguration aus dem gemeinsamen RADOS-Konfigurationsobjekt enthält. Das gemeinsame Konfigurationsobjekt kann zusätzliche <literal>%url</literal>-Anweisungen für jeden der NFS-Exporte enthalten, die in den RADOS-Konfigurationsobjekten definiert sind.
 </para>
 <figure>
  <title>NFS-Ganesha-Struktur</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="nfs_ganesha_structure.png" width="75%"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="nfs_ganesha_structure.png" width="75%"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="ceph-nfsganesha-nfservice">
  <title>Erstellen eines NFS-Service</title>

  <para>
   Die Spezifikation der Bereitstellung von Ceph-Services erfolgt am besten durch Erstellen einer YAML-formatierten Datei mit der Spezifikation der Services, die Sie bereitstellen möchten. Sie können für jeden Servicetyp eine eigene Spezifikationsdatei erstellen, oder Sie geben mehrere (oder alle) Servicetypen in einer Datei an.
  </para>

  <para>
   Je nachdem, wofür Sie sich entschieden haben, müssen Sie eine entsprechende YAML-formatierte Datei aktualisieren oder erstellen, um einen NFS-Ganesha-Dienst anzulegen. Weitere Informationen zum Erstellen der Datei finden Sie im <xref linkend="cephadm-service-and-placement-specs"/>.
  </para>

  <para>
   Nachdem Sie die Datei aktualisiert oder erstellt haben, erstellen Sie mit folgendem Kommando einen <literal>nfs-ganesha</literal>-Dienst:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph orch apply -i <replaceable>FILE_NAME</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-services">
  <title>Starten oder Neustarten von NFS Ganesha</title>

  <important>
   <para>
    Durch Starten des NFS-Ganesha-Diensts wird ein CephFS-Dateisystem nicht automatisch exportiert. Erstellen Sie eine Export-Konfigurationsdatei, um ein CephFS-Dateisystem zu exportieren. Weitere Informationen finden Sie in <xref linkend="ceph-nfsganesha-create-export"/>.
   </para>
  </important>

  <para>
   Führen Sie zum Starten des NFS-Ganesha-Diensts folgendes Kommando aus:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch start nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Führen Sie für einen Neustart des NFS-Ganesha-Diensts folgendes Kommando aus:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch restart nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Falls Sie nur einen einzelnen NFS-Ganesha-Daemon neu starten möchten, führen Sie folgendes Kommando aus:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch daemon restart nfs.<replaceable>SERVICE_ID</replaceable></screen>

  <para>
   Wenn NFS Ganesha gestartet oder neu gestartet wird, hat es eine Kulanzzeitüberschreitung von 90 Sekunden für NFS v4. Während des Kulanzzeitraums werden neue Anforderungen von Clients aktiv abgelehnt. Somit werden die Anforderungen der Clients möglicherweise verzögert, wenn sich NFS im Kulanzzeitraum befindet.
  </para>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-list-objects">
  <title>Auflisten von Objekten im NFS-Wiederherstellungspool</title>

  <para>
   Listen Sie die Objekte im NFS-Widerherstellungspool mit folgendem Kommando auf:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>rados --pool <replaceable>POOL_NAME</replaceable> --namespace <replaceable>NAMESPACE_NAME</replaceable> ls</screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-create-export">
  <title>Erstellen eines NFS-Exports</title>

  <para>
   Sie können einen NFS-Export entweder über das Ceph Dashboard oder manuell über die Kommandozeile erstellen. Weitere Informationen zum Exportieren über das Ceph Dashboard finden Sie in <xref linkend="dash-webui-nfs"/>, insbesondere in <xref linkend="dash-webui-nfs-create"/>.
  </para>

  <para>
   Für einen manuellen NFS-Export erstellen Sie zunächst eine Konfigurationsdatei. Zum Beispiel die Datei <filename>/tmp/export-1</filename> mit dem folgenden Inhalt:
  </para>

<screen>
EXPORT {
    export_id = 1;
    path = "/";
    pseudo = "/";
    access_type = "RW";
    squash = "no_root_squash";
    protocols = 3, 4;
    transports = "TCP", "UDP";
    FSAL {
        name = "CEPH";
        user_id = "admin";
        filesystem = "a";
        secret_access_key = "<replaceable>SECRET_ACCESS_KEY</replaceable>";
    }
}
</screen>

  <para>
   Nachdem Sie die Konfigurationsdatei für den neuen Export erstellt und gespeichert haben, führen Sie folgendes Kommando zum Exportieren aus:
  </para>

<screen>rados --pool <replaceable>POOL_NAME</replaceable> --namespace <replaceable>NAMESPACE_NAME</replaceable> put <replaceable>EXPORT_NAME</replaceable> <replaceable>EXPORT_CONFIG_FILE</replaceable></screen>

  <para>
   Beispiel:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>rados --pool example_pool --namespace example_namespace put export-1 /tmp/export-1</screen>

  <note>
   <para>
    Der FSAL-Block sollte so geändert werden, dass er die gewünschte <systemitem class="service">cephx</systemitem>-Benutzer-ID und den geheimen Zugangsschlüssel enthält.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-verify">
  <title>Überprüfen des NFS-Exports</title>

  <para>
   NFS v4 erstellt eine Liste von Exporten im Stamm eines Pseudodateisystems. Sie können überprüfen, ob die NFS-Freigaben exportiert werden. Hängen Sie dazu <filename>/</filename> des NFS-Ganesha-Serverknotens ein:
  </para>

<screen><prompt role="root"># </prompt><command>mount</command> -t nfs <replaceable>nfs_ganesha_server_hostname:/ /path/to/local/mountpoint</replaceable>
<prompt role="root"># </prompt><command>ls</command> <replaceable>/path/to/local/mountpoint</replaceable> cephfs</screen>

  <note>
   <title>NFS Ganesha ist nur v4</title>
   <para>
    Standardmäßig konfiguriert cephadm einen NFS-v4-Server. NFS v4 interagiert weder mit <literal>rpcbind</literal> noch mit dem <literal>mountd</literal>-Daemon. NFS-Client-Tools wie <command>showmount</command> zeigen keine konfigurierten Exporte an.
   </para>
  </note>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-mount">
  <title>Einhängen des NFS-Exports</title>

  <para>
   Führen Sie zum Einhängen der exportierten NFS-Freigabe auf einem Client-Host folgendes Kommando aus:
  </para>

<screen><prompt role="root"># </prompt><command>mount</command> -t nfs <replaceable>nfs_ganesha_server_hostname:/ /path/to/local/mountpoint</replaceable></screen>
 </sect1>
 <sect1 xml:id="ceph-nfsganesha-customrole">
  <title>Mehrere NFS-Ganesha-Cluster</title>

  <para>
   Es können mehrere NFS-Ganesha-Cluster definiert werden. Dies ermöglicht:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Getrennte NFS-Ganesha-Cluster für den Zugriff auf CephFS.
    </para>
   </listitem>
  </itemizedlist>


 </sect1>
</chapter>
