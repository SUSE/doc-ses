<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="upgrade-to-pacific.xml" version="5.0" xml:id="upgrade-to-pacific">
 <title>從 SUSE Enterprise Storage 7 升級至版本 7.1</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  本章說明將 SUSE Enterprise Storage 7 升級至版本 7.1 的步驟。
 </para>
 <para>
  升級包括以下任務：
 </para>
 <itemizedlist>
  <listitem>
   <para>
    將基礎 SUSE Linux Enterprise Server 15 SP2 升級至 SUSE Linux Enterprise Server 15 SP3 版本。
   </para>
  </listitem>
  <listitem>
   <para>
    從 Ceph Octopus 升級至 Pacific。
   </para>
  </listitem>
 </itemizedlist>
 <sect1 xml:id="before-upgrade-7p">
  <title>升級前</title>

  <para>
   開始升級之前，<emphasis>必須</emphasis>完成以下任務。在 SUSE Enterprise Storage 7 生命週期內可隨時執行這些任務。
  </para>

  <sect2 xml:id="upgrade-consider-points-7p">
   <title>需考量的要點</title>
   <para>
    升級前，請務必閱讀以下章節，確定您瞭解所有需要執行的任務。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <emphasis>閱讀版本說明</emphasis>。在版本說明中，您可以找到更多有關自 SUSE Enterprise Storage 的上一個版本發行後所進行的變更的資訊。檢查版本說明以瞭解：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        您的硬體是否有特殊注意事項。
       </para>
      </listitem>
      <listitem>
       <para>
        所用的任何軟體套件是否已發生重大變更。
       </para>
      </listitem>
      <listitem>
       <para>
        是否需要對您的安裝施行特殊預防措施。
       </para>
      </listitem>
     </itemizedlist>
     <para>
      版本說明還會提供無法及時編入手冊的資訊。它們還包含有關已知問題的說明。
     </para>
     <para>
      您可以在 <link xlink:href="https://www.suse.com/releasenotes/"/> 上找到線上 SES 7.1 版本說明。
     </para>
     <para>
      此外，安裝 SES 7.1 儲存庫中的 <package>release-notes-ses</package> 套件之後，可在本地的 <filename>/usr/share/doc/release-notes</filename> 目錄中或 <link xlink:href="https://www.suse.com/releasenotes/"/> 網頁上找到版本說明。
     </para>
    </listitem>
    <listitem>
     <para>
      閱讀<xref linkend="ses-deployment"/>，熟悉 <systemitem class="resource">ceph-salt</systemitem> 和 Ceph orchestrator，特別需要瞭解有關服務規格的資訊。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="upgrade-backup-config-data-7p">
   <title>備份叢集組態和資料</title>
   <para>
    我們強烈建議您在開始升級之前備份所有叢集組態和資料。如需如何備份所有資料的說明，請參閱<xref linkend="cha-deployment-backup"/>。
   </para>
  </sect2>

  <sect2 xml:id="verify-previous-upgrade-patch-repos-7p">
   <title>確認對軟體儲存庫和容器影像的存取權</title>
   <para>
    確認是否每個叢集節點都能存取 SUSE Linux Enterprise Server 15 SP3 和 SUSE Enterprise Storage 7.1 軟體儲存庫以及容器影像登錄。
   </para>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-repos-7p">
    <title>軟體儲存庫</title>
    <para>
     如果所有節點均已在 SCC 中註冊，您便可以使用 <command>zypper migration</command> 指令進行升級。如需更多詳細資料，請參閱 <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>。
    </para>
    <para>
     如果節點<emphasis role="bold">未</emphasis>在 SCC 中註冊，請停用所有現有軟體儲存庫，並為下面每個延伸新增 <literal>Pool</literal> 和 <literal>Updates</literal> 儲存庫：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       SLE-Product-SLES/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Basesystem/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Server-Applications/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SUSE-Enterprise-Storage-7.1
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-images-7p">
    <title>容器影像</title>
    <para>
     所有叢集節點都需要存取容器影像登錄。在大多數情況下，您將使用 <literal>registry.suse.com</literal> 上的公用 SUSE 登錄。您需要以下影像：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/ceph
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/grafana
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-server
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-node-exporter
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-alertmanager
      </para>
     </listitem>
    </itemizedlist>
    <para>
     或者，例如對於實體隔離部署，請設定本地登錄並確認您是否有一組正確的容器影像可用。如需設定本地容器影像登錄的更多詳細資料，請參閱<xref linkend="deploy-cephadm-configure-registry"/>。
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="upgrade-cluster-nodes">
  <title>將每個叢集節點上的 SUSE Linux Enterprise Server 移轉至 SUSE Linux Enterprise Server 15 SP3 版本</title>

  <para>
   如果叢集節點設定為使用 SUSE Customer Center，您可以使用 <command>zypper migration</command> 指令。
  </para>

  <para>
   如果叢集節點的軟體儲存庫是以手動方式設定的，您需要手動升級節點。
  </para>

  <para>
   如需使用 <command>zypper</command> 升級 SUSE Linux Enterprise Server 的詳細資訊，請參閱 <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>。
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-packages">
  <title>升級每個叢集節點上與 SUSE Enterprise Storage 相關的套件</title>

  <para>
   若要將 SUSE Enterprise Storage 套件升級至最新版本，請使用 <command>ceph-salt update</command> 指令。如需詳細資訊，請參閱 <xref linkend="cephadm-rolling-updates"/>。
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-services">
  <title>升級現有 Ceph 叢集服務</title>

  <para>
   從管理節點中執行以下指令來將整個 Ceph 叢集升級至 Pacific 版本：
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch upgrade start --image registry.suse.com/ses/7.1/ceph/ceph</screen>
 </sect1>
</chapter>
