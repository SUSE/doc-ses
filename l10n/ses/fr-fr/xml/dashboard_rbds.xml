<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>Gestion du périphérique de traitement par blocs RADOS (RBD)</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>oui</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Pour répertorier tous les périphériques de bloc RADOS (RADOS Block Device, RBD) disponibles, cliquez sur <menuchoice><guimenu>Bloc</guimenu><guimenu>Images</guimenu></menuchoice> dans le menu principal.
 </para>
 <para>
  La liste affiche de brèves informations sur le périphérique, telles que son nom, le nom de la réserve associée, l'espace de noms, la taille du périphérique, le nombre et la taille des objets sur le périphérique, des informations sur le provisioning des détails et le parent.
 </para>
 <figure>
  <title>Liste des images RBD</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>Affichage des détails sur les RBD</title>

  <para>
   Pour afficher des informations plus détaillées sur un périphérique, cliquez sur sa ligne dans le tableau :
  </para>

  <figure>
   <title>Détails des RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>Affichage de la configuration d'un RBD</title>

  <para>
   Pour afficher la configuration détaillée d'un périphérique, cliquez sur sa ligne dans le tableau, puis sur l'onglet <guimenu>Configuration</guimenu> dans le tableau inférieur :
  </para>

  <figure>
   <title>Configuration d'un RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>Création de RBD</title>

  <para>
   Pour ajouter un nouveau périphérique, cliquez sur <guimenu>Créer</guimenu> en haut à gauche de l'en-tête du tableau, puis procédez comme suit dans l'écran <guimenu>Créer RBD</guimenu> :
  </para>

  <figure>
   <title>Ajout d'un nouveau RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     Entrez le nom du nouveau périphérique. Reportez-vous au <xref linkend="sysreq-naming"/> pour plus d'informations sur les règles de dénomination.
    </para>
   </step>
   <step>
    <para>
     Sélectionnez la réserve à laquelle est assignée l'application <option>rbd</option> à partir de laquelle le nouveau périphérique RBD va être créé.
    </para>
   </step>
   <step>
    <para>
     Spécifiez la taille du nouveau périphérique.
    </para>
   </step>
   <step>
    <para>
     Spécifiez des options supplémentaires pour le périphérique. Pour affiner les paramètres de l'appareil, cliquez sur <guimenu>Avancé</guimenu> et entrez des valeurs pour la taille d'objet, l'unité de segmentation ou le nombre de segments. Pour spécifier les limites de la qualité de service (Quality of Service, QoS), cliquez sur <guimenu>Qualité de service</guimenu> et indiquez les valeurs.
    </para>
   </step>
   <step>
    <para>
     Confirmez en cliquant sur le bouton <guimenu>Créer RBD</guimenu>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>Suppression de RBD</title>

  <para>
   Pour supprimer un périphérique, sélectionnez-le dans la ligne du tableau. Cliquez sur la flèche de liste déroulante en regard du bouton <guimenu>Créer</guimenu>, puis sur <guimenu>Supprimer</guimenu>. Confirmez la suppression en cliquant sur <guimenu>Delete RBD</guimenu> (Supprimer le RBD).
  </para>

  <tip>
   <title>déplacement de RBD vers la corbeille</title>
   <para>
    La suppression d'un RDB est une opération irréversible. En revanche, <guimenu>Déplacer vers la corbeille</guimenu> vous permet de restaurer ultérieurement le périphérique en le sélectionnant sur l'onglet <guimenu>Corbeille</guimenu> du principal tableau et en cliquant sur <guimenu>Restaurer</guimenu> en haut à gauche de l'en-tête du tableau.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>Création d'instantanés de périphériques de traitement par blocs RADOS (RBD)</title>

  <para>
   Pour créer un instantané de périphérique de traitement par blocs RADOS, sélectionnez le périphérique dans la ligne du tableau. Le volet de contenu de configuration détaillé apparaît. Sélectionnez l'onglet <guimenu>Instantanés</guimenu> et cliquez sur <guimenu>Créer</guimenu> en haut à gauche de l'en-tête du tableau. Entrez le nom de l'instantané et confirmez en cliquant sur <guimenu>Create RBD Snapshot</guimenu> (Créer un instantané de RBD).
  </para>

  <para>
   Après avoir sélectionné un instantané, vous pouvez effectuer des opérations supplémentaires sur le périphérique, telles que renommer, protéger, cloner, copier ou supprimer. <guimenu>Rollback</guimenu> restaure l'état de l'appareil à partir de l'instantané actuel.
  </para>

  <figure>
   <title>Instantanés de RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>Mise en miroir de RBD</title>

  <para>
   Les images RBD peuvent être mises en miroir de manière asynchrone entre deux grappes Ceph. Vous pouvez utiliser Ceph Dashboard pour configurer la réplication d'images RBD entre plusieurs grappes. Cette fonctionnalité est disponible en deux modes :
  </para>

  <variablelist>
   <varlistentry>
    <term>Mode basé sur un journal</term>
    <listitem>
     <para>
      Ce mode utilise la fonctionnalité de journalisation de l'image RBD afin de garantir une réplication ponctuelle, cohérente entre les grappes en cas de panne.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Mode basé sur des instantanés</term>
    <listitem>
     <para>
      Ce mode utilise des instantanés en miroir d'image RBD planifiés régulièrement ou créés manuellement pour répliquer des images RBD cohérentes entre les grappes en cas de panne.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   La mise en miroir est configurée réserve par réserve au sein des grappes homologues et peut être configurée sur un sous-ensemble spécifique d'images dans la réserve ou configurée pour mettre en miroir automatiquement toutes les images d'une réserve lorsque vous utilisez la mise en miroir basée sur le journal uniquement.
  </para>

  <para>
   La mise en miroir est configurée à l'aide de la commande <command>rbd</command>, qui est installée par défaut dans SUSE Enterprise Storage 7. Le daemon <systemitem class="daemon">rbd-mirror</systemitem> est chargé d'extraire les mises à jour de l'image de la grappe homologue distante et de les appliquer à l'image dans la grappe locale. Reportez-vous à la <xref linkend="rbd-mirror-daemon-enable"/> pour plus d'informations sur l'activation du daemon <systemitem class="daemon">rbd-mirror</systemitem>.
  </para>

  <para>
   Selon les besoins de réplication, la mise en miroir RBD peut être configurée pour une réplication unidirectionnelle ou bidirectionnelle :
  </para>

  <variablelist>
   <varlistentry>
    <term>Réplication unidirectionnelle</term>
    <listitem>
     <para>
      Lorsque les données sont mises en miroir uniquement à partir d'une grappe primaire vers une grappe secondaire, le daemon <systemitem class="daemon">rbd-mirror</systemitem> s'exécute uniquement sur la grappe secondaire.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Réplication bidirectionnelle</term>
    <listitem>
     <para>
      Lorsque les données sont mises en miroir à partir des images primaires sur une grappe vers des images non primaires sur une autre grappe (et inversement), le daemon <systemitem class="daemon">rbd-mirror</systemitem> s'exécute sur les deux grappes.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    Chaque instance du daemon <systemitem class="daemon">rbd-mirror</systemitem> doit pouvoir se connecter simultanément aux grappes Ceph locales et distantes, par exemple tous les hôtes de moniteur et OSD. En outre, le réseau doit disposer de suffisamment de bande passante entre les deux centres de données pour gérer le workload en miroir.
   </para>
  </important>

  <tip>
   <title>informations générales</title>
   <para>
    Pour des informations générales et l'approche de ligne de commande pour la mise en miroir de périphérique de bloc RADOS, reportez-vous à la <xref linkend="ceph-rbd-mirror"/>.
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>Configuration de grappes primaires et secondaires</title>
   <para>
    Une grappe <emphasis>primaire</emphasis> est celle sur laquelle la réserve d'origine avec les images est créée. Une grappe <emphasis>secondaire</emphasis> est celle sur laquelle la réserve ou les images sont répliquées à partir de la grappe <emphasis>primaire</emphasis>.
   </para>
   <note>
    <title>assignation d'un nom relatif</title>
    <para>
     Les termes <emphasis>primaire</emphasis> et <emphasis>secondaire</emphasis> peuvent être relatifs dans le contexte de la réplication, étant donné qu'ils se rapportent davantage aux réserves individuelles qu'aux grappes. Par exemple, dans la réplication bidirectionnelle, une réserve peut être mise en miroir de la grappe <emphasis>primaire</emphasis> vers la grappe <emphasis>secondaire</emphasis>, tandis qu'une autre réserve peut être mise en miroir de la grappe <emphasis>secondaire</emphasis> vers la grappe <emphasis>primaire</emphasis>.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>Activation du daemon <systemitem class="daemon">rbd-mirror</systemitem></title>
   <para>
    Les procédures suivantes montrent comment effectuer les tâches d'administration de base pour configurer la mise en miroir à l'aide de la commande <command>rbd</command>. La mise en miroir est configurée réserve par réserve au sein des grappes Ceph.
   </para>
   <para>
    Les étapes de configuration d'une réserve doivent être effectuées sur les deux grappes homologues. Ces procédures supposent que deux grappes, nommées « primary » (primaire) et « secondary » (secondaire), sont accessibles depuis un seul hôte pour plus de clarté.
   </para>
   <para>
    Le daemon <systemitem class="daemon">rbd-mirror</systemitem> effectue la réplication réelle des données de grappe.
   </para>
   <procedure>
    <step>
     <para>
      Renommez <filename>ceph.conf</filename> et les fichiers de trousseau de clés et copiez-les de l'hôte primaire vers l'hôte secondaire :
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      Pour activer la mise en miroir sur une réserve avec <command>rbd</command>, indiquez <command>mirror pool enable</command>, le nom de la réserve et le mode de mise en miroir :
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       Le mode de mise en miroir peut être <literal>image</literal> ou <literal>pool</literal>. Par exemple :
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      Dans Ceph Dashboard, accédez à <menuchoice><guimenu>Bloc</guimenu><guimenu>Mise en miroir</guimenu></menuchoice>. Le tableau <guimenu>Daemons</guimenu> à gauche montre les daemons <systemitem class="daemon">rbd-mirror</systemitem> en cours d'exécution et leur état de santé.
     </para>
     <figure>
      <title>Exécution de daemons <systemitem class="daemon">rbd-mirror</systemitem></title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>Désactivation de la mise en miroir</title>
   <para>
    Pour désactiver la mise en miroir sur une réserve avec <command>rbd</command>, spécifiez la commande <command>mirror pool disable</command> et le nom de la réserve :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    Lorsque la mise en miroir est désactivée sur une réserve de cette manière, la mise en miroir est également désactivée sur toutes les images (dans la réserve) pour lesquelles la mise en miroir a été explicitement activée.
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>Démarrage des homologues</title>
   <para>
    Pour que <systemitem class="daemon">rbd-mirror</systemitem> découvre sa grappe homologue, l'homologue doit être enregistré dans la réserve et un compte utilisateur doit être créé. Ce processus peut être automatisé avec <command>rbd</command> et les commandes <command>mirror pool peer bootstrap create</command> ainsi que<command> mirror pool peer bootstrap import</command>.
   </para>
   <para>
    Pour créer manuellement un nouveau jeton Bootstrap avec <command>rbd</command>, spécifiez la commande <command>mirror pool peer bootstrap create</command>, un nom de réserve, ainsi qu'un nom de site facultatif pour décrire la grappe locale :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    La sortie de la commande <command>mirror pool peer bootstrap create</command> sera un jeton qui doit être fourni à la commande <command>mirror pool peer bootstrap import</command>. Par exemple, sur la grappe primaire :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
  joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    Pour importer manuellement le jeton Bootstrap créé par une autre grappe à l'aide de la commande <command>rbd</command>, spécifiez la commande <command>mirror pool peer bootstrap import</command>, le nom de la réserve, un chemin d'accès au jeton créé (ou « - » pour lire à partir de l'entrée standard), ainsi qu'un nom de site facultatif pour décrire la grappe locale et une direction de mise en miroir (par défaut, <literal>rx-tx</literal> pour la mise en miroir bidirectionnelle, mais cela peut également être défini sur <literal>rx-only</literal> pour la mise en miroir unidirectionnelle) :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    Par exemple, sur la grappe secondaire :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>Suppression d'un homologue de grappe</title>
   <para>
    Pour supprimer une grappe Ceph homologue de mise en miroir avec la commande <command>rbd</command>, indiquez la commande <command>mirror pool peer remove</command>, le nom de la réserve et l'UUID de l'homologue (disponible dans le résultat de la commande <command>rbd mirror pool info</command>) :
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Configuration de la réplication de réserve dans Ceph Dashboard</title>
   <para>
    Le daemon <systemitem class="daemon">rbd-mirror</systemitem> doit avoir accès à la grappe primaire pour pouvoir mettre en miroir des images RBD. Veillez à avoir suivi les étapes de la <xref linkend="rbd-mirror-peer-bootstrap"/> avant de poursuivre.
   </para>
   <procedure>
    <step>
     <para>
      Sur les grappes <emphasis>primaire</emphasis> et <emphasis>secondaire</emphasis>, créez une réserve portant le même nom et assignez-lui l'application <literal>rbd</literal>. Reportez-vous à la <xref linkend="dashboard-pools-create"/> pour plus de détails sur la création d'une réserve.
     </para>
     <figure>
      <title>Création d'une réserve avec l'application RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Sur les tableaux de bord des grappes <emphasis>primaire</emphasis> et <emphasis>secondaire</emphasis>, accédez à <menuchoice><guimenu>Bloc</guimenu><guimenu>Mise en miroir</guimenu></menuchoice>. Dans le tableau <guimenu>Réserves</guimenu> à droite, cliquez sur le nom de la réserve à répliquer et, après avoir cliqué sur <guimenu>Mode d'édition</guimenu>, sélectionnez le mode de réplication. Dans cet exemple, nous travaillerons avec un mode de réplication <emphasis>réserve</emphasis>, ce qui signifie que toutes les images d'une réserve donnée seront répliquées. Confirmez en cliquant sur <guimenu>Mise à jour</guimenu>.
     </para>
     <figure>
      <title>Configuration du mode de réplication</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>erreur ou avertissement sur la grappe primaire</title>
      <para>
       Après la mise à jour du mode de réplication, un drapeau d'erreur ou d'avertissement apparaît dans la colonne de droite correspondante. Cela est dû au fait que la réserve n'a encore aucun utilisateur homologue qui lui est assigné pour la réplication. Ignorez ce drapeau pour la grappe <emphasis>primaire</emphasis> étant donné que nous assignons un utilisateur homologue à la grappe <emphasis>secondaire</emphasis> uniquement.
      </para>
     </important>
    </step>
    <step>
     <para>
      Sur le tableau de bord de la grappe <emphasis>secondaire</emphasis>, accédez à <menuchoice><guimenu>Bloc</guimenu><guimenu>Mise en mise en miroir</guimenu></menuchoice>. Ajoutez l'homologue de miroir de réserve en sélectionnant <guimenu>Ajouter un homologue</guimenu>. Spécifiez les détails de la grappe <emphasis>primaire</emphasis> :
     </para>
     <figure>
      <title>Ajout des informations d'identification de l'homologue</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>Nom de la grappe</guimenu></term>
       <listitem>
        <para>
         Chaîne unique arbitraire qui identifie la grappe primaire (par exemple « primaire »). Le nom de la grappe doit être différent de celui de la grappe secondaire réel.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>ID CephX</guimenu></term>
       <listitem>
        <para>
         ID utilisateur Ceph que vous avez créé en tant qu'homologue de mise en miroir. Dans cet exemple, il s'agit de « rbd-mirror-peer ».
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Adresses du moniteur</guimenu></term>
       <listitem>
        <para>
         Liste des adresses IP des noeuds Ceph Monitor de la grappe principale, séparées par des virgules.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Clé CephX</guimenu></term>
       <listitem>
        <para>
         Clé liée à l'ID utilisateur homologue. Vous pouvez la récupérer en exécutant l'exemple de commande suivant sur la grappe primaire :
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Confirmez en cliquant sur <guimenu>Soumettre</guimenu>.
     </para>
     <figure>
      <title>Liste des réserves répliquées</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>Vérification du fonctionnement de la réplication d'image RBD</title>
   <para>
    Lorsque le daemon <systemitem class="daemon">rbd-mirror</systemitem> est en cours d'exécution et que la réplication d'image RBD est configurée sur Ceph Dashboard, il est temps de vérifier si la réplication fonctionne réellement :
   </para>
   <procedure>
    <step>
     <para>
      Sur l'instance Ceph Dashboard de la grappe <emphasis>primaire</emphasis>, créez une image RBD de sorte que sa réserve parent soit la réserve que vous avez déjà créée à des fins de réplication. Activez les fonctionnalités <option>Verrou exclusif</option> et <option>Journalisation</option> pour l'image. Reportez-vous à la <xref linkend="dashboard-rbds-create"/> pour plus de détails sur la création d'images RBD.
     </para>
     <figure>
      <title>Nouvelle image RBD</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Après avoir créé l'image que vous souhaitez répliquer, ouvrez l'instance Ceph Dashboard de la grappe <emphasis>secondaire</emphasis> et accédez à <menuchoice><guimenu>Bloc</guimenu><guimenu>Mise en miroir</guimenu></menuchoice>. Le tableau <guimenu>Réserves</guimenu> sur la droite rend compte du changement du <guimenu>nombre d'images à distance</guimenu> et synchronise le <guimenu>nombre d'images en local</guimenu>.
     </para>
     <figure>
      <title>Nouvelle image RBD synchronisée</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>progression de la réplication</title>
      <para>
       Le tableau <guimenu>Images</guimenu> en bas de la page affiche le statut de la réplication des images RBD. L'onglet <guimenu>Problèmes</guimenu> inclut les éventuels problèmes, l'onglet <guimenu>Synchronisation en cours</guimenu> affiche la progression de la réplication des images et l'onglet <guimenu>Prêt</guimenu> répertorie toutes les images dont la réplication a réussi.
      </para>
      <figure>
       <title>Statut de la réplication des images RBD</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      Sur la grappe <emphasis>primaire</emphasis>, écrivez des données dans l'image RBD. Sur l'instance Ceph Dashboard de la grappe <emphasis>secondaire</emphasis>, accédez à <menuchoice><guimenu>Bloc</guimenu><guimenu>Images</guimenu></menuchoice> et surveillez si la taille de l'image correspondante augmente au fur et à mesure que des données sont inscrites sur la grappe primaire.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>Gestion des passerelles iSCSI</title>

  <tip>
   <title>plus d'informations sur les passerelles iSCSI</title>
   <para>
    Pour plus d'informations sur les passerelles iSCSI, reportez-vous au <xref linkend="cha-ceph-iscsi"/>.
   </para>
  </tip>

  <para>
   Pour répertorier toutes les passerelles disponibles et les images assignées, cliquez sur <menuchoice><guimenu>Bloc</guimenu><guimenu>iSCSI</guimenu></menuchoice> dans le menu principal. Un onglet <guimenu>Présentation</guimenu> s'ouvre et répertorie les passerelles iSCSI actuellement configurées et les images RBD assignées.
  </para>

  <para>
   Le tableau <guimenu>Passerelles</guimenu> répertorie l'état de chaque passerelle, le nombre de cibles iSCSI et le nombre de sessions. Le tableau <guimenu>Images</guimenu> répertorie le nom de chaque image assignée, le type de backstore du nom de la réserve associée et d'autres détails statistiques.
  </para>

  <para>
   L'onglet <guimenu>Cibles</guimenu> répertorie les cibles iSCSI actuellement configurées.
  </para>

  <figure>
   <title>Liste des cibles iSCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Pour afficher des informations plus détaillées sur une cible, cliquez sur la flèche de liste déroulante sur la ligne cible du tableau. Un schéma structuré en arborescence s'ouvre et liste les disques, les portails, les initiateurs et les groupes. Cliquez sur un élément pour le développer et afficher son contenu détaillé, éventuellement avec une configuration associée dans le tableau sur la droite.
  </para>

  <figure>
   <title>Détails d'une cible ISCSI</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>Ajout de cibles iSCSI</title>
   <para>
    Pour ajouter une nouvelle cible iSCSI, cliquez sur <guimenu>Créer</guimenu> en haut à gauche dans le tableau <guimenu>Cibles</guimenu>, puis entrez les informations requises.
   </para>
   <figure>
    <title>Ajout d'une nouvelle cible</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      Entrez l'adresse cible de la nouvelle passerelle.
     </para>
    </step>
    <step>
     <para>
      Cliquez sur <guimenu>Add portal</guimenu> (Ajouter un portail) et sélectionnez un ou plusieurs portails iSCSI dans la liste.
     </para>
    </step>
    <step>
     <para>
      Cliquez sur <guimenu>Add image</guimenu> (Ajouter une image) et sélectionnez une ou plusieurs images RBD pour la passerelle.
     </para>
    </step>
    <step>
     <para>
      Si vous devez utiliser l'authentification pour accéder à la passerelle, sélectionnez la case à cocher <guimenu>Authentification ACL</guimenu>, puis entrez les informations d'identification. Vous pouvez trouver des options d'authentification plus avancées après avoir activé <guimenu>l'authentification mutuelle</guimenu> et l'<guimenu>authentification par détection</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Confirmez en cliquant sur le bouton <guimenu>Create Target</guimenu> (Créer une cible).
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>Modification des cibles iSCSI</title>
   <para>
    Pour modifier une cible iSCSI existante, cliquez sur sa ligne dans le tableau <guimenu>Cibles</guimenu>, puis cliquez sur <guimenu>Modifier</guimenu> en haut à gauche du tableau.
   </para>
   <para>
    Vous pouvez ensuite modifier la cible iSCSI, ajouter ou supprimer des portails et ajouter ou supprimer des images RBD associées. Vous pouvez également ajuster les informations d'authentification pour la passerelle.
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>Suppression de cibles iSCSI</title>
   <para>
    Pour supprimer une cible iSCSI, sélectionnez la ligne du tableau, puis cliquez sur la flèche déroulante en regard du bouton <guimenu>Modifier</guimenu>, puis sélectionnez <guimenu>Supprimer</guimenu>. Cochez la case <guimenu>Oui</guimenu> et confirmez avec le bouton <guimenu>Delete iSCSI </guimenu> (Supprimer la cible iSCSI).
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>Qualité de service (QoS) RBD</title>

  <tip>
   <title>informations supplémentaires</title>
   <para>
    Pour plus d'informations générales et une description des options de configuration QoS RBD, reportez-vous à la <xref linkend="rbd-qos"/>.
   </para>
  </tip>

  <para>
   Les options QoS peuvent être configurées à différents niveaux.
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Globalement
    </para>
   </listitem>
   <listitem>
    <para>
     Par réserve
    </para>
   </listitem>
   <listitem>
    <para>
     Par image
    </para>
   </listitem>
  </itemizedlist>

  <para>
   La configuration <emphasis>globale</emphasis> est en haut de la liste et sera utilisée pour toutes les images RBD récemment créées et pour les images qui ne remplacent pas ces valeurs au niveau de la couche image RBD ou réserve. Une valeur d'option spécifiée globalement peut être remplacée par réserve ou par image. Les options spécifiées sur une réserve seront appliquées à toutes les images RBD de cette réserve, excepté si elles sont remplacées par une option de configuration définie sur une image. Les options spécifiées sur une image remplaceront les options spécifiées sur une réserve et celles définies globalement.
  </para>

  <para>
   De cette façon, il est possible de définir des valeurs par défaut de manière globale, de les adapter pour toutes les images RBD d'une réserve spécifique et de remplacer la configuration de la réserve pour des images RBD individuelles.
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>Configuration globale des options</title>
   <para>
    Pour configurer globalement les options de périphérique de traitement par blocs RADOS (RBD), sélectionnez <menuchoice><guimenu>Grappe</guimenu>
    <guimenu>Configuration</guimenu></menuchoice> dans le menu principal.
   </para>
   <procedure>
    <step>
     <para>
      Pour lister toutes les options de configuration globale disponibles, en regard de <menuchoice><guimenu>Niveau</guimenu></menuchoice>, choisissez <menuchoice><guimenu>Avancé</guimenu></menuchoice> dans le menu déroulant.
     </para>
    </step>
    <step>
     <para>
      Filtrez ensuite les résultats du tableau en entrant <literal>rbd_qos</literal> dans le champ de recherche. Cela liste toutes les options de configuration disponibles pour QoS.
     </para>
    </step>
    <step>
     <para>
      Pour modifier une valeur, cliquez sur sa ligne dans le tableau, puis sélectionnez <guimenu>Modifier</guimenu> en haut à gauche du tableau. La boîte de dialogue <guimenu>Modifier</guimenu> contient six champs différents pour spécifier les valeurs. Les valeurs d'option de configuration RBD sont requises dans la zone de texte <guimenu>mgr.</guimenu>
     </para>
     <note>
      <para>
       Contrairement aux autres boîtes de dialogue, celle-ci ne vous permet pas de spécifier la valeur dans des unités pratiques. Vous devez définir ces valeurs en octets ou en entrées/sorties par seconde (IOPS), en fonction de l'option que vous modifiez.
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>Configuration des options d'une nouvelle réserve</title>
   <para>
    Pour créer une réserve et configurer ses options de configuration RBD, cliquez sur <menuchoice><guimenu>Réserves</guimenu>
    <guimenu> Créer</guimenu></menuchoice>. Sélectionnez <guimenu>replicated</guimenu> (répliqué) comme type de réserve. Vous devez ensuite ajouter la balise d'application <literal>rbd</literal> à la réserve pour être en mesure de configurer les options QoS RBD.
   </para>
   <note>
    <para>
     Il n'est pas possible de définir les options de configuration RBD QoS sur une réserve codée à effacement. Pour configurer les options QoS RBD pour les réserves codées à effacement, vous devez modifier la réserve de métadonnées répliquée d'une image RBD. La configuration sera ensuite appliquée à la réserve de données codée à effacement de cette image.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>Configuration des options d'une réserve existante</title>
   <para>
    Pour configurer les options QoS RBD sur une réserve existante, cliquez sur <guimenu>Réserves</guimenu>, puis sur la ligne de la réserve dans le tableau, et sélectionnez <guimenu>Modifier</guimenu> en haut à gauche du tableau.
   </para>
   <para>
    Dans la boîte de dialogue, vous devriez voir la section <guimenu>Configuration RBD</guimenu> suivie d'une section <guimenu>Qualité de service</guimenu>.
   </para>
   <note>
    <para>
     Si aucune d'elles n'apparaît<guimenu/><guimenu/>, vous êtes probablement occupé à modifier une réserve <emphasis>codée à effacement</emphasis>, qui ne permet pas de définir des options de configuration RBD, ou la réserve n'est pas configurée pour être utilisée par des images RBD. Dans ce dernier cas, assignez la balise d'application <guimenu>rbd</guimenu> à la réserve et les sections de configuration correspondantes s'afficheront.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>Options de configuration</title>
   <para>
    Cliquez sur <guimenu>Qualité de service +</guimenu> pour développer les options de configuration. Une liste de toutes les options disponibles s'affiche. Les unités des options de configuration sont déjà affichées dans les zones de texte. En cas d'option d'octets par seconde, vous pouvez utiliser des raccourcis tels que « 1M » ou « 5G ». Ils seront automatiquement convertis en « 1 Mo/s » et « 5 Go/s » respectivement.
   </para>
   <para>
    Si vous cliquez sur le bouton de réinitialisation à droite de chaque zone de texte, toute valeur éventuelle définie pour la réserve est supprimée. En revanche, cela ne supprime pas les valeurs de configuration des options configurées globalement ou au niveau d'une image RBD.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>Création d'options QoS RBD avec une nouvelle image RBD</title>
   <para>
    Pour créer une image RBD avec des options QoS RBD définies sur cette image, sélectionnez <menuchoice><guimenu>Bloc</guimenu> <guimenu> Images</guimenu></menuchoice>, puis cliquez sur <guimenu>Créer</guimenu>. Cliquez sur <guimenu>Avancé...</guimenu> pour développer la section de configuration avancée. Cliquez sur <guimenu>Qualité de service +</guimenu> pour ouvrir toutes les options de configuration disponibles.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>Modification des options QoS RBD sur les images existantes</title>
   <para>
    Pour modifier les options QoS RBD pour une image existante, sélectionnez <menuchoice><guimenu>Bloc</guimenu>
    <guimenu>Images</guimenu></menuchoice> et cliquez sur la ligne du tableau de la réserve, puis sur <guimenu>Modifier</guimenu>. La boîte de dialogue de modification s'affiche. Cliquez sur <guimenu>Avancé...</guimenu> pour développer la section de configuration avancée. Cliquez sur <guimenu>Qualité de service +</guimenu> pour ouvrir toutes les options de configuration disponibles.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>Modification des options de configuration lors de la copie ou du clonage d'images</title>
   <para>
    Si une image RBD est clonée ou copiée, par défaut, les valeurs définies sur cette image particulière sont également copiées. Si vous le souhaitez, vous pouvez les modifier lors de la copie ou du clonage en spécifiant les valeurs de configuration mises à jour dans la boîte de dialogue de copie/clonage, de la même manière que lors de la création ou de l'édition d'une image RBD. De cette façon, seules les valeurs de l'image RBD copiée ou clonée sont définies (ou réinitialisées). Cette opération ne modifie ni la configuration d'image RBD source, ni la configuration globale.
   </para>
   <para>
    Si vous choisissez de réinitialiser la valeur d'option lors de la copie/du clonage, aucune valeur ne sera définie pour cette option sur cette image. Cela signifie que toute valeur de cette option spécifiée pour la réserve parent sera utilisée si elle est configurée pour la réserve parent. Dans le cas contraire, le système appliquera la valeur par défaut globale.
   </para>
  </sect2>
 </sect1>
</chapter>
