<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Configuration haute disponibilité du noeud Admin</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Le <emphasis>noeud Admin</emphasis> est un noeud de la grappe Ceph sur lequel le service Salt Master s&apos;exécute. Il gère le reste des noeuds de la grappe en interrogeant et en indiquant leurs services de minion Salt. En général, il inclut également d&apos;autres services, par exemple, le tableau de bord <emphasis>Grafana</emphasis> soutenu par le toolkit de surveillance <emphasis>Prometheus</emphasis>.
 </para>
 <para>
  En cas de défaillance du noeud Admin, vous devez généralement fournir un nouveau matériel pour le noeud et restaurer la pile de configuration complète de la grappe à partir d&apos;une sauvegarde récente. Cette méthode prend énormément de temps et provoque l&apos;interruption de la grappe.
 </para>
 <para>
  Pour éviter le temps hors service de la grappe Ceph causé par la défaillance du noeud Admin, il est recommandé d&apos;utiliser une grappe haute disponibilité (High Availability, HA) pour le noeud Admin Ceph.
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Aperçu de la grappe HA pour le noeud Admin</title>

  <para>
   Le principe d&apos;une grappe HA est qu&apos;en cas de défaillance d&apos;un noeud de la grappe, un autre noeud prend automatiquement en charge son rôle, y compris le noeud Admin virtualisé. De cette façon, les autres noeuds de la grappe Ceph ne remarquent pas la défaillance du noeud Admin.
  </para>

  <para>
   La solution HA minimale pour le noeud Admin requiert le matériel suivant :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Deux serveurs sans système d&apos;exploitation en mesure d&apos;exécuter SUSE Linux Enterprise avec l&apos;extension haute disponibilité et de virtualiser le noeud Admin.
    </para>
   </listitem>
   <listitem>
    <para>
     Deux ou plusieurs chemins de communication réseau redondants, par exemple via la liaison de périphérique réseau.
    </para>
   </listitem>
   <listitem>
    <para>
     Un stockage partagé pour héberger les images de disque de la machine virtuelle du noeud Admin. Le stockage partagé doit être accessible depuis les deux serveurs. Il peut s&apos;agir, par exemple, d&apos;une exportation NFS, d&apos;un partage Samba ou d&apos;une cible iSCSI.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Pour plus de détails sur les conditions requises de la grappe, reportez-vous à la page <link xlink:href="https://documentation.suse.com/sle-ha/15-SP3/single-html/SLE-HA-install-quick/#sec-ha-inst-quick-req"/>.
  </para>

  <figure>
   <title>Grappe haute disponibilité à 2 noeuds pour le noeud Admin</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>Création d&apos;une grappe haute disponibilité avec le noeud Admin</title>

  <para>
   La procédure suivante résume les étapes les plus importantes de la création d&apos;une grappe haute disponibilité pour la virtualisation du noeud Admin. Pour plus d&apos;informations, reportez-vous aux liens indiqués.
  </para>

  <procedure>
   <step>
    <para>
     Configurez une grappe haute disponibilité à 2 noeuds de base avec un stockage partagé comme décrit dans le manuel <link xlink:href="https://documentation.suse.com/sle-ha/15-SP3/single-html/SLE-HA-install-quick/#art-sleha-install-quick"/>.
    </para>
   </step>
   <step>
    <para>
     Sur les deux noeuds de la grappe, installez tous les paquetages requis pour l&apos;exécution de l&apos;hyperviseur KVM et du toolkit <systemitem class="library">libvirt</systemitem> comme décrit dans le manuel <link xlink:href="https://documentation.suse.com/sles/15-SP3/single-html/SLES-virtualization/#sec-vt-installation-kvm"/>.
    </para>
   </step>
   <step>
    <para>
     Sur le premier noeud de la grappe, créez une machine virtuelle KVM en utilisant <systemitem class="library">libvirt</systemitem> comme décrit dans le manuel <link xlink:href="https://documentation.suse.com/sles/15-SP3/single-html/SLES-virtualization/#sec-libvirt-inst-virt-install"/>. Utilisez le stockage partagé préconfiguré pour stocker les images de disque de la machine virtuelle.
    </para>
   </step>
   <step>
    <para>
     Une fois la configuration de la machine virtuelle terminée, exportez sa configuration dans un fichier XML sur le stockage partagé. Utilisez la syntaxe suivante.
    </para>
<screen>
<prompt role="root"># </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Créez une ressource pour la machine virtuelle du noeud Admin. Reportez-vous à l&apos;adresse <link xlink:href="https://documentation.suse.com/sle-ha/15-SP3/single-html/SLE-HA-guide/#cha-conf-hawk2"/> pour des informations générales sur la création de ressources haute disponibilité. Des informations détaillées sur la création de ressources pour une machine virtuelle KVM sont décrites à l&apos;adresse <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/>.
    </para>
   </step>
   <step>
    <para>
     Sur l&apos;invité de la machine virtuelle qui vient d&apos;être créé, déployez le noeud Admin, y compris les services supplémentaires dont vous avez besoin. Suivez les étapes appropriées du <xref linkend="deploy-salt"/>. En même temps, déployez les noeuds de la grappe Ceph restants sur les serveurs de grappe non-HA.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
