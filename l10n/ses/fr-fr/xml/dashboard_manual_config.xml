<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_manual_config.xml" version="5.0" xml:id="dashboard-initial-configuration">
 <title>Configuration manuelle</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>oui</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Cette section présente des informations avancées pour les utilisateurs qui préfèrent configurer manuellement les paramètres du tableau de bord via la ligne de commande.
 </para>
 <sect1 xml:id="dashboard-ssl">
  <title>Configuration de la prise en charge de TLS/SSL</title>

  <para>
   Par défaut, toutes les connexions HTTP vers le tableau de bord sont sécurisées via TLS/SSL. Une connexion sécurisée nécessite un certificat SSL. Vous pouvez soit utiliser un certificat auto-signé, soit générer un certificat à faire signer par une autorité de certification bien connue.
  </para>

  <tip>
   <title>désactivation de SSL</title>
   <para>
    Vous pouvez souhaiter désactiver le support SSL pour une raison spécifique, par exemple, si le tableau de bord s'exécute derrière un proxy qui ne prend pas en charge SSL.
   </para>
   <para>
    Soyez toutefois prudent lorsque vous désactivez SSL, car <emphasis role="bold">les noms d'utilisateur et les mots de passe</emphasis> seront envoyés au tableau de bord <emphasis role="bold">non chiffrés</emphasis>.
   </para>
   <para>
    Pour désactiver SSL, exécutez la commande suivante :
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/ssl false
</screen>
  </tip>

  <tip>
   <title>redémarrage des processus Ceph Manager</title>
   <para>
    Vous devez redémarrer manuellement les processus Ceph Manager après avoir modifié le certificat et la clé SSL. Pour ce faire, vous pouvez exécuter la commande
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr fail <replaceable>ACTIVE-MANAGER-NAME</replaceable></screen>
   <para>
    ou désactiver, puis réactiver le module de tableau de bord, ce qui déclenche une régénération du gestionnaire :
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard
<prompt>cephuser@adm &gt; </prompt>ceph mgr module enable dashboard
</screen>
  </tip>

  <sect2 xml:id="self-sign-certificates">
   <title>Création de certificats auto-signés</title>
   <para>
    La création d'un certificat auto-signé pour une communication sécurisée est simple. Elle vous permet d'exécuter rapidement le tableau de bord.
   </para>
   <note>
    <title>exigence des navigateurs Web</title>
    <para>
     En cas de certificat auto-signé, la plupart des navigateurs Web exigent une confirmation explicite avant d'établir une connexion sécurisée au tableau de bord.
    </para>
   </note>
   <para>
    Pour générer et installer un certificat auto-signé, utilisez la commande intégrée suivante :
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard create-self-signed-cert
</screen>
  </sect2>

  <sect2 xml:id="cert-sign-CA">
   <title>Utilisation de certificats signés par une autorité de certification</title>
   <para>
    Pour sécuriser correctement la connexion au tableau de bord et pour éviter l'exigence de confirmation explicite imposée par les navigateurs Web en cas de certificat auto-signé, nous vous recommandons d'utiliser un certificat signé par une autorité de certification.
   </para>
   <para>
    Vous pouvez générer une paire de clés de certificat avec une commande similaire à la suivante :
   </para>
<screen>
<prompt role="root">root # </prompt>openssl req -new -nodes -x509 \
  -subj "/O=IT/CN=ceph-mgr-dashboard" -days 3650 \
  -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</screen>
   <para>
    La commande ci-dessus produit les fichiers <filename>dashboard.key</filename> et <filename>dashboard.crt</filename>. Une fois le fichier <filename>dashboard.crt</filename> signé par une autorité de certification, activez-le pour toutes les instances Ceph Manager en exécutant les commandes suivantes :
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/key -i dashboard.key
</screen>
   <tip>
    <title>des certificats différents pour chaque instance du gestionnaire</title>
    <para>
     Si vous avez besoin de certificats différents pour chaque instance Ceph Manager, modifiez les commandes et incluez le nom de l'instance comme suit. Remplacez <replaceable>NAME</replaceable> par le nom de l'instance Ceph Manager (généralement le nom d'hôte associé) :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/key -i dashboard.key
</screen>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-hostname-port">
  <title>Modification du nom d’hôte et du numéro de port</title>

  <para>
   Ceph Dashboard se lie à une adresse TCP/IP et à un port TCP spécifiques. Par défaut, l'instance Ceph Manager actuellement active qui héberge le tableau de bord se lie au port TCP 8443 (ou 8080 lorsque SSL est désactivé).
  </para>

  <note>
   <para>
    Si un pare-feu est activé sur les hôtes qui exécutent Ceph Manager (et donc Ceph Dashboard), vous devrez peut-être modifier la configuration pour autoriser l'accès à ces ports. Pour plus d'informations sur les paramètres de pare-feu pour Ceph, reportez-vous au <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Ceph Dashboard se lie par défaut à « :: », ce qui correspond à toutes les adresses IPv4 et IPv6 disponibles. Vous pouvez modifier l'adresse IP et le numéro de port de l'application Web afin qu'ils s'appliquent à toutes les instances Ceph Manager en utilisant les commandes suivantes :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>

  <tip>
   <title>configuration séparée des instances Ceph Manager</title>
   <para>
    Étant donné que chaque daemon <systemitem class="daemon">ceph-mgr</systemitem> héberge sa propre instance du tableau de bord, vous devrez peut-être les configurer séparément. Pour changer l'adresse IP et le numéro de port pour une instance spécifique du gestionnaire, utilisez les commandes suivantes (remplacez <replaceable>NAME</replaceable> par l'ID de l'instance <systemitem class="daemon">ceph-mgr</systemitem>) :
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>
  </tip>

  <tip>
   <title>liste des noeuds d'extrémité configurés</title>
   <para>
    La commande <command>ceph mgr services</command> affiche tous les noeuds d'extrémité actuellement configurés. Recherchez la clé <literal>dashboard</literal> pour obtenir l'URL d'accès au tableau de bord.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-username-password">
  <title>Modification des noms d'utilisateur et des mots de passe</title>

  <para>
   Si vous ne souhaitez pas utiliser le compte d'administrateur par défaut, créez un compte utilisateur différent et associez-le à au moins un rôle. Nous fournissons un ensemble de rôles système prédéfinis que vous pouvez utiliser. Pour plus d'informations, reportez-vous au <xref linkend="dashboard-user-roles"/>.
  </para>

  <para>
   Pour créer un utilisateur avec des privilèges d'administrateur, utilisez la commande suivante :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard ac-user-create <replaceable>USER_NAME</replaceable> <replaceable>PASSWORD</replaceable> administrator
</screen>
 </sect1>
 <sect1 xml:id="dashboard-ogw-enabling">
  <title>Activation de l'interface client de gestion d'Object Gateway</title>

  <para>
   Pour utiliser la fonctionnalité de gestion d'Object Gateway du tableau de bord, vous devez fournir les informations d'identification de connexion d'un utilisateur avec le drapeau <option>system</option> activé :
  </para>

  <procedure>
   <step>
    <para>
     Si vous n'avez pas d'utilisateur avec le drapeau <option>system</option>, créez-en un :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user create --uid=<replaceable>USER_ID</replaceable> --display-name=<replaceable>DISPLAY_NAME</replaceable> --system
</screen>
    <para>
     Prenez note des clés <replaceable>clé_accès</replaceable> et <replaceable>clé_secrète</replaceable> dans la sortie de la commande.
    </para>
   </step>
   <step>
    <para>
     Vous pouvez également obtenir les informations d'identification d'un utilisateur existant à l'aide de la commande <command>radosgw-admin</command> :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user info --uid=<replaceable>USER_ID</replaceable>
</screen>
   </step>
   <step>
    <para>
     Fournissez les informations d'identification reçues au tableau de bord :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-access-key <replaceable>ACCESS_KEY</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-secret-key <replaceable>SECRET_KEY</replaceable>
</screen>
   </step>
  </procedure>

  <note>
   <para>
    Par défaut, le pare-feu est activé dans SUSE Linux Enterprise Server 15 SP2. Pour plus d'informations sur la configuration du pare-feu, reportez-vous au <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Plusieurs points sont à prendre en considération :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Le nom de l'hôte et le numéro de port d'Object Gateway sont déterminés automatiquement.
    </para>
   </listitem>
   <listitem>
    <para>
     Si plusieurs zones sont utilisées, le système détermine automatiquement l'hôte dans le groupe de zones maître et la zone maître. Cela est suffisant pour la plupart des configurations, mais dans certaines circonstances, vous pouvez souhaiter définir le nom de l'hôte et le port manuellement :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-host <replaceable>HOST</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-port <replaceable>PORT</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Voici d'autres paramètres dont vous pouvez avoir besoin :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-scheme <replaceable>SCHEME</replaceable>  # http or https
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-admin-resource <replaceable>ADMIN_RESOURCE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-user-id <replaceable>USER_ID</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Si vous utilisez un certificat auto-signé (<xref linkend="dashboard-ssl"/>) dans votre configuration Object Gateway, désactivez la vérification du certificat dans le tableau de bord pour éviter les refus de connexions dus à des certificats signés par une autorité de certification inconnue ou ne correspondant pas au nom d'hôte :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-ssl-verify False
</screen>
   </listitem>
   <listitem>
    <para>
     Si Object Gateway prend trop de temps pour traiter les requêtes et que le tableau de bord s'exécute selon des timeouts, la valeur de ces derniers peut être ajustée (elle est par défaut de 45 secondes) :
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rest-requests-timeout <replaceable>SECONDS</replaceable>
</screen>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="dashboard-iscsi-management">
  <title>Activation de la gestion iSCSI</title>

  <para>
   Ceph Dashboard gère les cibles iSCSI à l'aide de l'API REST fournie par le service <systemitem class="service">rbd-target-api</systemitem> de la passerelle Ceph iSCSI. Assurez-vous qu'elle est installée et activée sur les passerelles iSCSI.
  </para>

  <note>
   <para>
    La fonctionnalité de gestion iSCSI de Ceph Dashboard dépend de la dernière version 3 du projet <literal>ceph-iscsi</literal>. Vérifiez que votre système d'exploitation fournit la version correcte, sinon Ceph Dashboard n'activera pas les fonctions de gestion.
   </para>
  </note>

  <para>
   Si l'API REST <literal>ceph-iscsi</literal> est configurée en mode HTTPS et qu'elle utilise un certificat auto-signé, configurez le tableau de bord pour éviter la vérification du certificat SSL lors de l'accès à l'API ceph-iscsi.
  </para>

  <para>
   Désactivez la vérification SSL de l'API :
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard set-iscsi-api-ssl-verification false</screen>

  <para>
   Définissez les passerelles iSCSI disponibles :
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-list
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-add <replaceable>scheme</replaceable>://<replaceable>username</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>[:port]
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-rm <replaceable>gateway_name</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="dashboard-sso">
  <title>Activation de Single Sign-On</title>

  <para>
   <emphasis>Single Sign-on</emphasis> (SSO) est une méthode de contrôle d'accès qui permet aux utilisateurs de se connecter avec un seul ID et mot de passe à plusieurs applications simultanément.
  </para>

  <para>
   Ceph Dashboard prend en charge l'authentification externe des utilisateurs via le protocole SAML 2.0. Étant donné que l'<emphasis>autorisation</emphasis> passe toujours par le tableau de bord, vous devez d'abord créer des comptes utilisateur et les associer aux rôles souhaités. En revanche, le processus d'<emphasis>authentification</emphasis> peut être exécuté par un <emphasis>fournisseur d'identité</emphasis> (IdP) existant.
  </para>

  <para>
   Pour configurer Single Sign-on, utilisez la commande suivante :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso setup saml2 <replaceable>CEPH_DASHBOARD_BASE_URL</replaceable> \
 <replaceable>IDP_METADATA</replaceable> <replaceable>IDP_USERNAME_ATTRIBUTE</replaceable> \
 <replaceable>IDP_ENTITY_ID</replaceable> <replaceable>SP_X_509_CERT</replaceable> \
 <replaceable>SP_PRIVATE_KEY</replaceable>
</screen>

  <para>
   Paramètres :
  </para>

  <variablelist>
   <varlistentry>
    <term><replaceable>CEPH_DASHBOARD_BASE_URL</replaceable></term>
    <listitem>
     <para>
      URL de base à laquelle Ceph Dashboard est accessible (par exemple, « https://cephdashboard.local »).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_METADATA</replaceable></term>
    <listitem>
     <para>
      URL, chemin ou contenu du fichier XML de métadonnées IdP (par exemple, « https://myidp/metadata »).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_USERNAME_ATTRIBUTE</replaceable></term>
    <listitem>
     <para>
      Facultatif. Attribut qui sera utilisé pour obtenir le nom d'utilisateur à partir de la réponse d'authentification. Sa valeur par défaut est « uid ».
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_ENTITY_ID</replaceable></term>
    <listitem>
     <para>
      Facultatif. Utilisez ce paramètre lorsqu'il existe plusieurs ID d'entité pour les métadonnées IdP.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>SP_X_509_CERT</replaceable> / <replaceable>SP_PRIVATE_KEY</replaceable></term>
    <listitem>
     <para>
      Facultatif. Chemin du fichier ou contenu du certificat qui sera utilisé par Ceph Dashboard (Fournisseur de service) pour la signature et le codage.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>requêtes SAML</title>
   <para>
    La valeur de l'émetteur des requêtes SAML suivra ce modèle :
   </para>
<screen>
<replaceable>CEPH_DASHBOARD_BASE_URL</replaceable>/auth/saml2/metadata
</screen>
  </note>

  <para>
   Pour afficher la configuration SAML 2.0 actuelle, exécutez :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso show saml2
</screen>

  <para>
   Pour désactiver Single Sign-on, exécutez :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso disable
</screen>

  <para>
   Pour vérifier si SSO est activé, exécutez :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso status
</screen>

  <para>
   Pour activer SSO, exécutez :
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso enable saml2
</screen>
 </sect1>
</chapter>
