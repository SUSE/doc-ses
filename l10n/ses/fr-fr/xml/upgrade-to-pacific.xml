<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="upgrade-to-pacific.xml" version="5.0" xml:id="upgrade-to-pacific">
 <title>Mise à niveau de SUSE Enterprise Storage 7 vers la version 7.1</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Ce chapitre présente les étapes requises pour mettre à niveau SUSE Enterprise Storage 7 vers la version 7.1.
 </para>
 <para>
  La mise à niveau inclut les tâches suivantes :
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Mise à niveau de la version sous-jacente de SUSE Linux Enterprise Server 15 SP2 vers la version SUSE Linux Enterprise Server 15 SP3.
   </para>
  </listitem>
  <listitem>
   <para>
    Mise à niveau de Ceph Octopus vers Pacific.
   </para>
  </listitem>
 </itemizedlist>
 <sect1 xml:id="before-upgrade-7p">
  <title>Avant la mise à niveau</title>

  <para>
   Les tâches suivantes <emphasis>doivent</emphasis> être effectuées avant de commencer la mise à niveau. Cette opération peut être effectuée à tout moment pendant la durée de vie de SUSE Enterprise Storage 7.
  </para>

  <sect2 xml:id="upgrade-consider-points-7p">
   <title>Considérations</title>
   <para>
    Avant la mise à niveau, veillez à lire les sections suivantes pour vous assurer que vous comprenez toutes les tâches à exécuter.
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <emphasis>Lisez les notes de version</emphasis>. Elles contiennent des informations supplémentaires sur les modifications apportées depuis la version précédente de SUSE Enterprise Storage. Consultez les notes de version pour vérifier les aspects suivants :
     </para>
     <itemizedlist>
      <listitem>
       <para>
        votre matériel doit tenir compte de certaines considérations spéciales ;
       </para>
      </listitem>
      <listitem>
       <para>
        les paquetages logiciels utilisés ont été considérablement modifiés ;
       </para>
      </listitem>
      <listitem>
       <para>
        des précautions spéciales sont nécessaires pour votre installation.
       </para>
      </listitem>
     </itemizedlist>
     <para>
      Les notes de version incluent également des informations de dernière minute qui, faute de temps, n&apos;ont pas pu être intégrées au manuel. Elles contiennent également des notes concernant les problèmes connus.
     </para>
     <para>
      Les notes de version de SES 7.1 sont disponibles en ligne à l&apos;adresse <link xlink:href="https://www.suse.com/releasenotes/"/>.
     </para>
     <para>
      De plus, après avoir installé le paquetage <package>release-notes-ses</package> à partir du dépôt SES 7.1, les notes de version sont disponibles en local dans le répertoire <filename>/usr/share/doc/release-notes</filename> ou en ligne à l&apos;adresse <link xlink:href="https://www.suse.com/releasenotes/"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      Lisez la <xref linkend="ses-deployment"/> pour vous familiariser avec <systemitem class="resource">ceph-salt</systemitem> et l&apos;orchestrateur Ceph, et en particulier prendre connaissance des informations sur les spécifications de service.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="upgrade-backup-config-data-7p">
   <title>Sauvegarde de la configuration et des données de grappe</title>
   <para>
    Nous vous recommandons vivement de sauvegarder l&apos;ensemble de la configuration et des données de la grappe avant de commencer la mise à niveau. Pour savoir comment sauvegarder toutes vos données, reportez-vous au <xref linkend="cha-deployment-backup"/>.
   </para>
  </sect2>

  <sect2 xml:id="verify-previous-upgrade-patch-repos-7p">
   <title>Vérification de l&apos;accès aux dépôts logiciels et aux images de conteneur</title>
   <para>
    Vérifiez que chaque noeud de la grappe a accès aux dépôts logiciels SUSE Linux Enterprise Server 15 SP3 et SUSE Enterprise Storage 7.1, ainsi qu&apos;au registre des images de conteneur.
   </para>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-repos-7p">
    <title>Dépôts logiciels</title>
    <para>
     Si tous les noeuds sont enregistrés auprès de SCC, vous pouvez utiliser la commande <command>zypper migration</command> pour effectuer la mise à niveau. Pour plus d&apos;informations, consultez le site <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>.
    </para>
    <para>
     Si les noeuds ne sont <emphasis role="bold">pas</emphasis> enregistrés auprès de SCC, désactivez tous les dépôts logiciels existants et ajoutez les dépôts <literal>Pool</literal> et <literal>Updates</literal> pour chacune des extensions suivantes :
    </para>
    <itemizedlist>
     <listitem>
      <para>
       SLE-Product-SLES/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Basesystem/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE-Module-Server-Applications/15-SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SUSE-Enterprise-Storage-7.1
      </para>
     </listitem>
    </itemizedlist>
   </sect3>
   <sect3 xml:id="verify-previous-upgrade-patch-repos-images-7p">
    <title>Images de conteneur</title>
    <para>
     Tous les noeuds de la grappe doivent accéder au registre des images de conteneur. Dans la plupart des cas, vous utiliserez le registre SUSE public à l&apos;adresse <literal>registration.suse.com</literal>. Les images suivantes sont nécessaires :
    </para>
    <itemizedlist>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/ceph
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/grafana
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-server
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-node-exporter
      </para>
     </listitem>
     <listitem>
      <para>
       registry.suse.com/ses/7.1/ceph/prometheus-alertmanager
      </para>
     </listitem>
    </itemizedlist>
    <para>
     Vous pouvez également, par exemple pour les déploiements à vide, configurer un registre local et vérifier que vous disposez de l&apos;ensemble approprié d&apos;images de conteneur. Pour plus d&apos;informations sur la configuration d&apos;un registre d&apos;images de conteneur local, reportez-vous à la <xref linkend="deploy-cephadm-configure-registry"/>.
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 xml:id="upgrade-cluster-nodes">
  <title>Migration de SUSE Linux Enterprise Server sur chaque noeud de grappe vers la version SUSE Linux Enterprise Server 15 SP3</title>

  <para>
   Si les noeuds de grappe sont configurés pour utiliser SUSE Customer Center, vous pouvez utiliser la commande <command>zypper migration</command>.
  </para>

  <para>
   Si les noeuds de grappe ont des dépôts logiciels configurés manuellement, vous devez mettre à niveau les noeuds manuellement.
  </para>

  <para>
   Pour plus d&apos;informations sur la mise à niveau de SUSE Linux Enterprise Server à l&apos;aide de <command>zypper</command>, reportez-vous à la documentation <link xlink:href="https://documentation.suse.com/sles/15-SP3/html/SLES-all/cha-upgrade-online.html#sec-upgrade-online-zypper"/>.
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-packages">
  <title>Mise à jour des paquetages associés à SUSE Enterprise Storage sur chaque noeud de grappe</title>

  <para>
   Pour mettre à jour les paquetages SUSE Enterprise Storage vers la dernière version, utilisez la commande <command>ceph-salt update</command>. Pour plus d&apos;informations, reportez-vous au <xref linkend="cephadm-rolling-updates"/>.
  </para>
 </sect1>
 <sect1 xml:id="upgrade-ses-services">
  <title>Mise à niveau des services de grappe Ceph existants</title>

  <para>
   Effectuez la mise à niveau de l&apos;ensemble de la grappe Ceph vers la version Pacific en exécutant la commande suivante à partir du noeud Admin :
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph orch upgrade start --image registry.suse.com/ses/7.1/ceph/ceph</screen>
 </sect1>
</chapter>
