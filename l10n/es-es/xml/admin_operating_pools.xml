<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_operating_pools.xml" version="5.0" xml:id="ceph-pools">
 <title>Gestión de repositorios de almacenamiento</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sí</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Ceph almacena los datos en repositorios. Los repositorios son grupos lógicos en los que se almacenan objetos. Al distribuir un clúster por primera vez sin crear un repositorio, Ceph utiliza los repositorios por defecto para almacenar los datos. Los siguientes aspectos importantes están relacionados con los repositorios de Ceph:
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    <emphasis>Resiliencia:</emphasis> los repositorios de Ceph proporcionan resiliencia al replicar o codificar los datos que contienen. Cada repositorio se puede definir como <literal>replicated</literal> (replicado) o como <literal>erasure coding</literal> (codificación de borrado). En el caso de los repositorios replicados, debe definir el número de réplicas o copias que tendrá cada objeto de datos en el repositorio. El número de copias (OSD, depósitos/hojas de CRUSH) que se pueden perder es uno menos que el número de réplicas. Con la codificación de borrado, se definen los valores de <option>k</option> y <option>m</option>, donde <option>k</option> es el número de fragmentos de datos y <option>m</option> es el número de fragmentos de codificación. Para los repositorios codificados de borrado, es el número de fragmentos de codificación lo que determina cuántos OSD (depósitos/hojas de CRUSH) se pueden perder sin perder datos.
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Grupos de colocación:</emphasis> puede establecer el número de grupos de colocación del repositorio. En una configuración típica, se utilizan aproximadamente 100 grupos de colocación por OSD para proporcionar el equilibrio óptimo sin necesidad de utilizar demasiados recursos informáticos. Al configurar varios repositorios, asegúrese de que ha definido un número razonable de grupos de colocación para el conjunto de repositorio y clúster.
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Reglas de CRUSH</emphasis>: cuando se almacenan datos en un repositorio, los objetos y sus réplicas (o los fragmentos en caso de los repositorios codificados de borrado) se colocan según el conjunto de reglas de CRUSH asignado al repositorio. Puede crear una regla de CRUSH personalizada para el repositorio.
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Instantáneas:</emphasis> al crear instantáneas con <command>ceph osd pool mksnap</command>, se realiza una instantánea de un repositorio concreto.
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Para organizar los datos en repositorios, puede enumerar, crear y eliminar repositorios. También puede ver las estadísticas de uso para cada repositorio.
 </para>
 <sect1 xml:id="ceph-pools-operate-add-pool">
  <title>Creación de un repositorio</title>

  <para>
   Los repositorios se pueden crear de tipo <literal>replicated</literal> (replicado) para recuperar los OSD perdidos manteniendo varias copias de los objetos o de tipo <literal>erasure</literal> (de borrado) para obtener capacidad de tipo RAID5/6 generalizada. Los repositorios replicados requieren más almacenamiento en bruto, mientras que los repositorios codificados de borrado requieren menos. El tipo por defecto es <literal>replicated</literal>. Para obtener más información sobre los repositorios codificados de borrado, consulte el <xref linkend="cha-ceph-erasure"/>.
  </para>

  <para>
   Para crear un repositorio replicado, ejecute:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool create <replaceable>POOL_NAME</replaceable></screen>

  <note>
   <para>
    El escalador automático se encargará del resto de los argumentos opcionales. Para obtener más información, consulte la <xref linkend="op-pgs-autoscaler"/>.
   </para>
  </note>

  <para>
   Para crear un repositorio codificado de borrado, ejecute:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool create <replaceable>POOL_NAME</replaceable> erasure <replaceable>CRUSH_RULESET_NAME</replaceable> \
<replaceable>EXPECTED_NUM_OBJECTS</replaceable></screen>

  <para>
   El comando <command>ceph osd pool create</command> puede fallar si supera el límite de grupos de colocación por OSD. El límite se establece con la opción <option>mon_max_pg_per_osd</option>.
  </para>

  <variablelist>
   <varlistentry>
    <term>POOL_NAME</term>
    <listitem>
     <para>
      Nombre del repositorio. Debe ser único. Esta opción es obligatoria.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>POOL_TYPE</term>
    <listitem>
     <para>
      El tipo de repositorio, que puede ser <literal>replicated</literal> (replicado) para recuperar los OSD perdidos manteniendo varias copias de los objetos o <literal>erasure</literal> (de borrado) para obtener un tipo de capacidad RAID5 generalizada. Los repositorios replicados requieren más espacio de almacenamiento en bruto, pero implementan todas las operaciones de Ceph. Los repositorios de borrado requieren menos espacio de almacenamiento en bruto, pero solo implementan un subconjunto de las operaciones disponibles. El tipo <literal>POOL_TYPE</literal> por defecto es <literal>replicated</literal>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>CRUSH_RULESET_NAME</term>
    <listitem>
     <para>
      El nombre de conjunto de reglas de CRUSH para el repositorio. Si el conjunto de reglas especificado no existe, se producirá un error -ENOENT al crear los repositorios replicados. Para los repositorios replicados es el conjunto de reglas especificado por la variable de configuración <varname>osd pool default CRUSH replicated ruleset</varname>. Este conjunto de reglas debe existir. Para los repositorios de borrado, es "erasure-code" si se utiliza el perfil de código de borrado por defecto o <replaceable>POOL_NAME</replaceable> de lo contrario. Este conjunto de reglas de creará de forma implícita si aún no existe.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>erasure_code_profile=perfil</term>
    <listitem>
     <para>
      Solo para los repositorios codificados de borrado. Utiliza el perfil de código de borrado. Debe ser un perfil existente, según se haya definido mediante <command>osd erasure-code-profile set</command>.
     </para>
     <note>
      <para>
       Si por algún motivo el escalador automático se ha inhabilitado (<literal>pg_autoscale_mode</literal> desactivado) en un repositorio, puede calcular y definir el número de grupos de colocación manualmente. Consulte la <xref linkend="op-pgs"/> (Grupos de colocación) para obtener información sobre cómo calcular el número adecuado de grupos de colocación para su repositorio.
      </para>
     </note>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>EXPECTED_NUM_OBJECTS</term>
    <listitem>
     <para>
      El número previsto de objetos para este repositorio. Al definir este valor (junto con un valor negativo en <option>filestore merge threshold</option>), la división de carpetas del grupo de colocación se produce en el momento de la creación del repositorio. Esto evita el impacto de latencia cuando se divide una carpeta en tiempo de ejecución.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="ceph-listing-pools">
  <title>Listado de repositorios</title>

  <para>
   Para enumerar los repositorios de su clúster, ejecute:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool ls</screen>
 </sect1>
 <sect1 xml:id="ceph-renaming-pool">
  <title>Cambio de nombre de un repositorio</title>

  <para>
   Para renombrar un repositorio, ejecute:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool rename <replaceable>CURRENT_POOL_NAME</replaceable> <replaceable>NEW_POOL_NAME</replaceable></screen>

  <para>
   Si ha renombrado de un repositorio y existen permisos por repositorio para los usuarios autenticados, debe actualizar los permisos con el nuevo nombre de repositorio.
  </para>
 </sect1>
 <sect1 xml:id="ceph-pools-operate-del-pool">
  <title>Supresión de un repositorio</title>

  <warning>
   <title>la supresión de un repositorio no se puede deshacer</title>
   <para>
    Los repositorios pueden contener datos importantes. Si suprime un repositorio, desaparecerán todos sus datos y no habrá forma de recuperarlo.
   </para>
  </warning>

  <para>
   Dado que la supresión accidental de un repositorio es un peligro real, Ceph implementa dos mecanismos que impiden suprimir los repositorios. Para suprimir un repositorio, primero es necesario inhabilitar ambos mecanismos.
  </para>

  <para>
   El primero es el indicador <literal>NODELETE</literal>. Todos los repositorios lo tienen y el valor por defecto es "false". Para averiguar el valor de este indicador en un repositorio, ejecute el siguiente comando:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool get <replaceable>pool_name</replaceable> nodelete</screen>

  <para>
   Si la salida es <literal>nodelete: true</literal>, no podrá suprimir el repositorio hasta que cambie el indicador mediante el siguiente comando:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set <replaceable>pool_name</replaceable> nodelete false</screen>

  <para>
   El segundo mecanismo es el parámetro de configuración para todo el clúster <option>mon allow pool delete</option>, que es "false" por defecto. Esto significa que, por defecto, no es posible suprimir un repositorio. El mensaje de error que se muestra es:
  </para>

<screen>Error EPERM: pool deletion is disabled; you must first set the
mon_allow_pool_delete config option to true before you can destroy a pool</screen>

  <para>
   Para suprimir el repositorio a pesar de la configuración de seguridad, puede definir temporalmente <option>mon allow pool delete</option> como "true", suprimir el repositorio y, a continuación, volver a definir el parámetro como "false":
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph tell mon.* injectargs --mon-allow-pool-delete=true
<prompt>cephuser@adm &gt; </prompt>ceph osd pool delete pool_name pool_name --yes-i-really-really-mean-it
<prompt>cephuser@adm &gt; </prompt>ceph tell mon.* injectargs --mon-allow-pool-delete=false</screen>

  <para>
   El comando <command>injectargs</command> muestra el siguiente mensaje:
  </para>

<screen>injectargs:mon_allow_pool_delete = 'true' (not observed, change may require restart)</screen>

  <para>
   Es una simple confirmación de que el comando se ha ejecutado correctamente. No es un error.
  </para>

  <para>
   Si ha creado sus propios conjuntos de reglas y reglas para un repositorio que ha creado, plantéese la posibilidad de eliminar estos elementos cuando ya no necesite el repositorio.
  </para>
 </sect1>
 <sect1 xml:id="ceph-pool-other-operations">
  <title>Otras operaciones</title>

  <sect2 xml:id="ceph-pools-associate">
   <title>Asociación de repositorios a una aplicación</title>
   <para>
    Para utilizar los grupos, debe asociarlos a una aplicación. Los repositorios que se utilizarán con CephFS y los creados automáticamente por Object Gateway se asocian de forma automática.
   </para>
   <para>
    En otros casos, se puede asociar manualmente un nombre de aplicación de formato libre al repositorio:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool application enable <replaceable>POOL_NAME</replaceable> <replaceable>APPLICATION_NAME</replaceable></screen>
   <tip>
    <title>nombres de las aplicaciones por defecto</title>
    <para>
     CephFS utiliza el nombre de aplicación <literal>cephfs</literal>, el dispositivo de bloques RADOS utiliza <literal>rbd</literal> y Object Gateway utiliza <literal>rgw</literal>.
    </para>
   </tip>
   <para>
    Un repositorio se puede asociar a varias aplicaciones y cada aplicación puede tener sus propios metadatos. Para mostrar la aplicación (o las aplicaciones) asociadas a un repositorio, emita el comando siguiente:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool application get <replaceable>pool_name</replaceable></screen>
  </sect2>

  <sect2 xml:id="ceph-set-pool-quotas">
   <title>Definición de cuotas de repositorio</title>
   <para>
    Puede definir cuotas de repositorio para el número máximo de bytes o el número máximo de objetos por repositorio.
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set-quota <replaceable>POOL_NAME</replaceable> <replaceable>MAX_OBJECTS</replaceable> <replaceable>OBJ_COUNT</replaceable> <replaceable>MAX_BYTES</replaceable> <replaceable>BYTES</replaceable></screen>
   <para>
    Por ejemplo:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set-quota data max_objects 10000</screen>
   <para>
    Para eliminar una cuota, establezca su valor en 0.
   </para>
  </sect2>

  <sect2 xml:id="ceph-showing-pool-statistics">
   <title>Visualización de estadísticas de repositorios</title>
   <para>
    Para mostrar las estadísticas de uso de un repositorio, ejecute:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rados df
 POOL_NAME                    USED OBJECTS CLONES COPIES MISSING_ON_PRIMARY UNFOUND DEGRADED  RD_OPS      RD  WR_OPS      WR USED COMPR UNDER COMPR
 .rgw.root                 768 KiB       4      0     12                  0       0        0      44  44 KiB       4   4 KiB        0 B         0 B
 cephfs_data               960 KiB       5      0     15                  0       0        0    5502 2.1 MiB      14  11 KiB        0 B         0 B
 cephfs_metadata           1.5 MiB      22      0     66                  0       0        0      26  78 KiB     176 147 KiB        0 B         0 B
 default.rgw.buckets.index     0 B       1      0      3                  0       0        0       4   4 KiB       1     0 B        0 B         0 B
 default.rgw.control           0 B       8      0     24                  0       0        0       0     0 B       0     0 B        0 B         0 B
 default.rgw.log               0 B     207      0    621                  0       0        0 5372132 5.1 GiB 3579618     0 B        0 B         0 B
 default.rgw.meta          961 KiB       6      0     18                  0       0        0     155 140 KiB      14   7 KiB        0 B         0 B
 example_rbd_pool          2.1 MiB      18      0     54                  0       0        0 3350841 2.7 GiB     118  98 KiB        0 B         0 B
 iscsi-images              769 KiB       8      0     24                  0       0        0 1559261 1.3 GiB      61  42 KiB        0 B         0 B
 mirrored-pool             1.1 MiB      10      0     30                  0       0        0  475724 395 MiB      54  48 KiB        0 B         0 B
 pool2                         0 B       0      0      0                  0       0        0       0     0 B       0     0 B        0 B         0 B
 pool3                     333 MiB      37      0    111                  0       0        0 3169308 2.5 GiB   14847 118 MiB        0 B         0 B
 pool4                     1.1 MiB      13      0     39                  0       0        0 1379568 1.1 GiB   16840  16 MiB        0 B         0 B
 </screen>
   <para>
    A continuación se ofrece una descripción de cada columna:
   </para>
   <variablelist>
    <varlistentry>
     <term>USED</term>
     <listitem>
      <para>
       El número de bytes utilizados por el repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>OBJECTS</term>
     <listitem>
      <para>
       El número de objetos almacenados en el repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>CLONES</term>
     <listitem>
      <para>
       El número de clones almacenados en el repositorio. Cuando se crea una instantánea y se escribe en un objeto, en lugar de modificar el objeto original, se crea su clon para que no se modifique el contenido del objeto original del que se ha hecho la instantánea.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>COPIES</term>
     <listitem>
      <para>
       El número de réplicas del objeto. Por ejemplo, si un repositorio replicado con el factor de réplica 3 tiene x objetos, normalmente tendrá 3 * x copias.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>MISSING_ON_PRIMARY</term>
     <listitem>
      <para>
       El número de objetos en estado degradado (no existen todas las copias) mientras falta la copia en el OSD primario.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>UNFOUND</term>
     <listitem>
      <para>
       El número de objetos no encontrados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>DEGRADED</term>
     <listitem>
      <para>
       El número de objetos degradados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RD_OPS</term>
     <listitem>
      <para>
       El número total de operaciones de lectura pedidas para este repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RD</term>
     <listitem>
      <para>
       El número total de bytes leídos de este repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>WR_OPS</term>
     <listitem>
      <para>
       El número total de operaciones de escritura pedidas para este repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>WR</term>
     <listitem>
      <para>
       El número total de bytes escritos en el repositorio. Tenga en cuenta que no es lo mismo que el uso del repositorio, ya que es posible escribir en el mismo objeto muchas veces. El resultado es que el uso del repositorio seguirá siendo el mismo, pero el número de bytes escritos en el repositorio aumentará.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>USED COMPR</term>
     <listitem>
      <para>
       El número de bytes asignados para datos comprimidos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>UNDER COMPR</term>
     <listitem>
      <para>
       El número de bytes que ocupan los datos comprimidos cuando no están comprimidos
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="ceph-getting-pool-values">
   <title>Obtención de valores de repositorio</title>
   <para>
    Para obtener un valor de un repositorio, ejecute el comando <command>get</command> siguiente:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool get <replaceable>POOL_NAME</replaceable> <replaceable>KEY</replaceable></screen>
   <para>
    Puede obtener los valores de las claves indicadas en la <xref linkend="ceph-pools-values"/>, además de las siguientes:
   </para>
   <variablelist>
    <varlistentry>
     <term>PG_NUM</term>
     <listitem>
      <para>
       El número de grupos de colocación del repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>PGP_NUM</term>
     <listitem>
      <para>
       El número efectivo de grupos de colocación que se deben utilizar para calcular la colocación de los datos. El intervalo válido es igual o menor que <option>PG_NUM</option>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>todos los valores de un repositorio</title>
    <para>
     Para mostrar todos los valores relacionados con un repositorio específico, ejecute:
    </para>
<screen>
 <prompt>cephuser@adm &gt; </prompt>ceph osd pool get <replaceable>POOL_NAME</replaceable> all
 </screen>
   </tip>
  </sect2>

  <sect2 xml:id="ceph-pools-values">
   <title>Definición de valores de repositorio</title>
   <para>
    Para definir un valor para un repositorio, ejecute:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set <replaceable>POOL_NAME</replaceable> <replaceable>KEY</replaceable> <replaceable>VALUE</replaceable></screen>
   <para>
    A continuación se muestra una lista de valores de repositorio ordenados por tipo de repositorio:
   </para>
   <variablelist>
    <title>Valores de repositorio comunes</title>
    <varlistentry>
     <term>crash_replay_interval</term>
     <listitem>
      <para>
       El número de segundos que se debe permitir a los clientes que reproduzcan peticiones reconocidas, pero no confirmadas.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pg_num</term>
     <listitem>
      <para>
       El número de grupos de colocación del repositorio. Si añade nuevos OSD al clúster, verifique el valor de los grupos de colocación en todos los repositorios de destino para los nuevos OSD.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pgp_num</term>
     <listitem>
      <para>
       El número efectivo de grupos de colocación que se deben utilizar para calcular la colocación de los datos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>crush_ruleset</term>
     <listitem>
      <para>
       El conjunto de reglas que se debe utilizar para asignar la colocación en el clúster.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hashpspool</term>
     <listitem>
      <para>
       Establece (1) o anula (0) el indicador HASHPSPOOL en un repositorio. Cuando se habilita este indicador, el algoritmo cambia para mejorar la distribución de los grupos de colocación a los OSD. Después de habilitar el indicador en un repositorio cuyo indicador HASHPSPOOL se ha definido con el valor por defecto, 0, el clúster inicia la reposición para que todos los grupos vuelvan a la colocación correcta. Tenga en cuenta que esto puede crear una carga de E/S bastante sustancial en un clúster; por lo tanto, no habilite el indicador de 0 a 1 en clústeres de producción con mucha carga.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nodelete</term>
     <listitem>
      <para>
       Impide la eliminación del repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nopgchange</term>
     <listitem>
      <para>
       Impide que se modifiquen los valores <option>pg_num</option> y <option>pgp_num</option> del repositorio.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>noscrub,nodeep-scrub</term>
     <listitem>
      <para>
       Inhabilita la depuración (profunda) de los datos para el repositorio específico, a fin de resolver un pico temporal de carga de E/S.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>write_fadvise_dontneed</term>
     <listitem>
      <para>
       Defina o anule la definición del indicador <literal>WRITE_FADVISE_DONTNEED</literal> en las peticiones de lectura/escritura de un repositorio determinado para omitir la colocación de datos en el caché. El valor por defecto es <literal>false</literal> (falso). Se aplica tanto a los repositorios replicados como a los codificados de borrado.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>scrub_min_interval</term>
     <listitem>
      <para>
       El intervalo mínimo en segundos para el borrado seguro de datos del repositorio cuando la carga del clúster es reducida. El valor <literal>0</literal> por defecto significa que se utiliza el valor <option>osd_scrub_min_interval</option> del archivo de configuración de Ceph.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>scrub_max_interval</term>
     <listitem>
      <para>
       El intervalo máximo en segundos para el borrado seguro de datos del repositorio, independientemente de la carga del clúster. El valor <literal>0</literal> por defecto significa que se utiliza el valor <option>osd_scrub_max_interval</option> del archivo de configuración de Ceph.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>deep_scrub_interval</term>
     <listitem>
      <para>
       El intervalo en segundos para el borrado seguro <emphasis>profundo</emphasis> del repositorio. El valor <literal>0</literal> por defecto significa que se utiliza el valor <option>osd_deep_scrub</option> del archivo de configuración de Ceph.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist>
    <title>Valores de repositorio replicados</title>
    <varlistentry>
     <term>size</term>
     <listitem>
      <para>
       Define el número de réplicas para los objetos del repositorio. Consulte la <xref linkend="ceph-pools-options-num-of-replicas"/> para obtener más información. Solo para repositorios replicados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>min_size</term>
     <listitem>
      <para>
       Define el número mínimo de réplicas obligatorias para E/S. Consulte la <xref linkend="ceph-pools-options-num-of-replicas"/> para obtener más información. Solo para repositorios replicados.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nosizechange</term>
     <listitem>
      <para>
       Impide que se modifique el tamaño del repositorio. Cuando se crea un repositorio, el valor por defecto se toma del valor del parámetro <option>osd_pool_default_flag_nosizechange</option>, que es <literal>false</literal> por defecto. Se aplica a los repositorios replicados solo porque no se puede cambiar el tamaño de los repositorios codificados de borrado.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_type</term>
     <listitem>
      <para>
       Habilita el seguimiento de conjuntos de resultados para repositorios de caché. Consulte <link xlink:href="http://en.wikipedia.org/wiki/Bloom_filter">este artículo sobre los filtros de Bloom</link> para obtener más información. Esta opción puede tener los valores siguientes: <literal>bloom</literal>, <literal>explicit_hash</literal> o <literal>explicit_object</literal>. El valor por defecto es <literal>bloom</literal>, los demás solo se emplean para realizar pruebas.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_count</term>
     <listitem>
      <para>
       El número de conjuntos de resultados que se deben almacenar en los repositorios de caché. Cuanto mayor sea el número, más RAM consumirá el daemon <systemitem>ceph-osd</systemitem>. El valor por defecto es <literal>0</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_period</term>
     <listitem>
      <para>
       La duración en segundos de un periodo de conjunto de resultados para los repositorios de caché. Cuanto mayor sea el número, más RAM consumirá el daemon <systemitem>ceph-osd</systemitem>. Cuando se crea un repositorio, el valor por defecto se toma del valor del parámetro <option>osd_tier_default_cache_hit_set_period</option>, que es <literal>1200</literal> por defecto. Se aplica a los repositorios replicados solo porque los repositorios codificados de borrado no se pueden usar como nivel de caché.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_fpp</term>
     <listitem>
      <para>
       La probabilidad de falsos positivos para el tipo de conjunto de resultados del filtro de Bloom. Consulte <link xlink:href="http://en.wikipedia.org/wiki/Bloom_filter">este artículo sobre los filtros de Bloom</link> para obtener más información. El intervalo válido es de 0.0 a 1.0; el valor predeterminado es <literal>0.05</literal>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>use_gmt_hitset</term>
     <listitem>
      <para>
       Forzar a los OSD para que utilicen marcas horarias GMT (hora del meridiano de Greenwich) al crear un conjunto de resultados para los niveles de caché. Esto garantiza que los nodos de distintas zonas horarias devuelvan el mismo resultado. El valor por defecto es <literal>1</literal>. Este valor no debe cambiarse.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_dirty_ratio</term>
     <listitem>
      <para>
       El porcentaje del repositorio de caché que debe contener objetos modificados (sucios) para que el agente de niveles de caché los vacíe en el repositorio de almacenamiento. El valor por defecto es <literal>0.4</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_dirty_high_ratio</term>
     <listitem>
      <para>
       El porcentaje del repositorio de caché que debe contener objetos modificados (sucios) para que el agente de niveles de caché los vacíe en el repositorio de almacenamiento a mayor velocidad. El valor por defecto es <literal>0.6</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_full_ratio</term>
     <listitem>
      <para>
       El porcentaje del repositorio de caché que debe contener objetos no modificados (limpios) para que el agente de niveles de caché los expulse del repositorio de caché. El valor por defecto es <literal>0.8</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>target_max_bytes</term>
     <listitem>
      <para>
       Ceph comenzará a expulsar o limpiar objetos cuando se active el umbral establecido en <option>max_bytes</option>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>target_max_objects</term>
     <listitem>
      <para>
       Ceph comenzará a expulsar o limpiar objetos cuando se active el umbral establecido en <option>max_objects</option>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_grade_decay_rate</term>
     <listitem>
      <para>
       Velocidad de caída de temperatura entre dos <literal>hit_set</literal>s sucesivos. El valor por defecto es <literal>20</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_search_last_n</term>
     <listitem>
      <para>
       Deben contarse como máximo <literal>N</literal> apariciones en <literal>hit_set</literal>s para calcular la temperatura. El valor por defecto es <literal>1</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_min_flush_age</term>
     <listitem>
      <para>
       El tiempo (en segundos) que debe transcurrir para que el agente de niveles de caché mueva un objeto del repositorio de caché al de almacenamiento.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_min_evict_age</term>
     <listitem>
      <para>
       El tiempo (en segundos) que debe transcurrir para que el agente de niveles de caché expulse un objeto del repositorio de caché.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <variablelist xml:id="pool-values-ec">
    <title>Valores de repositorio codificado de borrado</title>
    <varlistentry>
     <term>fast_read</term>
     <listitem>
      <para>
       Si este indicador está habilitado en los repositorios codificados de borrado, las peticiones de lectura emite sublecturas a todos los shards y espera a recibir suficientes shards que descodificar para ofrecer servicio al cliente. En el caso de los complementos de borrado <emphasis>jerasure</emphasis> e <emphasis>isa</emphasis>, cuando vuelve la respuesta <literal>K</literal>, la petición del cliente se atiende de inmediato con los datos descodificados a partir de estas respuestas. Este enfoque provoca más carga de CPU y menos carga de disco/red. Actualmente, este indicador solo se admite para los repositorios codificados de borrado. El valor por defecto es <literal>0</literal>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="ceph-pools-options-num-of-replicas">
   <title>Definición del número de réplicas de objetos</title>
   <para>
    Para establecer el número de réplicas de objetos en un repositorio replicado, ejecute lo siguiente:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set <replaceable>poolname</replaceable> size <replaceable>num-replicas</replaceable></screen>
   <para>
    El valor <replaceable>num-replicas</replaceable> incluye el objeto en sí. Por ejemplo, si quiere que existan el objeto y dos copias (tres instancias en total), especifique 3.
   </para>
   <warning>
    <title>no defina menos de 3 réplicas</title>
    <para>
     Si establece un valor de 2 en <replaceable>num-replicas</replaceable>, solo habrá <emphasis>una</emphasis> copia de los datos. Si pierde una instancia de un objeto, para recuperarlo debe poder confiar en que la otra copia no haya sufrido daños, por ejemplo, desde el último borrado seguro (consulte la <xref linkend="scrubbing-pgs"/> para obtener más detalles).
    </para>
    <para>
     Si establece solo una réplica en el repositorio, significa que habrá exactamente <emphasis>una</emphasis> única instancia del objeto de datos. Si el OSD falla, se perderán los datos. Un posible uso de un repositorio con una réplica es el almacenamiento temporal de datos durante poco tiempo.
    </para>
   </warning>
   <tip>
    <title>definición de más de 3 réplicas</title>
    <para>
     Si se definen 4 réplicas para un repositorio, la fiabilidad aumenta en un 25%.
    </para>
    <para>
     En el caso de dos centros de datos, debe definir al menos 4 réplicas para que un repositorio tenga dos copias en cada centro de datos. De este modo, si se pierde un centro de datos, aún existen dos copias y se puede perder un disco más sin que se pierdan datos.
    </para>
   </tip>
   <note>
    <para>
     Un objeto puede aceptar operaciones de E/S en modo degradado con menos réplicas de las indicadas en <literal>pool size</literal>. Para configurar un número mínimo de réplicas necesarias para las operaciones de E/S, debe utilizar el valor <literal>min_size</literal>. Por ejemplo:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool set data min_size 2</screen>
    <para>
     Esto garantiza que ningún objeto del repositorio de datos recibirá operaciones de E/S con menos réplicas de las indicadas en <literal>min_size</literal>.
    </para>
   </note>
   <tip>
    <title>obtención del número de réplicas de objetos</title>
    <para>
     Para obtener el número de réplicas de objetos, ejecute lo siguiente:
    </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd dump | grep 'replicated size'</screen>
    <para>
     Ceph enumerará los grupos con el atributo <literal>replicated size</literal> destacado. Ceph crea por defecto dos réplicas de cada objeto (un total de tres copias o un tamaño de 3).
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="pools-migration">
  <title>Migración de repositorios</title>

  <para>
   Al crear un repositorio (consulte la <xref linkend="ceph-pools-operate-add-pool"/>) debe especificar sus parámetros iniciales, como el tipo de repositorio o el número de grupos de colocación. Si más adelante decide cambiar cualquiera de estos parámetros (por ejemplo, al convertir un repositorio replicado en uno codificado de borrado o al disminuir el número de grupos de colocación), debe migrar los datos del repositorio a otro cuyos parámetros se adapten a la distribución.
  </para>

  <para>
   En esta sección se describen dos métodos de migración: un método de <emphasis>nivel de caché</emphasis> para la migración de datos de repositorios generales y un método que utiliza los subcomandos <command>rbd migrate</command> para migrar imágenes RBD a un repositorio nuevo. Cada método tiene sus particularidades y limitaciones.
  </para>

  <sect2 xml:id="pool-migrate-limits">
   <title>Limitaciones</title>
   <itemizedlist>
    <listitem>
     <para>
      Puede usar el método de <emphasis>niveles de caché</emphasis> para migrar desde un repositorio replicado a un repositorio codificado de borrado o a otro repositorio replicado. No se admite la migración desde un repositorio codificado de borrado.
     </para>
    </listitem>
    <listitem>
     <para>
      No se pueden migrar imágenes RBD ni exportaciones de CephFS de un repositorio replicado a un repositorio codificado de borrado. La razón es que los repositorios codificados de borrado no admiten <literal>omap</literal>, mientras que RBD y CephFS utilizan <literal>omap</literal> para almacenar sus metadatos. Por ejemplo, el objeto de encabezado del RBD no se podrá vaciar. Sin embargo, es posible migrar los datos al repositorio codificado de borrado y dejar los metadatos en el repositorio replicado.
     </para>
    </listitem>
    <listitem>
     <para>
      El método <command>rbd migration</command> permite migrar imágenes con el mínimo tiempo de inactividad del cliente. Solo es necesario detener el cliente antes del paso de <option>preparación</option> e iniciarlo después. Tenga en cuenta que solo un cliente <systemitem>librbd</systemitem> que admita esta característica (Ceph Nautilus o posterior) podrá abrir la imagen justo después del paso de <option>preparación</option>, mientras que los clientes <systemitem>librbd</systemitem> más antiguos o los clientes <systemitem>krbd</systemitem> no podrán abrir la imagen hasta que ejecute el paso de <option>asignación</option>.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>

  <sect2 xml:id="pool-migrate-cache-tier">
   <title>Migración mediante el nivel de caché</title>
   <para>
    El principio básico es simple: incluir el repositorio que quiere migrar en un nivel de caché en orden inverso. En el ejemplo siguiente se migra un repositorio replicado denominado "testpool" a un repositorio codificado de borrado:
   </para>
   <procedure>
    <title>Migración de un repositorio replicado a un repositorio codificado de borrado</title>
    <step>
     <para>
      Cree un nuevo repositorio codificado de borrado y llámelo "newpool". Consulte la <xref linkend="ceph-pools-operate-add-pool"/> para obtener una explicación detallada de los parámetros de creación de repositorios.
     </para>
<screen>
 <prompt>cephuser@adm &gt; </prompt>ceph osd pool create newpool erasure default
</screen>
     <para>
      Verifique que el anillo de claves de cliente utilizado proporcione al menos las mismas capacidades para "newpool" que para "testpool".
     </para>
     <para>
      Ahora tiene dos repositorios: el original replicado y lleno de datos ("testpool") y el nuevo repositorio codificado de borrado vacío ("newpool"):
     </para>
     <figure>
      <title>Repositorios antes de la migración</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate1.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate1.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Configure los niveles de caché y establezca el repositorio replicado "testpool" como repositorio de caché. La opción <option>-force-nonempty</option> permite añadir un nivel de caché incluso si el repositorio ya tiene datos:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph tell mon.* injectargs \
 '--mon_debug_unsafe_allow_tier_with_nonempty_snaps=1'
<prompt>cephuser@adm &gt; </prompt>ceph osd tier add newpool testpool --force-nonempty
<prompt>cephuser@adm &gt; </prompt>ceph osd tier cache-mode testpool proxy
</screen>
     <figure>
      <title>Configuración de los niveles de caché</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate2.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate2.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Ejecute un traslado forzoso de todos los objetos del repositorio de caché al nuevo repositorio:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rados -p testpool cache-flush-evict-all
</screen>
     <figure>
      <title>Limpieza de datos</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate3.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate3.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Hasta que todos los datos se hayan movido al nuevo repositorio codificado de borrado, es preciso especificar una superposición para que los objetos se busquen en el repositorio antiguo:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph osd tier set-overlay newpool testpool
</screen>
     <para>
      Con la superposición, todas las operaciones se reenvían al repositorio replicado antiguo ("testpool"):
     </para>
     <figure>
      <title>Configuración de la superposición</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate4.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate4.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      Ahora puede configurar todos los clientes para que accedan a los objetos en el nuevo repositorio.
     </para>
    </step>
    <step>
     <para>
      Una vez migrados todos los datos al repositorio codificado de borrado "newpool", elimine la superposición y el repositorio de caché antiguo ("testpool"):
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph osd tier remove-overlay newpool
<prompt>cephuser@adm &gt; </prompt>ceph osd tier remove newpool testpool
</screen>
     <figure>
      <title>Migración completada</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate5.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate5.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Ejecute:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph tell mon.* injectargs \
 '--mon_debug_unsafe_allow_tier_with_nonempty_snaps=0'
</screen>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="migrate-rbd-image">
   <title>Migración de imágenes RBD</title>
   <para>
    A continuación se muestra la forma recomendada de migrar imágenes RBD de un repositorio replicado a otro repositorio replicado.
   </para>
   <procedure>
    <step>
     <para>
      Detenga el acceso de los clientes (como una máquina virtual) a la imagen RBD.
     </para>
    </step>
    <step>
     <para>
      Cree una nueva imagen en el repositorio de destino, con la imagen de origen como elemento padre:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rbd migration prepare <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable> <replaceable>TARGET_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
     <tip>
      <title>migración solo de datos a un repositorio codificado de borrado</title>
      <para>
       Si necesita migrar solo los datos de imagen a un nuevo repositorio codificado de borrado y dejar los metadatos en el repositorio replicado original, ejecute el siguiente comando:
      </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rbd migration prepare <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable> \
 --data-pool <replaceable>TARGET_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
     </tip>
    </step>
    <step>
     <para>
      Permita que los clientes accedan a la imagen en el repositorio de destino.
     </para>
    </step>
    <step>
     <para>
      Migre los datos al repositorio de destino:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rbd migration execute <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
    </step>
    <step>
     <para>
      Elimine la imagen antigua:
     </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rbd migration commit <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="cha-ceph-snapshots-pool">
  <title>Instantáneas de repositorios</title>

  <para>
   Las instantáneas de repositorios son instantáneas del estado del repositorio Ceph completo. Con las instantáneas de repositorios, es posible conservar el historial de estado del repositorio. Crear instantáneas de repositorio consume un espacio de almacenamiento proporcional al tamaño del repositorio. Compruebe siempre que hay espacio de almacenamiento suficiente antes de crear la instantánea de un repositorio.
  </para>

  <sect2 xml:id="ceph-make-snapshot-pool">
   <title>Creación de una instantánea de un repositorio</title>
   <para>
    Para crear una instantánea de un repositorio, ejecute:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph osd pool mksnap <replaceable>POOL-NAME</replaceable> <replaceable>SNAP-NAME</replaceable>
</screen>
   <para>
    Por ejemplo:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool mksnap pool1 snap1
created pool pool1 snap snap1</screen>
  </sect2>

  <sect2 xml:id="ceph-listing-snapshots-pool">
   <title>Lista de las instantáneas de un repositorio</title>
   <para>
    Para mostrar las instantáneas existentes de un repositorio, ejecute:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rados lssnap -p <replaceable>POOL_NAME</replaceable>
</screen>
   <para>
    Por ejemplo:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>rados lssnap -p pool1
1	snap1	2018.12.13 09:36:20
2	snap2	2018.12.13 09:46:03
2 snaps
</screen>
  </sect2>

  <sect2 xml:id="ceph-removing-snapshot-pool">
   <title>Eliminación de una instantánea de un repositorio</title>
   <para>
    Para eliminar una instantánea de un repositorio, ejecute:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph osd pool rmsnap <replaceable>POOL-NAME</replaceable> <replaceable>SNAP-NAME</replaceable></screen>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-ceph-pool-compression">
  <title>Compresión de datos</title>

  <para>
   BlueStore (encontrará más información en <xref linkend="about-bluestore"/>) proporciona compresión de datos sobre la marcha para ahorrar espacio en disco. La relación de compresión depende de los datos almacenados en el sistema. Tenga en cuenta que la compresión/descompresión requiere potencia de CPU adicional.
  </para>

  <para>
   Puede configurar la compresión de datos a nivel global (consulte la <xref linkend="sec-ceph-pool-bluestore-compression-options"/>) y, a continuación, sustituir la configuración específica para cada repositorio individual.
  </para>

  <para>
   Es posible habilitar o inhabilitar la compresión de datos del repositorio o cambiar el algoritmo y el modo de compresión en cualquier momento, independientemente de si el repositorio contiene datos o no.
  </para>

  <para>
   No se aplicará ninguna compresión a los datos existentes después de habilitar la compresión del repositorio.
  </para>

  <para>
   Después de inhabilitar la compresión de un repositorio, todos sus datos se descomprimirán.
  </para>

  <sect2 xml:id="sec-ceph-pool-compression-enable">
   <title>Habilitación de la compresión</title>
   <para>
    Para habilitar la compresión de datos para un repositorio denominado <replaceable>POOL_NAME</replaceable>, ejecute el siguiente comando:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_algorithm <replaceable>COMPRESSION_ALGORITHM</replaceable>
<prompt>cephuser@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_mode <replaceable>COMPRESSION_MODE</replaceable>
</screen>
   <tip>
    <title>inhabilitación de la compresión de repositorios</title>
    <para>
     Para inhabilitar la compresión de datos para un repositorio, utilice "none" como algoritmo de compresión:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_algorithm none
</screen>
   </tip>
  </sect2>

  <sect2 xml:id="sec-ceph-pool-compression-options">
   <title>Opciones de compresión de repositorios</title>
   <para>
    Este es un listado completo de las opciones de compresión:
   </para>
   <variablelist>
    <varlistentry xml:id="compr-algorithm">
     <term>compression_algorithm</term>
     <listitem>
      <para>
       Los valores posibles son <literal>none</literal>, <literal>zstd</literal> y <literal>snappy</literal>. El valor por defecto es <literal>snappy</literal>.
      </para>
      <para>
       El algoritmo de compresión utilizado depende del caso de uso específico. A continuación s ofrecen varias recomendaciones:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Utilice el valor por defecto, <literal>snappy</literal>, si no tiene una buena razón para cambiarlo.
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>zstd</literal> ofrece una buena relación de compresión, pero causa una alta sobrecarga de CPU cuando comprime pequeñas cantidades de datos.
        </para>
       </listitem>
       <listitem>
        <para>
         Ejecute una comparativa de estos algoritmos en una muestra de sus datos reales y observe el uso de CPU y memoria en su clúster.
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="compr-mode">
     <term>compression_mode</term>
     <listitem>
      <para>
       Los valores posibles son <literal>none</literal>, <literal>aggressive</literal>, <literal>passive</literal> y <literal>force</literal>. El valor por defecto es <literal>none</literal>.
      </para>
      <itemizedlist>
       <listitem>
        <para>
         <literal>none</literal>: no comprimir nunca
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>passive</literal>: comprimir si se sugiere <literal>COMPRESSIBLE</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>aggressive</literal>: comprimir a menos que se sugiera <literal>INCOMPRESSIBLE</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>force</literal>: comprimir siempre
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="compr-ratio">
     <term>compression_required_ratio</term>
     <listitem>
      <para>
       Valor: doble, proporción = SIZE_COMPRESSED / SIZE_ORIGINAL. El valor por defecto es <literal>0.875</literal>, lo que significa que si la compresión no reduce el espacio ocupado en al menos un 12,5 %, el objeto no se comprimirá.
      </para>
      <para>
       Los objetos por encima de esta proporción no se almacenarán comprimidos, ya que el beneficio neto es bajo.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>compression_max_blob_size</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>0</literal>
      </para>
      <para>
       El tamaño máximo de los objetos comprimidos.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>compression_min_blob_size</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>0</literal>
      </para>
      <para>
       El tamaño mínimo de los objetos comprimidos.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-ceph-pool-bluestore-compression-options">
   <title>Opciones de compresión global</title>
   <para>
    Las siguientes opciones de configuración se pueden definir en la configuración de Ceph y se aplican a todos los OSD y no a un solo repositorio. La configuración específica del repositorio indicada en la <xref linkend="sec-ceph-pool-compression-options"/> tendrá prioridad.
   </para>
   <variablelist>
    <varlistentry>
     <term>bluestore_compression_algorithm</term>
     <listitem>
      <para>
       Consulte <xref linkend="compr-algorithm"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_mode</term>
     <listitem>
      <para>
       Consulte <xref linkend="compr-mode"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_required_ratio</term>
     <listitem>
      <para>
       Consulte <xref linkend="compr-ratio"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>0</literal>
      </para>
      <para>
       El tamaño mínimo de los objetos comprimidos. La configuración se omite por defecto si se usa <option>bluestore_compression_min_blob_size_hdd</option> y <option>bluestore_compression_min_blob_size_ssd</option>. Tiene prioridad cuando se define un valor distinto a cero.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>0</literal>
      </para>
      <para>
       El tamaño máximo de los objetos que se comprimen antes de dividirse en fragmentos más pequeños. La configuración se omite por defecto si se usa <option>bluestore_compression_max_blob_size_hdd</option> y <option>bluestore_compression_max_blob_size_ssd</option>. Tiene prioridad cuando se define un valor distinto a cero.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size_ssd</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>8K</literal>
      </para>
      <para>
       Tamaño mínimo de los objetos comprimidos y almacenados en la unidad de estado sólido.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size_ssd</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>64K</literal>
      </para>
      <para>
       El tamaño máximo de los objetos que se comprimen y se almacenan en unidades de estado sólido antes de dividirse en fragmentos más pequeños.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size_hdd</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>128K</literal>
      </para>
      <para>
       Tamaño mínimo de los objetos comprimidos y almacenados en los discos duros.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size_hdd</term>
     <listitem>
      <para>
       Valor: entero sin firmar, tamaño en bytes. Por defecto: <literal>512K</literal>
      </para>
      <para>
       El tamaño máximo de los objetos que se comprimen y se almacenan en discos duros antes de dividirse en fragmentos más pequeños.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
</chapter>
