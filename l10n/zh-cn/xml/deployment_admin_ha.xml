<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>管理节点 HA 设置</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>是</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  <emphasis>管理节点</emphasis>是运行 Salt Master 服务的 Ceph 集群节点。它管理着集群的其余节点，它会查询这些节点的 Salt Minion 服务并向其发出指示。它通常也会包含其他服务，例如 <emphasis>Grafana</emphasis> 仪表盘（由 <emphasis>Prometheus</emphasis> 监控工具包提供支持）。
 </para>
 <para>
  如果管理节点发生故障，通常需要为该节点提供新的工作硬件，并通过最近的备份恢复完整的集群配置堆栈。这种方法很费时，并会导致集群故障。
 </para>
 <para>
  为防止出现由于管理节点故障导致的 Ceph 集群性能下降，建议您为 Ceph 管理节点使用高可用性 (HA) 集群。
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>管理节点的 HA 集群概述</title>

  <para>
   HA 集群的原理是，当其中一个集群节点发生故障时，由另一个节点自动接管其职责，包括虚拟化管理节点。使用此方法时，其他 Ceph 集群节点将不会知道管理节点发生故障。
  </para>

  <para>
   管理节点的极简 HA 解决方案需要以下硬件：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     两台能够运行具有高可用性扩展的 SUSE Linux Enterprise 以及虚拟化管理节点的裸机服务器。
    </para>
   </listitem>
   <listitem>
    <para>
     两个或多个冗余网络通讯路径，例如通过网络设备绑定。
    </para>
   </listitem>
   <listitem>
    <para>
     用于托管管理节点虚拟机磁盘映像的共享存储。必须能够通过这两台服务器访问共享存储。例如，共享存储可以是 NFS 导出项、Samba 共享或 iSCSI 目标。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   有关集群要求的更多详细信息，请访问 <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-install-quick/#sec-ha-inst-quick-req"/>。
  </para>

  <figure>
   <title>管理节点的双节点 HA 集群</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>构建具有管理节点的 HA 集群</title>

  <para>
   以下过程汇总了构建将管理节点虚拟化的 HA 集群的几个最重要的步骤。有关详细信息，请参见指定链接。
  </para>

  <procedure>
   <step>
    <para>
     设置一个具有共享存储的基本双节点 HA 集群，如 <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-install-quick/#art-sleha-install-quick"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在两个集群节点上，安装运行 KVM 超级管理程序和 <systemitem class="library">libvirt</systemitem> 工具包所需的所有程序包，如 <link xlink:href="https://documentation.suse.com/sles/15-SP2/single-html/SLES-virtualization/#sec-vt-installation-kvm"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在第一个集群节点上，使用 <systemitem class="library">libvirt</systemitem> 创建新的 KVM 虚拟机 (VM)，如 <link xlink:href="https://documentation.suse.com/sles/15-SP2/single-html/SLES-virtualization/#sec-libvirt-inst-virt-install"/> 中所述。使用预配置的共享存储来存储 VM 的磁盘映像。
    </para>
   </step>
   <step>
    <para>
     VM 设置完成后，将其配置导出到共享存储上的 XML 文件。使用以下语法：
    </para>
<screen>
<prompt role="root">root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     为管理节点 VM 创建资源。有关创建 HA 资源的一般信息，请参见 <link xlink:href="https://documentation.suse.com/sle-ha/15-SP2/single-html/SLE-HA-guide/#cha-conf-hawk2"/>。<link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/> 中提供了有关为 KVM 虚拟机创建资源的详细信息。
    </para>
   </step>
   <step>
    <para>
     在新创建的 VM guest 中，部署管理节点，包括您需要在其上使用的其他服务。执行<xref linkend="deploy-salt"/>中的相关步骤。同时，在非 HA 集群服务器上部署其余 Ceph 集群节点。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
