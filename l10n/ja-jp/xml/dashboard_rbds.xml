<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>RADOS Block Deviceの管理</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  利用可能なすべてのRBD (RADOS Block Devices)を一覧にするには、メインメニューから<menuchoice><guimenu>ブロック</guimenu><guimenu>イメージ</guimenu></menuchoice>をクリックします。
 </para>
 <para>
  このリストにはデバイスの概要が含まれます。たとえば、デバイス名、関連するプール名、ネームスペース、デバイスのサイズ、デバイスのオブジェクト数とオブジェクトサイズ、デバイスのプロビジョニングの詳細、親などです。
 </para>
 <figure>
  <title>RBDイメージのリスト</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>RBDに関する詳細の表示</title>

  <para>
   デバイスに関する詳細情報を表示するには、テーブルでそのデバイスの行をクリックします。
  </para>

  <figure>
   <title>RBDの詳細</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>RBDの設定の表示</title>

  <para>
   デバイスの詳細な設定を表示するには、テーブルでそのデバイスの行をクリックし、続いてその下のテーブルで<guimenu>設定</guimenu>タブをクリックします。
  </para>

  <figure>
   <title>RBD設定</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>RBDの作成</title>

  <para>
   新しいデバイスを追加するには、テーブル見出しの左上の<guimenu>作成</guimenu>をクリックして、<guimenu>RBDの作成</guimenu>画面で次の操作を行います。
  </para>

  <figure>
   <title>新しいRBDの追加</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     新しいデバイスの名前を入力します。命名の制限については、<xref linkend="sysreq-naming"/>を参照してください。
    </para>
   </step>
   <step>
    <para>
     新しいRBDデバイスの作成元となる、<option>rbd</option>アプリケーションが割り当てられたプールを選択します。
    </para>
   </step>
   <step>
    <para>
     新しいデバイスのサイズを指定します。
    </para>
   </step>
   <step>
    <para>
     デバイスの追加オプションを指定します。デバイスのパラメータを微調整するには、<guimenu>詳細</guimenu>をクリックし、オブジェクトサイズ、ストライプユニット、またはストライプ数の値を入力します。QoS (サービス品質)の制限を入力するには、<guimenu>サービス品質</guimenu>をクリックし、制限値を入力します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>Create RBD (RBDの作成)</guimenu>をクリックして確認します。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>RBDの削除</title>

  <para>
   デバイスを削除するには、そのテーブル行を選択します。<guimenu>作成</guimenu>ボタンの横にあるドロップダウン矢印をクリックして、<guimenu>削除</guimenu>をクリックします。<guimenu>Delete RBD (RBDの削除)</guimenu>をクリックして削除を確認します。
  </para>

  <tip>
   <title>RBDのごみ箱への移動</title>
   <para>
    RBDの削除は元に戻せないアクションです。代わりに<guimenu>ごみ箱に移動する</guimenu>を実行すると、後でメインテーブルの<guimenu>ごみ箱</guimenu>タブでデバイスを選択し、テーブル見出しの左上の<guimenu>復元</guimenu>をクリックしてデバイスを復元できます。
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>RADOS Block Deviceのスナップショットの作成</title>

  <para>
   RADOS Block Deviceのスナップショットを作成するには、そのテーブル行を選択してください。設定内容ペインが表示されます。<guimenu>スナップショット</guimenu>タブを選択し、テーブル見出しの左上にある<guimenu>作成</guimenu>をクリックします。スナップショットの名前を入力し、<guimenu>RBDスナップショットの作成</guimenu>をクリックして確認します。
  </para>

  <para>
   スナップショットを選択した後で、デバイスの名前の変更、保護、複製、コピー、削除などの追加のアクションを実行できます。<guimenu>ロールバック</guimenu>は、現在のスナップショットからデバイスの状態を復元します。
  </para>

  <figure>
   <title>RBDのスナップショット</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>RBDミラーリング</title>

  <para>
   RADOS Block Deviceイメージを2つのCephクラスタ間で非同期にミラーリングできます。Cephダッシュボードを使用して、2つ以上のクラスタ間でRBDイメージを複製するよう設定できます。この機能には2つのモードがあります。
  </para>

  <variablelist>
   <varlistentry>
    <term>ジャーナルベース</term>
    <listitem>
     <para>
      このモードは、RBDイメージのジャーナリング機能を使用して、クラスタ間でクラッシュコンシステントなレプリケーションを保証します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>スナップショットベース</term>
    <listitem>
     <para>
      このモードでは、RBDイメージのミラースナップショットを使用して、クラッシュコンシステントなRBDイメージをクラスタ間で複製します。ミラースナップショットはスケジュールに沿って定期的に作成するか、手動で作成します。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   ジャーナルベースのミラーリングだけを使用している場合、ミラーリングはピアクラスタ内のプールごとに設定されます。また、プール内の特定のイメージサブセットに設定することや、プール内のすべてのイメージを自動的にミラーリングするように設定することもできます。
  </para>

  <para>
   ミラーリングは<command>rbd</command>コマンドを使用して設定します。rbdはデフォルトでSUSE Enterprise Storage 7にインストール済みです。<systemitem class="daemon">rbd-mirror</systemitem>デーモンは、リモートのピアクラスタからイメージの更新を取得して、ローカルクラスタ内のイメージに適用する処理を受け持ちます。<systemitem class="daemon">rbd-mirror</systemitem>デーモンの有効化の詳細については、<xref linkend="rbd-mirror-daemon-enable"/>を参照してください。
  </para>

  <para>
   レプリケーションに対する要望に応じて、RADOS Block Deviceのミラーリングは単方向レプリケーション用または双方向レプリケーション用に設定できます。
  </para>

  <variablelist>
   <varlistentry>
    <term>単方向レプリケーション</term>
    <listitem>
     <para>
      データがプライマリクラスタからセカンダリクラスタにミラーリングされるだけであれば、<systemitem class="daemon">rbd-mirror</systemitem>デーモンはセカンダリクラスタ上でのみ実行されます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>双方向レプリケーション</term>
    <listitem>
     <para>
      データが、あるクラスタのプライマリイメージから別のクラスタの非プライマリイメージにミラーリングされる場合(逆も同様)、<systemitem class="daemon">rbd-mirror</systemitem>デーモンは両方のクラスタで実行されます。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem>デーモンの各インスタンスは、ローカルとリモート両方のCephクラスタを同時に接続できなければなりません。たとえば、すべてのMonitorホストとOSDホストを接続できる必要があります。さらに、ミラーリングのワークロードを扱うため、ネットワークの2つのデータセンター間には十分な帯域幅が必要です。
   </para>
  </important>

  <tip>
   <title>一般情報</title>
   <para>
    RADOS Block Deviceのミラーリングの一般情報とコマンドラインによるアプローチについては、<xref linkend="ceph-rbd-mirror"/>を参照してください。
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>プライマリクラスタとセカンダリクラスタの設定</title>
   <para>
    <emphasis/>「プライマリ」クラスタは、イメージを含む元のプールが作成される場所です。<emphasis/>「セカンダリ」クラスタは、<emphasis/>「プライマリ」クラスタからプールやイメージが複製される場所です。
   </para>
   <note>
    <title>相対命名</title>
    <para>
     <emphasis/>「プライマリ」および<emphasis/>「セカンダリ」という用語は、クラスタよりも個々のプールとの関連性が高いため、レプリケーションのコンテキストでは相対的に使用できます。たとえば、双方向レプリケーションにおいて、あるプールを<emphasis/>「プライマリ」クラスタから<emphasis/>「セカンダリ」クラスタにミラーリングし、別のプールを<emphasis/>「セカンダリ」クラスタから<emphasis/>「プライマリ」クラスタにミラーリングできます。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title><systemitem class="daemon">rbd-mirror</systemitem>デーモンの有効化</title>
   <para>
    次の手順では、<command>rbd</command>コマンドを使用してミラーリングを設定するための基本的な管理タスクを実行する方法を説明します。ミラーリングは、Cephクラスタ内のプールごとに設定します。
   </para>
   <para>
    プールの設定手順は、両方のピアクラスタで行う必要があります。これから説明する手順では、わかりやすくするため「プライマリ」および「セカンダリ」という名前の2つのクラスタが1つのホストからアクセス可能であることを想定しています。
   </para>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem>デーモンは、クラスタデータの実際のレプリケーションを実行します。
   </para>
   <procedure>
    <step>
     <para>
      <filename>ceph.conf</filename>とキーリングファイルの名前を変更し、プライマリホストからセカンダリホストにコピーします。
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      <command>rbd</command>を使用してプールのミラーリングを有効にするには、<command>mirror pool enable</command>、プール名、ミラーリングモードを指定します。
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       ミラーリングモードは<literal>image</literal>または<literal>pool</literal>を指定できます。以下に例を示します。
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      Cephダッシュボードで<menuchoice><guimenu>ブロック</guimenu><guimenu>ミラーリング</guimenu></menuchoice>に移動します。左側の<guimenu>デーモン</guimenu>テーブルに、アクティブに実行されている<systemitem class="daemon">rbd-mirror</systemitem>デーモンとそのヘルスが表示されます。
     </para>
     <figure>
      <title><systemitem class="daemon">rbd-mirror</systemitem>デーモンの実行</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>ミラーリングの無効化</title>
   <para>
    <command>rbd</command>を使用してプールのミラーリングを無効化するには、<command>mirror pool disable</command>コマンドとプール名を指定します。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    この方法でプールのミラーリングを無効にした場合、ミラーリングを明示的に有効にしたイメージ(プール内)のミラーリングも無効になります。
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>ピアのブートストラップ処理</title>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem>がピアクラスタを発見するためには、ピアをプールに登録し、ユーザアカウントを作成する必要があります。このプロセスは<command>rbd</command>コマンドとともに<command>mirror pool peer bootstrap create</command>コマンドと<command>mirror pool peer bootstrap import</command>コマンドを使用することで自動化できます。
   </para>
   <para>
    <command>rbd</command>を使用して新しいブートストラップトークンを手動で作成するには、<command>mirror pool peer bootstrap create</command>コマンドとプール名に加えて、ローカルクラスタを記述するためにオプションのサイト名を指定します。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    <command>mirror pool peer bootstrap create</command>コマンドの出力はトークンです。このトークンを<command>mirror pool peer bootstrap import</command>コマンドに提供する必要があります。たとえば、プライマリクラスタで次のコマンドを実行します。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
  joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    <command>rbd</command>コマンドを使用して別のクラスタが作成したブートストラップトークンを手動でインポートするには、次の項目を指定します。<command>mirror pool peer bootstrap import</command>コマンド、プール名、作成されたトークンへのファイルパス(標準入力から読み込む場合は「-」)、および、オプションでローカルクラスタとミラーリング方向を記述するサイト名(デフォルトでは双方向ミラーリングを表す<literal>rx-tx</literal>に設定されていますが、単方向ミラーリングを表す<literal>rx-only</literal>にも設定できます)。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    たとえば、セカンダリクラスタで次のコマンドを実行します。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW1pcn \
Jvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>クラスタピアの削除</title>
   <para>
    <command>rbd</command>コマンドを使用して、ミラーリングピアCephクラスタを削除するには、<command>mirror pool peer remove</command>コマンド、プール名、ピアのUUIDを指定します(UUIDは<command>rbd mirror pool info</command>コマンドにより取得できます)。
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Cephダッシュボードによるプールのレプリケーション設定</title>
   <para>
    RBDイメージをミラーリングできるようにするには、<systemitem class="daemon">rbd-mirror</systemitem>デーモンがプライマリクラスタへのアクセス権を持っている必要があります。作業を始める前に、<xref linkend="rbd-mirror-peer-bootstrap"/>の手順に従って設定したかを確認してください。
   </para>
   <procedure>
    <step>
     <para>
      <emphasis/>「プライマリ」および<emphasis/>「セカンダリ」クラスタの両方で同じ名前のプールを作成し、プールに<literal>rbd</literal>アプリケーションを割り当てます。新しいプールの作成の詳細については、<xref linkend="dashboard-pools-create"/>を参照してください。
     </para>
     <figure>
      <title>RBDアプリケーションを使用したプールの作成</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      <emphasis/>「プライマリ」および<emphasis/>「セカンダリ」クラスタの両方のダッシュボードで、<menuchoice><guimenu>ブロック</guimenu><guimenu>ミラーリング</guimenu></menuchoice>に移動します。右側の<guimenu>プール</guimenu>テーブルで、複製するプールの名前をクリックし、<guimenu>モードの編集</guimenu>をクリックした後で、レプリケーションモードを選択します。この例では、<emphasis/>「プール」レプリケーションモードを使用します。つまり、指定したプール内のすべてのイメージが複製されます。<guimenu>更新</guimenu>をクリックして確認します。
     </para>
     <figure>
      <title>レプリケーションモードの設定</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>プライマリクラスタでのエラーまたは警告</title>
      <para>
       レプリケーションモードを更新すると、対応する右側の列にエラーまたは警告フラグが表示されます。これは、まだプールにレプリケーション用のピアユーザが割り当てられていないためです。ピアユーザは<emphasis/>「セカンダリ」クラスタにのみ割り当てるので、<emphasis/>「プライマリ」クラスタではこのフラグは無視してください。
      </para>
     </important>
    </step>
    <step>
     <para>
      <emphasis/>「セカンダリ」クラスタのダッシュボードで、<menuchoice><guimenu>ブロック</guimenu><guimenu>ミラーリング</guimenu></menuchoice>に移動します。<guimenu>ピアの追加</guimenu>を選択してプールミラーピアを追加します。<emphasis/>「プライマリ」クラスタの詳細を指定します。
     </para>
     <figure>
      <title>ピア資格情報の追加</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>クラスタ名</guimenu></term>
       <listitem>
        <para>
         プライマリクラスタを識別する任意の固有の文字列(「primary」など)。このクラスタ名は、実際のセカンダリクラスタの名前とは異なる必要があります。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephX ID</guimenu></term>
       <listitem>
        <para>
         ミラーリングピアとして作成したCephユーザID。この例では、「rbd-mirror-peer」です。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>モニターアドレス</guimenu></term>
       <listitem>
        <para>
         プライマリクラスタのCeph MonitorノードのIPアドレスをカンマ区切りリスト。
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephXキー</guimenu></term>
       <listitem>
        <para>
         ピアユーザIDに関連したキー。このキーを取得するには、プライマリクラスタで次のサンプルコマンドを実行します。
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      <guimenu>送信</guimenu>をクリックして確認します。
     </para>
     <figure>
      <title>複製されたプールのリスト</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>RBDイメージレプリケーションが機能することの確認</title>
   <para>
    <systemitem class="daemon">rbd-mirror</systemitem>デーモンが実行されていて、CephダッシュボードでRBDイメージレプリケーションが設定されている場合、ここで、レプリケーションが実際に機能するかどうかを確認します。
   </para>
   <procedure>
    <step>
     <para>
      <emphasis/>「プライマリ」クラスタのCephダッシュボードで、RBDイメージを作成し、その親プールが、レプリケーション用にすでに作成済みのプールになるようにします。イメージに対して［<option>排他ロック</option>］機能と［<option>ジャーナリング</option>］機能を有効にします。RBDイメージの作成方法の詳細については、<xref linkend="dashboard-rbds-create"/>を参照してください。
     </para>
     <figure>
      <title>新しいRBDイメージ</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      複製するイメージを作成した後で、<emphasis/>「セカンダリ」クラスタのCephダッシュボードを開き、<menuchoice><guimenu>ブロック</guimenu><guimenu>ミラーリング</guimenu></menuchoice>に移動します。右側の<guimenu>プール</guimenu>テーブルは、<guimenu>#リモート</guimenu>イメージの数の変更を反映し、<guimenu>#ローカル</guimenu>イメージの数を同期します。
     </para>
     <figure>
      <title>新しいRBDイメージの同期</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>レプリケーションの進行状況</title>
      <para>
       ページ下部の<guimenu>イメージ</guimenu>テーブルには、RBDイメージのレプリケーションのステータスが表示されます。<guimenu>問題</guimenu>タブには、考えられる問題が含まれており、<guimenu>同期中</guimenu>タブには、イメージのレプリケーションの進行状況が表示され、<guimenu>準備完了</guimenu>タブには、レプリケーションが正常に完了したすべてのイメージが一覧にされます。
      </para>
      <figure>
       <title>RBDイメージのレプリケーションステータス</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      <emphasis/>「プライマリ」クラスタで、データをRBDイメージに書き込みます。<emphasis/>「セカンダリ」クラスタのCephダッシュボードで、<menuchoice><guimenu>ブロック</guimenu><guimenu>イメージ</guimenu></menuchoice>に移動して、プライマリクラスタのデータが書き込まれるにつれて、対応するイメージのサイズが大きくなっているかどうかを監視します。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>iSCSI Gatewayの管理</title>

  <tip>
   <title>iSCSI Gatewayについての詳細</title>
   <para>
    iSCSI Gatewayの全般的な情報については、<xref linkend="cha-ceph-iscsi"/>を参照してください。
   </para>
  </tip>

  <para>
   利用可能なすべてのゲートウェイとマップ済みイメージを一覧にするには、メインメニューから<menuchoice><guimenu>ブロック</guimenu><guimenu>iSCSI</guimenu></menuchoice>をクリックします。<guimenu>概要</guimenu>タブを開くと、現在設定されているiSCSI Gatewayとマップ済みのRBDイメージが一覧にされます。
  </para>

  <para>
   <guimenu>ゲートウェイ</guimenu>テーブルには、各ゲートウェイの状態、iSCSIターゲットの数、およびセッションの数が一覧にされます。<guimenu>イメージ</guimenu>テーブルには、各マップ済みイメージの名前、関連するプール名のバックストアタイプ、および他の統計情報の詳細が一覧にされます。
  </para>

  <para>
   <guimenu>ターゲット</guimenu>タブには、現在設定されているiSCSIターゲットが一覧にされます。
  </para>

  <figure>
   <title>iSCSIターゲットのリスト</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   ターゲットのより詳細な情報を表示するには、そのテーブル行のドロップダウン矢印をクリックしてください。ツリー構造のスキーマが開き、ディスク、ポータル、イニシエータ、およびグループが一覧にされます。項目をクリックして展開し、その詳細コンテンツを表示します。オプションで右側の表に関連する設定が表示されます。
  </para>

  <figure>
   <title>iSCSIターゲット詳細</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>iSCSIターゲットの追加</title>
   <para>
    新しいiSCSIターゲットを追加するには、<guimenu>ターゲット</guimenu>テーブルの左上の<guimenu>作成</guimenu>をクリックして、必要な情報を入力します。
   </para>
   <figure>
    <title>新しいターゲットの追加</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      新しいゲートウェイのターゲットアドレスを入力します。
     </para>
    </step>
    <step>
     <para>
      <guimenu>Add portal (ポータルの追加)</guimenu>をクリックして、リストから1つまたは複数のiSCSIポータルを選択します。
     </para>
    </step>
    <step>
     <para>
      <guimenu>Add image (イメージの追加)</guimenu>をクリックして、ゲートウェイのRBDイメージを1つまたは複数選択します。
     </para>
    </step>
    <step>
     <para>
      認証を使用してゲートウェイにアクセスする必要がある場合は、<guimenu>ACL認証</guimenu>チェックボックスをオンにして資格情報を入力します。<guimenu>Mutual authentication (相互認証)</guimenu>および<guimenu>Discovery authentication (ディスカバリ認証)</guimenu>を有効にすると、より高度な認証オプションが表示されます。
     </para>
    </step>
    <step>
     <para>
      <guimenu>Create Target (ターゲットの作成)</guimenu>をクリックして確認します。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>iSCSIターゲットの編集</title>
   <para>
    既存のiSCSIターゲットを編集するには、<guimenu>ターゲット</guimenu>テーブルでその行をクリックし、テーブルの左上の<guimenu>編集</guimenu>をクリックします。
   </para>
   <para>
    その後、iSCSIターゲットの追加、ポータルの追加または削除、および関連するRBDイメージの追加または削除を行うことができます。ゲートウェイの認証情報を調整することもできます。
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>iSCSIターゲットの削除</title>
   <para>
    iSCSIターゲットを削除するには、テーブル行を選択してから<guimenu>編集</guimenu>ボタンの隣にあるドロップダウン矢印をクリックして、<guimenu>削除</guimenu>を選択します。<guimenu>はい</guimenu>を有効にして、<guimenu>iSCSIターゲットの削除</guimenu>をクリックして確認します。
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>RBD QoS (サービス品質)</title>

  <tip>
   <title>詳細の参照先</title>
   <para>
    RBD QoS設定オプションの全般的な情報と説明については、<xref linkend="rbd-qos"/>を参照してください。
   </para>
  </tip>

  <para>
   QoSオプションは次の複数のレベルで設定できます。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     グローバル
    </para>
   </listitem>
   <listitem>
    <para>
     プールごと
    </para>
   </listitem>
   <listitem>
    <para>
     イメージごと
    </para>
   </listitem>
  </itemizedlist>

  <para>
   <emphasis/>「グローバル」の設定はリストの一番上にあり、新しく作成されたすべてのRBDイメージと、プールまたはRBDイメージ層でこれらの値を上書きしないイメージに使用されます。グローバルに指定されたオプション値をプールごとまたはイメージごとに上書きできます。プールに対して指定されたオプションは、そのプールのすべてのRBDイメージに適用されます。ただし、イメージに対して設定された設定オプションが優先される場合を除きます。イメージに対して指定されたオプションは、プールに対して指定されたオプションを上書きし、グローバルに指定されたオプションを上書きします。
  </para>

  <para>
   このようにして、デフォルトをグローバルに定義して、特定のプールのすべてのRBDイメージに適合させ、個々のRBDイメージのプール設定を上書きできます。
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>オプションのグローバルな設定</title>
   <para>
    RADOS Block Deviceをグローバルに設定するには、メインメニューから<menuchoice><guimenu>クラスタ</guimenu>
    <guimenu>設定</guimenu></menuchoice>を選択してください。
   </para>
   <procedure>
    <step>
     <para>
      <menuchoice><guimenu>レベル</guimenu></menuchoice>の横に、すべての利用可能なグローバル設定オプションを一覧にするには、ドロップダウンメニューから<menuchoice><guimenu>詳細</guimenu></menuchoice>を選択します。
     </para>
    </step>
    <step>
     <para>
      検索フィールドで<literal>rbd_qos</literal>をフィルタリングして、テーブルの結果をフィルタします。これにより、QoSで使用可能なすべての設定オプションが一覧にされます。
     </para>
    </step>
    <step>
     <para>
      値を変更するには、テーブルでその行をクリックし、テーブルの左上の<guimenu>編集</guimenu>を選択します。<guimenu>編集</guimenu>ダイアログには、値を指定するための6つの異なるフィールドが含まれます。<guimenu>mgr</guimenu>テキストボックスには、RBD設定オプションの値を入力する必要があります。
     </para>
     <note>
      <para>
       他のダイアログとは異なり、このダイアログでは接頭辞付きの単位で値を指定できません。編集するオプションによっては、バイトまたはIOPSのいずれかでこれらの値を設定する必要があります。
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>新しいプールでのオプションの設定</title>
   <para>
    新しいプールを作成し、そのプールにRBD設定オプションを設定するには、<menuchoice><guimenu>プール</guimenu>
    <guimenu>作成</guimenu></menuchoice>をクリックします。プールタイプとして<guimenu>replicated (複製)</guimenu>を選択します。RBD QoSオプションを設定できるようにするには、プールに<literal>rbd</literal>アプリケーションタグを追加する必要があります。
   </para>
   <note>
    <para>
     イレージャコーディングプールにRBD QoS設定オプションを設定することはできません。イレージャコーディングプールにRBD QoSオプションを設定するには、RBDイメージの複製されたメタデータプールを編集する必要があります。これにより、そのイメージのイレージャコーディングデータプールに設定が適用されます。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>既存のプールでのオプションの設定</title>
   <para>
    既存のプールにRBD QoSオプションを設定するには、<guimenu>プール</guimenu>をクリックし、プールのテーブル行をクリックして、テーブルの左上の<guimenu>編集</guimenu>を選択します。
   </para>
   <para>
    ダイアログに<guimenu>RBD設定</guimenu>セクションが表示され、その後に<guimenu>サービス品質</guimenu>セクションが表示されます。
   </para>
   <note>
    <para>
     <guimenu>RBD設定</guimenu>セクションも<guimenu>サービス品質</guimenu>セクションも表示されない場合は、RBD設定オプションの設定に使用できない<emphasis/>「イレージャコーディング」プールを編集しているか、RBDイメージで使用するようにプールが設定されていない可能性があります。後者の場合は、<guimenu>RBD</guimenu>アプリケーションタグをプールに割り当てます。これにより、対応する設定セクションが表示されます。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>設定オプション</title>
   <para>
    設定オプションを展開するには、<guimenu>サービス品質+</guimenu>をクリックします。使用可能なすべてのオプションのリストが表示されます。設定オプションの単位は、テキストボックスにすでに表示されています。BPS (1秒あたりのバイト数)オプションの場合は、「1M」や「5G」などのショートカットを自由に使用できます。これらはそれぞれ自動的に「1 MB/秒」と「5 GB/秒」に変換されます。
   </para>
   <para>
    各テキストボックスの右にあるリセットボタンをクリックすると、プールに設定されている値が削除されます。グローバルに設定されたオプションやRBDイメージに設定されたオプションの設定値は削除されません。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>新しいRBDイメージを使用したRBD QoSオプションの作成</title>
   <para>
    イメージにRBD QoSオプションが設定された状態でRBDイメージを作成するには、<menuchoice><guimenu>ブロック</guimenu> <guimenu>イメージ</guimenu></menuchoice>を選択し、<guimenu>作成</guimenu>をクリックします。詳細設定セクションを展開するには、<guimenu>詳細...</guimenu>をクリックします。使用可能なすべての設定オプションを開くには、<guimenu>サービス品質+</guimenu>をクリックします。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>既存のイメージでのRBD QoSの編集</title>
   <para>
    既存のイメージでRBD QoSオプションを編集するには、<menuchoice><guimenu>ブロック</guimenu>
    <guimenu>イメージ</guimenu></menuchoice>を選択し、プールのテーブル行をクリックして、最後に<guimenu>編集</guimenu>をクリックします。編集ダイアログが表示されます。詳細設定セクションを展開するには、<guimenu>詳細...</guimenu>をクリックします。使用可能なすべての設定オプションを開くには、<guimenu>サービス品質+</guimenu>をクリックします。
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>イメージをコピーまたは複製する際の設定オプションの変更</title>
   <para>
    RBDイメージを複製またはコピーする場合、デフォルトでは、その特定のイメージに設定された値もコピーされます。コピーまたは複製時にRBDイメージを変更する場合は、RBDイメージを作成または編集する場合と同様に、コピー/複製ダイアログで、更新された設定値を指定できます。この場合、コピーまたは複製するRBDイメージの値のみが設定(またはリセット)されます。この操作では、ソースRBDイメージの設定もグローバル設定も変更されません。
   </para>
   <para>
    コピー/複製時にオプションの値をリセットすることを選択した場合、そのオプションの値は、そのイメージに設定されません。つまり、親プールに値が設定されている場合、親プールに指定されたそのオプションの値が使用されます。親プールに値が設定されていない場合は、グローバルなデフォルトが使用されます。
   </para>
  </sect2>
 </sect1>
</chapter>
