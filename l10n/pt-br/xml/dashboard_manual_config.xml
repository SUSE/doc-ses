<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_manual_config.xml" version="5.0" xml:id="dashboard-initial-configuration">
 <title>Configuração manual</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>sim</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Esta seção apresenta informações avançadas para usuários que preferem definir as configurações do painel de controle manualmente na linha de comando.
 </para>
 <sect1 xml:id="dashboard-ssl">
  <title>Configurando o suporte a TLS/SSL</title>

  <para>
   Por padrão, todas as conexões HTTP com o painel de controle são protegidas com TLS/SSL. Uma conexão segura requer um certificado SSL. Você pode usar um certificado autoassinado ou gerar um certificado assinado por uma autoridade de certificação (CA, certificate authority) reconhecida.
  </para>

  <tip>
   <title>Desabilitação de SSL</title>
   <para>
    Talvez você tenha algum motivo específico para desabilitar o suporte a SSL. Por exemplo, se o painel de controle for executado por meio de um proxy que não suporta SSL.
   </para>
   <para>
    Tenha cuidado ao desabilitar o SSL, já que os <emphasis role="bold">nomes de usuário e as senhas</emphasis> serão enviados ao painel de controle <emphasis role="bold">não criptografados</emphasis>.
   </para>
   <para>
    Para desabilitar o SSL, execute:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/ssl false
</screen>
  </tip>

  <tip>
   <title>Reiniciando os processos do Ceph Manager</title>
   <para>
    Você precisará reiniciar os processos do Ceph Manager manualmente após mudar o certificado SSL e a chave. Para fazer isso, é possível executar
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph mgr fail <replaceable>ACTIVE-MANAGER-NAME</replaceable></screen>
   <para>
    ou desabilitar e habilitar novamente o módulo do painel de controle, o que também aciona o gerenciador para se reativar:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph mgr module disable dashboard
<prompt>cephuser@adm &gt; </prompt>ceph mgr module enable dashboard
</screen>
  </tip>

  <sect2 xml:id="self-sign-certificates">
   <title>Criando certificados autoassinados</title>
   <para>
    A criação de um certificado autoassinado para uma comunicação segura é simples. Dessa forma, você pode fazer com que o painel de controle seja executado rapidamente.
   </para>
   <note>
    <title>Reclamação dos browsers da Web</title>
    <para>
     A maioria dos browsers da Web reclamará de um certificado autoassinado e exigirá a confirmação explícita antes de estabelecer uma conexão segura com o painel de controle.
    </para>
   </note>
   <para>
    Para gerar e instalar um certificado autoassinado, use o seguinte comando incorporado:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard create-self-signed-cert
</screen>
  </sect2>

  <sect2 xml:id="cert-sign-CA">
   <title>Usando certificados assinados por CA</title>
   <para>
    Para proteger apropriadamente a conexão com o painel de controel e eliminar as reclamações do browser da Web por causa de um certificado autoassinado, recomendamos o uso de um certificado assinado por uma CA.
   </para>
   <para>
    Você pode gerar um par de chaves do certificado com um comando semelhante ao seguinte:
   </para>
<screen>
<prompt role="root">root # </prompt>openssl req -new -nodes -x509 \
  -subj "/O=IT/CN=ceph-mgr-dashboard" -days 3650 \
  -keyout dashboard.key -out dashboard.crt -extensions v3_ca
</screen>
   <para>
    O comando acima resulta nos arquivos <filename>dashboard.key</filename> e <filename>dashboard.crt</filename>. Após receber o arquivo <filename>dashboard.crt</filename> assinado por uma CA, habilite-o para todas as instâncias do Ceph Manager executando os seguintes comandos:
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/key -i dashboard.key
</screen>
   <tip>
    <title>Certificados diferentes para cada instância do gerenciador</title>
    <para>
     Se você precisar de certificados diferentes para cada instância do Ceph Manager, modifique os comandos e inclua o nome da instância da seguinte maneira. Substitua <replaceable>NAME</replaceable> pelo nome da instância do Ceph Manager (normalmente, o nome de host relacionado):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/crt -i dashboard.crt
<prompt>cephuser@adm &gt; </prompt>ceph config-key set mgr/dashboard/<replaceable>NAME</replaceable>/key -i dashboard.key
</screen>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-hostname-port">
  <title>Mudando nome de host e número de porta</title>

  <para>
   O Ceph Dashboard está vinculado a um endereço TCP/IP e uma porta TCP específicos. Por padrão, o Ceph Manager ativo no momento e que hospeda o painel de controle está vinculado à porta TCP 8443 (ou 8080 quando o SSL está desabilitado).
  </para>

  <note>
   <para>
    Se um firewall estiver habilitado nos hosts que executam o Ceph Manager (e, portanto, o Ceph Dashboard), talvez seja necessário mudar a configuração para habilitar o acesso a essas portas. Para obter mais informações sobre as configurações de firewall do Ceph, consulte o <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Por padrão, o Ceph Dashboard está vinculado a "::", que corresponde a todos os endereços IPv4 e IPv6 disponíveis. Você pode mudar o endereço IP e o número da porta do aplicativo Web para que eles se apliquem a todas as instâncias do Ceph Manager usando os seguintes comandos:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>

  <tip>
   <title>Configurando as instâncias do Ceph Manager separadamente</title>
   <para>
    Como cada daemon <systemitem class="daemon">ceph-mgr</systemitem> hospeda sua própria instância do painel de controle, talvez seja necessário configurá-los separadamente. Mude o endereço IP e o número da porta para uma instância específica do gerenciador usando os seguintes comandos (substitua <replaceable>NAME</replaceable> pelo ID da instância do <systemitem class="daemon">ceph-mgr</systemitem>):
   </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_addr <replaceable>IP_ADDRESS</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph config set mgr mgr/dashboard/<replaceable>NAME</replaceable>/server_port <replaceable>PORT_NUMBER</replaceable>
</screen>
  </tip>

  <tip>
   <title>Listando endpoints configurados</title>
   <para>
    O comando <command>ceph mgr services</command> exibe todos os endpoints que estão configurados. Procure a chave <literal>dashboard</literal> para obter o URL de acesso ao painel de controle.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-username-password">
  <title>Ajustando nomes de usuário e senhas</title>

  <para>
   Se você não deseja usar a conta de administrador padrão, crie uma conta de usuário diferente e associe-a a pelo menos uma função. Oferecemos um conjunto de funções de sistema predefinidas que você pode usar. Para obter mais detalhes, consulte a <xref linkend="dashboard-user-roles"/>.
  </para>

  <para>
   Para criar um usuário com privilégios de administrador, use o seguinte comando:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard ac-user-create <replaceable>USER_NAME</replaceable> <replaceable>PASSWORD</replaceable> administrator
</screen>
 </sect1>
 <sect1 xml:id="dashboard-ogw-enabling">
  <title>Habilitando o front end de gerenciamento do Gateway de Objetos</title>

  <para>
   Para usar a funcionalidade de gerenciamento do Gateway de Objetos do painel de controle, você precisa fornecer as credenciais de login de um usuário com o flag <option>system</option> habilitado:
  </para>

  <procedure>
   <step>
    <para>
     Se você não tem um usuário com o flag <option>system</option>, crie-o:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user create --uid=<replaceable>USER_ID</replaceable> --display-name=<replaceable>DISPLAY_NAME</replaceable> --system
</screen>
    <para>
     Anote as chaves <replaceable>access_key</replaceable> e <replaceable>secret_key</replaceable> na saída do comando.
    </para>
   </step>
   <step>
    <para>
     Você também pode obter as credenciais de um usuário existente usando o comando <command>radosgw-admin</command>:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>radosgw-admin user info --uid=<replaceable>USER_ID</replaceable>
</screen>
   </step>
   <step>
    <para>
     Insira as credenciais recebidas no painel de controle:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-access-key <replaceable>ACCESS_KEY</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-secret-key <replaceable>SECRET_KEY</replaceable>
</screen>
   </step>
  </procedure>

  <note>
   <para>
    Por padrão, o firewall está habilitado no SUSE Linux Enterprise Server 15 SP2. Para obter informações sobre configuração de firewall, consulte o <xref linkend="storage-bp-net-firewall"/>.
   </para>
  </note>

  <para>
   Há vários pontos a serem considerados:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     O nome de host e o número da porta do Gateway de Objetos são determinados automaticamente.
    </para>
   </listitem>
   <listitem>
    <para>
     Se várias zonas forem usadas, ele determinará automaticamente o host no grupo de zonas master e na zona master. Isso é o suficiente para a maioria das configurações. No entanto, em algumas circunstâncias, talvez você queira definir o nome de host e a porta manualmente:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-host <replaceable>HOST</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-port <replaceable>PORT</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Veja a seguir outras configurações que você pode precisar:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-scheme <replaceable>SCHEME</replaceable>  # http or https
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-admin-resource <replaceable>ADMIN_RESOURCE</replaceable>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-user-id <replaceable>USER_ID</replaceable>
</screen>
   </listitem>
   <listitem>
    <para>
     Se você usa um certificado autoassinado (<xref linkend="dashboard-ssl"/>) na configuração do Gateway de Objetos, desabilite a verificação de certificado no painel de controle para evitar conexões recusadas por causa de certificados assinados por uma CA desconhecida ou que não correspondem ao nome de host:
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rgw-api-ssl-verify False
</screen>
   </listitem>
   <listitem>
    <para>
     Se o Gateway de Objetos levar muito tempo para processar as solicitações, e se a execução do painel de controle apresentar tempo de espera, o valor do tempo de espera poderá ser ajustado (o padrão é 45 segundos):
    </para>
<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard set-rest-requests-timeout <replaceable>SECONDS</replaceable>
</screen>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="dashboard-iscsi-management">
  <title>Habilitando o gerenciamento de iSCSI</title>

  <para>
   O Ceph Dashboard gerencia destinos iSCSI usando a API REST fornecida pelo serviço <systemitem class="service">rbd-target-api</systemitem> do gateway Ceph iSCSI. Verifique se ela está instalada e habilitada nos gateways iSCSI.
  </para>

  <note>
   <para>
    A funcionalidade de gerenciamento de iSCSI do Ceph Dashboard depende da versão 3 mais recente do projeto <literal>ceph-iscsi</literal>. Verifique se o seu sistema operacional tem a versão correta; do contrário, o Ceph Dashboard não habilitará os recursos de gerenciamento.
   </para>
  </note>

  <para>
   Se a API REST do <literal>ceph-iscsi</literal> estiver configurada no modo HTTPS e usar um certificado autoassinado, configure o painel de controle para evitar a verificação do certificado SSL ao acessar a API do ceph-iscsi.
  </para>

  <para>
   Desabilite a verificação do SSL da API:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard set-iscsi-api-ssl-verification false</screen>

  <para>
   Defina os gateways iSCSI disponíveis:
  </para>

<screen><prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-list
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-add <replaceable>scheme</replaceable>://<replaceable>username</replaceable>:<replaceable>password</replaceable>@<replaceable>host</replaceable>[:port]
<prompt>cephuser@adm &gt; </prompt>ceph dashboard iscsi-gateway-rm <replaceable>gateway_name</replaceable>
</screen>
 </sect1>
 <sect1 xml:id="dashboard-sso">
  <title>Habilitando o login único</title>

  <para>
   O <emphasis>Login Único</emphasis> (SSO, Single Sign-On) é um método de controle de acesso que permite aos usuários efetuar login com ID e senha exclusivos em vários aplicativos simultaneamente.
  </para>

  <para>
   O Ceph Dashboard suporta autenticação externa de usuários por meio do protocolo SAML 2.0. Como a <emphasis>autorização</emphasis> ainda é realizada pelo painel de controle, você precisa primeiro criar as contas de usuário e associá-las às funções desejadas. No entanto, o processo de <emphasis>autenticação</emphasis> pode ser efetuado por um <emphasis>Provedor de Identidade</emphasis> (IdP, Identity Provider) existente.
  </para>

  <para>
   Para configurar o Login Único, use o seguinte comando:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso setup saml2 <replaceable>CEPH_DASHBOARD_BASE_URL</replaceable> \
 <replaceable>IDP_METADATA</replaceable> <replaceable>IDP_USERNAME_ATTRIBUTE</replaceable> \
 <replaceable>IDP_ENTITY_ID</replaceable> <replaceable>SP_X_509_CERT</replaceable> \
 <replaceable>SP_PRIVATE_KEY</replaceable>
</screen>

  <para>
   Parâmetros:
  </para>

  <variablelist>
   <varlistentry>
    <term><replaceable>CEPH_DASHBOARD_BASE_URL</replaceable></term>
    <listitem>
     <para>
      URL de base para acessar o Ceph Dashboard (por exemplo, “https://cephdashboard.local”).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_METADATA</replaceable></term>
    <listitem>
     <para>
      URL, caminho de arquivo ou conteúdo do XML de metadados do IdP (por exemplo, “https://myidp/metadata”).
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_USERNAME_ATTRIBUTE</replaceable></term>
    <listitem>
     <para>
      Opcional. Atributo que será usado para obter o nome de usuário da resposta de autenticação. O padrão “uid” é usado.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>IDP_ENTITY_ID</replaceable></term>
    <listitem>
     <para>
      Opcional. Use quando há mais de um ID de entidade nos metadados do IdP.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><replaceable>SP_X_509_CERT</replaceable>/<replaceable>SP_PRIVATE_KEY</replaceable></term>
    <listitem>
     <para>
      Opcional. Caminho de arquivo ou conteúdo do certificado que será usado pelo Ceph Dashboard (Provedor de Serviços) para assinatura e criptografia.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>Solicitações SAML</title>
   <para>
    O valor do emissor das solicitações SAML seguirá este padrão:
   </para>
<screen>
<replaceable>CEPH_DASHBOARD_BASE_URL</replaceable>/auth/saml2/metadata
</screen>
  </note>

  <para>
   Para exibir a configuração atual do SAML 2.0, execute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso show saml2
</screen>

  <para>
   Para desabilitar o Login Único, execute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso disable
</screen>

  <para>
   Para verificar se o SSO está habilitado, execute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso status
</screen>

  <para>
   Para habilitar o SSO, execute:
  </para>

<screen>
<prompt>cephuser@adm &gt; </prompt>ceph dashboard sso enable saml2
</screen>
 </sect1>
</chapter>
