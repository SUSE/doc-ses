<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="dashboard_rbds.xml" version="5.0" xml:id="dashboard-rbds">
 <title>Verwalten von RADOS-Blockgeräten</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>Ja</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Klicken Sie zum Auflisten aller verfügbaren RADOS-Blockgeräte (RBDs) im Hauptmenü auf <menuchoice><guimenu>Block</guimenu><guimenu>Images</guimenu></menuchoice>.
 </para>
 <para>
  In der Liste werden kurze Informationen über das Gerät angezeigt, wie der Name des Geräts, der zugehörige Poolname, der Namespace, die Größe des Geräts, die Anzahl und Größe der Objekte auf dem Gerät, Details zur Bereitstellung der Details sowie das übergeordnete Gerät.
 </para>
 <figure>
  <title>Liste der RBD-Images</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="dash_rbd_images.png" width="100%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>
 <sect1 xml:id="dashboard-rbds-details">
  <title>Anzeigen von Details zu RBDs</title>

  <para>
   Zum Abrufen ausführlicher Informationen zu einem Gerät klicken Sie auf dessen Zeile in der Tabelle:
  </para>

  <figure>
   <title>RBD-Details</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_details.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-configuration">
  <title>Anzeigen der RBD-Konfiguration</title>

  <para>
   Zum Abrufen der ausführlichen Konfiguration eines Geräts klicken Sie auf dessen Zeile in der Tabelle und dann in der unteren Tabelle auf die Registerkarte <guimenu>Konfiguration</guimenu>:
  </para>

  <figure>
   <title>RBD-Konfiguration</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_config.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dashboard-rbds-create">
  <title>Erstellen von RBDs</title>

  <para>
   Klicken Sie zum Hinzufügen eines neuen Geräts oben links in der Tabellenüberschrift auf <guimenu>Erstellen</guimenu> und verfahren Sie im Bildschirm <guimenu>RBD erstellen</guimenu> folgendermaßen:
  </para>

  <figure>
   <title>Hinzufügen eines neuen RBD</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="oa_rbd_add.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <procedure>
   <step>
    <para>
     Geben Sie den Namen des neuen Geräts ein. Informationen zu Benennungseinschränkungen finden Sie im <xref linkend="sysreq-naming"/>.
    </para>
   </step>
   <step>
    <para>
     Wählen Sie den Pool mit der zugewiesenen <option>rbd</option>-Anwendung aus, von dem aus das neue RBD-Gerät erstellt werden soll.
    </para>
   </step>
   <step>
    <para>
     Geben Sie die Größe des neuen Geräts an.
    </para>
   </step>
   <step>
    <para>
     Legen Sie zusätzliche Optionen für das Gerät fest. Zum Abstimmen der Geräteparameter klicken Sie auf <guimenu>Erweitert</guimenu> und geben Sie Werte für die Objektgröße, die Stripe-Einheit oder die Stripe-Anzahl ein. Sollen Grenzwerte für Quality of Service (QoS) festgelegt werden, klicken Sie auf <guimenu>Quality of Service</guimenu> und geben Sie die Werte ein.
    </para>
   </step>
   <step>
    <para>
     Bestätigen Sie mit <guimenu>RBD erstellen</guimenu>.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="dashboard-rbd-delete">
  <title>Löschen von RBDs</title>

  <para>
   Wählen Sie ein zu löschendes Gerät in der Tabellenzeile aus. Klicken Sie auf den Dropdown-Pfeil neben der Schaltfläche <guimenu>Erstellen</guimenu> und dann auf <guimenu>Löschen</guimenu>. Bestätigen Sie den Löschvorgang mit <guimenu>RBD löschen</guimenu>.
  </para>

  <tip>
   <title>Verschieben von RBDs in den Papierkorb</title>
   <para>
    Das Löschen eines RBDs kann nicht rückgängig gemacht werden. Wenn Sie stattdessen die Option <guimenu>In Papierkorb verschieben</guimenu> wählen, können Sie das Gerät später wiederherstellen. Wählen Sie das Gerät hierzu auf der Registerkarte <guimenu>Papierkorb</guimenu> der Haupttabelle aus und klicken Sie oben links in der Tabellenüberschrift auf <guimenu>Wiederherstellen</guimenu>.
   </para>
  </tip>
 </sect1>
 <sect1 xml:id="dashboard-rbds-snapshots">
  <title>Erstellen von Snapshots von RADOS-Blockgeräten</title>

  <para>
   Wählen Sie zum Erstellen eines RBD-Snapshots das Gerät in der Tabellenzeile aus, und das Inhaltsfenster für die detaillierte Konfiguration erscheint. Wählen Sie den Karteireiter <guimenu>Snapshots</guimenu> aus und klicken Sie oben links in der Tabellenüberschrift auf <guimenu>Erstellen</guimenu>. Geben Sie den Namen des Snapshots ein und bestätigen Sie mit <guimenu>RBD-Snapshot erstellen</guimenu>.
  </para>

  <para>
   Wenn Sie einen Snapshot ausgewählt haben, können Sie weitere Aktionen für das Gerät durchführen, z. B. Umbenennen, Schützen, Klonen, Kopieren oder Löschen. Mit <guimenu>Rollback</guimenu> wird der Zustand des Geräts vom aktuellen Snapshot wiederhergestellt.
  </para>

  <figure>
   <title>RBD-Snapshots</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_rbd_images_snapshots.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="dash-rbd-mirror">
  <title>RBD-Spiegelung</title>

  <para>
   RBD-Images können asynchron zwischen zwei Ceph-Clustern gespiegelt werden. Mit dem Ceph Dashboard können Sie die Reproduktion von RBD-Images zwischen mindestens zwei Clustern konfigurieren. Diese Funktion ist in zwei Modi verfügbar:
  </para>

  <variablelist>
   <varlistentry>
    <term>Journal-basiert</term>
    <listitem>
     <para>
      Bei diesem Modus wird die Funktion des RBD-Journaling-Images verwendet, um die absturzkonsistente Reproduktion zwischen Clustern sicherzustellen.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Snapshot-basiert</term>
    <listitem>
     <para>
      Dieser Modus verwendet periodisch geplante oder manuell erstellte RBD-Image-Spiegel-Snapshots, um absturzsichere RBD-Images zwischen Clustern zu reproduzieren.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Die Spiegelung wird innerhalb von Peer-Clustern pro Pool konfiguriert. Sie kann für eine bestimmte Untergruppe von Images innerhalb des Pools konfiguriert werden oder so, dass alle Images innerhalb eines Pools automatisch gespiegelt werden, wenn nur die Journal-basierte Spiegelung verwendet wird.
  </para>

  <para>
   Die Spiegelung wird mit dem Kommando <command>rbd</command> konfiguriert, das standardmäßig in SUSE Enterprise Storage 7 installiert ist. Der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon ist dafür zuständig, Image-Aktualisierungen aus dem Remote-Peer-Cluster zu entnehmen und sie auf das Image im lokalen Cluster anzuwenden. In <xref linkend="rbd-mirror-daemon-enable"/> finden Sie weitere Informationen zum Aktivieren des <systemitem class="daemon">rbd-mirror</systemitem>-Daemons.
  </para>

  <para>
   Abhängig von den gewünschten Anforderungen an die Reproduktion kann die RBD-Spiegelung entweder für eine einseitige oder für eine zweiseitige Reproduktion konfiguriert werden:
  </para>

  <variablelist>
   <varlistentry>
    <term>Einseitige Reproduktion</term>
    <listitem>
     <para>
      Wenn Daten nur von einem primären Cluster auf einen sekundären Cluster gespiegelt werden, läuft der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon nur auf dem sekundären Cluster.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Zweiseitige Reproduktion</term>
    <listitem>
     <para>
      Wenn Daten von primären Images auf einem Cluster auf nicht primäre Images auf einem anderen Cluster gespiegelt werden (und umgekehrt), wird der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon auf beiden Clustern ausgeführt.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <important>
   <para>
    Jede Instanz des <systemitem class="daemon">rbd-mirror</systemitem>-Daemons muss in der Lage sein, sich gleichzeitig mit dem lokalen und dem entfernten Ceph-Cluster zu verbinden, zum Beispiel mit allen Monitor- und OSD-Hosts. Außerdem muss das Netzwerk über eine ausreichende Bandbreite zwischen den beiden Rechenzentren verfügen, um die Spiegelung des Workloads zu bewältigen.
   </para>
  </important>

  <tip>
   <title>Allgemeine Informationen</title>
   <para>
    Allgemeine Informationen und Anweisungen für die RADOS-Block-Device-Spiegelung über die Kommandozeile finden Sie in <xref linkend="ceph-rbd-mirror"/>.
   </para>
  </tip>

  <sect2 xml:id="rbd-mirror-primary-secondary">
   <title>Konfigurieren von primären und sekundären Clustern</title>
   <para>
    Im <emphasis>primären</emphasis> Cluster wird der ursprüngliche Pool mit Images erstellt. Im <emphasis>sekundären</emphasis> Cluster werden der Pool oder die Images aus dem <emphasis>primären</emphasis> Cluster reproduziert.
   </para>
   <note>
    <title>Relative Namen</title>
    <para>
     Die Bezeichnungen <emphasis>primär</emphasis> und <emphasis>sekundär</emphasis> sind im Zusammenhang mit der Reproduktion relativ, da sie sich eher auf einzelne Pools als auf Cluster beziehen. Bei einer bidirektionalen Reproduktion kann ein Pool beispielsweise aus dem <emphasis>primären</emphasis> in den <emphasis>sekundären</emphasis> Cluster gespiegelt werden, während ein anderer Pool aus dem <emphasis>sekundären</emphasis> in den <emphasis>primären</emphasis> Cluster gespiegelt wird.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="rbd-mirror-daemon-enable">
   <title>Konfigurieren des <systemitem class="daemon">rbd-mirror</systemitem>-Daemons</title>
   <para>
    Die folgenden Verfahren zeigen, wie einfache Verwaltungsaufgaben zum Konfigurieren der Spiegelung mit dem <command>rbd</command>-Kommando ausgeführt werden. Die Spiegelung wird pro Pool in den Ceph-Clustern konfiguriert.
   </para>
   <para>
    Die Schritte der Pool-Konfiguration sollten auf beiden Peer-Clustern durchgeführt werden. Bei diesen Verfahren wird der Einfachheit halber angenommen, dass von einem einzelnen Host aus auf zwei Cluster (den „primären“ und den „sekundären“) zugegriffen werden kann.
   </para>
   <para>
    Der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon führt die eigentliche Cluster-Datenreproduktion durch.
   </para>
   <procedure>
    <step>
     <para>
      Benennen Sie die Datei <filename>ceph.conf</filename> und die Schlüsselbunddatei um und kopieren Sie sie vom primären Host auf den sekundären Host:
     </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.conf /etc/ceph/primary.conf
<prompt>cephuser@secondary &gt; </prompt>cp /etc/ceph/ceph.admin.client.keyring \
 /etc/ceph/primary.client.admin.keyring
<prompt>cephuser@secondary &gt; </prompt>scp <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.conf \
 /etc/ceph/secondary.conf
<prompt>cephuser@secondary &gt; </prompt>scp  <replaceable>PRIMARY_HOST</replaceable>:/etc/ceph/ceph.client.admin.keyring \
 /etc/ceph/secondary.client.admin.keyring
</screen>
    </step>
    <step>
     <para>
      Geben Sie zum Aktivieren der Spiegelung in einem Pool mit <command>rbd</command> das Kommando <command>mirror pool enable</command>, den Poolnamen und den Spiegelungsmodus an:
     </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool enable <replaceable>POOL_NAME</replaceable> <replaceable>MODE</replaceable></screen>
     <note>
      <para>
       Der Spiegelungsmodus kann entweder <literal>Image</literal> oder <literal>Pool</literal> lauten. Beispiel:
      </para>
<screen>
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster primary mirror pool enable image-pool image
<prompt>cephuser@secondary &gt; </prompt>rbd --cluster secondary mirror pool enable image-pool image
</screen>
     </note>
    </step>
    <step>
     <para>
      Navigieren Sie im Ceph Dashboard zu <menuchoice><guimenu>Block</guimenu><guimenu>Spiegelung</guimenu></menuchoice>. Die Tabelle <guimenu>Daemons</guimenu> links zeigt die aktiv ausgeführten <systemitem class="daemon">rbd-mirror</systemitem>-Daemons und ihren Zustand.
     </para>
     <figure>
      <title>Ausführen von <systemitem class="daemon">rbd-mirror</systemitem>-Daemons</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-daemon.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-disable">
   <title>Deaktivieren der Spiegelung</title>
   <para>
    Geben Sie zum Deaktivieren der Spiegelung in einem Pool mit <command>rbd</command> das Kommando <command>mirror pool disable</command> und den Poolnamen an:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool disable <replaceable>POOL_NAME</replaceable></screen>
   <para>
    Wenn die Spiegelung auf diese Weise in einem Pool deaktiviert wird, dann wird sie auch in anderen Images (im Pool) deaktiviert, für die eine Spiegelung explizit aktiviert wurde.
   </para>
  </sect2>

  <sect2 xml:id="rbd-mirror-peer-bootstrap">
   <title>Bootstrapping von Peers</title>
   <para>
    Damit der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon seinen Peer-Cluster erkennen kann, muss der Peer im Pool registriert und ein Benutzerkonto erstellt werden. Dieser Vorgang kann mit <command>rbd</command> und den Kommandos <command>mirror pool peer bootstrap create</command> und <command>mirror pool peer bootstrap import</command> automatisiert werden.
   </para>
   <para>
    Geben Sie zum Erstellen eines neues Bootstrap-Tokens mit <command>rbd</command> das Kommando <command>mirror pool peer bootstrap create</command>, einen Pool-Namen sowie einen optionalen Namen für den Standort zur Beschreibung des lokalen Clusters an:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap create [--site-name <replaceable>local-site-name</replaceable>] <replaceable>pool-name</replaceable></screen>
   <para>
    Die Ausgabe von <command>mirror pool peer bootstrap create</command> ist ein Token, das dem Kommando <command>mirror pool peer bootstrap import</command> übergeben werden sollte, beispielsweise am primären Cluster:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd --cluster primary mirror pool peer bootstrap create --site-name primary
  image-pool eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkL \
  W1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1vbl9ob3N0I \
  joiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==</screen>
   <para>
    Geben Sie zum manuellen Importieren des von einem anderen Cluster erstellten Bootstrap-Tokens mit dem Kommando <command>rbd</command> das Kommando <command>mirror pool peer bootstrap import</command>, den Poolnamen, einen Dateipfad zum erstellten Token (oder „-“, um von der Standardeingabe zu lesen) sowie einen optionalen Standortnamen zur Beschreibung des lokalen Clusters sowie eine Spiegelungsrichtung an (standardmäßig <literal>rx-tx</literal> für eine bidirektionale Spiegelung, kann aber auch auf <literal>rx-only</literal> für eine unidirektionale Spiegelung festgelegt werden):
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer bootstrap import [--site-name <replaceable>local-site-name</replaceable>] \
[--direction <replaceable>rx-only or rx-tx</replaceable>] <replaceable>pool-name</replaceable> <replaceable>token-path</replaceable></screen>
   <para>
    Beispielsweise am sekundären Cluster:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>cat &gt;&gt;EOF &lt; token
eyJmc2lkIjoiOWY1MjgyZGItYjg5OS00NTk2LTgwOTgtMzIwYzFmYzM5NmYzIiwiY2xpZW50X2lkIjoicmJkLW \
1pcnJvci1wZWVyIiwia2V5IjoiQVFBUnczOWQwdkhvQmhBQVlMM1I4RmR5dHNJQU50bkFTZ0lOTVE9PSIsIm1v \
bl9ob3N0IjoiW3YyOjE5Mi4xNjguMS4zOjY4MjAsdjE6MTkyLjE2OC4xLjM6NjgyMV0ifQ==
EOF
<prompt>cephuser@adm &gt; </prompt>rbd --cluster secondary mirror pool peer bootstrap import --site-name secondary image-pool token</screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-remove-peers">
   <title>Entfernen des Cluster-Peers</title>
   <para>
    Geben Sie zum Entfernen eines Ceph-Peer-Clusters für die Spiegelung mit dem Kommando <command>rbd</command> das Kommando <command>mirror pool peer remove</command>, den Poolnamen und die Peer-UUID (verfügbar über das Kommando <command>rbd mirror pool info</command>) an:
   </para>
<screen><prompt>cephuser@adm &gt; </prompt>rbd mirror pool peer remove <replaceable>pool-name</replaceable> <replaceable>peer-uuid</replaceable></screen>
  </sect2>

  <sect2 xml:id="rbd-mirror-gui-config">
   <title>Konfigurieren der Pool-Reproduktion im Ceph Dashboard</title>
   <para>
    Der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon benötigt Zugriff auf den primären Cluster, damit die RBD-Images gespiegelt werden können. Stellen Sie sicher, dass Sie die Schritte in <xref linkend="rbd-mirror-peer-bootstrap"/> befolgt haben, bevor Sie fortfahren.
   </para>
   <procedure>
    <step>
     <para>
      Erstellen Sie sowohl auf dem <emphasis>primären</emphasis> als auch auf dem <emphasis>sekundären</emphasis> Cluster Pools mit demselben Namen und weisen Sie ihnen die Anwendung <literal>rbd</literal> zu. Weitere Informationen zum Erstellen eines neuen Pools finden Sie in <xref linkend="dashboard-pools-create"/>.
     </para>
     <figure>
      <title>Erstellen eines Pools mit der RBD-Anwendung</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Navigieren Sie im Dashboard des <emphasis>primären</emphasis> und des <emphasis>sekundären</emphasis> Clusters zu <menuchoice><guimenu>Block</guimenu><guimenu>Spiegelung</guimenu></menuchoice>. Klicken Sie in der Tabelle <guimenu>Pools</guimenu> rechts auf den Namen des zu reproduzierenden Pools und dann auf <guimenu>Bearbeitungsmodus</guimenu> und wählen Sie den Reproduktionsmodus aus. In diesem Beispiel wird der <emphasis>Pool</emphasis>-Reproduktionsmodus herangezogen, bei dem alle Images in einem bestimmten Pool reproduziert werden. Bestätigen Sie mit <guimenu>Aktualisieren</guimenu>.
     </para>
     <figure>
      <title>Konfigurieren des Reproduktionsmodus</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-mode.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <important>
      <title>Fehler oder Warnung im primären Cluster</title>
      <para>
       Nach dem Aktualisieren des Reproduktionsmodus wird eine Fehler- oder Warnflagge in der entsprechenden rechten Spalte angezeigt. Der Grund hierfür ist, dass dem Pool bislang noch kein Peer-Benutzer für die Reproduktion zugewiesen wurde. Ignorieren Sie diese Flagge im <emphasis>primären</emphasis> Cluster, da der Peer-Benutzer ausschließlich im <emphasis>sekundären</emphasis> Cluster zugewiesen wird.
      </para>
     </important>
    </step>
    <step>
     <para>
      Navigieren Sie im Dashboard des <emphasis>sekundären</emphasis> Clusters zu <menuchoice><guimenu>Block</guimenu><guimenu>Spiegelung</guimenu></menuchoice>. Wählen Sie <guimenu>Peer hinzufügen</guimenu> aus, um einen Pool-Spiegel-Peer hinzuzufügen. Geben Sie die Details für den <emphasis>primären</emphasis> Cluster an:
     </para>
     <figure>
      <title>Hinzufügen des Peer-Berechtigungsnachweises</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-peer.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <variablelist>
      <varlistentry>
       <term><guimenu>Clustername</guimenu></term>
       <listitem>
        <para>
         Eine willkürliche, eindeutige Zeichenkette, die den primären Cluster identifiziert, z. B. „primary“. Der Cluster-Name darf nicht mit dem tatsächlichen Namen des sekundären Clusters übereinstimmen.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephX-ID</guimenu></term>
       <listitem>
        <para>
         Die Ceph-Benutzer-ID, die Sie als Spiegelungs-Peer erstellt haben. In diesem Beispiel lautet sie „rbd-mirror-peer“.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Adressen der Monitore</guimenu></term>
       <listitem>
        <para>
         Kommagetrennte Liste von IP-Adressen der Ceph Monitor-Knoten des primären Clusters.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>CephX-Schlüssel</guimenu></term>
       <listitem>
        <para>
         Schlüssel für die Peer-Benutzer-ID. Zum Abrufen führen Sie folgendes (Beispiel-)Kommando im primären Cluster aus:
        </para>
<screen><prompt>cephuser@adm &gt; </prompt>ceph auth print_key <replaceable>pool-mirror-peer-name</replaceable></screen>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Bestätigen Sie mit <guimenu>Absenden</guimenu>.
     </para>
     <figure>
      <title>Liste der reproduzierten Pools</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="rbd-mirror-test">
   <title>Prüfen der Funktionsfähigkeit der RBD-Image-Reproduktion</title>
   <para>
    Wenn der <systemitem class="daemon">rbd-mirror</systemitem>-Daemon ausgeführt wird und die RBD-Image-Reproduktion im Ceph Dashboard konfiguriert ist, können Sie prüfen, ob die Reproduktion tatsächlich funktioniert:
   </para>
   <procedure>
    <step>
     <para>
      Erstellen Sie im Ceph Dashboard des <emphasis>primären</emphasis> Clusters ein RBD-Image und geben Sie den Pool, den Sie bereits für die Reproduktion erstellt haben, als dessen übergeordneten Pool an. Aktivieren Sie die Funktionen <option>Exklusive Sperre</option> und <option>Journaling</option> für das Image. Weitere Informationen zum Erstellen von RBD-Images finden Sie in <xref linkend="dashboard-rbds-create"/>.
     </para>
     <figure>
      <title>Neues RBD-Image</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-image.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Sobald Sie das zu reproduzierende Image erstellt haben, öffnen Sie das Ceph Dashboard im <emphasis>sekundären</emphasis> Cluster und navigieren Sie zu <menuchoice><guimenu>Block</guimenu><guimenu>Spiegelung</guimenu></menuchoice>. Die Tabelle <guimenu>Pools</guimenu> rechts zeigt die Veränderung in der Anzahl der <guimenu># remote</guimenu>-Images und die Anzahl der <guimenu># lokalen</guimenu> Images wird synchronisiert.
     </para>
     <figure>
      <title>Synchronisiertes neues RBD-Image</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="rbd-mirror-pool-list-1.png" width="100%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <tip>
      <title>Reproduktionsprozess</title>
      <para>
       Die Tabelle <guimenu>Images</guimenu> unten auf der Seite zeigt den Reproduktionsstatus der RBD-Images. Auf der Registerkarte <guimenu>Probleme</guimenu> werden eventuelle Probleme angezeigt, die Registerkarte <guimenu>Wird synchronisiert</guimenu> zeigt den Fortschritt der Image-Reproduktion und die Registerkarte <guimenu>Fertig</guimenu> enthält alle Images mit erfolgreicher Reproduktion.
      </para>
      <figure>
       <title>Reproduktionsstatus der RBD-Images</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="rbd-mirror-images-status.png" width="100%"/>
        </imageobject>
       </mediaobject>
      </figure>
     </tip>
    </step>
    <step>
     <para>
      Schreiben Sie im <emphasis>primären</emphasis> Cluster Daten in das RBD-Image. Navigieren Sie im Ceph Dashboard des <emphasis>sekundären</emphasis> Clusters zu <menuchoice><guimenu>Block</guimenu><guimenu>Images</guimenu></menuchoice> und prüfen Sie, ob die Größe des entsprechenden Images wächst, während die Daten im primären Cluster geschrieben werden.
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="dashboard-iscsi">
  <title>Verwalten von iSCSI Gateways</title>

  <tip>
   <title>Weitere Informationen zu iSCSI-Gateways</title>
   <para>
    Weitere Informationen zu iSCSI-Gateways finden Sie in <xref linkend="cha-ceph-iscsi"/>.
   </para>
  </tip>

  <para>
   Klicken Sie zum Auflisten aller verfügbaren Gateways und zugeordneten Images im Hauptmenü auf <menuchoice><guimenu>Block</guimenu><guimenu>iSCSI</guimenu></menuchoice>. Die Registerkarte <guimenu>Übersicht</guimenu> mit einer Liste der derzeit konfigurierten iSCSI-Gateways und zugeordneten RBD-Images wird geöffnet.
  </para>

  <para>
   Die Tabelle <guimenu>Gateways</guimenu> enthält den Status der einzelnen Gateways, die Anzahl der iSCSI-Ziele und die Anzahl der Sitzungen. Die Tabelle <guimenu>Images</guimenu> enthält den Namen der einzelnen zugeordneten Images, den Backstore-Typ des zugehörigen Pool-Namens und weitere statistische Daten.
  </para>

  <para>
   Die Registerkarte <guimenu>Ziele</guimenu> enthält eine Liste der derzeit konfigurierten iSCSI-Ziele.
  </para>

  <figure>
   <title>Liste der iSCSI-Ziele</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Klicken Sie zum Anzeigen detaillierterer Informationen über ein Ziel auf den Dropdown-Pfeil in der Tabellenzeile des Ziels. Eine Baumstruktur mit den Datenträgern, Portalen, Initiatoren und Gruppen wird geöffnet. Wenn Sie auf ein Element klicken, wird es erweitert und sein Inhalt wird angezeigt, optional mit einer zugehörigen Konfiguration in der Tabelle rechts.
  </para>

  <figure>
   <title>Details zu iSCSI-Zielen</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="dash_igws_status.png" width="100%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <sect2 xml:id="dashboard-iscsi-create">
   <title>Hinzufügen von iSCSI-Zielen</title>
   <para>
    Klicken Sie zum Hinzufügen eines neuen iSCSI-Ziels links oben in der Tabelle <guimenu>Ziele</guimenu> auf <guimenu>Erstellen</guimenu> und geben Sie die erforderlichen Informationen ein.
   </para>
   <figure>
    <title>Hinzufügen eines neuen Ziels</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="dash_igws_add.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
    <step>
     <para>
      Geben Sie die Zieladresse des neuen Gateways ein.
     </para>
    </step>
    <step>
     <para>
      Klicken Sie auf <guimenu>Portal hinzufügen</guimenu> und wählen Sie ein oder mehrere iSCSI-Portale aus der Liste aus.
     </para>
    </step>
    <step>
     <para>
      Klicken Sie auf <guimenu>Image hinzufügen</guimenu> und wählen Sie ein oder mehrere RBD-Images für das Gateway aus.
     </para>
    </step>
    <step>
     <para>
      Wenn Sie für den Zugriff auf das Gateway eine Authentifizierung verwenden müssen, aktivieren Sie das Kontrollkästchen <guimenu>ACL-Authentifizierung</guimenu> und geben Sie den Berechtigungsnachweis ein. Weitere erweiterte Authentifizierungsoptionen finden Sie nach Aktivieren von <guimenu>Mutual authentication</guimenu> (Gegenseitige Authentifizierung) und <guimenu>Discovery authentication</guimenu> (Ermittlungsauthentifizierung).
     </para>
    </step>
    <step>
     <para>
      Bestätigen Sie mit <guimenu>Ziel erstellen</guimenu>.
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-edit">
   <title>Bearbeiten von iSCSI-Zielen</title>
   <para>
    Zum Bearbeiten eines vorhandenen iSCSI-Ziels klicken Sie auf dessen Zeile in der Tabelle <guimenu>Ziele</guimenu> und dann oben links in der Tabelle auf <guimenu>Bearbeiten</guimenu>.
   </para>
   <para>
    Sie können dann das iSCSI-Ziel bearbeiten, Portale hinzufügen oder löschen und entsprechende RBD-Images hinzufügen oder löschen. Außerdem haben Sie die Möglichkeit, die Authentifizierungsoptionen für das Gateway anzupassen.
   </para>
  </sect2>

  <sect2 xml:id="dashboard-iscsi-delete">
   <title>Löschen von iSCSI-Zielen</title>
   <para>
    Wählen Sie zum Löschen eines iSCSI-Ziels die Tabellenzeile aus, klicken Sie auf den Dropdown-Pfeil neben der Schaltfläche <guimenu>Bearbeiten</guimenu> und wählen Sie <guimenu>Löschen</guimenu> aus. Aktivieren Sie <guimenu>Ja, ich bin sicher</guimenu> und bestätigen Sie mit <guimenu>iSCSI-Ziel löschen</guimenu>.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="dash-rbd-qos">
  <title>RBD-Quality-of-Service (QoS)</title>

  <tip>
   <title>Weitere Informationen</title>
   <para>
    Allgemeine Informationen und eine Beschreibung der RBD-QoS-Konfigurationsoptionen finden Sie in <xref linkend="rbd-qos"/>.
   </para>
  </tip>

  <para>
   Die QoS-Optionen können auf verschiedenen Ebenen konfiguriert werden.
  </para>

  <itemizedlist>
   <listitem>
    <para>
     global
    </para>
   </listitem>
   <listitem>
    <para>
     für einzelne Pools
    </para>
   </listitem>
   <listitem>
    <para>
     für einzelne Images
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Die <emphasis>globale</emphasis> Konfiguration befindet sich an oberster Stelle in der Liste und wird für alle neu erstellten RBD-Images herangezogen, außerdem für alle Images, in denen diese Werte in der Pool- oder RBD-Image-Schicht nicht überschrieben werden. Ein global festgelegter Optionswert kann für einzelne Pools oder Images überschrieben werden. Die für einen Pool festgelegten Optionen werden für alle RBD-Images dieses Pools übernommen, sofern sie nicht von einer Konfigurationsoption in einem Image überschrieben werden. Die für ein Image festgelegten Optionen überschreiben die für einen Pool festgelegten Optionen sowie die global festgelegten Optionen.
  </para>

  <para>
   Auf diese Weise können Sie globale Standardwerte definieren, für alle RBD-Images eines bestimmten Pools anpassen und dann die Poolkonfiguration für einzelne RBD-Images überschreiben.
  </para>

  <sect2 xml:id="dash-rbd-qos-global">
   <title>Globale Konfiguration von Optionen</title>
   <para>
    Wählen Sie für die globale Konfiguration von RBD-Optionen im Hauptmenü <menuchoice><guimenu>Cluster</guimenu>
    <guimenu>Konfiguration</guimenu></menuchoice> aus.
   </para>
   <procedure>
    <step>
     <para>
      Wählen Sie zum Auflisten aller verfügbaren globalen Konfigurationsoptionen neben <menuchoice><guimenu>Ebene</guimenu></menuchoice> die Option <menuchoice><guimenu>Erweitert</guimenu></menuchoice> aus dem Dropdown-Menü.
     </para>
    </step>
    <step>
     <para>
      Filtern Sie im Suchfeld die Ergebnisse der Tabelle nach <literal>rbd_qos</literal>. Damit wird eine Liste aller verfügbaren Konfigurationsoptionen für QoS angezeigt.
     </para>
    </step>
    <step>
     <para>
      Klicken Sie zum Ändern eines Werts auf dessen Tabellenzeile und wählen Sie dann oben links in der Tabelle <guimenu>Bearbeiten</guimenu> aus. Das Dialogfeld <guimenu>Bearbeiten</guimenu> enthält sechs Felder für die Eingabe von Werten. Die RBD-Konfigurationsoptionswerte müssen im Textfeld <guimenu>mgr</guimenu> angegeben werden.
     </para>
     <note>
      <para>
       Im Gegensatz zu anderen Dialogfeldern können Sie den Wert in diesem Dialogfeld nicht in bequemen Einheiten angeben. Sie müssen ihn entweder in Byte oder in IOPS angeben, je nach bearbeiteter Option.
      </para>
     </note>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-create">
   <title>Konfigurieren von Optionen für einen neuen Pool</title>
   <para>
    Zum Erstellen eines neuen Pools und zum Konfigurieren von RBD-Konfigurationsoptionen klicken Sie auf <menuchoice><guimenu>Pools</guimenu>
    <guimenu>Erstellen</guimenu></menuchoice>. Wählen Sie den Pooltyp <guimenu>replicated</guimenu> aus. Ergänzen Sie den Pool dann mit dem Anwendungs-Tag <literal>rbd</literal>, damit Sie die RBD-QoS-Optionen konfigurieren können.
   </para>
   <note>
    <para>
     Bei einem Pool mit Löschcodierung können keine RBD-QoS-Konfigurationsoptionen konfiguriert werden. Zum Konfigurieren der RBD-QoS-Optionen für Pools mit Löschcodierung müssen Sie den reproduzierten Metadaten-Pool eines RBD-Images bearbeiten. Die Konfiguration wird dann für den Daten-Pool mit Löschcodierung dieses Images übernommen.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-pool-edit">
   <title>Konfigurieren von Optionen für einen vorhandenen Pool</title>
   <para>
    Zum Konfigurieren von RBD-QoS-Optionen für einen vorhandenen Pool klicken Sie auf <guimenu>Pools</guimenu>, dann auf die Tabellenzeile des Pools und dann oben links in der Tabelle auf <guimenu>Bearbeiten</guimenu>.
   </para>
   <para>
    Im Dialogfeld wird der Abschnitt <guimenu>RBD-Konfiguration</guimenu> angezeigt, gefolgt vom Abschnitt <guimenu>Quality of Service</guimenu>.
   </para>
   <note>
    <para>
     Wenn weder der Abschnitt <guimenu>RBD-Konfiguration</guimenu> noch der Abschnitt <guimenu>Quality of Service</guimenu> angezeigt wird, bearbeiten Sie entweder einen Pool mit <emphasis>Löschcodierung</emphasis>, bei dem keine RBD-Konfigurationsoptionen festgelegt werden können, oder der Pool ist nicht für die Verwendung durch RBD-Images konfiguriert. Im letzteren Fall weisen Sie dem Pool das Anwendungs-Tag <guimenu>rbd</guimenu> zu; hiermit werden die entsprechenden Konfigurationsabschnitte angezeigt.
    </para>
   </note>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-qos">
   <title>Konfigurationsoptionen</title>
   <para>
    Erweitern Sie die Konfigurationsoptionen mit <guimenu>Quality of Service +</guimenu>. Eine Liste aller verfügbaren Optionen wird angezeigt. Die Einheiten der Konfigurationsoptionen werden bereits in den Textfeldern angezeigt. Bei Optionen mit Byte pro Sekunde (BPS) können Sie Abkürzungen wie „1M“ oder „5G“ eingeben. Diese werden automatisch in „1 MB/s“ bzw. „5 GB/s“ umgewandelt.
   </para>
   <para>
    Mit der Schaltfläche zum Zurücksetzen rechts neben den einzelnen Textfeldern können Sie die für den Pool festgelegten Werte entfernen. Die Konfigurationswerte für global konfigurierte Optionen oder für RBD-Images werden hiermit nicht entfernt.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-create">
   <title>Erstellen von RBD-QoS-Optionen mit einem neuen RBD-Image</title>
   <para>
    Zum Erstellen eines RBD-Images und zum Festlegen von RBD-QoS-Optionen für dieses Image klicken Sie auf <menuchoice><guimenu>Block</guimenu> <guimenu>Images</guimenu></menuchoice> und dann auf <guimenu>Erstellen</guimenu>. Klicken Sie auf <guimenu>Erweitert...</guimenu>, um den Abschnitt mit der erweiterten Konfiguration zu maximieren. Öffnen Sie alle verfügbaren Konfigurationsoptionen mit <guimenu>Quality of Service +</guimenu>.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-edit">
   <title>Bearbeiten von RBD-QoS-Optionen für vorhandene Images</title>
   <para>
    Zum Bearbeiten von RBD-QoS-Optionen für ein vorhandenes Image wählen Sie <menuchoice><guimenu>Block</guimenu>
    <guimenu>Images</guimenu></menuchoice>, klicken auf die Tabellenzeile des Pools und schließlich auf <guimenu>Bearbeiten</guimenu>. Das Dialogfeld „Bearbeiten“ wird geöffnet. Klicken Sie auf <guimenu>Erweitert...</guimenu>, um den Abschnitt mit der erweiterten Konfiguration zu maximieren. Öffnen Sie alle verfügbaren Konfigurationsoptionen mit <guimenu>Quality of Service +</guimenu>.
   </para>
  </sect2>

  <sect2 xml:id="dash-rbd-qos-image-copy">
   <title>Ändern von Konfigurationsoptionen beim Kopieren oder Klonen von Images</title>
   <para>
    Wenn ein RBD-Image geklont oder kopiert wird, werden die für dieses Image festgelegten Werte standardmäßig ebenfalls kopiert. Sollen diese Werte beim Kopieren oder Klonen geändert werden, geben Sie die aktualisierten Konfigurationswerte im Dialogfeld zum Kopieren/Klonen ein, ebenso wie beim Erstellen oder Bearbeiten eines RBD-Images. Hiermit werden ausschließlich die Werte für das zu kopierende oder zu klonende RBD-Image festgelegt (oder zurückgesetzt). Dieser Vorgang verändert weder die Konfiguration des Quell-RBD-Images noch die globale Konfiguration.
   </para>
   <para>
    Wenn Sie den Optionswert beim Kopieren/Klonen zurücksetzen, wird in diesem Image kein Wert für diese Option festgelegt. Dies bedeutet, dass ein Wert für diese Option herangezogen wird, der für den übergeordneten Pool festgelegt wurde, sofern der betreffende Wert im übergeordneten Pool konfiguriert ist. Ansonsten wird der globale Standardwert verwendet.
   </para>
  </sect2>
 </sect1>
</chapter>
