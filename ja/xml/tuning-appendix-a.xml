<?xml version="1.0" encoding="UTF-8"?>
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning-appendix-a.xml" version="5.0" xml:id="tuning-appendix-a">
 <title>カーネルチューニングのためのSalt状態</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:editurl>https://github.com/SUSE/doc-ses/edit/master/xml/</dm:editurl>
   <dm:translation>yes</dm:translation>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para>
   Cephクラスタのパフォーマンスを向上させるために調整できる項目は多数あります。前のセクションで提供した資料は、重要な項目を紹介しようとするものですが、すべてを網羅しているとは限りません。ここに含まれる情報の使用は、ベースラインパフォーマンスと比較して、特定のチューニングのパフォーマンスのニーズと結果を理解するための科学的なアプローチを使用して行うことを強くお勧めします。
 </para>
   <para>
     このSalt状態を利用するには、次の手順に従います。
   </para>
   <procedure>
     <step>
       <para>
         <filename>/srv/salt/</filename>に<filename>my_kerntune</filename>という名前のディレクトリを作成します。
       </para>
     </step>
     <step>
       <para>
         次の内容で<filename>/srv/salt/my_kerntune/init.sls</filename>を作成します。
       </para>
<screen>
  my_kern_tune:
    file.replace:
      - name: /etc/default/grub
      - pattern: showopts.*
      - repl: showopts intel_idle.max_cstate=0 processor.max_cstate=0 idle=poll scsi_mod.use_blk_mq=1 nospec spectre_v2=off pti=off spec_store_bypass_disable=off l1tf=off"

  grub2_mkconfig:
    cmd.run:
      - runas: root
      - name: grub2-mkconfig -o /boot/grub2/grub.cfg
      - onchanges:
        - file: my_kern_tune
</screen>
     </step>
     <step>
       <para>
         次のコマンドを発行して、状態を設定します。
       </para>
<screen>
salt '*' state.apply my_kerntune
</screen>
     </step>
     <step>
       <para>
         ノードを再起動します。
       </para>
     </step>
   </procedure>
   <warning>
     <para>
       <command>grub</command>カーネルコマンドラインを確認し、pattern:パラメータで指定されたパターン一致が適切であることを確認します。これは<option>showopts</option>カーネルコマンドライン引数の後にあるすべてを上書きします。
     </para>
   </warning>
 </appendix>
