<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning-intro.xml" version="5.0" xml:id="tuning-intro">
 <title>SUSE Enterprise Storageクラスタのチューニングの概要 </title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:editurl>https://github.com/SUSE/doc-ses/edit/master/xml/</dm:editurl>
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <para>
   分散クラスタのチューニングは、反復テストに裏打ちされた科学的方法を使用する新たな取り組みです。クラスタを全体的に見てから、すべてのコンポーネントを詳しく調べることより、劇的な改善を実現できます。このガイドの作成に貢献した作業の過程で、作成者は一部の特定のケースで、パフォーマンスが2倍を超えていることを確認しています。
 </para>
 <para>
   このガイドは、読者がSUSE Enterprise Storageクラスタのチューニングの内容と方法を理解するのを支援することを目的としています。このガイドの範囲を超えるトピックがあり、特定のエンドユーザ環境で最適なパフォーマンスを実現するために、個々のクラスタに対してさらなる微調整が実行される可能性があることが予想されます。
 </para>
 <para>
   このリファレンスガイドは、最適なパフォーマンスを得るためにSUSE Enterprise Storageクラスタをチューニングする必要があるアーキテクトと管理者を対象としています。LinuxおよびCephに精通していることを前提としています。
 </para>
 <sect1 xml:id="tuning-philosophy">
   <title>チューニングの考え方</title>
   <para>
     チューニングでは、調整されるシステム全体を調べ、プロセスに科学的に厳格な方法でアプローチする必要があります。徹底的なアプローチでは、初期ベースラインを取得し、一度に1つの変数を変更して、結果を測定し、次のチューニングパラメータに移動しながら、それをデフォルトに戻す必要があります。そのプロセスの最後に、スループットの向上、レイテンシの削減、CPU消費の削減などの結果を調べ、追加のメリットを得るためにどの候補を組み合わせるかを決定することができます。この2番目のフェーズでも、最初のフェーズと同じ方法で繰り返す必要があります。この一般的なプロセスは、すべての可能性のある組み合わせが試行され、最適な設定が検出されるまで続行されます。
   </para>
   <para>
     残念ながら、このような徹底的な作業を行う時間のある人はほとんどいません。これは現実的であり、知識を利用して、パフォーマンス向上のためによく知られた候補を組み合わせて測定し、結果の変化を測定する反復プロセスを開始することができます。それは、このガイドを生み出した研究中に従ったプロセスです。
   </para>
 </sect1>
 <sect1 xml:id="tuning-process">
   <title>プロセス</title>
   <para>
     効果的なチューニングを行うには、適切なプロセスが必要です。このプロセスの原則は次のとおりです。
   </para>
   <variablelist>
    <varlistentry>
     <term>評価</term>
     <listitem>
      <para>
        ベースラインから開始し、各反復の後で同じ方法で測定します。すべての関連するディメンションを測定していることを確認します。複数の反復を実行した後に初めてCPUバウンドであることを検出すると、反復に費やされたすべての時間が無効になります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ドキュメント</term>
     <listitem>
      <para>
        将来の分析のためにすべての結果をドキュメント化します。パターンは後で確認するまで明らかにされない場合があります。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>ディスカッション</term>
     <listitem>
      <para>
        可能な場合は、洞察やフィードバックを得るために、見ている結果について他の人とディスカッションしてください。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>繰り返し</term>
     <listitem>
      <para>
        1回の測定では再現性は保証されません。同じテストを複数回実行すると、結果をより適切に確立することができます。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>要素の分離</term>
     <listitem>
      <para>
        一度に環境に影響を与える変更は1つだけであるため、プロセスが長くなる可能性がありますが、テスト中の特定の調整を検証するのにも役立ちます。
      </para>
     </listitem>
    </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="tuning-hardware-software">
   <title>ハードウェアとソフトウェア</title>
   <para>
     SUSE Enterprise Storageに利用されるこの作業は、2つのモデルのサーバで実行されました。このガイドで参照されるすべての結果は、この特定のハードウェア環境から得られたものです。環境の変動は結果に影響を与える可能性があり、また、影響を及ぼします。
   </para>
   <para>
     ストレージノード:
   </para>
   <itemizedlist>
     <listitem>
       <para>
         2Uサーバ
       </para>
       <itemizedlist>
         <listitem>
           <para>
             1x Intel Skylake 6124
           </para>
         </listitem>
         <listitem>
           <para>
             96GB RAM
           </para>
         </listitem>
         <listitem>
           <para>
             MellanoxデュアルポートConnectX-4 100GbE
           </para>
         </listitem>
         <listitem>
           <para>
             12x Intel SSD D3-S4510 960GB
           </para>
         </listitem>
         <listitem>
           <para>
             RAID-1 480GB M.2ブートデバイス
           </para>
         </listitem>
       </itemizedlist>
     </listitem>
   </itemizedlist>
   <para>
     管理、モニター、およびプロトコルゲートウェイ:
   </para>
   <itemizedlist>
     <listitem>
       <para>
         1Uサーバ
       </para>
       <itemizedlist>
         <listitem>
           <para>
             1x Intel Skylake 4112
           </para>
         </listitem>
         <listitem>
           <para>
             32GB RAM
           </para>
         </listitem>
         <listitem>
           <para>
             MellanoxデュアルポートConnectX-4 100GbE
           </para>
         </listitem>
         <listitem>
           <para>
             RAID-1 480GB M.2ブートデバイス
           </para>
         </listitem>
       </itemizedlist>
     </listitem>
   </itemizedlist>
   <para>
     スイッチ:
   </para>
   <itemizedlist>
     <listitem>
       <para>
         2x 32-port 100GbE
       </para>
     </listitem>
   </itemizedlist>
   <para>
     ソフトウェア:
   </para>
   <itemizedlist>
     <listitem>
       <para>
         SUSE Enterprise Storage 5.5
       </para>
     </listitem>
     <listitem>
       <para>
         SUSE Linux Enterprise Server 15 SP1
       </para>
     </listitem>
   </itemizedlist>
   <note>
     <para>
       SUSE Enterprise Storageには、サブスクリプション資格の一部として、SUSE Linux Enterprise Serverの限定使用サブスクリプションが提供されます。
     </para>
   </note>
   <sect2>
     <title>パフォーマンスメトリック</title>
     <para>
       ストレージのパフォーマンスは2つの、異なるが関連する軸である<literal>レイテンシ</literal>と<literal>スループット</literal>で測定されます。場合によっては、一方が他方よりも重要です。スループットがより重要な例として、バックアップの使用例が挙げられます。この場合、スループットは最も重要な測定値であり、転送サイズを大きくすると最大のパフォーマンスが得られます。逆に、パフォーマンスが高いデータベースでは、レイテンシが最も重要な測定値です。
     </para>
     <para>
       <emphasis/>「レイテンシ」は、要求が行われたときから、要求が完了したときまでの時間です。これは通常、ミリ秒単位で測定されます。このパフォーマンスは、CPUクロック速度、システムバス、およびデバイスパフォーマンスに直接関係しています。<emphasis/>「スループット」は、特定の時間内に書き込みまたは取得できるデータ量の測定です。スループットは通常、MB/秒、およびGB/秒、あるいはMiB/秒およびGiB/秒単位です。
     </para>
     <para>
       しばしば参照される3番目の測定は、<literal>IOPS</literal>です。これは、秒あたりの入力/出力操作を表します。IOPSは、結果がI/O動作のサイズ、タイプ(読み取り/書き込み)、およびI/Oパターンの詳細(新規書き込み、上書き、ランダム書き込み、読み取りと書き込みの混在)に依存するため、多少あいまいです。あいまいではありますが、ストレージ環境のパフォーマンスの変化を測定する際に使用する有効なツールです。たとえば、単一の4Kの順次書き込み操作のレイテンシに影響を与えない調整を行うことができますが、より多くの操作を並行して行えるため、スループットとIOPSが変化します。
     </para>
   </sect2>
 </sect1>
 <sect1 xml:id="tuning-measurement">
   <title>測定する内容の決定</title>
   <para>
     環境を調整する際には、調整対象のI/Oを理解することが重要です。I/Oパターンを適切に理解することによって、テストを環境に適合させることができ、環境の詳細なシミュレーションが可能になります。
   </para>
   <para>
     I/Oパターンを理解するために役立つツールは次のとおりです。
   </para>
   <itemizedlist>
     <listitem>
       <para>
         <command>iostat</command>
       </para>
     </listitem>
     <listitem>
       <para>
         <command>blktrace</command>、<command>blkparse</command>
       </para>
     </listitem>
     <listitem>
       <para>
         <command>systemtap (stap)</command>
       </para>
     </listitem>
     <listitem>
       <para>
         <command>dtrace</command>
       </para>
     </listitem>
   </itemizedlist>
   <para>
     これらのツールについて説明することはこのドキュメントの範囲を超えていますが、このツールが提供できる情報は、調整が必要なI/Oプロファイルを理解するのに非常に役立つ場合があります。
   </para>
   <sect2>
     <title>シングルスレッドと集約IO</title>
     <para>
       スケールアップまたはスケールアウトのパフォーマンスが必要かどうかに関連してワークロードの要件を理解することは、多くの場合、適切なチューニングの鍵となります。特にハードウェアアーキテクチャのチューニングや、問題のアプリケーションのチューニングに関する有効な情報を提供するテストシナリオの作成において重要です。
     </para>
   </sect2>
 </sect1>
 <sect1 xml:id="tuning-testing-tools-protocol">
   <title>テストツールとプロトコル</title>
   <para>
     適切なテストには、適切なツールの選択が含まれます。ほとんどのパフォーマンステストケースでは、 <command>fio</command>を使用することをお勧めします。テストケースを構築するためのさまざまなオプションを提供しているためです。S3など、一部の使用例では、I/Oのすべてのフェーズをテストするために代替ツールを使用する必要がある場合があります。
   </para>
   <para>
     I/Oをシミュレートするために一般的に使用されるツールは次のとおりです。
   </para>
   <itemizedlist>
     <listitem>
       <para>
         <command>fio</command>
       </para>
     </listitem>
     <listitem>
       <para>
         <command>iometer</command>
       </para>
     </listitem>
   </itemizedlist>
   <para>
     テストを実行する際には、適切な方法を使用することが不可欠です。これには次のものが含まれます。
   </para>
   <itemizedlist>
     <listitem>
       <para>
         メディアの事前調整。
       </para>
     </listitem>
     <listitem>
       <para>
         測定している対象が測定目的のものであることの確認。
       </para>
     </listitem>
     <listitem>
       <para>
         表示される結果に意味があることを検証する。
       </para>
     </listitem>
     <listitem>
       <para>
         各コンポーネントを個別にテストしてから、一度に1つのレイヤをまとめてテストする。
       </para>
     </listitem>
   </itemizedlist>
 </sect1>
</chapter>
