<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_ceph_faqs.xml" version="5.0" xml:id="storage-faqs">
 <title>FAQ (よくある質問と答え)</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para/>
 <sect1 xml:id="storage-bp-tuneups-pg-num">
  <title>配置グループの数はクラスタのパフォーマンスにどのように影響しますか?</title>

  <para>
   クラスタの使用率が70～80%になったら、OSDを追加するタイミングです。OSDの数を増やす際には、配置グループの数も増やすことを検討できます。
  </para>

  <warning>
   <para>
    PGの数を変更すると、クラスタ内で大量のデータ転送が発生します。
   </para>
  </warning>

  <para>
   新しくサイズ調整したクラスタに最適な値を計算するのは複雑なタスクです。
  </para>

  <para>
   PGの数が多いと、小さいデータチャンクが作成されます。この場合、OSD障害後の回復は速くなりますが、データの場所の計算を担当するMonitorノードに多大な負荷がかかります。
  </para>

  <para>
   一方、PGの数が少ないと、OSD障害からの回復にかかる時間とデータ転送は増加しますが、Monitorノードにそれほど負荷はかかりません。これは、Monitorノードが計算する必要があるデータチャンクの場所の数が少ないためです(ただしデータチャンクの容量は大きくなります)。
  </para>

  <para>
   <xref linkend="op-pgs-pg-num"/>で、クラスタに最適なPG数を特定してください。
  </para>
 </sect1>
 <sect1 xml:id="storage-bp-tuneups-mix-ssd">
  <title>同じクラスタでSSDとハードディスクを使用できますか?</title>

  <para>
   ソリッドステートドライブ(SSD)は一般にハードディスクより高速です。同じ書き込み操作に対して2種類のディスクを混在させると、ハードディスクのパフォーマンスのためにSSDディスクへのデータ書き込み速度が低下します。したがって、「同じルール」<emphasis/>に従うデータ書き込みでは「SSDとハードディスクを混在させない」<emphasis/>でください(データの保存ルールの詳細については、<xref linkend="datamgm-rules"/>を参照してください)。
  </para>

  <para>
   一般的に次の2つのケースでは、同じクラスタでSSDとハードディスクを使用することに意味があります。
  </para>

  <orderedlist spacing="normal">
   <listitem>
    <para>
     各ディスクタイプを異なるルールに従うデータ書き込みに使用する場合。この場合、SSDディスク用の別個のルールを1つと、ハードディスク用のルールをもう1つ用意する必要があります。
    </para>
   </listitem>
   <listitem>
    <para>
     各ディスクタイプを特定の目的に使用する場合。たとえば、SSDディスクをジャーナルに使用し、ハードディスクをデータの保存に使用する場合などです。
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 <sect1 xml:id="storage-bp-tuneups-ssd-tradeoffs">
  <title>ジャーナルをSSDで使用することにはどのようなトレードオフがありますか?</title>

  <para>
   通常、ハードディスクのみのOSDではジャーナルがボトルネックになるため、OSDジャーナルにSSDを使用するとパフォーマンスが向上します。SSDは、複数のOSDのジャーナルを共有するために使用されることがよくあります。
  </para>

  <para>
   次に、OSDジャーナルにSSDを使用することの潜在的な欠点のリストを示します。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     SSDディスクはハードディスクより高価である。ただし、1つのOSDジャーナルに必要なディスク領域は最大6GB程度なので、価格はそれほど問題にならない可能性があります。
    </para>
   </listitem>
   <listitem>
    <para>
     本来であれば大容量ハードディスクで使用してクラスタ容量を拡張できるストレージスロットがSSDディスクによって消費されてしまう。
    </para>
   </listitem>
   <listitem>
    <para>
     SSDディスクはハードディスクと比べて書き込みサイクルが短いが、この問題は最新技術によって解消され始めている。
    </para>
   </listitem>
   <listitem>
    <para>
     同じSSDディスク上で共有するジャーナルを増やすと、SSDディスクの障害発生後にすべての関連OSDが失われる危険があります。この場合、クラスタを再バランスするために大量のデータを移動する必要があります。
    </para>
   </listitem>
   <listitem>
    <para>
     障害が発生したOSDとジャーナルディスクのデータマッピングが1:1ではないため、ディスクのホットプラグが複雑になる。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="storage-bp-monitoring-diskfails">
  <title>ディスクに障害が発生すると、どうなりますか?</title>

  <para>
   クラスタデータが保存されているディスクがハードウェアの問題で動作しなくなった場合、次のような流れになります。
  </para>

  <itemizedlist mark="bullet" spacing="normal">
   <listitem>
    <para>
     関連するOSDがクラッシュして、自動的にクラスタから削除されます。
    </para>
   </listitem>
   <listitem>
    <para>
     障害ディスクのデータが、他のOSDに保存されている同じデータの別のコピーからクラスタ内の別のOSDに複製されます。
    </para>
   </listitem>
   <listitem>
    <para>
     その後、ディスクをクラスタのCRUSHマップから削除し、ホストハードウェアから物理的に取り外す必要があります。
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <sect1 xml:id="storage-bp-monitoring-journalfails">
  <title>ジャーナルディスクに障害が発生すると、どうなりますか?</title>

  <para>
   ジャーナルや先書きログをOSDとは別のデバイスに保存するようCephを設定できます。ジャーナル専用ディスクに障害が発生した場合、関連するOSDにも障害が発生します(<xref linkend="storage-bp-monitoring-diskfails"/>を参照してください)。
  </para>

  <warning>
   <title>1台のディスクでの複数ジャーナルのホスト</title>
   <para>
    パフォーマンスを向上させるため、高速なディスク(SSDなど)を使用して、複数のOSDのジャーナルパーティションを保存できます。1台のディスクで5つ以上のOSDのジャーナルをホストすることはお勧めしません。なぜなら、ジャーナルのディスクに障害が発生した場合、関連するOSDの全ディスクの保存データが失われる危険があるためです。
   </para>
  </warning>
 </sect1>
</chapter>
