<?xml version="1.0" encoding="UTF-8"?>
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="tuning-appendix-b.xml" version="5.0" xml:id="tuning-appendix-b">
 <title>リングバッファ最大値スクリプト</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:translation>yes</dm:translation>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
  <para>
    このスクリプトは、一度に単一ホスト上で実行することを目的としています。ホスト上のすべてのインターフェイスを最大リングバッファ値に設定します。クラスタ内のすべてのホストに適用するために、Saltなどの何らかのオーケストレーションで使用できます。
  </para>
<screen>
 for i in `ls /etc/sysconfig/network/ifcfg-*`;do
   nicname=`echo $i|cut -f2 -d"-"`
   echo nicname=$nicname
   if [ `ethtool -g $nicname 2&gt;/dev/null |wc -l ` -gt 6 ]; then
     ethtoolcmd="-G $nicname rx `ethtool -g $nicname|head -6|grep RX:|cut -f2 -d":"|xargs` tx `ethtool -g $nicname|head -6|grep TX:|cut -f2 -d":"|xargs`"
     echo ethtoolcmd=$ethtoolcmd
     sed -i "s/ETHTOOL_OPTIONS=''/ETHTOOL_OPTIONS='$ethtoolcmd'/g" $i
   fi
   done
</screen>
</appendix>
