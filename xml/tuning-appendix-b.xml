<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<appendix xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="tuning-appendix-b">
 <title>Ring Buffer Max Value Script</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:editurl>https://github.com/SUSE/doc-ses/edit/master/xml/</dm:editurl>
   <dm:translation>yes</dm:translation>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
  <para>
    This script is intended to be run on a single host at a time.
    It will set all interfaces on the host to the maximum ring
    buffer values. It may be used with some sort of orchestration,
    for example &salt;, to apply to all hosts in a cluster.
  </para>
<screen>
 for i in `ls /etc/sysconfig/network/ifcfg-*`;do
   nicname=`echo $i|cut -f2 -d"-"`
   echo nicname=$nicname
   if [ `ethtool -g $nicname 2>/dev/null |wc -l ` -gt 6 ]; then
     ethtoolcmd="-G $nicname rx `ethtool -g $nicname|head -6|grep RX:|cut -f2 -d":"|xargs` tx `ethtool -g $nicname|head -6|grep TX:|cut -f2 -d":"|xargs`"
     echo ethtoolcmd=$ethtoolcmd
     sed -i "s/ETHTOOL_OPTIONS=''/ETHTOOL_OPTIONS='$ethtoolcmd'/g" $i
   fi
   done
</screen>
</appendix>
