<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="bp-troubleshooting-dashboard">
 <title>Troubleshooting the &dashboard;</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:editurl>https://github.com/SUSE/doc-ses/edit/master/xml/</dm:editurl>
   <dm:translation>yes</dm:translation>
   <dm:release>SES 7</dm:release>
  </dm:docmanager>
 </info>
 <sect1 xml:id="bp-troubleshooting-locate-dashboard">
   <title>Locating the Dashboard</title>
   <para>
     If you are unsure of the location of the &dashboard;, run the
     following command:
   </para>
<screen>
&prompt.cephuser;ceph mgr services | grep dashboard
"dashboard": "https://<replaceable>host</replaceable>:<replaceable>port</replaceable>"
</screen>
   <para>
     The command returns the URL where the &dashboard; is located:
     (https://<replaceable>host</replaceable>:<replaceable>port</replaceable>/)
   </para>
 </sect1>
 <sect1 xml:id="bp-troubleshooting-access-dashboard">
   <title>Accessing the &dashboard;</title>
   <para>
     If you are unable to access the &dashboard;, run through the following
     commands.
   </para>
   <procedure>
     <step>
       <para>
         Verify the &dashboard; module is enabled:
       </para>
<screen>
&prompt.cephuser;ceph mgr module ls
</screen>
     </step>
     <step>
       <para>
         Ensure the &dashboard; module is listed in the <literal>enabled_modules</literal>
         section. Example snipped output from the <command>ceph mgr module ls</command>
         command:
       </para>
<screen>
  {
      "always_on_modules": [
          "balancer",
          "crash",
          "devicehealth",
          "orchestrator",
          "osd_support",
          "pg_autoscaler",
          "progress",
          "rbd_support",
          "status",
          "telemetry",
          "volumes"
      ],
      "enabled_modules": [
          "dashboard",
          "iostat",
          "restful"
      ],
      "disabled_modules": [
          {
               ...
          }
      ]
  }
</screen>
     </step>
      <step>
        <para>
          If it is not listed, activate the module with
         the following command:
       </para>
<screen>
&prompt.cephuser;ceph mgr module enable dashboard
</screen>
     </step>
     <step>
       <para>
         Check the &dashboard;mgr log file for any errors:
<!-- where do I Find this logfile? Tatjana is checking-->
       </para>
     </step>
     <step>
       <para>
         Ensure the SSL/TSL support is configured properly:
       </para>
<screen>
&prompt.cephuser;
</screen>
     </step>
     <step>
       <para>
         Verify the self-signed certificate exists. If not, run:
       </para>
<screen>
&prompt.cephuser;ceph dashboard create-self-signed-cert
</screen>
       <para>
         See <xref linkend="self-sign-certificates"/> for more information on
         self-signed certificates or <xref linkend="cert-sign-CA"/> for information
         on self-signed certificates by CA.
       </para>
     </step>
   </procedure>
 </sect1>
 <sect1 xml:id="bp-troubleshooting-login-dashboard">
   <title>Trouble Logging into the &dashboard;</title>
   <para>
     If you are unable to log into the &dashboard; and you receive the
     following error, run through the procedural checks below:
   </para>
   <figure xml:id="dashboard-invalid-credentials">
    <title>Failed to execute Login</title>
    <mediaobject>
     <imageobject role="html">
      <imagedata fileref="dashboard-invalid-credentials.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
   <procedure>
     <step>
       <para>
         Check that your user credentials are correct. If you are seeing the
         notification message above when trying to log into the &dashboard;,
         it is likely you are using the wrong credentials. Double check your
         username and password, and ensure the caps lock key is not enabled
         by accident.
       </para>
     </step>
     <step>
       <para>
         If your user credentials are correct, but you are experiencing the
         same error, check that the user account exists:
       </para>
<screen>
&prompt.cephuser;ceph dashboard ac-user-show <replaceable>USERNAME</replaceable>
</screen>
       <para>
         This command returns your user data. If the user does not exist,
         it will print:
       </para>
<screen>
Error ENOENT: User <replaceable>USERNAME</replaceable> does not exist
</screen>
       <para>
         In this case, you will need to create the user. See <xref linkend="dashboard-user-accounts"/>
         for more information on user accounts.
       </para>
     </step>
     <step>
       <para>
         Check if the user is enabled:
       </para>
<screen>
&prompt.cephuser;ceph dashboard ac-user-show <replaceable>USERNAME</replaceable> {..., "enabled": true, ..}
</screen>
       <para>
         Check if <literal>enabled</literal> is set to <option>true</option> for
         your user. If not the user is not enabled, run:
       </para>
<screen>
&prompt.cephuser;ceph dashboard ac-user-enable <replaceable>USERNAME</replaceable>
</screen>
     </step>
   </procedure>
 </sect1>
 <sect1 xml:id="bp-troubleshooting-features-dashboard">
   <title>A &dashboard; Feature is Not Working</title>
   <para>
     When an error occurs on the backend, you will usually receive an error
     notification on the frontend. Run through the following scenarios to
     debug.
   </para>
   <procedure>
     <step>
       <para>
         Check the &dashboard;/mgr logfile(s) for any errors. These can be
         identified by searching for keywords, such as <emphasis>500 Internal Server Error</emphasis>,
         followed by <literal>traceback</literal>. The end of a traceback
         contains more details about what exact error occurred.
       </para>
     </step>
     <step>
       <para>
         Check your web browser's Javascript Console for any errors.
       </para>
     </step>
   </procedure>
 </sect1>
 <sect1 xml:id="bp-troubleshooting-logging-dashboard">
   <title>&dashboard; Logs</title>
   <sect2 xml:id="debug-dashboard-flag">
     <title>Debug &dashboard; Flag</title>
     <para>
       With this flag enabled, traceback of errors are included in
       backend responses.
     </para>
     <para>
       To enable this flag via the &dashboard;, navigate from
       <guimenu>Cluster</guimenu> to <guimenu>Manager modules</guimenu>.
       Select <guimenu>Dashboard module</guimenu> and click the edit button.
       Click the <guimenu>debug</guimenu> checkbox and update.
     </para>
     <para>
       To enable via the CLI, run the following command:
     </para>
<screen>
&prompt.cephuser;ceph dashboard debug enable
</screen>
   </sect2>
   <sect2 xml:id="setting-log-level-dashboard-module">
     <title>Setting Logging Level of &dashboard; Module</title>
     <para>
       Setting the logging level to debug makes the log more verbose
       and helpful for debugging.
     </para>
     <procedure>
       <step>
         <para>
           Increase the logging level of manager daemons:
         </para>
<screen>
&prompt.cephuser;ceph tell mgr config set debug_mgr 20
</screen>
       </step>
       <step>
         <para>
           Adjust the logging level of the &dashboard; module via the
           &dashboard; or CLI:
         </para>
         <itemizedlist>
           <listitem>
             <para>
               Navigate from <guimenu>Cluster</guimenu> to <guimenu>Manager modules</guimenu>.
               Select <guimenu>Dashboard module</guimenu> and click the edit button.
               Modify the <literal>log_level</literal> configuration.
             </para>
           </listitem>
           <listitem>
             <para>
               To adjust via the CLI, run the following command:
             </para>
<screen>
&prompt.cephuser;bin/ceph config set mgr mgr/dashboard/log_level debug
</screen>
           </listitem>
         </itemizedlist>
       </step>
     </procedure>
   </sect2>
 </sect1>
</chapter>
