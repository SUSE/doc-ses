<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_operating_pools.xml" version="5.0" xml:id="ceph-pools">
 <title>Gestione di pool di memorizzazione</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:editurl>https://github.com/SUSE/doc-ses/edit/maintenance/ses6/xml/</dm:editurl>
   <dm:translation>sì</dm:translation>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para>
  Ceph memorizza i dati nei pool. I pool sono gruppi logici per la memorizzazione di oggetti. Quando inizialmente si installa un cluster senza creare un pool, Ceph utilizza i pool di default per la memorizzazione dei dati. Gli elementi di rilievo più importanti riportati di seguito sono relativi ai pool Ceph:
 </para>
 <itemizedlist mark="bullet" spacing="normal">
  <listitem>
   <para>
    <emphasis>Resilienza</emphasis>: è possibile impostare il numero di OSD, compartimenti o uscite cui sono consentiti errori senza perdere dati. Per i pool replicati, è il numero desiderato di copie/repliche di un oggetto. I nuovi pool vengono creati con un numero di repliche di default impostato a 3. Per i pool con codice di cancellazione, è il numero di porzioni di codifica (vale a dire <emphasis>m=2</emphasis> nel profilo del codice di cancellazione).
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Gruppi di posizionamento</emphasis>: sono strutture di dati interne per la memorizzazione dei dati in un pool negli OSD. Il modo in cui i dati vengono memorizzati nei gruppi di posizionamento in Ceph viene definito in una mappa CRUSH. È possibile impostare il numero di gruppi di posizionamento per un pool al momento della sua creazione. In una configurazione tipica si utilizzano circa 100 gruppi di posizionamento per OSD per fornire il bilanciamento ottimale senza utilizzare troppe risorse di calcolo. Quando si configurano più pool, assicurarsi di impostare un numero ragionevole di gruppi di posizionamento per entrambi il pool e il cluster insieme. È possibile utilizzare lo strumento <link xlink:href="https://ceph.com/pgcalc/">Ceph PGs per Pool Calculator</link>.
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Regole CRUSH</emphasis>: quando si memorizzano dati in un pool, gli oggetti e le relative repliche (o porzioni, nel caso dei pool con codice di cancellazione) vengono posizionati in base al set di regole CRUSH mappate al pool. È possibile creare una regola CRUSH personalizzata per il pool.
   </para>
  </listitem>
  <listitem>
   <para>
    <emphasis>Snapshot</emphasis>: quando si creano snapshot con <command>ceph osd pool mksnap</command>, si crea effettivamente uno snapshot di un determinato pool.
   </para>
  </listitem>
 </itemizedlist>
 <para>
  Per organizzare i dati nei pool, è possibile elencare, creare e rimuovere pool. È inoltre possibile visualizzare le statistiche di utilizzo per ciascun pool.
 </para>
 <sect1 xml:id="ceph-pools-associate">
  <title>Associazione di pool a un'applicazione</title>

  <para>
   Prima di utilizzare i pool, è necessario associare loro un'applicazione. I pool che verranno utilizzati con CephFS o quelli creati automaticamente da Object Gateway vengono associati automaticamente.
  </para>

  <para>
   Negli altri casi, è possibile associare manualmente un nome applicazione in formato libero a un pool:
  </para>

<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool application enable <replaceable>pool_name</replaceable> <replaceable>application_name</replaceable></screen>

  <tip>
   <title>nomi applicazioni di default</title>
   <para>
    CephFS utilizza il nome applicazione <literal>cephfs</literal>, per il RADOS Block Device (dispositivo di blocco RADOS) viene utilizzato <literal>rbd</literal> e per Object Gateway viene utilizzato <literal>rgw</literal>.
   </para>
  </tip>

  <para>
   È possibile associare un pool a più applicazioni, ciascuna delle quali può disporre di metadati propri. È possibile visualizzare i metadati dell'applicazione per un determinato pool mediante l'uso del seguente comando:
  </para>

<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool application get <replaceable>pool_name</replaceable></screen>
 </sect1>
 <sect1 xml:id="ceph-pools-operate">
  <title>Pool operativi</title>

  <para>
   In questa sezione vengono fornite informazioni pratiche per eseguire task di base con i pool. È possibile scoprire come elencare, creare ed eliminare pool, nonché visualizzare le statistiche dei pool o gestire gli snapshot di un pool.
  </para>

  <sect2>
   <title>Elenco di pool</title>
   <para>
    Per elencare il pool del cluster, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool ls</screen>
  </sect2>

  <sect2 xml:id="ceph-pools-operate-add-pool">
   <title>Creazione di un pool</title>
   <para>
    È possibile creare un pool "replicated" (replicato), per il recupero degli OSD persi mantenendo più copie degli oggetti, o "erasure" (di cancellazione), per ottenere un tipo di capacità RAID5/6 generalizzata. Per i pool replicati è necessario maggior spazio di storage nominale rispetto a quello necessario per i pool con codice di cancellazione. L'impostazione di default è "replicated".
   </para>
   <para>
    Per creare un pool replicato, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool create <replaceable>pool_name</replaceable> <replaceable>pg_num</replaceable> <replaceable>pgp_num</replaceable> replicated <replaceable>crush_ruleset_name</replaceable> \
<replaceable>expected_num_objects</replaceable></screen>
   <para>
    Per creare un pool con codice di cancellazione, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool create <replaceable>pool_name</replaceable> <replaceable>pg_num</replaceable> <replaceable>pgp_num</replaceable> erasure <replaceable>erasure_code_profile</replaceable> \
 <replaceable>crush_ruleset_name</replaceable> <replaceable>expected_num_objects</replaceable></screen>
   <para>
    Se si supera il limite di gruppi di posizionamento per OSD, è possibile che <command>ceph osd pool create</command> si concluda con un errore. Il limite viene impostato con l'opzione <option>mon_max_pg_per_osd</option>.
   </para>
   <variablelist>
    <varlistentry>
     <term>pool_name</term>
     <listitem>
      <para>
       Indica il nome del pool. Deve essere univoco. Questa opzione è obbligatoria. 
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pg_num</term>
     <listitem>
      <para>
       Indica il numero totale dei gruppi di posizionamento per il pool. Questa opzione è obbligatoria. Il valore di default è 8.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pgp_num</term>
     <listitem>
      <para>
       Indica il numero totale dei gruppi di posizionamento ai fini del posizionamento stesso. Deve essere uguale al numero totale di gruppi di posizionamento, tranne nei casi in cui questi vengono suddivisi. Questa opzione è obbligatoria. Il valore di default è 8.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>crush_ruleset_name</term>
     <listitem>
      <para>
       Indica il nome del set di regole CRUSH per il pool. Se il set di regole specificato non esiste, la creazione dei pool replicati si concluderà con un errore con -ENOENT. Per i pool replicati, si tratta del set di regole specificato dalla <varname>variabile di configurazione</varname> osd pool default crush replicated ruleset. Questo set di regole deve esistere. Nel caso dei pool con codice di cancellazione, si tratta del set di regole "erasure-code", se è utilizzato il profilo con codice di cancellazione di default, oppure di <replaceable>POOL_NAME</replaceable>. Questo set di regole verrà creato in modo implicito se non esiste già.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>erasure_code_profile=profile</term>
     <listitem>
      <para>
       Solo per i pool con codice di cancellazione. Utilizzare il profilo del codice di cancellazione. Deve essere un profilo esistente, come definito da <command>osd erasure-code-profile set</command>.
      </para>
      <para>
       Durante la creazione di un pool, impostare il numero di gruppi di posizionamento su un valore ragionevole. Considerare anche il numero totale di gruppi di posizionamento per OSD. I gruppi di posizionamento sono costosi a livello di computer, pertanto le prestazioni saranno compromesse quando sono presenti molti pool con molti gruppi di posizionamento (ad esempio 50 pool con 100 gruppi di posizionamento ciascuno).
      </para>
      <para>
       Per informazioni più dettagliate sul calcolo del numero appropriato di gruppi di posizionamento per il pool, vedere <xref linkend="op-pgs"/> (in lingua inglese).
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>expected_num_objects</term>
     <listitem>
      <para>
       Indica il numero di oggetti previsto per il pool. Quando questo valore viene impostato (insieme a una <option>soglia di unione del filestore</option>), al momento della creazione del pool si verifica la suddivisione della cartella del gruppo di posizionamento. In tal modo si evita l'impatto di latenza con una suddivisione della cartella di runtime.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Impostazione delle quote del pool</title>
   <para>
    È possibile impostare le quote del pool per il numero massimo di byte e/o il numero massimo di oggetti per pool.
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set-quota <replaceable>pool-name</replaceable> <replaceable>max_objects</replaceable> <replaceable>obj-count</replaceable> <replaceable>max_bytes</replaceable> <replaceable>bytes</replaceable></screen>
   <para>
    Ad esempio:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set-quota data max_objects 10000</screen>
   <para>
    Per rimuovere una quota, impostarne il valore a 0.
   </para>
  </sect2>

  <sect2 xml:id="ceph-pools-operate-del-pool">
   <title>Eliminazione di un pool</title>
   <warning>
    <title>l'eliminazione del pool è irreversibile</title>
    <para>
     I pool possono contenere dati importanti. L'eliminazione di un pool comporta la cancellazione di tutti i dati in esso contenuti e non è possibile recuperarli in alcun modo.
    </para>
   </warning>
   <para>
    Poiché l'eliminazione involontaria di un pool è un pericolo effettivo, Ceph implementa due meccanismi che impediscono che ciò accada. Prima di poter eliminare un pool è necessario disabilitare entrambi i meccanismi.
   </para>
   <para>
    Il primo di questi è il flag <literal>NODELETE</literal>. Ciascun pool è dotato di questo flag, il cui valore di default è "false". Per scoprire il valore di questo flag su un pool, eseguire il seguente comando:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool get <replaceable>pool_name</replaceable> nodelete</screen>
   <para>
    Se l'output è <literal>nodelete: true</literal>, non è possibile eliminare il pool fino a quando non si modifica il flag con il seguente comando:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set <replaceable>pool_name</replaceable> nodelete false</screen>
   <para>
    Il secondo meccanismo è il parametro di configurazione esteso a tutto il cluster <option>mon allow pool delete</option>, il cui valore di default è "false". Vale a dire che per default non è possibile eliminare un pool. Il messaggio di errore visualizzato è:
   </para>
<screen>Error EPERM: pool deletion is disabled; you must first set the
mon_allow_pool_delete config option to true before you can destroy a pool</screen>
   <para>
    Per eliminare il pool malgrado questa impostazione di sicurezza, è possibile impostare temporaneamente <option>mon allow pool delete</option> su "true", eliminare il pool e riportare il parametro su "false":
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph tell mon.* injectargs --mon-allow-pool-delete=true
<prompt>cephadm@adm &gt; </prompt>ceph osd pool delete pool_name pool_name --yes-i-really-really-mean-it
<prompt>cephadm@adm &gt; </prompt>ceph tell mon.* injectargs --mon-allow-pool-delete=false</screen>
   <para>
    Con il comando <command>injectargs</command> viene visualizzato il seguente messaggio:
   </para>
<screen>injectargs:mon_allow_pool_delete = 'true' (not observed, change may require restart)</screen>
   <para>
    Ciò conferma semplicemente che il comando è stato eseguito correttamente. Non si tratta di un errore.
   </para>
   <para>
    Se sono stati creati set di regole propri e regole per un pool creato precedentemente, considerare di rimuovere tali regole quando il pool non è più necessario.
   </para>
  </sect2>

  <sect2>
   <title>Ridenominazione di un pool</title>
   <para>
    Per rinominare un pool, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool rename <replaceable>current-pool-name</replaceable> <replaceable>new-pool-name</replaceable></screen>
   <para>
    Se si rinomina un pool e si dispone di funzionalità specifiche per il pool per un utente autenticato, è necessario aggiornare le funzionalità dell'utente con il nuovo nome pool.
   </para>
  </sect2>

  <sect2>
   <title>Visualizzazione delle statistiche del pool</title>
   <para>
    Per visualizzare le statistiche di utilizzo di un pool, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>rados df
POOL_NAME                    USED OBJECTS CLONES COPIES MISSING_ON_PRIMARY UNFOUND DEGRADED  RD_OPS      RD  WR_OPS      WR USED COMPR UNDER COMPR
.rgw.root                 768 KiB       4      0     12                  0       0        0      44  44 KiB       4   4 KiB        0 B         0 B
cephfs_data               960 KiB       5      0     15                  0       0        0    5502 2.1 MiB      14  11 KiB        0 B         0 B
cephfs_metadata           1.5 MiB      22      0     66                  0       0        0      26  78 KiB     176 147 KiB        0 B         0 B
default.rgw.buckets.index     0 B       1      0      3                  0       0        0       4   4 KiB       1     0 B        0 B         0 B
default.rgw.control           0 B       8      0     24                  0       0        0       0     0 B       0     0 B        0 B         0 B
default.rgw.log               0 B     207      0    621                  0       0        0 5372132 5.1 GiB 3579618     0 B        0 B         0 B
default.rgw.meta          961 KiB       6      0     18                  0       0        0     155 140 KiB      14   7 KiB        0 B         0 B
example_rbd_pool          2.1 MiB      18      0     54                  0       0        0 3350841 2.7 GiB     118  98 KiB        0 B         0 B
iscsi-images              769 KiB       8      0     24                  0       0        0 1559261 1.3 GiB      61  42 KiB        0 B         0 B
mirrored-pool             1.1 MiB      10      0     30                  0       0        0  475724 395 MiB      54  48 KiB        0 B         0 B
pool2                         0 B       0      0      0                  0       0        0       0     0 B       0     0 B        0 B         0 B
pool3                     333 MiB      37      0    111                  0       0        0 3169308 2.5 GiB   14847 118 MiB        0 B         0 B
pool4                     1.1 MiB      13      0     39                  0       0        0 1379568 1.1 GiB   16840  16 MiB        0 B         0 B
</screen>
   <para>
    Di seguito è riportata una descrizione delle singole colonne:
   </para>
   <variablelist>
    <varlistentry>
     <term>USED</term>
     <listitem>
      <para>
       Numero di byte utilizzati dal pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>OBJECTS</term>
     <listitem>
      <para>
       Numero di oggetti memorizzati nel pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>CLONES</term>
     <listitem>
      <para>
       Numero di cloni memorizzati nel pool. Quando viene creata una snapshot e si scrive su un oggetto, invece di modificare l'oggetto originale, ne viene creato un clone per evitare che il contenuto dell'oggetto originale acquisito tramite snapshot venga modificato.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>COPIES</term>
     <listitem>
      <para>
       Numero di repliche dell'oggetto. Ad esempio, se un pool replicato con fattore di replica di 3 contiene "x" oggetti, in genere disporrà di 3 * x copie.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>MISSING_ON_PRIMARY</term>
     <listitem>
      <para>
       Numero di oggetti in stato danneggiato (non esistono tutte le copie) mentre la copia è mancante sull'OSD primario.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>UNFOUND</term>
     <listitem>
      <para>
       Numero di oggetti non trovati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>DEGRADED</term>
     <listitem>
      <para>
       Numero di oggetti danneggiati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RD_OPS</term>
     <listitem>
      <para>
       Numero totale di operazioni di lettura richieste per il pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>RD</term>
     <listitem>
      <para>
       Numero totale di byte letti dal pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>WR_OPS</term>
     <listitem>
      <para>
       Numero totale di operazioni di scrittura richieste per il pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>WR</term>
     <listitem>
      <para>
       Numero totale di byte scritti sul pool. Tenere presente che questo valore non corrisponde all'utilizzo del pool, poiché è possibile scrivere sullo stesso oggetto per più volte. Come risultato, il valore di utilizzo del pool rimarrà invariato, ma il numero di byte scritti nel pool aumenterà.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>USED COMPR</term>
     <listitem>
      <para>
       Numero di byte allocati per i dati compressi.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>UNDER COMPR</term>
     <listitem>
      <para>
       Numero di byte occupati dai dati compressi quando non lo sono.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2>
   <title>Ottenimento dei valori del pool</title>
   <para>
    Per ottenere un valore da un pool, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool get <replaceable>pool-name</replaceable> <replaceable>key</replaceable></screen>
   <para>
    È possibile ottenere valori per le chiavi elencate nella <xref linkend="ceph-pools-values"/> oltre che per le chiavi seguenti:
   </para>
   <variablelist>
    <varlistentry>
     <term>pg_num</term>
     <listitem>
      <para>
       Indica il numero di gruppi di posizionamento per il pool. 
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pgp_num</term>
     <listitem>
      <para>
       Indica il numero effettivo dei gruppi di posizionamento da utilizzare quando si calcola il posizionamento dei dati. L'intervallo valido è uguale o minore di <literal>pg_num</literal>.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
   <tip>
    <title>tutti i valori di un pool</title>
    <para>
     Per visualizzare un elenco di tutti i valori correlati a un pool specifico, eseguire:
    </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph osd pool get <replaceable>POOL_NAME</replaceable> all
</screen>
   </tip>
  </sect2>

  <sect2 xml:id="ceph-pools-values">
   <title>Impostazione dei valori del pool </title>
   <para>
    Per impostare un valore a un pool, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set <replaceable>pool-name</replaceable> <replaceable>key</replaceable> <replaceable>value</replaceable></screen>
   <para>
    È possibile impostare i valori per le seguenti chiavi:
   </para>
   <variablelist>
    <varlistentry>
     <term>size</term>
     <listitem>
      <para>
       Imposta il numero di repliche per gli oggetti nel pool. Per ulteriori informazioni, vedere <xref linkend="ceph-pools-options-num-of-replicas"/>. Solo pool replicati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>min_size</term>
     <listitem>
      <para>
       Imposta il numero minimo di repliche richiesto per I/O. Per ulteriori informazioni, vedere <xref linkend="ceph-pools-options-num-of-replicas"/>. Solo pool replicati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>crash_replay_interval</term>
     <listitem>
      <para>
       Indica il numero di secondi da consentire ai client per riprodurre richieste riconosciute, ma non sottoposte a commit.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pg_num</term>
     <listitem>
      <para>
       Indica il numero di gruppi di posizionamento per il pool. Se si aggiungono nuovi OSD al cluster, verificare il valore dei gruppi di posizionamento su tutti i pool utilizzati come destinazione per i nuovi OSD.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>pgp_num</term>
     <listitem>
      <para>
       Indica il numero effettivo dei gruppi di posizionamento da utilizzare quando si calcola il posizionamento dei dati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>crush_ruleset</term>
     <listitem>
      <para>
       Indica il set di regole da utilizzare per la mappatura del posizionamento oggetti nel cluster.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hashpspool</term>
     <listitem>
      <para>
       Impostare (1) o annullare l'impostazione (0) del flag HASHPSPOOL su un determinato pool. Se si abilita questo flag, l'algoritmo viene modificato per distribuire meglio i gruppi di posizionamento agli OSD. Dopo aver abilitato questo flag in un pool il cui flag HASHPSPOOL è stato impostato sul valore 0 di default, nel cluster viene avviato il processo di backfill per fare in modo che il posizionamento di tutti i gruppi di posizionamento sia nuovamente corretto. Si tenga presente che questa procedura potrebbe generare un notevole carico I/O su un cluster, pertanto non abilitare il flag da 0 a 1 sui cluster di produzione con carico elevato.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nodelete</term>
     <listitem>
      <para>
       Impedisce la rimozione del pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nopgchange</term>
     <listitem>
      <para>
       Impedisce di modificare i valori <option>pg_num</option> e <option>pgp_num</option> del pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>nosizechange</term>
     <listitem>
      <para>
       Impedisce di modificare le dimensioni del pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>write_fadvise_dontneed</term>
     <listitem>
      <para>
       Consente di impostare/annullare l'impostazione del flag <literal>WRITE_FADVISE_DONTNEED</literal> su un determinato pool.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>noscrub,nodeep-scrub</term>
     <listitem>
      <para>
       Disabilita la pulitura (approfondita) dei dati per un pool specifico per risolvere carichi I/O temporaneamente elevati.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_type</term>
     <listitem>
      <para>
       Consente di controllare i set di accessi per i pool di cache. Per ulteriori informazioni, vedere <link xlink:href="http://en.wikipedia.org/wiki/Bloom_filter">Bloom Filter</link> (in lingua inglese). Questa opzione può contenere i seguenti valori: <literal>bloom</literal>, <literal>explicit_hash</literal>, <literal>explicit_object</literal>. Il valore di default è <literal>bloom</literal>, gli altri valori sono solo ai fini dei test.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_count</term>
     <listitem>
      <para>
       Indica il numero di set di accessi per i pool di cache. Più elevato è il numero, maggiore è il consumo di RAM da parte del daemon <systemitem>ceph-osd</systemitem>. Il valore di default è <literal>0</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_period</term>
     <listitem>
      <para>
       Indica la durata, espressa in secondi, di un periodo di set di accessi per i pool di cache. Più elevato è il numero, maggiore è il consumo di RAM da parte del daemon <systemitem>ceph-osd</systemitem>. 
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_fpp</term>
     <listitem>
      <para>
       Probabilità falsa positiva per il tipo di set di accessi bloom. Per ulteriori informazioni, vedere <link xlink:href="http://en.wikipedia.org/wiki/Bloom_filter">Bloom Filter</link> (in lingua inglese). L'intervallo valido è da 0,0 a 1,0; il valore di default è <literal>0,05</literal>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>use_gmt_hitset</term>
     <listitem>
      <para>
       Forza gli OSD a utilizzare le registrazioni dell'orario GMT (ora di Greenwich) quando si crea un set di accessi per la suddivisione in livelli di cache. In tal modo ci si assicura che i nodi in fusi orari diversi restituiscano lo stesso risultato. Il valore di default è <literal>1</literal>. Tale valore non deve essere modificato.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_dirty_ratio</term>
     <listitem>
      <para>
       Indica la percentuale del pool di cache contenente oggetti modificati prima che l'agente di suddivisione in livelli di cache li svuoti nel pool di memorizzazione di supporto. Il valore di default è <literal>0.4</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_dirty_high_ratio</term>
     <listitem>
      <para>
       Indica la percentuale del pool di cache contenente oggetti modificati prima che l'agente di suddivisione in livelli di cache li svuoti nel pool di memorizzazione di supporto con una velocità più elevata. Il valore di default è <literal>0.6</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_target_full_ratio</term>
     <listitem>
      <para>
       Indica la percentuale del pool di cache contenente oggetti non modificati prima che l'agente di suddivisione in livelli di cache li rimuova dal pool di cache. Il valore di default è <literal>0.8</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>target_max_bytes</term>
     <listitem>
      <para>
       Ceph inizierà lo svuotamento o la rimozione degli oggetti quando viene attivata la soglia <option>max_bytes</option>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>target_max_objects</term>
     <listitem>
      <para>
       Ceph inizierà lo svuotamento o la rimozione degli oggetti quando viene attivata la soglia <option>max_objects</option>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_grade_decay_rate</term>
     <listitem>
      <para>
       Grado di decadimento della temperatura tra due <literal>hit_set</literal> consecutivi. Il valore di default è <literal>20</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>hit_set_search_last_n</term>
     <listitem>
      <para>
       Numero massimo <literal>N</literal> di visualizzazioni negli <literal>hit_set</literal> per il calcolo della temperatura. Il valore di default è <literal>1</literal>. 
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_min_flush_age</term>
     <listitem>
      <para>
       Tempo (in secondi) prima che l'agente di suddivisione in livelli di cache svuoti un oggetto dal pool di cache nel pool di memorizzazione.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>cache_min_evict_age</term>
     <listitem>
      <para>
       Tempo (in secondi) prima che l'agente di suddivisione in livelli di cache rimuova un oggetto dal pool di cache.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>fast_read</term>
     <listitem>
      <para>
       Se questo flag è abilitato nei pool con codice di cancellazione, la richiesta di lettura emette sottoletture a tutte le partizioni e attende di ricevere un numero sufficiente di partizioni da decodificare per servire il client. Nel caso dei plug-in di cancellazione <emphasis>jerasure</emphasis> e <emphasis>isa</emphasis>, quando vengono restituite le prime risposte <literal>K</literal>, la richiesta del client viene eseguita immediatamente utilizzando i dati decodificati da tali risposte. Questo approccio causa un maggiore carico sulla CPU e un minore carico sul disco/sulla rete. Attualmente il flag è supportato solo per i pool con codice di cancellazione. Il valore di default è <literal>0</literal>.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>scrub_min_interval</term>
     <listitem>
      <para>
       Intervallo minimo espresso in secondi per la pulitura dei pool quando il carico del cluster è basso. Il valore di default <literal>0</literal> significa che viene utilizzato il valore <option>osd_scrub_min_interval</option> ricavato dal file di configurazione Ceph.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>scrub_max_interval</term>
     <listitem>
      <para>
       Intervallo massimo espresso in secondi per la pulitura dei pool, indipendentemente dal carico del cluster. Il valore di default <literal>0</literal> significa che viene utilizzato il valore <option>osd_scrub_max_interval</option> ricavato dal file di configurazione Ceph.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>deep_scrub_interval</term>
     <listitem>
      <para>
       Intervallo espresso in secondi per la pulitura <emphasis>approfondita</emphasis> del pool. Il valore di default <literal>0</literal> significa che viene utilizzato il valore <option>osd_deep_scrub</option> ricavato dal file di configurazione Ceph.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="ceph-pools-options-num-of-replicas">
   <title>Impostazione del numero di repliche di oggetti</title>
   <para>
    Per impostare il numero di repliche di oggetti in un pool replicato, eseguire quanto riportato di seguito:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set <replaceable>poolname</replaceable> size <replaceable>num-replicas</replaceable></screen>
   <para>
    In <replaceable>num-replicas</replaceable> è incluso l'oggetto stesso. Se ad esempio si desiderano l'oggetto e due copie dello stesso per un totale di tre istanze dell'oggetto, specificare 3.
   </para>
   <warning>
    <title>non impostare meno di 3 repliche</title>
    <para>
     Se si imposta <replaceable>num-replicas</replaceable> a 2, si otterrà solo <emphasis>una</emphasis> copia dei dati. Se si perde un'istanza oggetto, è necessario confidare nel fatto che l'altra copia non sia corrotta, ad esempio dall'ultima pulitura effettuata durante il recupero (fare riferimento alla <xref linkend="scrubbing"/>).
    </para>
    <para>
     L'impostazione di un pool a una replica significa che nel pool è presente <emphasis>una</emphasis> istanza esatta dell'oggetto Dati. In caso di errore dell'OSD, i dati vengono persi. Un utilizzo possibile di un pool con una replica consiste nella memorizzazione temporanea dei dati per un breve periodo.
    </para>
   </warning>
   <tip>
    <title>impostazione di più di 3 repliche</title>
    <para>
     Se vengono impostate 4 repliche per un pool, è possibile aumentare l'affidabilità del 25%.
    </para>
    <para>
     Nel caso di due data center, è necessario impostare almeno 4 repliche per un pool affinché siano presenti due copie in ciascun data center per fare in modo che, se un data center viene perso, ne esistano comunque due copie e i dati vengano conservati anche in caso di perdita di un disco.
    </para>
   </tip>
   <note>
    <para>
     Un oggetto potrebbe accettare I/O danneggiati con meno di <literal>pool size</literal> repliche. Per impostare un numero minimo di repliche obbligatorie per I/O, si deve utilizzare l'impostazione <literal>min_size</literal>. Ad esempio:
    </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool set data min_size 2</screen>
    <para>
     In tal modo ci si assicura che nessun oggetto nel pool di dati riceva I/O con meno di <literal>min_size</literal> repliche.
    </para>
   </note>
   <tip>
    <title>ottenimento del numero di repliche di oggetti</title>
    <para>
     Per ottenere il numero di repliche di oggetti, eseguire quanto riportato di seguito:
    </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd dump | grep 'replicated size'</screen>
    <para>
     Ceph elencherà i pool, con l'attributo <literal>replicated size</literal> evidenziato. Per default, Ceph crea due repliche di un oggetto (per un totale di tre copie o una dimensione pari a 3).
    </para>
   </tip>
  </sect2>
 </sect1>
 <sect1 xml:id="pools-migration">
  <title>Migrazione del pool</title>

  <para>
   Quando si crea un pool (vedere <xref linkend="ceph-pools-operate-add-pool"/>) è necessario specificarne i parametri iniziali, come il tipo di pool o il numero dei gruppi di posizionamento. Se in un secondo momento si decide di modificare uno di questi parametri, ad esempio durante la conversione di un pool replicato in uno con codice di cancellazione o se si riduce il numero di gruppi di posizionamento, è necessario eseguire la migrazione dei dati del pool su un altro i cui parametri sono adatti alla distribuzione attualmente attiva.
  </para>

  <para>
   Esistono vari metodi di migrazione dei pool. Si consiglia di utilizzare il <emphasis>livello di cache</emphasis> perché questo metodo è invisibile all'utente, riduce il tempo di fermo del cluster e consente di evitare la duplicazione dei dati di tutto il pool.
  </para>

  <sect2 xml:id="pool-migrate-cache-tier">
   <title>Esecuzione della migrazione con il livello di cache</title>
   <tip>
    <title>migrazione del solo pool replicato</title>
    <para>
     È possibile utilizzare il metodo del livello di cache per eseguire la migrazione da un pool replicato a un pool con codice di cancellazione o a un altro pool replicato. La migrazione da un pool con codice di cancellazione non è supportata.
    </para>
   </tip>
   <para>
    Il principio è semplice: includere il pool di cui eseguire la migrazione in un livello di cache in ordine inverso. Ulteriori dettagli sui livelli di cache sono disponibili nel <xref linkend="cha-ceph-tiered"/>. Nell'esempio seguente viene eseguita la migrazione di un pool replicato denominato "testpool" a un pool con codice di cancellazione:
   </para>
   <procedure>
    <title>Migrazione del pool replicato al pool con codice di cancellazione</title>
    <step>
     <para>
      Creare un novo pool con codice di cancellazione denominato "newpool". Fare riferimento alla <xref linkend="ceph-pools-operate-add-pool"/> per una spiegazione dettagliata dei parametri di creazione del pool.
     </para>
<screen>
 <prompt>cephadm@adm &gt; </prompt>ceph osd pool create newpool <replaceable>PG_NUM</replaceable> <replaceable>PGP_NUM</replaceable> erasure default
</screen>
     <para>
      Verificare che il portachiavi del client utilizzato fornisca per "newpool" almeno le stesse capacità di "testpool".
     </para>
     <para>
      Adesso si hanno due pool: quello originale replicato "testpool" compilato con i dati e il nuovo pool con codice di cancellazione vuoto "newpool":
     </para>
     <figure>
      <title>Pool prima della migrazione</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate1.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate1.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Impostare il livello di cache e configurare il pool replicato "testpool" come pool di cache. L'opzione <option>-force-nonempty</option> consente di aggiungere un livello di cache anche se il pool contiene già dei dati:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph tell mon.* injectargs \
 '--mon_debug_unsafe_allow_tier_with_nonempty_snaps=1'
<prompt>cephadm@adm &gt; </prompt>ceph osd tier add newpool testpool --force-nonempty
<prompt>cephadm@adm &gt; </prompt>ceph osd tier cache-mode testpool proxy
</screen>
     <figure>
      <title>Impostazione del livello di cache</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate2.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate2.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Forzare il pool di cache in modo che tutti gli oggetti vengano spostati nel nuovo pool:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rados -p testpool cache-flush-evict-all
</screen>
     <figure>
      <title>Svuotamento dei dati</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate3.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate3.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Fino a quando lo svuotamento di tutti i dati nel pool con codice di cancellazione non è completato, è necessario specificare un overlay in modo che la ricerca degli oggetti venga eseguita nel pool precedente:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph osd tier set-overlay newpool testpool
</screen>
     <para>
      Con l'overlay, tutte le operazioni vengono inoltrate al "testpool" replicato precedente:
     </para>
     <figure>
      <title>Impostazione dell'overlay</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate4.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate4.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>
      Adesso è possibile commutare tutti i client agli oggetti di accesso nel nuovo pool.
     </para>
    </step>
    <step>
     <para>
      Dopo la migrazione di tutti i dati nel "newpool" con codice di cancellazione, rimuovere l'overlay e il pool di cache "testpool" precedente:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph osd tier remove-overlay newpool
<prompt>cephadm@adm &gt; </prompt>ceph osd tier remove newpool testpool
</screen>
     <figure>
      <title>Completamento della migrazione</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="pool_migrate5.png" width="60%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="pool_migrate5.png" width="60%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </step>
    <step>
     <para>
      Esecuzione
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph tell mon.* injectargs \
 '--mon_debug_unsafe_allow_tier_with_nonempty_snaps=0'
</screen>
    </step>
   </procedure>
   <warning>
    <title>non è possibile eseguire la migrazione delle immagini RBD e delle esportazioni CephFS su un pool EC</title>
    <para>
     Non è possibile eseguire la migrazione delle immagini RBD e delle esportazioni CephFS da un pool replicato a un pool EC. I pool EC possono memorizzare i dati, ma non i metadati. Lo svuotamento dell'oggetto intestazione dell'RBD non riuscirà correttamente. Lo stesso vale per CephFS.
    </para>
   </warning>
  </sect2>

  <sect2 xml:id="migrate-rbd-image">
   <title>Migrazione di un'immagine del dispositivo di blocco RADOS</title>
   <para>
    Di seguito è indicata la modalità consigliata per eseguire la migrazione delle immagini RBD da un pool replicato a un altro.
   </para>
   <procedure>
    <step>
     <para>
      Interrompere l'accesso dei client (ad esempio le macchine virtuali) all'immagine RBD.
     </para>
    </step>
    <step>
     <para>
      Creare una nuova immagine nel pool di destinazione, con l'elemento superiore impostato sull'immagine di origine:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rbd migration prepare <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable> <replaceable>TARGET_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
     <tip>
      <title>migrazione soltanto dei dati a un pool EC</title>
      <para>
       Se è necessario eseguire la migrazione soltanto dei dati dell'immagine a un nuovo pool EC e lasciare i metadati nel pool replicato originale, eseguire invece il comando seguente:
      </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rbd migration prepare <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable> \
 --data-pool <replaceable>TARGET_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
     </tip>
     <note>
      <title>supporto e tempo di fermo del client</title>
      <para>
       Il metodo <command>rbd migration</command> consente di eseguire la migrazione delle immagini con un tempo di fermo del client minimo. È necessario soltanto interrompere il client prima della fase "prepare" e avviarlo in seguito. Tenere presente che solo un client <systemitem>librbd</systemitem> che supporta questa funzione (Ceph Nautilus o più recenti) sarà in grado di aprire l'immagine subito dopo la fase "prepare", mentre i client <systemitem>librbd</systemitem> meno recenti o i client <systemitem>krbd</systemitem> non saranno in grado di aprire l'immagine finché non viene eseguita la fase "commit".
      </para>
     </note>
    </step>
    <step>
     <para>
      Concedere ai client l'accesso all'immagine nel pool di destinazione.
     </para>
    </step>
    <step>
     <para>
      Eseguire la migrazione dei dati al pool di destinazione:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rbd migration execute <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
    </step>
    <step>
     <para>
      Rimuovere l'immagine meno recente:
     </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rbd migration commit <replaceable>SRC_POOL</replaceable>/<replaceable>IMAGE</replaceable>
</screen>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="cha-ceph-snapshots-pool">
  <title>Snapshot del pool</title>

  <para>
   Gli snapshot del pool riprendono lo stato dell'interno pool Ceph. Con gli snapshot del pool è possibile mantenere la cronologia dello stato del pool. La creazione di snapshot del pool consuma spazio di storage in modo proporzionale alle dimensioni del pool. Verificare sempre che lo spazio su disco nello spazio di memorizzazione correlato sia sufficiente prima di creare lo snapshot di un pool.
  </para>

  <sect2>
   <title>Creazione dello snapshot di un pool</title>
   <para>
    Per creare una snapshot di un pool, eseguire:
   </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>ceph osd pool mksnap <replaceable>POOL-NAME</replaceable> <replaceable>SNAP-NAME</replaceable>
</screen>
   <para>
    Ad esempio:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool mksnap pool1 snap1
created pool pool1 snap snap1</screen>
  </sect2>

  <sect2>
   <title>Elenco di snapshot di un pool</title>
   <para>
    Per visualizzare un elenco delle snapshot esistenti di un pool, eseguire:
   </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rados lssnap -p <replaceable>POOL_NAME</replaceable>
</screen>
   <para>
    Ad esempio:
   </para>
<screen>
<prompt>cephadm@adm &gt; </prompt>rados lssnap -p pool1
1	snap1	2018.12.13 09:36:20
2	snap2	2018.12.13 09:46:03
2 snaps
</screen>
  </sect2>

  <sect2>
   <title>Rimozione dello snapshot di un pool</title>
   <para>
    Per rimuovere una snapshot di un pool, eseguire:
   </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd pool rmsnap <replaceable>POOL-NAME</replaceable> <replaceable>SNAP-NAME</replaceable></screen>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-ceph-pool-compression">
  <title>Compressione dei dati</title>

  <para>
   Per risparmiare spazio su disco, in BlueStore (ulteriori dettagli nel riferimento <xref linkend="about-bluestore"/>) è disponibile la compressione rapida dei dati. Il rapporto di compressione dipende dai dati memorizzati nel sistema. Tenere presente che per le attività di compressione/decompressione è richiesta una potenza della CPU aggiuntiva.
  </para>

  <para>
   È possibile configurare la compressione dei dati a livello globale (vedere la <xref linkend="sec-ceph-pool-bluestore-compression-options"/>) e quindi sostituire le impostazioni di compressione specifiche per ciascun pool individuale.
  </para>

  <para>
   È possibile abilitare o disabilitare la compressione dei dati del pool o modificare l'algoritmo e la modalità di compressione in qualsiasi momento, a prescindere dal fatto che il pool contenga o meno dati.
  </para>

  <para>
   Dopo aver abilitato la compressione del pool, non verrà applicata alcuna compressione ai dati esistenti.
  </para>

  <para>
   Dopo aver disabilitato la compressione di un pool, tutti i relativi dati verranno decompressi.
  </para>

  <sect2 xml:id="sec-ceph-pool-compression-enable">
   <title>Abilitazione della compressione</title>
   <para>
    Per abilitare la compressione dei dati per un pool denominato <replaceable>POOL_NAME</replaceable>, eseguire il comando seguente:
   </para>
<screen>
<prompt>cephadm@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_algorithm <replaceable>COMPRESSION_ALGORITHM</replaceable>
<prompt>cephadm@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_mode <replaceable>COMPRESSION_MODE</replaceable>
</screen>
   <tip>
    <title>disabilitazione della compressione del pool</title>
    <para>
     Per disabilitare la compressione dei dati per un pool, utilizzare "none" come algoritmo di compressione:
    </para>
<screen>
<prompt>cephadm@adm &gt; </prompt><command>ceph</command> osd pool set <replaceable>POOL_NAME</replaceable> compression_algorithm none
</screen>
   </tip>
  </sect2>

  <sect2 xml:id="sec-ceph-pool-compression-options">
   <title>Opzioni di compressione del pool</title>
   <para>
    Elenco completo delle opzioni di compressione:
   </para>
   <variablelist>
    <varlistentry xml:id="compr-algorithm">
     <term>compression_algorithm</term>
     <listitem>
      <para>
       I valori possibili sono <literal>none</literal>, <literal>zstd</literal>, <literal>snappy</literal>. L'impostazione di default è <literal>snappy</literal>.
      </para>
      <para>
       L'algoritmo di compressione da utilizzare dipenda dal caso di utilizzo specifico. Di seguito sono riportati alcuni suggerimenti:
      </para>
      <itemizedlist>
       <listitem>
        <para>
         Utilizzare il valore di default <literal>snappy</literal> a meno che non sia necessario modificarlo per qualche motivo.
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>zstd</literal> offre un buon rapporto di compressione, ma causa un elevato overhead della CPU durante la compressione di piccole quantità di dati.
        </para>
       </listitem>

       <listitem>
        <para>
         Eseguire un benchmark di questi algoritmi su un campione dei dati effettivi continuando a osservare la CPU e il consumo di memoria del cluster.
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="compr-mode">
     <term>compression_mode</term>
     <listitem>
      <para>
       I valori possibili sono <literal>none</literal>, <literal>aggressive</literal>, <literal>passive</literal>, <literal>force</literal>. L'impostazione di default è <literal>none</literal>.
      </para>
      <itemizedlist>
       <listitem>
        <para>
         <literal>none</literal>: la compressione non viene eseguita mai
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>passive</literal>: la compressione viene eseguita se suggerita come <literal>COMPRESSIBLE</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>aggressive</literal>: la compressione viene eseguita a meno che non sia suggerita come <literal>INCOMPRESSIBLE</literal>
        </para>
       </listitem>
       <listitem>
        <para>
         <literal>force</literal>: la compressione viene eseguita sempre
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry xml:id="compr-ratio">
     <term>compression_required_ratio</term>
     <listitem>
      <para>
       Valore: doppio, rapporto = SIZE_COMPRESSED / SIZE_ORIGINAL. Il valore di default è <literal>0,875</literal>, che indica che l'oggetto non verrà compresso se la compressione non riduce lo spazio occupato di almeno il 12,5%.
      </para>
      <para>
       Gli oggetti al di sopra di tale rapporto non verranno memorizzati compressi a causa del basso guadagno netto.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>compression_max_blob_size</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>0</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti che vengono compressi.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>compression_min_blob_size</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>0</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti che vengono compressi.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-ceph-pool-bluestore-compression-options">
   <title>Opzioni di compressione globali</title>
   <para>
    È possibile impostare le seguenti opzioni di configurazione nella configurazione di Ceph e applicarle a tutti gli OSD, non solo a un singolo pool. La configurazione specifica per il pool indicata nella <xref linkend="sec-ceph-pool-compression-options"/> ha la precedenza.
   </para>
   <variablelist>
    <varlistentry>
     <term>bluestore_compression_algorithm</term>
     <listitem>
      <para>
       Vedere <xref linkend="compr-algorithm"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_mode</term>
     <listitem>
      <para>
       Vedere <xref linkend="compr-mode"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_required_ratio</term>
     <listitem>
      <para>
       Vedere <xref linkend="compr-ratio"/>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>0</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti che vengono compressi. L'impostazione viene ignorata per default a favore di <option>bluestore_compression_min_blob_size_hdd</option> e <option>bluestore_compression_min_blob_size_ssd</option>. Ha la precedenza quando viene impostata su un valore diverso da zero.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>0</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti compressi prima che vengano suddivisi in porzioni più piccole. L'impostazione viene ignorata per default a favore di <option>bluestore_compression_max_blob_size_hdd</option> e <option>bluestore_compression_max_blob_size_ssd</option>. Ha la precedenza quando viene impostata su un valore diverso da zero.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size_ssd</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>8 K</literal>
      </para>
      <para>
       Dimensioni minime degli oggetti che vengono compressi e memorizzati su un'unità SSD.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size_ssd</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>64 K</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti compressi e memorizzati nell'unità a stato solito prima che vengano suddivisi in porzioni più piccole.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_min_blob_size_hdd</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>128 K</literal>
      </para>
      <para>
       Dimensioni minime degli oggetti che vengono compressi e memorizzati su dischi rigidi.
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>bluestore_compression_max_blob_size_hdd</term>
     <listitem>
      <para>
       Valore: intero non firmato, dimensioni in byte. Default: <literal>512 K</literal>
      </para>
      <para>
       Dimensioni massime degli oggetti compressi e memorizzati nei dischi rigidi prima che vengano suddivisi in porzioni più piccole.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
</chapter>
