<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_ds_backup.xml" version="5.0" xml:id="cha.deployment_backup">
 <title>Fazendo backup da configuração do cluster</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer>tbazant@suse.com</dm:maintainer>
        <dm:status>editando</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes (sim)</dm:translation>
        <dm:languages/>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  Este capítulo explica os arquivos no nó de admin dos quais se deve fazer o backup. Logo após concluir a implantação ou a migração do seu cluster, crie um backup destes diretórios.
 </para>
 <sect1 xml:id="sec.deployment_backup.salt">
  <title>Fazer backup da configuração do Salt</title>

  <para>
   É possível fazer backup do diretório <filename>/etc/salt/</filename>. Ele contém os arquivos de configuração do Salt. Por exemplo, a chave master do Salt e as chaves aceitas do cliente.
  </para>

  <para>
   Os arquivos do Salt não são estritamente necessários para fazer backup do nó de admin, mas facilitam a reimplantação do cluster do Salt. Se não houver nenhum backup desses arquivos, os minions Salt precisarão ser registrados novamente no novo nó de admin.
  </para>

  <note>
   <title>Segurança da chave privada master do Salt</title>
   <para>
    Garanta que o backup da chave privada master do Salt esteja armazenado em um local seguro. A chave master do Salt pode ser usada para manipular todos os nós do cluster.
   </para>
  </note>

  <para>
   Após a restauração do diretório <filename>/etc/salt</filename> de um backup, reinicie os serviços Salt:
  </para>

<screen><prompt>root@master # </prompt><command>systemctl</command> restart salt-master
<prompt>root@master # </prompt><command>systemctl</command> restart salt-minion</screen>
 </sect1>
 <sect1 xml:id="sec.deployment_backup.deepsea">
  <title>Fazer backup da configuração do DeepSea</title>

  <para>
   Todos os arquivos necessários ao DeepSea são armazenados em <filename>/srv/pillar/</filename>, <filename>/srv/salt/</filename> e <filename>/etc/salt/master.d</filename>.
  </para>

  <para>
   Se você precisar reimplantar o nó de admin, instale o pacote do DeepSea no novo nó e mova os dados dos quais foi feito o backup de volta aos diretórios. Em seguida, o DeepSea poderá ser usado novamente sem a necessidade de outras modificações. Antes de usar o DeepSea de novo, verifique se todos os minions Salt estão registrados corretamente no nó de admin.
  </para>
 </sect1>
</chapter>
