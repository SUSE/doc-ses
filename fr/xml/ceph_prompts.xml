<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ceph_prompts.xml" version="5.0">
 <title>Privilèges des utilisateurs et invites de commande</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>tbazant@suse.com</dm:maintainer>
   <dm:status>modification</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>oui</dm:translation>
   <dm:languages/>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para>
  En tant qu'administrateur de grappe Ceph, vous configurez et ajustez le comportement de la grappe en exécutant des commandes spécifiques. Il existe plusieurs types de commandes dont vous avez besoin :
 </para>
 <sect1>
  <title>Commandes associées à Salt/DeepSea</title>

  <para>
   Ces commandes vous aident à déployer ou à mettre à niveau la grappe Ceph, à exécuter des commandes simultanément sur plusieurs noeuds de la grappe (ou tous), ou à ajouter ou supprimer des noeuds de la grappe. Les plus fréquemment utilisées sont <command>salt</command>, <command>salt-run</command> et <command>deepsea</command>. Vous devez exécuter les commandes Salt sur le noeud Salt Master (voir <xref linkend="deepsea-description"/> pour les détails) en tant qu'utilisateur <systemitem class="username">root</systemitem>. Ces commandes sont introduites avec l'invite suivante :
  </para>

<screen>
<prompt>root@master # </prompt>
</screen>

  <para>
   Par exemple :
  </para>

<screen>
<prompt>root@master # </prompt>salt '*.example.net' test.ping
</screen>
 </sect1>
 <sect1>
  <title>Commandes associées à Ceph</title>

  <para>
   Il s'agit de commandes de niveau inférieur pour configurer et affiner tous les aspects de la grappe et de ses passerelles sur la ligne de commande. Citons notamment les suivantes : <command>ceph</command>, <command>rbd</command>, <command>radosgw-admin</command> ou <command>crushtool</command>.
  </para>

  <para>
   Pour exécuter les commandes associées à Ceph, vous devez disposé d'un accès en lecture à une clé Ceph. Les fonctionnalités de la clé définissent alors vos privilèges au sein de l'environnement Ceph. Une option consiste à exécuter les commandes Ceph en tant qu'utilisateur <systemitem class="username">root</systemitem> (ou via <command>sudo</command>) et à employer le trousseau de clés par défaut sans restriction « ceph.client.admin.key ».
  </para>

  <para>
   L'option plus sûre et recommandée est de créer une clé individuelle plus restrictive pour chaque administrateur et de la placer dans un répertoire où les utilisateurs peuvent la lire, par exemple :
  </para>

<screen>~/.ceph/ceph.client.<replaceable>USERNAME</replaceable>.keyring</screen>

  <tip>
   <title>chemin des clés Ceph</title>
   <para>
    Pour utiliser un administrateur et un trousseau de clés personnalisés, vous devez spécifier le nom d'utilisateur et le chemin d'accès à la clé chaque fois que vous exécutez la commande <command>ceph</command> à l'aide des options <option>-n client.<replaceable>NOM_UTILISATEUR</replaceable></option> et <option>--keyring <replaceable>CHEMIN/VERS/TROUSSEAU</replaceable></option>.
   </para>
   <para>
    Pour éviter cela, incluez ces options dans la variable <varname>CEPH_ARGS</varname> des fichiers <filename>~/.bashrc</filename> des différents utilisateurs.
   </para>
  </tip>

  <para>
   Bien que vous puissiez exécuter les commandes associées à Ceph sur n'importe quel noeud de la grappe, nous vous recommandons de les lancer sur le noeud Admin. Dans cette documentation, nous employons l'utilisateur <systemitem class="username">cephadm</systemitem> pour exécuter les commandes. Elles sont donc introduites avec l'invite suivante :
  </para>

<screen>
<prompt>cephadm@adm &gt; </prompt>
</screen>

  <para>
   Par exemple :
  </para>

<screen>
<prompt>cephadm@adm &gt; </prompt>ceph auth list
</screen>

  <tip>
   <title>commandes de noeuds spécifiques</title>
   <para>
    Si la documentation vous demande d'exécuter une commande sur un noeud de la grappe avec un rôle spécifique, cela sera réglé par l'invite. Par exemple :
   </para>
<screen>
<prompt>cephadm@mon &gt; </prompt>
</screen>
  </tip>
 </sect1>
 <sect1>
  <title>Commandes Linux générales</title>

  <para>
   Les commandes Linux non associées à Ceph ou à DeepSea, telles que <command>mount</command>, <command>cat</command> ou <command>openssl</command>, sont introduites avec les invites <prompt>cephadm@adm &gt;</prompt> ou <prompt>root #</prompt>, selon les privilèges que la commande concernée nécessite.
  </para>
 </sect1>
 <sect1>
  <title>Informations complémentaires</title>

  <para>
   Pour plus d'informations sur la gestion des clés Ceph, reportez-vous à la <xref linkend="storage-cephx-keymgmt"/>.
  </para>
 </sect1>
</chapter>
