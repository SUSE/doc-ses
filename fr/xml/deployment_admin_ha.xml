<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha.admin_ha">
 <title>Configuration haute disponibilité du noeud Ceph Admin</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>oui</dm:translation>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  Le <emphasis>noeud Ceph Admin</emphasis> est un noeud de la grappe Ceph dans lequel le service Salt Master est en cours d'exécution. Le noeud admin est un point central de la grappe Ceph, car il gère les autres noeuds de la grappe en interrogeant et en instruisant leurs services de minion Salt. En général, il inclut également d'autres services, par exemple l'interface utilisateur Web openATTIC avec le tableau de bord <emphasis>Grafana</emphasis> et le toolkit de surveillance <emphasis>Prometheus</emphasis>.
 </para>
 <para>
  En cas de défaillance du noeud Ceph Admin, vous devez généralement fournir un nouveau matériel pour le noeud et restaurer la pile de configuration complète de la grappe à partir d'une sauvegarde récente. Cette méthode prend énormément de temps et provoque l'interruption de la grappe.
 </para>
 <para>
  Pour éviter le temps hors service des performances de la grappe Ceph causé par la défaillance du noeud admin, il est recommandé d'utiliser la grappe haute disponibilité pour le noeud Ceph Admin.
 </para>
 <sect1 xml:id="admin_ha.architecture">
  <title>Aperçu de la grappe haute disponibilité pour le noeud Ceph Admin</title>

  <para>
   L'idée d'une grappe haute disponibilité (High Availability, HA) est qu'en cas de défaillance d'un noeud de la grappe, l'autre noeud prend automatiquement en charge son rôle, y compris le noeud Ceph Admin virtualisé. Ainsi, les autres noeuds de la grappe Ceph ne remarquent pas la défaillance du noeud Ceph Admin.
  </para>

  <para>
   La solution haute disponibilité minimale pour le noeud Ceph Admin requiert le matériel suivant :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Deux serveurs sans système d'exploitation en mesure d'exécuter SUSE Linux Enterprise avec l'extension haute disponibilité et de virtualiser le noeud Ceph Admin.
    </para>
   </listitem>
   <listitem>
    <para>
     Deux ou plusieurs chemins de communication réseau redondants, par exemple via la liaison de périphérique réseau.
    </para>
   </listitem>
   <listitem>
    <para>
     Stockage partagé pour héberger les images de disque de la machine virtuelle du noeud Ceph Admin. Le stockage partagé doit être accessible depuis les deux serveurs. Il peut s'agir, par exemple, d'une exportation NFS, d'un partage Samba ou d'une cible iSCSI.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Pour plus d'informations sur les conditions requises de la grappe, reportez-vous à l'adresse <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html#sec_ha_inst_quick_req"/>.
  </para>

  <figure>
   <title>grappe haute disponibilité à 2 noeuds pour le noeud Ceph Admin</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin_ha.cluster">
  <title>Création d'une grappe haute disponibilité avec le noeud Ceph Admin</title>

  <para>
   La procédure suivante résume les étapes les plus importantes de la création d'une grappe haute disponibilité pour la virtualisation du noeud Ceph Admin. Pour plus d'informations, reportez-vous aux liens indiqués.
  </para>

  <procedure>
   <step>
    <para>
     Configurez une grappe haute disponibilité à 2 noeuds de base avec un stockage partagé comme décrit dans le manuel <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html"/>.
    </para>
   </step>
   <step>
    <para>
     Sur les deux noeuds de la grappe, installez tous les paquetages requis pour l'exécution de l'hyperviseur KVM et du toolkit <systemitem class="library">libvirt</systemitem> comme décrit dans le manuel <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_vt_installation_kvm.html"/>.
    </para>
   </step>
   <step>
    <para>
     Sur le premier noeud de la grappe, créez une machine virtuelle KVM en utilisant <systemitem class="library">libvirt</systemitem> comme décrit dans le manuel <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_libvirt_inst_vmm.html"/>. Utilisez le stockage partagé préconfiguré pour stocker les images de disque de la machine virtuelle.
    </para>
   </step>
   <step>
    <para>
     Une fois la configuration de la machine virtuelle terminée, exportez sa configuration dans un fichier XML sur le stockage partagé. Utilisez la syntaxe suivante.
    </para>
<screen>
<prompt>root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Créez une ressource pour la machine virtuelle du noeud Ceph Admin. Reportez-vous à l'adresse <link xlink:href="https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_conf_hawk2.html"/> pour des informations générales sur la création de ressources haute disponibilité. Des informations détaillées sur la création de ressources pour une machine virtuelle KVM sont décrites à l'adresse <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/>.
    </para>
   </step>
   <step>
    <para>
     Sur l'invité de la machine virtuelle qui vient d'être créé, déployez le noeud Ceph Admin, y compris les services supplémentaires dont vous avez besoin. Suivez les étapes appropriées de la <xref linkend="ceph.install.stack"/>. En même temps, déployez les noeuds de la grappe Ceph restants sur les serveurs de grappe non-HA.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>
