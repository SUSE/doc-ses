<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_ds_backup.xml" version="5.0" xml:id="cha-deployment-backup">
 <title>Copia de seguridad de la configuración y los datos del clúster</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>tbazant@suse.com</dm:maintainer>
   <dm:status>editar</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>sí</dm:translation>
   <dm:languages/>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para>
  En este capítulo se explica de qué partes del clúster de Ceph se debe realizar una copia de seguridad para poder restaurarlo.
 </para>
 <sect1 xml:id="backup-ceph">
  <title>Copia de seguridad de la configuración de Ceph</title>

  <para>
   Realice una copia de seguridad del directorio <filename>/etc/ceph</filename>. Contiene configuración crucial del clúster. Necesitará la copia de seguridad de <filename>/etc/ceph</filename> cuando necesite sustituir el nodo de administración, por ejemplo.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-backup-salt">
  <title>Copia de seguridad de la configuración de Salt</title>

  <para>
   Debe realizar una copia de seguridad del directorio <filename>/etc/salt/</filename>. Contiene los archivos de configuración de Salt, por ejemplo la clave maestra de Salt y las claves de cliente aceptadas.
  </para>

  <para>
   No es estrictamente necesario incluir los archivos de Salt al realizar una copia de seguridad del nodo de administración, pero facilita la posterior redistribución del clúster de Salt. Si no se hace una copia de seguridad de estos archivos, los minions de Salt deben registrarse de nuevo en el nuevo nodo de administración.
  </para>

  <note>
   <title>seguridad de la clave privada de master de Salt</title>
   <para>
    Asegúrese de que la copia de seguridad de la clave privada del master de Salt se guarda en una ubicación segura. La clave del master de Salt puede emplearse para manipular todos los nodos del clúster.
   </para>
  </note>

  <para>
   Después de restaurar el directorio <filename>/etc/salt</filename> desde una copia de seguridad, reinicie los servicios de Salt:
  </para>

<screen><prompt>root@master # </prompt><command>systemctl</command> restart salt-master
<prompt>root@master # </prompt><command>systemctl</command> restart salt-minion</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-backup-deepsea">
  <title>Copia de seguridad de la configuración de DeepSea</title>

  <para>
   Todos los archivos requeridos por DeepSea se almacenan en <filename>/srv/pillar/</filename>, en <filename>/srv/salt/</filename> y en <filename>/etc/salt/master.d</filename>.
  </para>

  <para>
   Si necesita volver a distribuir el nodo de administración, instale el paquete de DeepSea en el nodo nuevo y mueva los datos copiados de vuelta a los directorios. DeepSea puede usarse de nuevo sin realizar más cambios. Antes de volver a utilizar DeepSea, asegúrese de que todos los minions de Salt están registrados correctamente en el nodo de administración.
  </para>
 </sect1>
 <sect1 xml:id="backup-config-files">
  <title>Copia de seguridad de configuraciones personalizadas</title>

  <itemizedlist>
   <listitem>
    <para>
     Datos y personalizaciones de Prometheus.
    </para>
   </listitem>
   <listitem>
    <para>
     Personalizaciones de Grafana.
    </para>
   </listitem>
   <listitem>
    <para>
     Verifique que tiene un registro de los usuarios openATTIC existentes a fin de poder crear nuevas cuentas para esos usuarios en Ceph Dashboard.
    </para>
   </listitem>
   <listitem>
    <para>
     Cambios manuales de <filename>ceph.conf</filename> fuera de DeepSea.
    </para>
   </listitem>
   <listitem>
    <para>
     Cambios manuales de la configuración de iSCSI fuera de DeepSea.
    </para>
   </listitem>
   <listitem>
    <para>
     Claves de ceph.
    </para>
   </listitem>
   <listitem>
    <para>
     Mapa y reglas de CRUSH. Guarde el mapa de CRUSH descompilado, incluidas las reglas de CRUSH, en <filename>crushmap-backup.txt</filename> ejecutando el siguiente comando:
    </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd getcrushmap | crushtool -d - -o crushmap-backup.txt</screen>
   </listitem>
   <listitem>
    <para>
     Configuración de Samba Gateway. Si utiliza una única pasarela, realice una copia de seguridad de <filename>/etc/samba/smb.conf</filename>. Si utiliza una configuración de alta disponibilidad, haga una copia de seguridad también de los archivos de configuración de CTDB y Pacemaker. Consulte el <xref linkend="cha-ses-cifs"/> para ver detalles sobre la configuración que se usa en las pasarelas Samba Gateway.
    </para>
   </listitem>
   <listitem>
    <para>
     Configuración de NFS Ganesha. Solo es necesario si se utiliza una configuración de alta disponibilidad. Consulte el <xref linkend="cha-ceph-nfsganesha"/> para ver detalles sobre la configuración que se usa en NFS Ganesha.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
