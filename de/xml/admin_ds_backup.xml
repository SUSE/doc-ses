<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_ds_backup.xml" version="5.0" xml:id="cha-deployment-backup">
 <title>Sichern der Cluster-Konfiguration und -Daten</title>
 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer>tbazant@suse.com</dm:maintainer>
   <dm:status>Bearbeiten</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>Ja</dm:translation>
   <dm:languages/>
   <dm:release>SES 6</dm:release>
  </dm:docmanager>
 </info>
 <para>
  In diesem Kapitel wird erläutert, welche Teile des Ceph-Clusters gesichert werden müssen, damit die Funktion des Clusters wieder hergestellt werden kann.
 </para>
 <sect1 xml:id="backup-ceph">
  <title>Sichern der Ceph-Konfiguration</title>

  <para>
   Sichern Sie das Verzeichnis <filename>/etc/ceph</filename>. Es enthält wichtige Cluster-Konfigurationsdaten. Die <filename>/etc/ceph</filename>-Sicherung ist beispielsweise dann erforderlich, wenn Sie den Admin Node ersetzen müssen.
  </para>
 </sect1>
 <sect1 xml:id="sec-deployment-backup-salt">
  <title>Sichern der Salt-Konfiguration</title>

  <para>
   Sichern Sie das Verzeichnis <filename>/etc/salt/</filename>. Es enthält die Salt-Konfigurationsdateien, beispielsweise den Salt Master-Schlüssel und die akzeptierten Client-Schlüssel.
  </para>

  <para>
   Die Salt-Dateien sind zum Sichern des Admin Node nicht unbedingt erforderlich, doch die erneute Bereitstellung des Salt Clusters wird dadurch einfacher. Wenn diese Dateien nicht gesichert sind, müssen die Salt Minions erneut beim neuen Admin Node registriert werden.
  </para>

  <note>
   <title>Sicherheit des privaten Salt Master-Schlüssels</title>
   <para>
    Vergewissern Sie sich, dass die Sicherungskopien des privaten Salt Master-Schlüssels an einem sicheren Ort verwahrt sind. Mit dem Salt Master-Schlüssel können alle Cluster Nodes manipuliert werden.
   </para>
  </note>

  <para>
   Nach dem Wiederherstellen des Verzeichnisses <filename>/etc/salt</filename> von einer Sicherung starten Sie die Salt Services neu:
  </para>

<screen><prompt>root@master # </prompt><command>systemctl</command> restart salt-master
<prompt>root@master # </prompt><command>systemctl</command> restart salt-minion</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-backup-deepsea">
  <title>Sichern der DeepSea-Konfiguration</title>

  <para>
   Alle für DeepSea erforderlichen Dateien sind unter <filename>/srv/pillar/</filename>, <filename>/srv/salt/</filename> und <filename>/etc/salt/master.d</filename> gespeichert.
  </para>

  <para>
   Wenn Sie den Admin Node erneut bereitstellen müssen, installieren Sie das DeepSea-Paket im neuen Knoten und verschieben Sie die gesicherten Daten in die Verzeichnisse zurück. DeepSea kann dann wieder verwendet werden, ohne dass weitere Änderungen erforderlich sind. Bevor Sie DeepSea wieder verwenden, vergewissern Sie sich, dass alle Salt Minions im Admin Node korrekt registriert sind.
  </para>
 </sect1>
 <sect1 xml:id="backup-config-files">
  <title>Sichern benutzerdefinierter Konfigurationen</title>

  <itemizedlist>
   <listitem>
    <para>
     Prometheus-Daten und -Anpassung.
    </para>
   </listitem>
   <listitem>
    <para>
     Grafana-Anpassung.
    </para>
   </listitem>
   <listitem>
    <para>
     Sie benötigen in jedem Fall Aufzeichnungen der vorhandenen openATTIC-Benutzer, sodass Sie neue Konten für diese Benutzer im Ceph Dashboard erstellen können.
    </para>
   </listitem>
   <listitem>
    <para>
     Manuelle Änderungen an <filename>ceph.conf</filename> außerhalb von DeepSea.
    </para>
   </listitem>
   <listitem>
    <para>
     Manuelle Änderungen an der iSCSI-Konfiguration außerhalb von DeepSea.
    </para>
   </listitem>
   <listitem>
    <para>
     Ceph-Schlüssel.
    </para>
   </listitem>
   <listitem>
    <para>
     CRUSH-Zuordnung und CRUSH-Regeln. Mit folgendem Kommando speichern Sie die dekompilierte CRUSH-Zuordnung zusammen mit den CRUSH-Regeln in <filename>crushmap-backup.txt</filename>:
    </para>
<screen><prompt>cephadm@adm &gt; </prompt>ceph osd getcrushmap | crushtool -d - -o crushmap-backup.txt</screen>
   </listitem>
   <listitem>
    <para>
     Samba Gateway-Konfiguration. Wenn Sie ein einzelnes Gateway nutzen, sichern Sie <filename>/etc/samba/smb.conf</filename>. Wenn Sie mit einer HA-Einrichtung arbeiten, sichern Sie auch die CTDB- und Pacemaker-Konfigurationsdateien. Weitere Informationen zur verwendeten Konfiguration der Samba Gateways finden Sie in <xref linkend="cha-ses-cifs"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     NFS Ganesha-Konfiguration. Nur bei einer HA-Einrichtung erforderlich. Weitere Informationen zur verwendeten Konfiguration von NFS Ganesha finden Sie in <xref linkend="cha-ceph-nfsganesha"/>.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>
